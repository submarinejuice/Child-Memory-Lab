(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js"),require("global/window"),require("global/document")):"function"==typeof define&&define.amd?define(["video.js","global/window","global/document"],t):e.videojsDash=t(e.videojs,e.window,e.document)})(this,function(e,t,n){"use strict";function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function i(e,t){return t={exports:{}},e(t,t.exports),t.exports}function o(t,n){function r(e){return"dash-audio-"+e}function a(e,t){return e.find(function(e){var n=e.index;return r(n)===t.id})}var i=t.dash.mediaPlayer,o=i.getTracksFor("audio"),s=t.audioTracks();s.length&&n.clearTracks(["audio"]);var u=i.getCurrentTrackFor("audio");o.forEach(function(n){var a,i;if(Array.isArray(n.labels))for(var o=0;o<n.labels.length;o++)if(n.labels[o].lang&&-1!==t.language().indexOf(n.labels[o].lang.toLowerCase())){a=n.labels[o];break}a?i=a.text:Array.isArray(n.labels)&&1===n.labels.length?i=n.labels[0].text:(i=n.lang,n.roles&&n.roles.length&&(i+=" ("+n.roles.join(", ")+")")),s.addTrack(new e.AudioTrack({enabled:n===u,id:r(n.index),kind:n.kind||"main",label:i,language:n.lang}))});var l=function(){for(var e=0;e<s.length;e++){var t=s[e];if(t.enabled){var n=a(o,t);i.setCurrentTrack(n)}else;}};s.addEventListener("change",l),t.dash.mediaPlayer.on(_.MediaPlayer.events.STREAM_TEARDOWN_COMPLETE,function(){s.removeEventListener("change",l)})}function u(e,t){e.dash.mediaPlayer.on(_.MediaPlayer.events.PLAYBACK_METADATA_LOADED,o.bind(null,e,t))}function l(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return e[n]}function c(e,t,n){function r(){for(var t=e.dash.mediaPlayer,r=e.textTracks(),i=-1,o=function(e){var t=r[e];if("showing"===t.mode){var o=l(a,function(e){return e.textTrack===t}),s=o?o.dashTrack:null;s&&(i=n.indexOf(s))}},s=0;s<r.length;s+=1)o(s);i!==t.getCurrentTextTrackIndex()&&t.setTextTrack(i)}var a=[],i=n.map(function(t){var n,r;if(Array.isArray(t.labels))for(var a=0;a<t.labels.length;a++)if(t.labels[a].lang&&-1!==e.language().indexOf(t.labels[a].lang.toLowerCase())){n=t.labels[a];break}return r=n?n.text:Array.isArray(t.labels)&&1===t.labels.length?t.labels[0].text:t.lang||t.label,{dashTrack:t,trackConfig:{label:r,language:t.lang,srclang:t.lang,kind:t.kind}}}).map(function(t){var n=t.trackConfig,r=t.dashTrack;if(r.isTTML&&!e.getChild("TTMLTextTrackDisplay"))return null;var i=e.addRemoteTextTrack(n,!1);return a.push({textTrack:i.track,dashTrack:r}),i}).filter(function(e){return null!==e});return e.textTracks().on("change",r),e.dash.mediaPlayer.on(_.MediaPlayer.events.STREAM_TEARDOWN_COMPLETE,function(){e.textTracks().off("change",r)}),r(),i}function f(n,r,a){function i(){s.forEach(n.removeRemoteTextTrack.bind(n)),s=[]}function o(e){e.index;var t=e.tracks;u.off(_.MediaPlayer.events.TEXT_TRACKS_ADDED,o),i(),t.length&&(s=c(n,r,t,a))}t.VTTCue&&!/\[native code\]/.test(t.VTTCue.toString())&&(t.VTTCue=!1);var s=[];if(r.featuresNativeTextTracks)e.log.error("You must pass {html: {nativeCaptions: false}} in the videojs constructor to use text tracks in videojs-contrib-dash");else{var u=n.dash.mediaPlayer;u.on(_.MediaPlayer.events.TEXT_TRACKS_ADDED,o),u.on(_.MediaPlayer.events.CAN_PLAY,function(){u.off(_.MediaPlayer.events.TEXT_TRACKS_ADDED,o)})}}function d(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,h(e,t)}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t,n){try{e.style[t]=n}catch(e){return}}function m(e){for(var t in e.style&&(e.style.left=null,e.style.width="100%"),e.children)m(e.children[t])}function y(e,t){var n;if(4===e.length)n=e[1]+e[1]+e[2]+e[2]+e[3]+e[3];else{if(7!==e.length)throw new Error("Invalid color code provided, "+e+"; must be formatted as e.g. #f0e or #f604e2.");n=e.slice(1)}return"rgba("+parseInt(n.slice(0,2),16)+","+parseInt(n.slice(2,4),16)+","+parseInt(n.slice(4,6),16)+","+t+")"}e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,n=n&&n.hasOwnProperty("default")?n.default:n;var E=i(function(e,t){var n;window,n=function(){return function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var a in e)t.d(r,a,function(t){return e[t]}.bind(null,a));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist/",t(t.s="./index.js")}({"./externals/base64.js":function(e,t,n){var r,i,o,u,l,c={encode:function(e){for(var t=[],n=0;n<e.length;++n){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?(t.push(192|r>>6),t.push(128|63&r)):r<65536?(t.push(224|r>>12),t.push(128|63&r>>6),t.push(128|63&r)):(t.push(240|r>>18),t.push(128|63&r>>12),t.push(128|63&r>>6),t.push(128|63&r))}return t},decode:function(e){for(var t=[],n=0;n<e.length;){var r=e[n++];r<128||(r<224?(r=(31&r)<<6,r|=63&e[n++]):r<240?(r=(15&r)<<12,r|=(63&e[n++])<<6,r|=63&e[n++]):(r=(7&r)<<18,r|=(63&e[n++])<<12,r|=(63&e[n++])<<6,r|=63&e[n++])),t.push(String.fromCharCode(r))}return t.join("")}},f={};r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=function(e){for(var t=0,n=[],a=0|e.length/3;0<a--;){var i=(e[t]<<16)+(e[t+1]<<8)+e[t+2];t+=3,n.push(r.charAt(63&i>>18)),n.push(r.charAt(63&i>>12)),n.push(r.charAt(63&i>>6)),n.push(r.charAt(63&i))}if(2==e.length-t){i=(e[t]<<16)+(e[t+1]<<8);n.push(r.charAt(63&i>>18)),n.push(r.charAt(63&i>>12)),n.push(r.charAt(63&i>>6)),n.push("=")}else if(1==e.length-t){i=e[t]<<16;n.push(r.charAt(63&i>>18)),n.push(r.charAt(63&i>>12)),n.push("==")}return n.join("")},o=function(){for(var e=[],t=0;t<r.length;++t)e[r.charCodeAt(t)]=t;return e["=".charCodeAt(0)]=0,e}(),u=function(e){for(var t=0,n=[],r=0|e.length/4;0<r--;){var a=(o[e.charCodeAt(t)]<<18)+(o[e.charCodeAt(t+1)]<<12)+(o[e.charCodeAt(t+2)]<<6)+o[e.charCodeAt(t+3)];n.push(255&a>>16),n.push(255&a>>8),n.push(255&a),t+=4}return n&&("="==e.charAt(t-2)?(n.pop(),n.pop()):"="==e.charAt(t-1)&&n.pop()),n},l={encode:function(e){for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t},decode:function(e){for(var t=0;t<s.length;++t)a[t]=String.fromCharCode(a[t]);return a.join("")}},f.decodeArray=function(e){var t=u(e);return new Uint8Array(t)},f.encodeASCII=function(e){var t=l.encode(e);return i(t)},f.decodeASCII=function(e){var t=u(e);return l.decode(t)},f.encode=function(e){var t=c.encode(e);return i(t)},f.decode=function(e){var t=u(e);return c.decode(t)},t.decode=f.decode,t.decodeArray=f.decodeArray,t.encode=f.encode,t.encodeASCII=f.encodeASCII},"./externals/cea608-parser.js":function(e,t,n){(function(e){var t={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},n=function(e){var n=e;return t.hasOwnProperty(e)&&(n=t[e]),String.fromCharCode(n)},r=15,a=32,i={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},o={17:2,18:4,21:6,22:8,23:10,19:13,20:15},s={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},u={25:2,26:4,29:6,30:8,31:10,27:13,28:15},l=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],c={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var n=this.verboseFilter[e];this.verboseLevel>=n&&console.log(this.time+" ["+e+"] "+t)}},f=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t},d=function(e,t,n,r,a){this.foreground=e||"white",this.underline=t||!1,this.italics=n||!1,this.background=r||"black",this.flash=a||!1};d.prototype={reset:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},setStyles:function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}},isDefault:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},equals:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},copy:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},toString:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}};var h=function(e,t,n,r,a,i){this.uchar=e||" ",this.penState=new d(t,n,r,a,i)};h.prototype={reset:function(){this.uchar=" ",this.penState.reset()},setChar:function(e,t){this.uchar=e,this.penState.copy(t)},setPenState:function(e){this.penState.copy(e)},equals:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},copy:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},isEmpty:function(){return" "===this.uchar&&this.penState.isDefault()}};var g=function(){this.chars=[];for(var e=0;e<a;e++)this.chars.push(new h);this.pos=0,this.currPenState=new d};g.prototype={equals:function(e){for(var t=!0,n=0;n<a;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t},copy:function(e){for(var t=0;t<a;t++)this.chars[t].copy(e.chars[t])},isEmpty:function(){for(var e=!0,t=0;t<a;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},setCursor:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(c.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>a&&(c.log("ERROR","Too large cursor position "+this.pos),this.pos=a)},moveCursor:function(e){var t=this.pos+e;if(e>1)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)},backSpace:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},insertChar:function(e){e>=144&&this.backSpace();var t=n(e);this.pos>=a?c.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},clearFromPos:function(e){var t;for(t=e;t<a;t++)this.chars[t].reset()},clear:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},clearToEndOfRow:function(){this.clearFromPos(this.pos)},getTextString:function(){for(var e=[],t=!0,n=0;n<a;n++){var r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")},setPenStyles:function(e){this.currPenState.setStyles(e);var t=this.chars[this.pos];t.setPenState(this.currPenState)}};var p=function(){this.rows=[];for(var e=0;e<r;e++)this.rows.push(new g);this.currRow=r-1,this.nrRollUpRows=null,this.reset()};p.prototype={reset:function(){for(var e=0;e<r;e++)this.rows[e].clear();this.currRow=r-1},equals:function(e){for(var t=!0,n=0;n<r;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t},copy:function(e){for(var t=0;t<r;t++)this.rows[t].copy(e.rows[t])},isEmpty:function(){for(var e=!0,t=0;t<r;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},backSpace:function(){var e=this.rows[this.currRow];e.backSpace()},clearToEndOfRow:function(){var e=this.rows[this.currRow];e.clearToEndOfRow()},insertChar:function(e){var t=this.rows[this.currRow];t.insertChar(e)},setPen:function(e){var t=this.rows[this.currRow];t.setPenStyles(e)},moveCursor:function(e){var t=this.rows[this.currRow];t.moveCursor(e)},setCursor:function(e){c.log("INFO","setCursor: "+e);var t=this.rows[this.currRow];t.setCursor(e)},setPAC:function(e){c.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.currRow=t;var n=this.rows[this.currRow];if(null!==e.indent){var r=e.indent,a=Math.max(r-1,0);n.setCursor(e.indent),e.color=n.chars[a].penState.foreground}var i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)},setBkgData:function(e){c.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},setRollUpRows:function(e){this.nrRollUpRows=e},rollUp:function(){if(null!==this.nrRollUpRows){c.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),c.log("INFO","Rolling up")}else c.log("DEBUG","roll_up but nrRollUpRows not set yet")},getDisplayText:function(e){e=e||!1;for(var t=[],n="",a=-1,i=0;i<r;i++){var o=this.rows[i].getTextString();o&&(a=i+1,e?t.push("Row "+a+': "'+o+'"'):t.push(o.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n},getTextAndFormat:function(){return this.rows}};var m=function(e,t){this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new p,this.nonDisplayedMemory=new p,this.lastOutputScreen=new p,this.currRollUpRow=this.displayedMemory.rows[r-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null};m.prototype={modes:["MODE_ROLL-UP","MODE_POP-ON","MODE_PAINT-ON","MODE_TEXT"],reset:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[r-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},getHandler:function(){return this.outputFilter},setHandler:function(e){this.outputFilter=e},setPAC:function(e){this.writeScreen.setPAC(e)},setBkgData:function(e){this.writeScreen.setBkgData(e)},setMode:function(e){e!==this.mode&&(this.mode=e,c.log("INFO","MODE="+e),"MODE_POP-ON"==this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},insertChars:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";c.log("INFO",n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(c.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},cc_RCL:function(){c.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},cc_BS:function(){c.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},cc_AOF:function(){},cc_AON:function(){},cc_DER:function(){c.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},cc_RU:function(e){c.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},cc_FON:function(){c.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},cc_RDC:function(){c.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},cc_TR:function(){c.log("INFO","TR"),this.setMode("MODE_TEXT")},cc_RTD:function(){c.log("INFO","RTD"),this.setMode("MODE_TEXT")},cc_EDM:function(){c.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()},cc_CR:function(){c.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()},cc_ENM:function(){c.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},cc_EOC:function(){if(c.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,c.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()},cc_TO:function(e){c.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},cc_MIDROW:function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var n=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[n]}c.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},outputDataUpdate:function(){var e=c.time;null!==e&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},cueSplitAtTime:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}};var y=function(e,t,n){this.field=e||1,this.outputs=[t,n],this.channels=[new m(1,t),new m(2,n)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}};y.prototype={getHandler:function(e){return this.channels[e].getHandler()},setHandler:function(e,t){this.channels[e].setHandler(t)},addData:function(e,t){var n,r,a,i=!1;this.lastTime=e,c.setTime(e);for(var o=0;o<t.length;o+=2)if(r=127&t[o],a=127&t[o+1],r>=16&&r<=31&&r===this.lastCmdA&&a===this.lastCmdB)this.lastCmdA=null,this.lastCmdB=null,c.log("DEBUG","Repeated command ("+f([r,a])+") is dropped");else if(0!==r||0!==a){if(c.log("DATA","["+f([t[o],t[o+1]])+"] -> ("+f([r,a])+")"),n=this.parseCmd(r,a),n||(n=this.parseMidrow(r,a)),n||(n=this.parsePAC(r,a)),n||(n=this.parseBackgroundAttributes(r,a)),!n&&(i=this.parseChars(r,a),i))if(this.currChNr&&this.currChNr>=0){var s=this.channels[this.currChNr-1];s.insertChars(i)}else c.log("WARNING","No channel found yet. TEXT-MODE?");n?this.dataCounters.cmd+=2:i?this.dataCounters.char+=2:(this.dataCounters.other+=2,c.log("WARNING","Couldn't parse cleaned data "+f([r,a])+" orig: "+f([t[o],t[o+1]])))}else this.dataCounters.padding+=2},parseCmd:function(e,t){var n=null,r=(20===e||21===e||28===e||29===e)&&32<=t&&t<=47,a=(23===e||31===e)&&33<=t&&t<=35;if(!r&&!a)return!1;n=20===e||21===e||23===e?1:2;var i=this.channels[n-1];return 20===e||21===e||28===e||29===e?32===t?i.cc_RCL():33===t?i.cc_BS():34===t?i.cc_AOF():35===t?i.cc_AON():36===t?i.cc_DER():37===t?i.cc_RU(2):38===t?i.cc_RU(3):39===t?i.cc_RU(4):40===t?i.cc_FON():41===t?i.cc_RDC():42===t?i.cc_TR():43===t?i.cc_RTD():44===t?i.cc_EDM():45===t?i.cc_CR():46===t?i.cc_ENM():47===t&&i.cc_EOC():i.cc_TO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0},parseMidrow:function(e,t){var n=null;if((17===e||25===e)&&32<=t&&t<=47){if(n=17===e?1:2,n!==this.currChNr)return c.log("ERROR","Mismatch channel in midrow parsing"),!1;var r=this.channels[n-1];return r.insertChars([32]),r.cc_MIDROW(t),c.log("DEBUG","MIDROW ("+f([e,t])+")"),this.lastCmdA=e,this.lastCmdB=t,!0}return!1},parsePAC:function(e,t){var n=null,r=null,a=(17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127,l=(16===e||24===e)&&64<=t&&t<=95;if(!a&&!l)return!1;n=e<=23?1:2,r=64<=t&&t<=95?1===n?i[e]:s[e]:1===n?o[e]:u[e];var c=this.interpretPAC(r,t),f=this.channels[n-1];return f.setPAC(c),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0},interpretPAC:function(e,t){var n=t,r={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=1==(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r},parseChars:function(e,t){var r=null,a=null,i=null;if(e>=25?(r=2,i=e-8):(r=1,i=e),17<=i&&i<=19){var o=t;o=17===i?t+80:18===i?t+112:t+144,c.log("INFO","Special char '"+n(o)+"' in channel "+r),a=[o],this.lastCmdA=e,this.lastCmdB=t}else 32<=e&&e<=127&&(a=0===t?[e]:[e,t],this.lastCmdA=null,this.lastCmdB=null);if(a){var s=f(a);c.log("DEBUG","Char codes =  "+s.join(","))}return a},parseBackgroundAttributes:function(e,t){var n,r,a,i,o=(16===e||24===e)&&32<=t&&t<=47,s=(23===e||31===e)&&45<=t&&t<=47;return!(!o&&!s)&&(n={},16===e||24===e?(r=Math.floor((t-32)/2),n.background=l[r],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0)),a=e<24?1:2,i=this.channels[a-1],i.setBkgData(n),this.lastCmdA=e,this.lastCmdB=t,!0)},reset:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},cueSplitAtTime:function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}};var E=function(e,t,n){for(var r=0,a=t,i=0,o=[],s=function(e,t,n,r){if(4!==e||t<8)return null;var a=n.getUint8(r),i=n.getUint16(r+1),o=n.getUint32(r+3),s=n.getUint8(r+7);return 181==a&&49==i&&1195456820==o&&3==s};a<t+n;){if(r=e.getUint32(a),i=31&e.getUint8(a+4),6===i)for(var u=a+5,l=-1;u<a+4+r-1;){l=0;for(var c=255;255===c;)c=e.getUint8(u),l+=c,u++;var f=0;for(c=255;255===c;)c=e.getUint8(u),f+=c,u++;s(l,f,e,u)&&o.push([u,f]),u+=f}a+=r+4}return o},_=function(e,t){var n=t[0],r=[[],[]];n+=8;var a=31&e.getUint8(n);n+=2;for(var i=0;i<a;i++){var o=e.getUint8(n),s=4&o,u=3&o;n++;var l=e.getUint8(n);n++;var c=e.getUint8(n);n++,s&&(127&l)+(127&c)!=0&&(0===u?(r[0].push(l),r[0].push(c)):1===u&&(r[1].push(l),r[1].push(c)))}return r};e.logger=c,e.PenState=d,e.CaptionScreen=p,e.Cea608Parser=y,e.findCea608Nalus=E,e.extractCea608DataFromRange=_})(t)},"./externals/xml2json.js":function(e,t,n){function r(e){function t(){void 0===e.escapeMode&&(e.escapeMode=!0),void 0===e.attributePrefix&&(e.attributePrefix="_"),e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",void 0===e.enableToStringFunc&&(e.enableToStringFunc=!0),e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],void 0===e.skipEmptyTextNodesForObj&&(e.skipEmptyTextNodesForObj=!0),void 0===e.stripWhitespaces&&(e.stripWhitespaces=!0),e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[],void 0===e.useDoubleQuotes&&(e.useDoubleQuotes=!1),e.xmlElementsFilter=e.xmlElementsFilter||[],e.jsonPropertiesFilter=e.jsonPropertiesFilter||[],void 0===e.keepCData&&(e.keepCData=!1),void 0===e.ignoreRoot&&(e.ignoreRoot=!1)}function n(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function r(e){return e.prefix}function a(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e}function i(e,t,n,r){for(var a=0;a<e.length;a++){var i=e[a];if("string"==typeof i){if(i==r)break}else if(i instanceof RegExp){if(i.test(r))break}else if("function"==typeof i&&i(t,n,r))break}return a!=e.length}function o(t,n,r){switch(e.arrayAccessForm){case"property":t[n]instanceof Array?t[n+"_asArray"]=t[n]:t[n+"_asArray"]=[t[n]]}!(t[n]instanceof Array)&&e.arrayAccessFormPaths.length>0&&i(e.arrayAccessFormPaths,t,n,r)&&(t[n]=[t[n]])}function s(e){var t=e.split(/[-T:+Z]/g),n=new Date(t[0],t[1]-1,t[2]),r=t[5].split(".");if(n.setHours(t[3],t[4],r[0]),r.length>1&&n.setMilliseconds(r[1]),t[6]&&t[7]){var a=60*t[6]+Number(t[7]),i=/\d\d-\d\d:\d\d$/.test(e)?"-":"+";a=0+("-"==i?-1*a:a),n.setMinutes(n.getMinutes()-a-n.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds())));return n}function u(t,n,r){if(e.datetimeAccessFormPaths.length>0){var a=r.split(".#")[0];return i(e.datetimeAccessFormPaths,t,n,a)?s(t):t}return t}function l(t,n,r,a){return!(n==A.ELEMENT_NODE&&e.xmlElementsFilter.length>0)||i(e.xmlElementsFilter,t,r,a)}function c(t,a){if(t.nodeType==A.DOCUMENT_NODE){for(var i=new Object,s=t.childNodes,f=0;f<s.length;f++){var d=s[f];if(d.nodeType==A.ELEMENT_NODE)if(e.ignoreRoot)i=c(d);else{i={};var h=n(d);i[h]=c(d)}}return i}if(t.nodeType==A.ELEMENT_NODE){i=new Object;i.__cnt=0;var g=[];for(s=t.childNodes,f=0;f<s.length;f++){d=s[f],h=n(d);if(d.nodeType!=A.COMMENT_NODE){var p=a+"."+h;if(l(i,d.nodeType,h,p))if(i.__cnt++,null==i[h]){var m=c(d,p);if("#text"!=h||/[^\s]/.test(m)){var y={};y[h]=m,g.push(y)}i[h]=m,o(i,h,p)}else{null!=i[h]&&(i[h]instanceof Array||(i[h]=[i[h]],o(i,h,p)));m=c(d,p);if("#text"!=h||/[^\s]/.test(m)){y={};y[h]=m,g.push(y)}i[h][i[h].length]=m}}}i.__children=g;for(var E=n(t),_=0;_<t.attributes.length;_++){var v=t.attributes[_];i.__cnt++;for(var T=v.value,S=0,b=e.matchers.length;S<b;S++){var R=e.matchers[S];R.test(v,E)&&(T=R.converter(v.value))}i[e.attributePrefix+v.name]=T}var I=r(t);return null!=I&&""!=I&&(i.__cnt++,i.__prefix=I),null!=i["#text"]&&(i.__text=i["#text"],i.__text instanceof Array&&(i.__text=i.__text.join("\n")),e.stripWhitespaces&&(i.__text=i.__text.trim()),delete i["#text"],"property"==e.arrayAccessForm&&delete i["#text_asArray"],i.__text=u(i.__text,h,a+"."+h)),null!=i["#cdata-section"]&&(i.__cdata=i["#cdata-section"],delete i["#cdata-section"],"property"==e.arrayAccessForm&&delete i["#cdata-section_asArray"]),0==i.__cnt&&"text"==e.emptyNodeForm?i="":1==i.__cnt&&null!=i.__text?i=i.__text:1!=i.__cnt||null==i.__cdata||e.keepCData?i.__cnt>1&&null!=i.__text&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&""==i.__text||""==i.__text.trim())&&delete i.__text:i=i.__cdata,delete i.__cnt,!e.enableToStringFunc||null==i.__text&&null==i.__cdata||(i.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),i}if(t.nodeType==A.TEXT_NODE||t.nodeType==A.CDATA_SECTION_NODE)return t.nodeValue}function f(t,n,r,i){var o="<"+(null!=t&&null!=t.__prefix?t.__prefix+":":"")+n;if(null!=r)for(var s=0;s<r.length;s++){var u=r[s],l=t[u];e.escapeMode&&(l=a(l)),o+=" "+u.substr(e.attributePrefix.length)+"=",e.useDoubleQuotes?o+='"'+l+'"':o+="'"+l+"'"}return o+=i?"/>":">",o}function d(e,t){return"</"+(null!=e.__prefix?e.__prefix+":":"")+t+">"}function h(e,t){return-1!==e.indexOf(t,e.length-t.length)}function g(t,n){return!!("property"==e.arrayAccessForm&&h(n.toString(),"_asArray")||0==n.toString().indexOf(e.attributePrefix)||0==n.toString().indexOf("__")||t[n]instanceof Function)}function p(e){var t=0;if(e instanceof Object)for(var n in e)g(e,n)||t++;return t}function m(t,n,r){return 0==e.jsonPropertiesFilter.length||""==r||i(e.jsonPropertiesFilter,t,n,r)}function y(t){var n=[];if(t instanceof Object)for(var r in t)-1==r.toString().indexOf("__")&&0==r.toString().indexOf(e.attributePrefix)&&n.push(r);return n}function E(t){var n="";return null!=t.__cdata&&(n+="<![CDATA["+t.__cdata+"]]>"),null!=t.__text&&(e.escapeMode?n+=a(t.__text):n+=t.__text),n}function _(t){var n="";return t instanceof Object?n+=E(t):null!=t&&(e.escapeMode?n+=a(t):n+=t),n}function v(e,t){return""===e?t:e+"."+t}function T(e,t,n,r){var a="";if(0==e.length)a+=f(e,t,n,!0);else for(var i=0;i<e.length;i++)a+=f(e[i],t,y(e[i]),!1),a+=S(e[i],v(r,t)),a+=d(e[i],t);return a}function S(e,t){var n="",r=p(e);if(r>0)for(var a in e)if(!g(e,a)&&(""==t||m(e,a,v(t,a)))){var i=e[a],o=y(i);if(null==i||null==i)n+=f(i,a,o,!0);else if(i instanceof Object)if(i instanceof Array)n+=T(i,a,o,t);else if(i instanceof Date)n+=f(i,a,o,!1),n+=i.toISOString(),n+=d(i,a);else{var s=p(i);s>0||null!=i.__text||null!=i.__cdata?(n+=f(i,a,o,!1),n+=S(i,v(t,a)),n+=d(i,a)):n+=f(i,a,o,!0)}else n+=f(i,a,o,!1),n+=_(i),n+=d(i,a)}return n+=_(e),n}var b="1.2.0";e=e||{},t();var A={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(e){var t;window.ActiveXObject||window;if(void 0===e)return null;if(window.DOMParser){var n=new window.DOMParser;try{t=n.parseFromString(e,"text/xml"),t.getElementsByTagNameNS("*","parsererror").length>0&&(t=null)}catch(e){t=null}}else 0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e);return t},this.asArray=function(e){return void 0===e||null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?s(e):e},this.xml2json=function(e){return c(e)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return null!=t?this.xml2json(t):null},this.json2xml_str=function(e){return S(e,"")},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return b}}n.r(t),t.default=r},"./index.js":function(e,t,n){n.r(t);var r=n("./index_mediaplayerOnly.js");n.d(t,"MediaPlayer",function(){return r.MediaPlayer});var a=n("./src/streaming/utils/Capabilities.js");n.d(t,"supportsMediaSource",function(){return a.supportsMediaSource});var i=n("./src/streaming/metrics/MetricsReporting.js");n.d(t,"MetricsReporting",function(){return i.default});var o=n("./src/streaming/protection/Protection.js");n.d(t,"Protection",function(){return o.default});var s=n("./src/streaming/MediaPlayerFactory.js");n.d(t,"MediaPlayerFactory",function(){return s.default});var u=n("./src/core/Debug.js");n.d(t,"Debug",function(){return u.default}),dashjs.Protection=o.default,dashjs.MetricsReporting=i.default,dashjs.MediaPlayerFactory=s.default,dashjs.Debug=u.default,dashjs.supportsMediaSource=a.supportsMediaSource,t.default=dashjs},"./index_mediaplayerOnly.js":function(e,t,n){n.r(t),function(e){var r=n("./src/streaming/MediaPlayer.js");n.d(t,"MediaPlayer",function(){return r.default});var a=n("./src/core/FactoryMaker.js");n.d(t,"FactoryMaker",function(){return a.default});var i=n("./src/core/Debug.js");n.d(t,"Debug",function(){return i.default});var o=n("./src/core/Version.js"),s=(n("./node_modules/es6-promise/auto.js"),"undefined"!=typeof window&&window||e),u=s.dashjs;u||(u=s.dashjs={}),u.MediaPlayer=r.default,u.FactoryMaker=a.default,u.Debug=i.default,u.Version=Object(o.getVersionString)(),t.default=u}.call(this,n("./node_modules/webpack/buildin/global.js"))},"./node_modules/base64-js/index.js":function(e,t,n){function r(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function a(e){var t=r(e),n=t[0],a=t[1];return 3*(n+a)/4-a}function i(e,t,n){return 3*(t+n)/4-n}function o(e){for(var t,n=r(e),a=n[0],o=n[1],s=new d(i(e,a,o)),u=0,l=o>0?a-4:a,c=0;c<l;c+=4)t=f[e.charCodeAt(c)]<<18|f[e.charCodeAt(c+1)]<<12|f[e.charCodeAt(c+2)]<<6|f[e.charCodeAt(c+3)],s[u++]=t>>16&255,s[u++]=t>>8&255,s[u++]=255&t;return 2===o&&(t=f[e.charCodeAt(c)]<<2|f[e.charCodeAt(c+1)]>>4,s[u++]=255&t),1===o&&(t=f[e.charCodeAt(c)]<<10|f[e.charCodeAt(c+1)]<<4|f[e.charCodeAt(c+2)]>>2,s[u++]=t>>8&255,s[u++]=255&t),s}function s(e){return c[e>>18&63]+c[e>>12&63]+c[e>>6&63]+c[63&e]}function u(e,t,n){for(var r,a=[],i=t;i<n;i+=3)r=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]),a.push(s(r));return a.join("")}function l(e){
for(var t,n=e.length,r=n%3,a=[],i=16383,o=0,s=n-r;o<s;o+=i)a.push(u(e,o,o+i>s?s:o+i));return 1===r?(t=e[n-1],a.push(c[t>>2]+c[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],a.push(c[t>>10]+c[t>>4&63]+c[t<<2&63]+"=")),a.join("")}t.byteLength=a,t.toByteArray=o,t.fromByteArray=l;for(var c=[],f=[],d="undefined"!=typeof Uint8Array?Uint8Array:Array,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g=0,p=h.length;g<p;++g)c[g]=h[g],f[h.charCodeAt(g)]=g;f["-".charCodeAt(0)]=62,f["_".charCodeAt(0)]=63},"./node_modules/codem-isoboxer/dist/iso_boxer.js":function(e,t,n){var r={parseBuffer:function(e){return new a(e).parse()},addBoxProcessor:function(e,t){"string"==typeof e&&"function"==typeof t&&(i.prototype._boxProcessors[e]=t)},createFile:function(){return new a},createBox:function(e,t,n){var r=i.create(e);return t&&t.append(r,n),r},createFullBox:function(e,t,n){var a=r.createBox(e,t,n);return a.version=0,a.flags=0,a},Utils:{}};r.Utils.dataViewToString=function(e,t){var n=t||"utf-8";if("undefined"!=typeof TextDecoder)return new TextDecoder(n).decode(e);var r=[],a=0;if("utf-8"===n)for(;a<e.byteLength;){var i=e.getUint8(a++);i<128||(i<224?(i=(31&i)<<6,i|=63&e.getUint8(a++)):i<240?(i=(15&i)<<12,i|=(63&e.getUint8(a++))<<6,i|=63&e.getUint8(a++)):(i=(7&i)<<18,i|=(63&e.getUint8(a++))<<12,i|=(63&e.getUint8(a++))<<6,i|=63&e.getUint8(a++))),r.push(String.fromCharCode(i))}else for(;a<e.byteLength;)r.push(String.fromCharCode(e.getUint8(a++)));return r.join("")},r.Utils.utf8ToByteArray=function(e){var t,n;if("undefined"!=typeof TextEncoder)t=(new TextEncoder).encode(e);else for(t=[],n=0;n<e.length;++n){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?(t.push(192|r>>6),t.push(128|63&r)):r<65536?(t.push(224|r>>12),t.push(128|63&r>>6),t.push(128|63&r)):(t.push(240|r>>18),t.push(128|63&r>>12),t.push(128|63&r>>6),t.push(128|63&r))}return t},r.Utils.appendBox=function(e,t,n){if(t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,-1!==n)if(null!=n){var r,a=-1;if("number"==typeof n)a=n;else{if("string"==typeof n)r=n;else{if("object"!=typeof n||!n.type)return void e.boxes.push(t);r=n.type}for(var i=0;i<e.boxes.length;i++)if(r===e.boxes[i].type){a=i+1;break}}e.boxes.splice(a,0,t)}else e.boxes.push(t)},t.parseBuffer=r.parseBuffer,t.addBoxProcessor=r.addBoxProcessor,t.createFile=r.createFile,t.createBox=r.createBox,t.createFullBox=r.createFullBox,t.Utils=r.Utils,r.Cursor=function(e){this.offset=void 0===e?0:e};var a=function(e){this._cursor=new r.Cursor,this.boxes=[],e&&(this._raw=new DataView(e))};a.prototype.fetch=function(e){var t=this.fetchAll(e,!0);return t.length?t[0]:null},a.prototype.fetchAll=function(e,t){var n=[];return a._sweep.call(this,e,n,t),n},a.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var e=i.parse(this);if(void 0===e.type)break;this.boxes.push(e)}return this},a._sweep=function(e,t,n){for(var r in this.type&&this.type==e&&t.push(this),this.boxes){if(t.length&&n)return;a._sweep.call(this.boxes[r],e,t,n)}},a.prototype.write=function(){var e,t=0;for(e=0;e<this.boxes.length;e++)t+=this.boxes[e].getLength(!1);var n=new Uint8Array(t);for(this._rawo=new DataView(n.buffer),this.bytes=n,this._cursor.offset=0,e=0;e<this.boxes.length;e++)this.boxes[e].write();return n.buffer},a.prototype.append=function(e,t){r.Utils.appendBox(this,e,t)};var i=function(){this._cursor=new r.Cursor};i.parse=function(e){var t=new i;return t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,t._parseBox(),e._cursor.offset=t._raw.byteOffset+t._raw.byteLength,t},i.create=function(e){var t=new i;return t.type=e,t.boxes=[],t},i.prototype._boxContainers=["dinf","edts","mdia","meco","mfra","minf","moof","moov","mvex","stbl","strk","traf","trak","tref","udta","vttc","sinf","schi","encv","enca"],i.prototype._boxProcessors={},i.prototype._procField=function(e,t,n){this._parsing?this[e]=this._readField(t,n):this._writeField(t,n,this[e])},i.prototype._procFieldArray=function(e,t,n,r){var a;if(this._parsing)for(this[e]=[],a=0;a<t;a++)this[e][a]=this._readField(n,r);else for(a=0;a<this[e].length;a++)this._writeField(n,r,this[e][a])},i.prototype._procFullBox=function(){this._procField("version","uint",8),this._procField("flags","uint",24)},i.prototype._procEntries=function(e,t,n){var r;if(this._parsing)for(this[e]=[],r=0;r<t;r++)this[e].push({}),n.call(this,this[e][r]);else for(r=0;r<t;r++)n.call(this,this[e][r])},i.prototype._procSubEntries=function(e,t,n,r){var a;if(this._parsing)for(e[t]=[],a=0;a<n;a++)e[t].push({}),r.call(this,e[t][a]);else for(a=0;a<n;a++)r.call(this,e[t][a])},i.prototype._procEntryField=function(e,t,n,r){this._parsing?e[t]=this._readField(n,r):this._writeField(n,r,e[t])},i.prototype._procSubBoxes=function(e,t){var n;if(this._parsing)for(this[e]=[],n=0;n<t;n++)this[e].push(i.parse(this));else for(n=0;n<t;n++)this._rawo?this[e][n].write():this.size+=this[e][n].getLength()},i.prototype._readField=function(e,t){switch(e){case"uint":return this._readUint(t);case"int":return this._readInt(t);case"template":return this._readTemplate(t);case"string":return-1===t?this._readTerminatedString():this._readString(t);case"data":return this._readData(t);case"utf8":return this._readUTF8String();default:return-1}},i.prototype._readInt=function(e){var t=null,n=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:t=this._raw.getInt8(n);break;case 16:t=this._raw.getInt16(n);break;case 32:t=this._raw.getInt32(n);break;case 64:var r=this._raw.getInt32(n),a=this._raw.getInt32(n+4);t=r*Math.pow(2,32)+a}return this._cursor.offset+=e>>3,t},i.prototype._readUint=function(e){var t,n,r=null,a=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:r=this._raw.getUint8(a);break;case 16:r=this._raw.getUint16(a);break;case 24:t=this._raw.getUint16(a),n=this._raw.getUint8(a+2),r=(t<<8)+n;break;case 32:r=this._raw.getUint32(a);break;case 64:t=this._raw.getUint32(a),n=this._raw.getUint32(a+4),r=t*Math.pow(2,32)+n}return this._cursor.offset+=e>>3,r},i.prototype._readString=function(e){for(var t="",n=0;n<e;n++){var r=this._readUint(8);t+=String.fromCharCode(r)}return t},i.prototype._readTemplate=function(e){var t=this._readUint(e/2),n=this._readUint(e/2);return t+n/Math.pow(2,e/2)},i.prototype._readTerminatedString=function(){for(var e="";this._cursor.offset-this._offset<this._raw.byteLength;){var t=this._readUint(8);if(0===t)break;e+=String.fromCharCode(t)}return e},i.prototype._readData=function(e){var t=e>0?e:this._raw.byteLength-(this._cursor.offset-this._offset);if(t>0){var n=new Uint8Array(this._raw.buffer,this._cursor.offset,t);return this._cursor.offset+=t,n}return null},i.prototype._readUTF8String=function(){var e=this._raw.byteLength-(this._cursor.offset-this._offset),t=null;return e>0&&(t=new DataView(this._raw.buffer,this._cursor.offset,e),this._cursor.offset+=e),t?r.Utils.dataViewToString(t):t},i.prototype._parseBox=function(){if(this._parsing=!0,this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)this._root._incomplete=!0;else{switch(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset,this._raw.byteLength-this._cursor.offset+8);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}this._incomplete||(this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type)?this._parseContainerBox():this._data=this._readData())}},i.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},i.prototype._parseContainerBox=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(i.parse(this))},i.prototype.append=function(e,t){r.Utils.appendBox(this,e,t)},i.prototype.getLength=function(){if(this._parsing=!1,this._rawo=null,this.size=0,this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.size+=this.boxes[e].getLength();return this._data&&this._writeData(this._data),this.size},i.prototype.write=function(){switch(this._parsing=!1,this._cursor.offset=this._parent._cursor.offset,this.size){case 0:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.parent._rawo.byteLength-this._cursor.offset);break;case 1:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.largesize);break;default:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.size)}if(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.boxes[e].write();return this._data&&this._writeData(this._data),this._parent._cursor.offset+=this.size,this.size},i.prototype._writeInt=function(e,t){if(this._rawo){var n=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setInt8(n,t);break;case 16:this._rawo.setInt16(n,t);break;case 32:this._rawo.setInt32(n,t);break;case 64:var r=Math.floor(t/Math.pow(2,32)),a=t-r*Math.pow(2,32);this._rawo.setUint32(n,r),this._rawo.setUint32(n+4,a)}this._cursor.offset+=e>>3}else this.size+=e>>3},i.prototype._writeUint=function(e,t){if(this._rawo){var n,r,a=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setUint8(a,t);break;case 16:this._rawo.setUint16(a,t);break;case 24:n=(16776960&t)>>8,r=255&t,this._rawo.setUint16(a,n),this._rawo.setUint8(a+2,r);break;case 32:this._rawo.setUint32(a,t);break;case 64:n=Math.floor(t/Math.pow(2,32)),r=t-n*Math.pow(2,32),this._rawo.setUint32(a,n),this._rawo.setUint32(a+4,r)}this._cursor.offset+=e>>3}else this.size+=e>>3},i.prototype._writeString=function(e,t){for(var n=0;n<e;n++)this._writeUint(8,t.charCodeAt(n))},i.prototype._writeTerminatedString=function(e){if(0!==e.length){for(var t=0;t<e.length;t++)this._writeUint(8,e.charCodeAt(t));this._writeUint(8,0)}},i.prototype._writeTemplate=function(e,t){var n=Math.floor(t),r=(t-n)*Math.pow(2,e/2);this._writeUint(e/2,n),this._writeUint(e/2,r)},i.prototype._writeData=function(e){if(e)if(this._rawo){if(e instanceof Array){for(var t=this._cursor.offset-this._rawo.byteOffset,n=0;n<e.length;n++)this._rawo.setInt8(t+n,e[n]);this._cursor.offset+=e.length}e instanceof Uint8Array&&(this._root.bytes.set(e,this._cursor.offset),this._cursor.offset+=e.length)}else this.size+=e.length},i.prototype._writeUTF8String=function(e){var t=r.Utils.utf8ToByteArray(e);if(this._rawo)for(var n=new DataView(this._rawo.buffer,this._cursor.offset,t.length),a=0;a<t.length;a++)n.setUint8(a,t[a]);else this.size+=t.length},i.prototype._writeField=function(e,t,n){switch(e){case"uint":this._writeUint(t,n);break;case"int":this._writeInt(t,n);break;case"template":this._writeTemplate(t,n);break;case"string":-1==t?this._writeTerminatedString(n):this._writeString(t,n);break;case"data":this._writeData(n);break;case"utf8":this._writeUTF8String(n)}},i.prototype._boxProcessors.avc1=i.prototype._boxProcessors.encv=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procField("pre_defined1","uint",16),this._procField("reserved2","uint",16),this._procFieldArray("pre_defined2",3,"uint",32),this._procField("width","uint",16),this._procField("height","uint",16),this._procField("horizresolution","template",32),this._procField("vertresolution","template",32),this._procField("reserved3","uint",32),this._procField("frame_count","uint",16),this._procFieldArray("compressorname",32,"uint",8),this._procField("depth","uint",16),this._procField("pre_defined3","int",16),this._procField("config","data",-1)},i.prototype._boxProcessors.dref=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},i.prototype._boxProcessors.elst=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,function(e){this._procEntryField(e,"segment_duration","uint",1===this.version?64:32),this._procEntryField(e,"media_time","int",1===this.version?64:32),this._procEntryField(e,"media_rate_integer","int",16),this._procEntryField(e,"media_rate_fraction","int",16)})},i.prototype._boxProcessors.emsg=function(){this._procFullBox(),1==this.version?(this._procField("timescale","uint",32),this._procField("presentation_time","uint",64),this._procField("event_duration","uint",32),this._procField("id","uint",32),this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1)):(this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1),this._procField("timescale","uint",32),this._procField("presentation_time_delta","uint",32),this._procField("event_duration","uint",32),this._procField("id","uint",32)),this._procField("message_data","data",-1)},i.prototype._boxProcessors.free=i.prototype._boxProcessors.skip=function(){this._procField("data","data",-1)},i.prototype._boxProcessors.frma=function(){this._procField("data_format","uint",32)},i.prototype._boxProcessors.ftyp=i.prototype._boxProcessors.styp=function(){this._procField("major_brand","string",4),this._procField("minor_version","uint",32);var e=-1;this._parsing&&(e=(this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset))/4),this._procFieldArray("compatible_brands",e,"string",4)},i.prototype._boxProcessors.hdlr=function(){this._procFullBox(),this._procField("pre_defined","uint",32),this._procField("handler_type","string",4),this._procFieldArray("reserved",3,"uint",32),this._procField("name","string",-1)},i.prototype._boxProcessors.mdat=function(){this._procField("data","data",-1)},i.prototype._boxProcessors.mdhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._parsing||"string"!=typeof this.language||(this.language=this.language.charCodeAt(0)-96<<10|this.language.charCodeAt(1)-96<<5|this.language.charCodeAt(2)-96),this._procField("language","uint",16),this._parsing&&(this.language=String.fromCharCode(96+(this.language>>10&31),96+(this.language>>5&31),96+(31&this.language))),this._procField("pre_defined","uint",16)},i.prototype._boxProcessors.mehd=function(){this._procFullBox(),this._procField("fragment_duration","uint",1==this.version?64:32)},i.prototype._boxProcessors.mfhd=function(){this._procFullBox(),this._procField("sequence_number","uint",32)},i.prototype._boxProcessors.mfro=function(){this._procFullBox(),this._procField("mfra_size","uint",32)},i.prototype._boxProcessors.mp4a=i.prototype._boxProcessors.enca=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procField("channelcount","uint",16),this._procField("samplesize","uint",16),this._procField("pre_defined","uint",16),this._procField("reserved3","uint",16),this._procField("samplerate","template",32),this._procField("esds","data",-1)},i.prototype._boxProcessors.mvhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procField("rate","template",32),this._procField("volume","template",16),this._procField("reserved1","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procFieldArray("matrix",9,"template",32),this._procFieldArray("pre_defined",6,"uint",32),this._procField("next_track_ID","uint",32)},i.prototype._boxProcessors.payl=function(){this._procField("cue_text","utf8")},i.prototype._boxProcessors.pssh=function(){this._procFullBox(),this._procFieldArray("SystemID",16,"uint",8),this._procField("DataSize","uint",32),this._procFieldArray("Data",this.DataSize,"uint",8)},i.prototype._boxProcessors.schm=function(){this._procFullBox(),this._procField("scheme_type","uint",32),this._procField("scheme_version","uint",32),1&this.flags&&this._procField("scheme_uri","string",-1)},i.prototype._boxProcessors.sdtp=function(){this._procFullBox();var e=-1;this._parsing&&(e=this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset)),this._procFieldArray("sample_dependency_table",e,"uint",8)},i.prototype._boxProcessors.sidx=function(){this._procFullBox(),this._procField("reference_ID","uint",32),this._procField("timescale","uint",32),this._procField("earliest_presentation_time","uint",1==this.version?64:32),this._procField("first_offset","uint",1==this.version?64:32),this._procField("reserved","uint",16),this._procField("reference_count","uint",16),this._procEntries("references",this.reference_count,function(e){this._parsing||(e.reference=(1&e.reference_type)<<31,e.reference|=2147483647&e.referenced_size,e.sap=(1&e.starts_with_SAP)<<31,e.sap|=(3&e.SAP_type)<<28,e.sap|=268435455&e.SAP_delta_time),this._procEntryField(e,"reference","uint",32),this._procEntryField(e,"subsegment_duration","uint",32),this._procEntryField(e,"sap","uint",32),this._parsing&&(e.reference_type=e.reference>>31&1,e.referenced_size=2147483647&e.reference,e.starts_with_SAP=e.sap>>31&1,e.SAP_type=e.sap>>28&7,e.SAP_delta_time=268435455&e.sap)})},i.prototype._boxProcessors.smhd=function(){this._procFullBox(),this._procField("balance","uint",16),this._procField("reserved","uint",16)},i.prototype._boxProcessors.ssix=function(){this._procFullBox(),this._procField("subsegment_count","uint",32),this._procEntries("subsegments",this.subsegment_count,function(e){this._procEntryField(e,"ranges_count","uint",32),this._procSubEntries(e,"ranges",e.ranges_count,function(e){this._procEntryField(e,"level","uint",8),this._procEntryField(e,"range_size","uint",24)})})},i.prototype._boxProcessors.stsd=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},i.prototype._boxProcessors.subs=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,function(e){this._procEntryField(e,"sample_delta","uint",32),this._procEntryField(e,"subsample_count","uint",16),this._procSubEntries(e,"subsamples",e.subsample_count,function(e){this._procEntryField(e,"subsample_size","uint",1===this.version?32:16),this._procEntryField(e,"subsample_priority","uint",8),this._procEntryField(e,"discardable","uint",8),this._procEntryField(e,"codec_specific_parameters","uint",32)})})},i.prototype._boxProcessors.tenc=function(){this._procFullBox(),this._procField("default_IsEncrypted","uint",24),this._procField("default_IV_size","uint",8),this._procFieldArray("default_KID",16,"uint",8)},i.prototype._boxProcessors.tfdt=function(){this._procFullBox(),this._procField("baseMediaDecodeTime","uint",1==this.version?64:32)},i.prototype._boxProcessors.tfhd=function(){this._procFullBox(),this._procField("track_ID","uint",32),1&this.flags&&this._procField("base_data_offset","uint",64),2&this.flags&&this._procField("sample_description_offset","uint",32),8&this.flags&&this._procField("default_sample_duration","uint",32),16&this.flags&&this._procField("default_sample_size","uint",32),32&this.flags&&this._procField("default_sample_flags","uint",32)},i.prototype._boxProcessors.tfra=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._parsing||(this.reserved=0,this.reserved|=(48&this.length_size_of_traf_num)<<4,this.reserved|=(12&this.length_size_of_trun_num)<<2,this.reserved|=3&this.length_size_of_sample_num),this._procField("reserved","uint",32),this._parsing&&(this.length_size_of_traf_num=(48&this.reserved)>>4,this.length_size_of_trun_num=(12&this.reserved)>>2,this.length_size_of_sample_num=3&this.reserved),this._procField("number_of_entry","uint",32),this._procEntries("entries",this.number_of_entry,function(e){this._procEntryField(e,"time","uint",1===this.version?64:32),this._procEntryField(e,"moof_offset","uint",1===this.version?64:32),this._procEntryField(e,"traf_number","uint",8*(this.length_size_of_traf_num+1)),this._procEntryField(e,"trun_number","uint",8*(this.length_size_of_trun_num+1)),this._procEntryField(e,"sample_number","uint",8*(this.length_size_of_sample_num+1))})},i.prototype._boxProcessors.tkhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("track_ID","uint",32),this._procField("reserved1","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procFieldArray("reserved2",2,"uint",32),this._procField("layer","uint",16),this._procField("alternate_group","uint",16),this._procField("volume","template",16),this._procField("reserved3","uint",16),this._procFieldArray("matrix",9,"template",32),this._procField("width","template",32),this._procField("height","template",32)},i.prototype._boxProcessors.trex=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._procField("default_sample_description_index","uint",32),this._procField("default_sample_duration","uint",32),this._procField("default_sample_size","uint",32),this._procField("default_sample_flags","uint",32)},i.prototype._boxProcessors.trun=function(){this._procFullBox(),this._procField("sample_count","uint",32),1&this.flags&&this._procField("data_offset","int",32),4&this.flags&&this._procField("first_sample_flags","uint",32),this._procEntries("samples",this.sample_count,function(e){256&this.flags&&this._procEntryField(e,"sample_duration","uint",32),512&this.flags&&this._procEntryField(e,"sample_size","uint",32),1024&this.flags&&this._procEntryField(e,"sample_flags","uint",32),2048&this.flags&&this._procEntryField(e,"sample_composition_time_offset",1===this.version?"int":"uint",32)})},i.prototype._boxProcessors["url "]=i.prototype._boxProcessors["urn "]=function(){this._procFullBox(),"urn "===this.type&&this._procField("name","string",-1),this._procField("location","string",-1)},i.prototype._boxProcessors.vlab=function(){this._procField("source_label","utf8")},i.prototype._boxProcessors.vmhd=function(){this._procFullBox(),this._procField("graphicsmode","uint",16),this._procFieldArray("opcolor",3,"uint",16)},i.prototype._boxProcessors.vttC=function(){this._procField("config","utf8")},i.prototype._boxProcessors.vtte=function(){}},"./node_modules/core-util-is/lib/util.js":function(e,t,n){(function(e){function n(e){return Array.isArray?Array.isArray(e):"[object Array]"===m(e)}function r(e){return"boolean"==typeof e}function a(e){return null===e}function i(e){return null==e}function o(e){return"number"==typeof e}function s(e){return"string"==typeof e}function u(e){return"symbol"==typeof e}function l(e){return void 0===e}function c(e){return"[object RegExp]"===m(e)}function f(e){return"object"==typeof e&&null!==e}function d(e){return"[object Date]"===m(e)}function h(e){return"[object Error]"===m(e)||e instanceof Error}function g(e){return"function"==typeof e}function p(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function m(e){return Object.prototype.toString.call(e)}t.isArray=n,t.isBoolean=r,t.isNull=a,t.isNullOrUndefined=i,t.isNumber=o,t.isString=s,t.isSymbol=u,t.isUndefined=l,t.isRegExp=c,t.isObject=f,t.isDate=d,t.isError=h,t.isFunction=g,t.isPrimitive=p,t.isBuffer=e.isBuffer}).call(this,n("./node_modules/node-libs-browser/node_modules/buffer/index.js").Buffer)},"./node_modules/es6-promise/auto.js":function(e,t,n){e.exports=n("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},"./node_modules/es6-promise/dist/es6-promise.js":function(e,t,n){(function(t,n){var r;r=function(){function e(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function r(e){return"function"==typeof e}function a(e){q=e}function i(e){Y=e}function o(){return function(){return t.nextTick(f)}}function s(){return void 0!==H?function(){H(f)}:c()}function u(){var e=0,t=new W(f),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function l(){var e=new MessageChannel;return e.port1.onmessage=f,function(){return e.port2.postMessage(0)}}function c(){var e=setTimeout;return function(){return e(f,1)}}function f(){for(var e=0;e<G;e+=2){var t=Q[e],n=Q[e+1];t(n),Q[e]=void 0,Q[e+1]=void 0}G=0}function d(){try{var e=Function("return this")().require("vertx");return H=e.runOnLoop||e.runOnContext,s()}catch(e){return c()}}function h(e,t){var n=this,r=new this.constructor(p);void 0===r[$]&&O(r);var a=n._state;if(a){var i=arguments[a-1];Y(function(){return N(a,r,i,n._result)})}else I(n,r,e,t);return r}function g(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(p);return S(n,e),n}function p(){}function m(){return new TypeError("You cannot resolve a promise with itself")}function y(){return new TypeError("A promises callback cannot return that same promise.")}function E(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function _(e,t,n){Y(function(e){var r=!1,a=E(n,t,function(n){r||(r=!0,t!==n?S(e,n):A(e,n))},function(t){r||(r=!0,R(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&a&&(r=!0,R(e,a))},e)}function v(e,t){t._state===ee?A(e,t._result):t._state===te?R(e,t._result):I(t,void 0,function(t){return S(e,t)},function(t){return R(e,t)})}function T(e,t,n){t.constructor===e.constructor&&n===h&&t.constructor.resolve===g?v(e,t):void 0===n?A(e,t):r(n)?_(e,t,n):A(e,t)}function S(t,n){if(t===n)R(t,m());else if(e(n)){var r=void 0;try{r=n.then}catch(e){return void R(t,e)}T(t,n,r)}else A(t,n)}function b(e){e._onerror&&e._onerror(e._result),C(e)}function A(e,t){e._state===Z&&(e._result=t,e._state=ee,0!==e._subscribers.length&&Y(C,e))}function R(e,t){e._state===Z&&(e._state=te,e._result=t,Y(b,e))}function I(e,t,n,r){var a=e._subscribers,i=a.length;e._onerror=null,a[i]=t,a[i+ee]=n,a[i+te]=r,0===i&&e._state&&Y(C,e)}function C(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,a=void 0,i=e._result,o=0;o<t.length;o+=3)r=t[o],a=t[o+n],r?N(n,r,a,i):a(i);e._subscribers.length=0}}function N(e,t,n,a){var i=r(n),o=void 0,s=void 0,u=!0;if(i){try{o=n(a)}catch(e){u=!1,s=e}if(t===o)return void R(t,y())}else o=a;t._state!==Z||(i&&u?S(t,o):!1===u?R(t,s):e===ee?A(t,o):e===te&&R(t,o))}function D(e,t){try{t(function(t){S(e,t)},function(t){R(e,t)})}catch(t){R(e,t)}}function w(){return ne++}function O(e){e[$]=ne++,e._state=void 0,e._result=void 0,e._subscribers=[]}function M(){return new Error("Array Methods must be provided an Array")}function P(e){return new re(this,e).promise}function L(e){var t=this;return U(e)?new t(function(n,r){for(var a=e.length,i=0;i<a;i++)t.resolve(e[i]).then(n,r)}):new t(function(e,t){return t(new TypeError("You must pass an array to race."))})}function F(e){var t=this,n=new t(p);return R(n,e),n}function j(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function x(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function k(){var e=void 0;if(void 0!==n)e=n;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=ae}var B=void 0;B=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var U=B,G=0,H=void 0,q=void 0,Y=function(e,t){Q[G]=e,Q[G+1]=t,G+=2,2===G&&(q?q(f):J())},K="undefined"!=typeof window?window:void 0,V=K||{},W=V.MutationObserver||V.WebKitMutationObserver,z="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),X="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Q=new Array(1e3),J=void 0;J=z?o():W?u():X?l():void 0===K?d():c();var $=Math.random().toString(36).substring(2),Z=void 0,ee=1,te=2,ne=0,re=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(p),this.promise[$]||O(this.promise),U(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?A(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&A(this.promise,this._result))):R(this.promise,M())}return e.prototype._enumerate=function(e){for(var t=0;this._state===Z&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===g){var a=void 0,i=void 0,o=!1;try{a=e.then}catch(e){o=!0,i=e}if(a===h&&e._state!==Z)this._settledAt(e._state,t,e._result);else if("function"!=typeof a)this._remaining--,this._result[t]=e;else if(n===ae){var s=new n(p);o?R(s,i):T(s,e,a),this._willSettleAt(s,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},e.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===Z&&(this._remaining--,e===te?R(r,n):this._result[t]=n),0===this._remaining&&A(r,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;I(e,void 0,function(e){return n._settledAt(ee,t,e)},function(e){return n._settledAt(te,t,e)})},e}(),ae=function(){function e(t){this[$]=w(),this._result=this._state=void 0,this._subscribers=[],p!==t&&("function"!=typeof t&&j(),this instanceof e?D(this,t):x())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var t=this,n=t.constructor;return r(e)?t.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})}):t.then(e,e)},e}();return ae.prototype.then=h,ae.all=P,ae.race=L,ae.resolve=g,ae.reject=F,ae._setScheduler=a,ae._setAsap=i,ae._asap=Y,ae.polyfill=k,ae.Promise=ae,ae},e.exports=r()}).call(this,n("./node_modules/process/browser.js"),n("./node_modules/webpack/buildin/global.js"))},"./node_modules/fast-deep-equal/index.js":function(e,t,n){var r=Array.isArray,a=Object.keys,i=Object.prototype.hasOwnProperty;e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){var o,s,u,l=r(t),c=r(n);if(l&&c){if(s=t.length,s!=n.length)return!1;for(o=s;0!=o--;)if(!e(t[o],n[o]))return!1;return!0}if(l!=c)return!1;var f=t instanceof Date,d=n instanceof Date;if(f!=d)return!1;if(f&&d)return t.getTime()==n.getTime();var h=t instanceof RegExp,g=n instanceof RegExp;if(h!=g)return!1;if(h&&g)return t.toString()==n.toString();var p=a(t);if(s=p.length,s!==a(n).length)return!1;for(o=s;0!=o--;)if(!i.call(n,p[o]))return!1;for(o=s;0!=o--;)if(u=p[o],!e(t[u],n[u]))return!1;return!0}return t!=t&&n!=n}},"./node_modules/ieee754/index.js":function(e,t){t.read=function(e,t,n,r,a){var i,o,s=8*a-r-1,u=(1<<s)-1,l=u>>1,c=-7,f=n?a-1:0,d=n?-1:1,h=e[t+f];for(f+=d,i=h&(1<<-c)-1,h>>=-c,c+=s;c>0;i=256*i+e[t+f],f+=d,c-=8);for(o=i&(1<<-c)-1,i>>=-c,c+=r;c>0;o=256*o+e[t+f],f+=d,c-=8);if(0===i)i=1-l;else{
if(i===u)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,r),i-=l}return(h?-1:1)*o*Math.pow(2,i-r)},t.write=function(e,t,n,r,a,i){var o,s,u,l=8*i-a-1,c=(1<<l)-1,f=c>>1,d=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:i-1,g=r?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),t+=o+f>=1?d/u:d*Math.pow(2,1-f),t*u>=2&&(o++,u/=2),o+f>=c?(s=0,o=c):o+f>=1?(s=(t*u-1)*Math.pow(2,a),o+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,a),o=0));a>=8;e[n+h]=255&s,h+=g,s/=256,a-=8);for(o=o<<a|s,l+=a;l>0;e[n+h]=255&o,h+=g,o/=256,l-=8);e[n+h-g]|=128*p}},"./node_modules/imsc/src/main/js/doc.js":function(e,t,n){(function(e,t,n,r,a){function i(e,t,n,r){var a=r&&"seq"===r.timeContainer,o=0;r&&(o=a&&n?n.end:r.begin),t.begin=t.explicit_begin?t.explicit_begin+o:o;var s=t.begin,u=null;for(var l in t.sets)i(e,t.sets[l],u,t),s="seq"===t.timeContainer?t.sets[l].end:Math.max(s,t.sets[l].end),u=t.sets[l];if("contents"in t)for(var c in t.contents)i(e,t.contents[c],u,t),s="seq"===t.timeContainer?t.contents[c].end:Math.max(s,t.contents[c].end),u=t.contents[c];else s=a?t.begin:Number.POSITIVE_INFINITY;null!==t.explicit_end&&null!==t.explicit_dur?t.end=Math.min(t.begin+t.explicit_dur,o+t.explicit_end):null===t.explicit_end&&null!==t.explicit_dur?t.end=t.begin+t.explicit_dur:null!==t.explicit_end&&null===t.explicit_dur?t.end=o+t.explicit_end:t.end=s,delete t.explicit_begin,delete t.explicit_dur,delete t.explicit_end,e._registerEvent(t)}function o(e){this.node=e}function s(){this.events=[],this.head=null,this.body=null}function u(){this.styling=null,this.layout=null}function l(){this.styles={}}function c(){this.id=null,this.styleAttrs=null,this.styleRefs=null}function f(){this.regions={}}function d(e){this.kind=e}function h(e){this.id=e}function g(e){this.regionID=e}function p(e){this.styleAttrs=e}function m(e){this.sets=e}function y(e){this.contents=e}function E(e,t,n){this.explicit_begin=e,this.explicit_end=t,this.explicit_dur=n}function _(){d.call(this,"body")}function v(){d.call(this,"div")}function T(){d.call(this,"p")}function S(){d.call(this,"span")}function b(){d.call(this,"span")}function A(){d.call(this,"br")}function R(){}function I(){}function C(e){return e&&"xml:id"in e.attributes&&e.attributes["xml:id"].value||null}function N(e){return e&&"region"in e.attributes?e.attributes.region.value:""}function D(e,t){var n=e&&"timeContainer"in e.attributes?e.attributes.timeContainer.value:null;return n&&"par"!==n?"seq"===n?"seq":(q(t,"Illegal value of timeContainer (assuming 'par')"),"par"):"par"}function w(e){return e&&"style"in e.attributes?e.attributes.style.value.split(" "):[]}function O(e,t){var n={};if(null!==e)for(var a in e.attributes){var i=e.attributes[a].uri+" "+e.attributes[a].local,o=r.byQName[i];if(void 0!==o){var s=o.parse(e.attributes[a].value);null!==s?(n[i]=s,o===r.byName.zIndex&&H(t,"zIndex attribute present but not used by IMSC1 since regions do not overlap")):q(t,"Cannot parse styling attribute "+i+" --> "+e.attributes[a].value)}}return n}function M(e,t,n){for(var r in e.attributes)if(e.attributes[r].uri===t&&e.attributes[r].local===n)return e.attributes[r].value;return null}function P(e,t){var r=M(e,n.ns_ittp,"aspectRatio"),a=null;if(null!==r){var i=/(\d+) (\d+)/,o=i.exec(r);if(null!==o){var s=parseInt(o[1]),u=parseInt(o[2]);0!==s&&0!==u?a=s/u:q(t,"Illegal aspectRatio values (ignoring)")}else q(t,"Malformed aspectRatio attribute (ignoring)")}return a}function L(e,t){var r=M(e,n.ns_ttp,"cellResolution"),a=15,i=32;if(null!==r){var o=/(\d+) (\d+)/,s=o.exec(r);null!==s?(i=parseInt(s[1]),a=parseInt(s[2])):H(t,"Malformed cellResolution value (using initial value instead)")}return{w:i,h:a}}function F(e,t){var r,a=M(e,n.ns_ttp,"frameRate"),i=30;if(null!==a){var o=/(\d+)/;r=o.exec(a),null!==r?i=parseInt(r[1]):H(t,"Malformed frame rate attribute (using initial value instead)")}var s=M(e,n.ns_ttp,"frameRateMultiplier"),u=1;if(null!==s){var l=/(\d+) (\d+)/;r=l.exec(s),null!==r?u=parseInt(r[1])/parseInt(r[2]):H(t,"Malformed frame rate multiplier attribute (using initial value instead)")}var c=u*i,f=1,d=M(e,n.ns_ttp,"tickRate");if(null===d)null!==a&&(f=c);else{var h=/(\d+)/;r=h.exec(d),null!==r?f=parseInt(r[1]):H(t,"Malformed tick rate attribute (using initial value instead)")}return{effectiveFrameRate:c,tickRate:f}}function j(e,t){var r=M(e,n.ns_tts,"extent");if(null===r)return null;var i=r.split(" ");if(2!==i.length)return H(t,"Malformed extent (ignoring)"),null;var o=a.parseLength(i[0]),s=a.parseLength(i[1]);return s&&o?{h:s,w:o}:(H(t,"Malformed extent values (ignoring)"),null)}function x(e,t,n){var r,a=/^(\d{2,}):(\d\d):(\d\d(?:\.\d+)?)$/,i=/^(\d{2,}):(\d\d):(\d\d)\:(\d{2,})$/,o=/^(\d+(?:\.\d+)?)f$/,s=/^(\d+(?:\.\d+)?)t$/,u=/^(\d+(?:\.\d+)?)ms$/,l=/^(\d+(?:\.\d+)?)s$/,c=/^(\d+(?:\.\d+)?)h$/,f=/^(\d+(?:\.\d+)?)m$/,d=null;return null!==(r=o.exec(n))?null!==t&&(d=parseFloat(r[1])/t):null!==(r=s.exec(n))?null!==e&&(d=parseFloat(r[1])/e):null!==(r=u.exec(n))?d=parseFloat(r[1])/1e3:null!==(r=l.exec(n))?d=parseFloat(r[1]):null!==(r=c.exec(n))?d=3600*parseFloat(r[1]):null!==(r=f.exec(n))?d=60*parseFloat(r[1]):null!==(r=a.exec(n))?d=3600*parseInt(r[1])+60*parseInt(r[2])+parseFloat(r[3]):null!==(r=i.exec(n))&&null!==t&&(d=3600*parseInt(r[1])+60*parseInt(r[2])+parseInt(r[3])+(null===r[4]?0:parseInt(r[4])/t)),d}function k(e,t,n,r){var a=null;n&&"begin"in n.attributes&&(a=x(e.tickRate,e.effectiveFrameRate,n.attributes.begin.value),null===a&&H(r,"Malformed begin value "+n.attributes.begin.value+" (using 0)"));var i=null;n&&"dur"in n.attributes&&(i=x(e.tickRate,e.effectiveFrameRate,n.attributes.dur.value),null===i&&H(r,"Malformed dur value "+n.attributes.dur.value+" (ignoring)"));var o=null;return n&&"end"in n.attributes&&(o=x(e.tickRate,e.effectiveFrameRate,n.attributes.end.value),null===o&&H(r,"Malformed end value (ignoring)")),{explicit_begin:a,explicit_end:o,explicit_dur:i}}function B(e,t,n){for(;t.styleRefs.length>0;){var r=t.styleRefs.pop();r in e.styles?(B(e,e.styles[r],n),G(e.styles[r].styleAttrs,t.styleAttrs)):q(n,"Non-existant style id referenced")}}function U(e,t,n,r){for(var a=t.length-1;a>=0;a--){var i=t[a];i in e.styles?G(e.styles[i].styleAttrs,n):q(r,"Non-existant style id referenced")}}function G(e,t){for(var n in e)n in t||(t[n]=e[n])}function H(e,t){if(e&&e.warn&&e.warn(t))throw t}function q(e,t){if(e&&e.error&&e.error(t))throw t}function Y(e,t){throw e&&e.fatal&&e.fatal(t),t}function K(e,t){for(var n,r=0,a=e.length-1;r<=a;){n=Math.floor((r+a)/2);var i=e[n];if(i<t)r=n+1;else{if(!(i>t))return{found:!0,index:n};a=n-1}}return{found:!1,index:r}}e.fromXML=function(e,r,a){var d=t.parser(!0,{xmlns:!0}),h=[],g=[],p=[],m=0,y=null;d.onclosetag=function(e){if(h[0]instanceof l)for(var t in h[0].styles)B(h[0],h[0].styles[t],r);else if(h[0]instanceof T||h[0]instanceof S){if(h[0].contents.length>1){var i,s=[h[0].contents[0]];for(i=1;i<h[0].contents.length;i++)h[0].contents[i]instanceof b&&s[s.length-1]instanceof b?s[s.length-1].text+=h[0].contents[i].text:s.push(h[0].contents[i]);h[0].contents=s}h[0]instanceof S&&1===h[0].contents.length&&h[0].contents[0]instanceof b&&(h[0].text=h[0].contents[0].text,delete h[0].contents)}else h[0]instanceof o&&(h[0].node.uri===n.ns_tt&&"metadata"===h[0].node.local?m--:m>0&&a&&"onCloseTag"in a&&a.onCloseTag());p.shift(),g.shift(),h.shift()},d.ontext=function(e){if(void 0===h[0]);else if(h[0]instanceof S||h[0]instanceof T){var t=new b;t.initFromText(y,h[0],e,p[0],r),h[0].contents.push(t)}else h[0]instanceof o&&m>0&&a&&"onText"in a&&a.onText(e)},d.onopentag=function(e){var t=e.attributes["xml:space"];t?p.unshift(t.value):0===p.length?p.unshift("default"):p.unshift(p[0]);var i=e.attributes["xml:lang"];if(i?g.unshift(i.value):0===g.length?g.unshift(""):g.unshift(g[0]),e.uri===n.ns_tt)if("tt"===e.local)null!==y&&Y(r,"Two <tt> elements at ("+this.line+","+this.column+")"),y=new s,y.initFromNode(e,r),h.unshift(y);else if("head"===e.local)h[0]instanceof s||Y(r,"Parent of <head> element is not <tt> at ("+this.line+","+this.column+")"),null!==y.head&&Y("Second <head> element at ("+this.line+","+this.column+")"),y.head=new u,h.unshift(y.head);else if("styling"===e.local)h[0]instanceof u||Y(r,"Parent of <styling> element is not <head> at ("+this.line+","+this.column+")"),null!==y.head.styling&&Y("Second <styling> element at ("+this.line+","+this.column+")"),y.head.styling=new l,h.unshift(y.head.styling);else if("style"===e.local){var d;h[0]instanceof l?(d=new c,d.initFromNode(e,r),d.id?y.head.styling.styles[d.id]=d:q(r,"<style> element missing @id attribute"),h.unshift(d)):h[0]instanceof R?(d=new c,d.initFromNode(e,r),G(d.styleAttrs,h[0].styleAttrs),h.unshift(d)):Y(r,"Parent of <style> element is not <styling> or <region> at ("+this.line+","+this.column+")")}else if("layout"===e.local)h[0]instanceof u||Y(r,"Parent of <layout> element is not <head> at "+this.line+","+this.column+")"),null!==y.head.layout&&Y(r,"Second <layout> element at "+this.line+","+this.column+")"),y.head.layout=new f,h.unshift(y.head.layout);else if("region"===e.local){h[0]instanceof f||Y(r,"Parent of <region> element is not <layout> at "+this.line+","+this.column+")");var E=new R;E.initFromNode(y,e,r),!E.id||E.id in y.head.layout.regions?q(r,"Ignoring <region> with duplicate or missing @id at "+this.line+","+this.column+")"):y.head.layout.regions[E.id]=E,h.unshift(E)}else if("body"===e.local){h[0]instanceof s||Y(r,"Parent of <body> element is not <tt> at "+this.line+","+this.column+")"),null!==y.body&&Y(r,"Second <body> element at "+this.line+","+this.column+")");var b=new _;b.initFromNode(y,e,r),y.body=b,h.unshift(b)}else if("div"===e.local){h[0]instanceof v||h[0]instanceof _||Y(r,"Parent of <div> element is not <body> or <div> at "+this.line+","+this.column+")");var C=new v;C.initFromNode(y,h[0],e,r),h[0].contents.push(C),h.unshift(C)}else if("p"===e.local){h[0]instanceof v||Y(r,"Parent of <p> element is not <div> at "+this.line+","+this.column+")");var N=new T;N.initFromNode(y,h[0],e,r),h[0].contents.push(N),h.unshift(N)}else if("span"===e.local){h[0]instanceof S||h[0]instanceof T||Y(r,"Parent of <span> element is not <span> or <p> at "+this.line+","+this.column+")");var D=new S;D.initFromNode(y,h[0],e,p[0],r),h[0].contents.push(D),h.unshift(D)}else if("br"===e.local){h[0]instanceof S||h[0]instanceof T||Y(r,"Parent of <br> element is not <span> or <p> at "+this.line+","+this.column+")");var w=new A;w.initFromNode(y,h[0],e,r),h[0].contents.push(w),h.unshift(w)}else if("set"===e.local){h[0]instanceof S||h[0]instanceof T||h[0]instanceof v||h[0]instanceof _||h[0]instanceof R||h[0]instanceof A||Y(r,"Parent of <set> element is not a content element or a region at "+this.line+","+this.column+")");var O=new I;O.initFromNode(y,h[0],e,r),h[0].sets.push(O),h.unshift(O)}else h.unshift(new o(e));else h.unshift(new o(e));if(h[0]instanceof o)if(e.uri===n.ns_tt&&"metadata"===e.local)m++;else if(m>0&&a&&"onOpenTag"in a){var M=[];for(var P in e.attributes)M[e.attributes[P].uri+" "+e.attributes[P].local]={uri:e.attributes[P].uri,local:e.attributes[P].local,value:e.attributes[P].value};a.onOpenTag(e.uri,e.local,M)}},d.write(e).close(),null!==y.head?delete y.head.styling:y.head=new u,null===y.head.layout&&(y.head.layout=new f);var E=!1;for(var C in y.head.layout.regions){E=!0;break}if(!E){var N=R.prototype.createDefaultRegion();y.head.layout.regions[N.id]=N}for(var D in y.head.layout.regions)i(y,y.head.layout.regions[D],null,null);return y.body&&i(y,y.body,null,null),y},s.prototype.initFromNode=function(e,t){this.cellResolution=L(e,t);var r=F(e,t);this.effectiveFrameRate=r.effectiveFrameRate,this.tickRate=r.tickRate,this.aspectRatio=P(e,t);var a=M(e,n.ns_ttp,"timeBase");null!==a&&"media"!==a&&Y(t,"Unsupported time base");var i=j(e,t);null===i?this.pxDimensions={h:480,w:640}:("px"===i.h.unit&&"px"===i.w.unit||Y(t,"Extent on TT must be in px or absent"),this.pxDimensions={h:i.h.value,w:i.w.value})},s.prototype._registerEvent=function(e){if(!(e.end<=e.begin)){var t=K(this.events,e.begin);if(t.found||this.events.splice(t.index,0,e.begin),e.end!==Number.POSITIVE_INFINITY){var n=K(this.events,e.end);n.found||this.events.splice(n.index,0,e.end)}}},s.prototype.getMediaTimeRange=function(){return[this.events[0],this.events[this.events.length-1]]},s.prototype.getMediaTimeEvents=function(){return this.events},c.prototype.initFromNode=function(e,t){this.id=C(e),this.styleAttrs=O(e,t),this.styleRefs=w(e)},h.prototype.initFromNode=function(e,t,n,r){this.id=C(n)},g.prototype.initFromNode=function(e,t,n,r){this.regionID=N(n)},p.prototype.initFromNode=function(e,t,n,r){this.styleAttrs=O(n,r),null!==e.head&&null!==e.head.styling&&U(e.head.styling,w(n),this.styleAttrs,r)},m.prototype.initFromNode=function(e,t,n,r){this.sets=[]},y.prototype.initFromNode=function(e,t,n,r){this.contents=[]},E.prototype.initFromNode=function(e,t,n,r){var a=k(e,t,n,r);this.explicit_begin=a.explicit_begin,this.explicit_end=a.explicit_end,this.explicit_dur=a.explicit_dur,this.timeContainer=D(n,r)},_.prototype.initFromNode=function(e,t,n){p.prototype.initFromNode.call(this,e,null,t,n),E.prototype.initFromNode.call(this,e,null,t,n),m.prototype.initFromNode.call(this,e,null,t,n),g.prototype.initFromNode.call(this,e,null,t,n),y.prototype.initFromNode.call(this,e,null,t,n)},v.prototype.initFromNode=function(e,t,n,r){p.prototype.initFromNode.call(this,e,t,n,r),E.prototype.initFromNode.call(this,e,t,n,r),m.prototype.initFromNode.call(this,e,t,n,r),g.prototype.initFromNode.call(this,e,t,n,r),y.prototype.initFromNode.call(this,e,t,n,r)},T.prototype.initFromNode=function(e,t,n,r){p.prototype.initFromNode.call(this,e,t,n,r),E.prototype.initFromNode.call(this,e,t,n,r),m.prototype.initFromNode.call(this,e,t,n,r),g.prototype.initFromNode.call(this,e,t,n,r),y.prototype.initFromNode.call(this,e,t,n,r)},S.prototype.initFromNode=function(e,t,n,r,a){p.prototype.initFromNode.call(this,e,t,n,a),E.prototype.initFromNode.call(this,e,t,n,a),m.prototype.initFromNode.call(this,e,t,n,a),g.prototype.initFromNode.call(this,e,t,n,a),y.prototype.initFromNode.call(this,e,t,n,a),this.space=r},b.prototype.initFromText=function(e,t,n,r,a){E.prototype.initFromNode.call(this,e,t,null,a),this.text=n,this.space=r},A.prototype.initFromNode=function(e,t,n,r){g.prototype.initFromNode.call(this,e,t,n,r),E.prototype.initFromNode.call(this,e,t,n,r)},R.prototype.createDefaultRegion=function(){var e=new R;return h.call(e,""),p.call(e,{}),m.call(e,[]),E.call(e,0,Number.POSITIVE_INFINITY,null),e},R.prototype.initFromNode=function(e,t,n){h.prototype.initFromNode.call(this,e,null,t,n),p.prototype.initFromNode.call(this,e,null,t,n),E.prototype.initFromNode.call(this,e,null,t,n),m.prototype.initFromNode.call(this,e,null,t,n),null!==e.head&&null!==e.head.styling&&U(e.head.styling,w(t),this.styleAttrs,n)},I.prototype.initFromNode=function(e,t,n,r){E.prototype.initFromNode.call(this,e,t,n,r);var a=O(n,r);for(var i in this.qname=null,this.value=null,a){if(this.qname){q(r,"More than one style specified on set");break}this.qname=i,this.value=a[i]}}})(t,"undefined"==typeof sax?n("./node_modules/sax/lib/sax.js"):sax,"undefined"==typeof imscNames?n("./node_modules/imsc/src/main/js/names.js"):imscNames,"undefined"==typeof imscStyles?n("./node_modules/imsc/src/main/js/styles.js"):imscStyles,"undefined"==typeof imscUtils?n("./node_modules/imsc/src/main/js/utils.js"):imscUtils)},"./node_modules/imsc/src/main/js/html.js":function(e,t,n){(function(e,t,n){function r(e,t,c){var f;if("region"===c.kind?(f=document.createElement("div"),f.style.position="absolute"):"body"===c.kind?f=document.createElement("div"):"div"===c.kind?f=document.createElement("div"):"p"===c.kind?f=document.createElement("p"):"span"===c.kind?f=document.createElement("span"):"br"===c.kind&&(f=document.createElement("br")),f){for(var g in f.style.margin="0",h){var p=h[g],m=c.styleAttrs[p.qname];void 0!==m&&null!==p.map&&p.map(e,f,c,m)}var y=f;if("region"===c.kind){var E=c.styleAttrs[n.byName.writingMode.qname];"lrtb"===E||"lr"===E?(e.ipd="lr",e.bpd="tb"):"rltb"===E||"rl"===E?(e.ipd="rl",e.bpd="tb"):"tblr"===E?(e.ipd="tb",e.bpd="lr"):"tbrl"!==E&&"tb"!==E||(e.ipd="tb",e.bpd="rl")}var _=c.styleAttrs[n.byName.linePadding.qname];if(_&&_>0){var v=Math.ceil(_*e.h)+"px";"tb"===e.bpd?(y.style.paddingLeft=v,y.style.paddingRight=v):(y.style.paddingTop=v,y.style.paddingBottom=v),e.lp=_}var T=c.styleAttrs[n.byName.multiRowAlign.qname];if(T&&"auto"!==T){var S=document.createElement("span");S.style.display="inline-block",S.style.textAlign=T,f.appendChild(S),y=S,e.mra=T}if(c.styleAttrs[n.byName.fillLineGap.qname]&&(e.flg=!0),"span"===c.kind&&c.text)if(e.lp||e.mra||e.flg)for(var b="",A=0;A<c.text.length;A++){b+=c.text.charAt(A);var R=c.text.charCodeAt(A);if(R<55296||R>56319||A===c.text.length){var I=document.createElement("span");I.textContent=b,f.appendChild(I),b=""}}else f.textContent=c.text;for(var C in t.appendChild(f),c.contents)r(e,y,c.contents[C]);var N=[];if((e.lp||e.mra||e.flg)&&"p"===c.kind&&(l(e,y,N,null),e.mra&&(i(N),e.mra=null),e.lp&&(a(N,e.lp*e.h,e),e.lp=null),e.flg)){var D=u(y.getBoundingClientRect(),e);o(N,D.before,D.after,e),e.flg=null}if("region"===c.kind&&(l(e,y,N),"tb"===e.bpd&&e.enableRollUp&&c.contents.length>0&&"after"===c.styleAttrs[n.byName.displayAlign.qname])){var w=""===c.id?"_":c.id,O=new s(w,N);if(e.currentISDState[O.id]=O,e.previousISDState&&O.id in e.previousISDState&&e.previousISDState[O.id].plist.length>0&&O.plist.length>1&&O.plist[O.plist.length-2].text===e.previousISDState[O.id].plist[e.previousISDState[O.id].plist.length-1].text){var M=f.firstElementChild,P=O.plist[O.plist.length-1].after-O.plist[O.plist.length-1].before;M.style.bottom="-"+P+"px",M.style.transition="transform 0.4s",M.style.position="relative",M.style.transform="translateY(-"+P+"px)"}}}else d(e.errorHandler,"Error processing ISD element kind: "+c.kind)}function a(e,t,n){for(var r in e){var a=e[r].elements.length,i=e[r].elements[e[r].start_elem],o=e[r].elements[e[r].end_elem],s=Math.ceil(t)+"px",u="-"+Math.ceil(t)+"px";0!==a&&("lr"===n.ipd?(i.node.style.borderLeftColor=i.bgcolor||"#00000000",i.node.style.borderLeftStyle="solid",i.node.style.borderLeftWidth=s,i.node.style.marginLeft=u):"rl"===n.ipd?(i.node.style.borderRightColor=i.bgcolor||"#00000000",i.node.style.borderRightStyle="solid",i.node.style.borderRightWidth=s,i.node.style.marginRight=u):"tb"===n.ipd&&(i.node.style.borderTopColor=i.bgcolor||"#00000000",i.node.style.borderTopStyle="solid",i.node.style.borderTopWidth=s,i.node.style.marginTop=u),"lr"===n.ipd?(o.node.style.borderRightColor=o.bgcolor||"#00000000",o.node.style.borderRightStyle="solid",o.node.style.borderRightWidth=s,o.node.style.marginRight=u):"rl"===n.ipd?(o.node.style.borderLeftColor=o.bgcolor||"#00000000",o.node.style.borderLeftStyle="solid",o.node.style.borderLeftWidth=s,o.node.style.marginLeft=u):"tb"===n.ipd&&(o.node.style.borderBottomColor=o.bgcolor||"#00000000",o.node.style.borderBottomStyle="solid",o.node.style.borderBottomWidth=s,o.node.style.marginBottom=u))}}function i(e){for(var t=0;t<e.length-1;t++){var n=e[t].elements.length;if(0!==n&&!1===e[t].br){var r=document.createElement("br"),a=e[t].elements[n-1].node;a.parentElement.insertBefore(r,a.nextSibling)}}}function o(e,t,n,r){for(var a=Math.sign(n-t),i=0;i<=e.length;i++){var o,s,u;if(o=0===i?t:i===e.length?n:(e[i].before+e[i-1].after)/2,i>0)for(var l=0;l<e[i-1].elements.length;l++)null!==e[i-1].elements[l].bgcolor&&(u=e[i-1].elements[l],a*(u.after-o)<0&&(s=Math.ceil(Math.abs(o-u.after))+"px",u.node.style.backgroundColor=u.bgcolor,"lr"===r.bpd?u.node.style.paddingRight=s:"rl"===r.bpd?u.node.style.paddingLeft=s:"tb"===r.bpd&&(u.node.style.paddingBottom=s)));if(i<e.length)for(var c=0;c<e[i].elements.length;c++)u=e[i].elements[c],null!==u.bgcolor&&a*(u.before-o)>0&&(s=Math.ceil(Math.abs(u.before-o))+"px",u.node.style.backgroundColor=u.bgcolor,"lr"===r.bpd?u.node.style.paddingLeft=s:"rl"===r.bpd?u.node.style.paddingRight=s:"tb"===r.bpd&&(u.node.style.paddingTop=s))}}function s(e,t){this.id=e,this.plist=t}function u(e,t){var n={before:null,after:null,start:null,end:null};return"tb"===t.bpd?(n.before=e.top,n.after=e.bottom,"lr"===t.ipd?(n.start=e.left,n.end=e.right):(n.start=e.right,n.end=e.left)):"lr"===t.bpd?(n.before=e.left,n.after=e.right,n.start=e.top,n.end=e.bottom):"rl"===t.bpd&&(n.before=e.right,n.after=e.left,n.start=e.top,n.end=e.bottom),n}function l(e,t,n,r){var a=t.style.backgroundColor||r;if(0===t.childElementCount)if("span"===t.localName){var i=t.getBoundingClientRect();if(0===i.height||0===i.width)return;var o=u(i,e);if(0!==n.length&&c(o.before,o.after,n[n.length-1].before,n[n.length-1].after)){var s=Math.sign(o.after-o.before),f=Math.sign(o.end-o.start);s*(o.before-n[n.length-1].before)<0&&(n[n.length-1].before=o.before),s*(o.after-n[n.length-1].after)>0&&(n[n.length-1].after=o.after),f*(o.start-n[n.length-1].start)<0&&(n[n.length-1].start=o.start,n[n.length-1].start_elem=n[n.length-1].elements.length),f*(o.end-n[n.length-1].end)>0&&(n[n.length-1].end=o.end,n[n.length-1].end_elem=n[n.length-1].elements.length)}else n.push({before:o.before,after:o.after,start:o.start,end:o.end,start_elem:0,end_elem:0,elements:[],text:"",br:!1});n[n.length-1].text+=t.textContent,n[n.length-1].elements.push({node:t,bgcolor:a,before:o.before,after:o.after})}else"br"===t.localName&&0!==n.length&&(n[n.length-1].br=!0);else for(var d=t.firstChild;d;)d.nodeType===Node.ELEMENT_NODE&&l(e,d,n,a),d=d.nextSibling}function c(e,t,n,r){return t<r&&e>n||r<=t&&n>=e}function f(e,t){this.qname=e,this.map=t}function d(e,t){if(e&&e.error&&e.error(t))throw t}e.render=function(e,t,n,a,i,o,s,u,l){var c=a||t.clientHeight,f=i||t.clientWidth;if(null!==e.aspectRatio){var d=c*e.aspectRatio;d>f?c=Math.round(f/e.aspectRatio):f=d}var h=document.createElement("div");h.style.position="relative",h.style.width=f+"px",h.style.height=c+"px",h.style.margin="auto",h.style.top=0,h.style.bottom=0,h.style.left=0,h.style.right=0,h.style.zIndex=0;var g={h:c,w:f,regionH:null,regionW:null,imgResolver:n,displayForcedOnlyMode:o||!1,isd:e,errorHandler:s,previousISDState:u,enableRollUp:l||!1,currentISDState:{},flg:null,lp:null,mra:null,ipd:null,bpd:null};for(var p in t.appendChild(h),e.contents)r(g,h,e.contents[p]);return g.currentISDState};var h=[new f("http://www.w3.org/ns/ttml#styling backgroundColor",function(e,t,n,r){0!==r[3]&&(t.style.backgroundColor="rgba("+r[0].toString()+","+r[1].toString()+","+r[2].toString()+","+(r[3]/255).toString()+")")}),new f("http://www.w3.org/ns/ttml#styling color",function(e,t,n,r){t.style.color="rgba("+r[0].toString()+","+r[1].toString()+","+r[2].toString()+","+(r[3]/255).toString()+")"}),new f("http://www.w3.org/ns/ttml#styling direction",function(e,t,n,r){t.style.direction=r}),new f("http://www.w3.org/ns/ttml#styling display",function(e,t,n,r){}),new f("http://www.w3.org/ns/ttml#styling displayAlign",function(e,t,n,r){t.style.display="flex",t.style.flexDirection="column","before"===r?t.style.justifyContent="flex-start":"center"===r?t.style.justifyContent="center":"after"===r&&(t.style.justifyContent="flex-end")}),new f("http://www.w3.org/ns/ttml#styling extent",function(e,t,n,r){e.regionH=r.h*e.h,e.regionW=r.w*e.w;var a=0,i=0,o=n.styleAttrs["http://www.w3.org/ns/ttml#styling padding"];o&&(a=(o[0]+o[2])*e.h,i=(o[1]+o[3])*e.w),t.style.height=e.regionH-a+"px",t.style.width=e.regionW-i+"px"}),new f("http://www.w3.org/ns/ttml#styling fontFamily",function(e,t,n,r){var a=[];for(var i in r)"monospaceSerif"===r[i]?(a.push("Courier New"),a.push('"Liberation Mono"'),a.push("Courier"),a.push("monospace")):"proportionalSansSerif"===r[i]?(a.push("Arial"),a.push("Helvetica"),a.push('"Liberation Sans"'),a.push("sans-serif")):"monospace"===r[i]?a.push("monospace"):"sansSerif"===r[i]?a.push("sans-serif"):"serif"===r[i]?a.push("serif"):"monospaceSansSerif"===r[i]?(a.push("Consolas"),a.push("monospace")):"proportionalSerif"===r[i]?a.push("serif"):a.push(r[i]);t.style.fontFamily=a.join(",")}),new f("http://www.w3.org/ns/ttml#styling fontSize",function(e,t,n,r){t.style.fontSize=r*e.h+"px"}),new f("http://www.w3.org/ns/ttml#styling fontStyle",function(e,t,n,r){t.style.fontStyle=r}),new f("http://www.w3.org/ns/ttml#styling fontWeight",function(e,t,n,r){t.style.fontWeight=r}),new f("http://www.w3.org/ns/ttml#styling lineHeight",function(e,t,n,r){t.style.lineHeight="normal"===r?"normal":r*e.h+"px"}),new f("http://www.w3.org/ns/ttml#styling opacity",function(e,t,n,r){t.style.opacity=r}),new f("http://www.w3.org/ns/ttml#styling origin",function(e,t,n,r){t.style.top=r.h*e.h+"px",t.style.left=r.w*e.w+"px"}),new f("http://www.w3.org/ns/ttml#styling overflow",function(e,t,n,r){t.style.overflow=r}),new f("http://www.w3.org/ns/ttml#styling padding",function(e,t,n,r){var a=[];a[0]=r[0]*e.h+"px",a[1]=r[3]*e.w+"px",a[2]=r[2]*e.h+"px",a[3]=r[1]*e.w+"px",t.style.padding=a.join(" ")}),new f("http://www.w3.org/ns/ttml#styling showBackground",null),new f("http://www.w3.org/ns/ttml#styling textAlign",function(e,t,r,a){var i,o=r.styleAttrs[n.byName.direction.qname];i="start"===a?"rtl"===o?"right":"left":"end"===a?"rtl"===o?"left":"right":a,t.style.textAlign=i}),new f("http://www.w3.org/ns/ttml#styling textDecoration",function(e,t,n,r){t.style.textDecoration=r.join(" ").replace("lineThrough","line-through")}),new f("http://www.w3.org/ns/ttml#styling textOutline",function(e,t,n,r){t.style.textShadow="none"===r?"":"rgba("+r.color[0].toString()+","+r.color[1].toString()+","+r.color[2].toString()+","+(r.color[3]/255).toString()+") 0px 0px "+r.thickness*e.h+"px"}),new f("http://www.w3.org/ns/ttml#styling unicodeBidi",function(e,t,n,r){var a;a="bidiOverride"===r?"bidi-override":r,t.style.unicodeBidi=a}),new f("http://www.w3.org/ns/ttml#styling visibility",function(e,t,n,r){t.style.visibility=r}),new f("http://www.w3.org/ns/ttml#styling wrapOption",function(e,t,n,r){"wrap"===r?"preserve"===n.space?t.style.whiteSpace="pre-wrap":t.style.whiteSpace="normal":"preserve"===n.space?t.style.whiteSpace="pre":t.style.whiteSpace="noWrap"}),new f("http://www.w3.org/ns/ttml#styling writingMode",function(e,t,n,r){"lrtb"===r||"lr"===r?t.style.writingMode="horizontal-tb":"rltb"===r||"rl"===r?t.style.writingMode="horizontal-tb":"tblr"===r?t.style.writingMode="vertical-lr":"tbrl"!==r&&"tb"!==r||(t.style.writingMode="vertical-rl")}),new f("http://www.w3.org/ns/ttml#styling zIndex",function(e,t,n,r){t.style.zIndex=r}),new f("http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt backgroundImage",function(e,t,n,r){if(null!==e.imgResolver&&null!==r){var a=document.createElement("img"),i=e.imgResolver(r,a);i&&(a.src=i),a.height=e.regionH,a.width=e.regionW,t.appendChild(a)}}),new f("http://www.w3.org/ns/ttml/profile/imsc1#styling forcedDisplay",function(e,t,n,r){e.displayForcedOnlyMode&&!1===r&&(t.style.visibility="hidden")})],g={};for(var p in h)g[h[p].qname]=h[p]})(t,"undefined"==typeof imscNames?n("./node_modules/imsc/src/main/js/names.js"):imscNames,"undefined"==typeof imscStyles?n("./node_modules/imsc/src/main/js/styles.js"):imscStyles)},"./node_modules/imsc/src/main/js/isd.js":function(e,t,n){(function(e,t,n){function r(e,t,o,l,c,f,d,h,g){if(t<d.begin||t>=d.end)return null;var p="regionID"in d&&""!==d.regionID?d.regionID:f;if(null!==c&&p!==o.id&&(!("contents"in d)||"contents"in d&&0===d.contents.length||""!==p))return null;var m=new s(d);for(var y in d.sets)t<d.sets[y].begin||t>=d.sets[y].end||(m.styleAttrs[d.sets[y].qname]=d.sets[y].value);var E,_={};for(var v in m.styleAttrs)if(_[v]=!0,v===n.byName.writingMode.qname&&!(n.byName.direction.qname in m.styleAttrs)){var T=m.styleAttrs[v];"lrtb"===T||"lr"===T?m.styleAttrs[n.byName.direction.qname]="ltr":"rltb"!==T&&"rl"!==T||(m.styleAttrs[n.byName.direction.qname]="rtl")}if(null!==c)for(var S in n.all){var b=n.all[S];if(b.qname===n.byName.textDecoration.qname){var A=c.styleAttrs[b.qname],R=m.styleAttrs[b.qname],I=[];void 0===R?I=A:-1===R.indexOf("none")?((-1===R.indexOf("noUnderline")&&-1!==A.indexOf("underline")||-1!==R.indexOf("underline"))&&I.push("underline"),(-1===R.indexOf("noLineThrough")&&-1!==A.indexOf("lineThrough")||-1!==R.indexOf("lineThrough"))&&I.push("lineThrough"),(-1===R.indexOf("noOverline")&&-1!==A.indexOf("overline")||-1!==R.indexOf("overline"))&&I.push("overline")):I.push("none"),m.styleAttrs[b.qname]=I}else b.inherit&&b.qname in c.styleAttrs&&!(b.qname in m.styleAttrs)&&(m.styleAttrs[b.qname]=c.styleAttrs[b.qname])}for(var C in n.all){var N=n.all[C];N.qname in m.styleAttrs||("region"===m.kind||!1===N.inherit&&null!==N.initial)&&(m.styleAttrs[N.qname]=N.parse(N.initial),_[N.qname]=!0)}for(var D in n.all){var w=n.all[D];if(w.qname in _&&null!==w.compute){var O=w.compute(e,c,m,m.styleAttrs[w.qname],g);null!==O?m.styleAttrs[w.qname]=O:u(h,"Style '"+w.qname+"' on element '"+m.kind+"' cannot be computed")}}if("none"===m.styleAttrs[n.byName.display.qname])return null;for(var M in null===c?E=null===l?[]:[l]:"contents"in d&&(E=d.contents),E){var P=r(e,t,o,l,m,p,E[M],h,g);null!==P&&m.contents.push(P.element)}for(var L in m.styleAttrs){var F=n.byQName[L];-1===F.applies.indexOf(m.kind)&&delete m.styleAttrs[L]}if("span"===m.kind&&m.text&&"default"===m.space){var j=m.text.replace(/\s+/g," ");m.text=j}if("p"===m.kind){var x=[];a(m,x);for(var k=0,B="after_br",U=0;;)if("after_br"===B)k>=x.length||"br"===x[k].kind?(B="before_br",U=k,k--):("preserve"!==x[k].space&&(x[k].text=x[k].text.replace(/^\s+/g,"")),x[k].text.length>0?(B="looking_br",k++):x.splice(k,1));else if("before_br"===B)if(k<0||"br"===x[k].kind){if(B="after_br",k=U+1,k>=x.length)break}else if("preserve"!==x[k].space&&(x[k].text=x[k].text.replace(/\s+$/g,"")),x[k].text.length>0){if(B="after_br",k=U+1,k>=x.length)break}else x.splice(k,1),k--;else k>=x.length||"br"===x[k].kind?(B="before_br",U=k,k--):k++;i(m)}return"div"===m.kind&&n.byName.backgroundImage.qname in m.styleAttrs||"br"===m.kind||"contents"in m&&m.contents.length>0||"span"===m.kind&&null!==m.text||"region"===m.kind&&"always"===m.styleAttrs[n.byName.showBackground.qname]?{region_id:p,element:m}:null}function a(e,t){if("contents"in e)for(var n in e.contents)a(e.contents[n],t);else t.push(e)}function i(e){if("br"===e.kind)return!1;if("text"in e)return 0===e.text.length;if("contents"in e){for(var t=e.contents.length;t--;)i(e.contents[t])&&e.contents.splice(t,1);return 0===e.contents.length}}function o(e){this.contents=[],this.aspectRatio=e.aspectRatio}function s(e){for(var t in this.kind=e.kind||"region",e.id&&(this.id=e.id),this.styleAttrs={},e.styleAttrs)this.styleAttrs[t]=e.styleAttrs[t];"text"in e?this.text=e.text:"br"!==e.kind&&(this.contents=[]),"space"in e&&(this.space=e.space)}function u(e,t){if(e&&e.error&&e.error(t))throw t}e.generateISD=function(e,t,n){var a=new o(e),i={};for(var s in e.head.layout.regions){var u=r(e,t,e.head.layout.regions[s],e.body,null,"",e.head.layout.regions[s],n,i);null!==u&&a.contents.push(u.element)}return a}})(t,"undefined"==typeof imscNames?n("./node_modules/imsc/src/main/js/names.js"):imscNames,"undefined"==typeof imscStyles?n("./node_modules/imsc/src/main/js/styles.js"):imscStyles)},"./node_modules/imsc/src/main/js/main.js":function(e,t,n){t.generateISD=n("./node_modules/imsc/src/main/js/isd.js").generateISD,t.fromXML=n("./node_modules/imsc/src/main/js/doc.js").fromXML,t.renderHTML=n("./node_modules/imsc/src/main/js/html.js").render},"./node_modules/imsc/src/main/js/names.js":function(e,t,n){var r;r=t,r.ns_tt="http://www.w3.org/ns/ttml",r.ns_tts="http://www.w3.org/ns/ttml#styling",r.ns_ttp="http://www.w3.org/ns/ttml#parameter",r.ns_xml="http://www.w3.org/XML/1998/namespace",r.ns_itts="http://www.w3.org/ns/ttml/profile/imsc1#styling",r.ns_ittp="http://www.w3.org/ns/ttml/profile/imsc1#parameter",r.ns_smpte="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt",r.ns_ebutts="urn:ebu:tt:style"},"./node_modules/imsc/src/main/js/styles.js":function(e,t,n){(function(e,t,n){function r(e,t,n,r,a,i,o,s){this.name=t,this.ns=e,this.qname=e+" "+t,this.inherit=a,this.animatable=i,this.initial=n,this.applies=r,this.parse=o,
this.compute=s}for(var a in e.all=[new r(t.ns_tts,"backgroundColor","transparent",["body","div","p","region","span"],!1,!0,n.parseColor,null),new r(t.ns_tts,"color","white",["span"],!0,!0,n.parseColor,null),new r(t.ns_tts,"direction","ltr",["p","span"],!0,!0,function(e){return e},null),new r(t.ns_tts,"display","auto",["body","div","p","region","span"],!1,!0,function(e){return e},null),new r(t.ns_tts,"displayAlign","before",["region"],!1,!0,function(e){return e},null),new r(t.ns_tts,"extent","auto",["tt","region"],!1,!0,function(e){if("auto"===e)return e;var t=e.split(" ");if(2!==t.length)return null;var r=n.parseLength(t[0]),a=n.parseLength(t[1]);return a&&r?{h:a,w:r}:null},function(e,t,n,r,a){var i,o;if("auto"===r)i=1;else if("%"===r.h.unit)i=r.h.value/100;else{if("px"!==r.h.unit)return null;i=r.h.value/e.pxDimensions.h}if("auto"===r)o=1;else if("%"===r.w.unit)o=r.w.value/100;else{if("px"!==r.w.unit)return null;o=r.w.value/e.pxDimensions.w}return{h:i,w:o}}),new r(t.ns_tts,"fontFamily","default",["span"],!0,!0,function(e){var t=e.split(","),n=[];for(var r in t)"'"!==t[r].charAt(0)&&'"'!==t[r].charAt(0)&&"default"===t[r]?n.push("monospaceSerif"):n.push(t[r]);return n},null),new r(t.ns_tts,"fontSize","1c",["span"],!0,!0,n.parseLength,function(t,n,r,a,i){var o;if("%"===a.unit)o=null!==n?n.styleAttrs[e.byName.fontSize.qname]*a.value/100:a.value/100/t.cellResolution.h;else if("em"===a.unit)o=null!==n?n.styleAttrs[e.byName.fontSize.qname]*a.value:a.value/t.cellResolution.h;else if("c"===a.unit)o=a.value/t.cellResolution.h;else{if("px"!==a.unit)return null;o=a.value/t.pxDimensions.h}return o}),new r(t.ns_tts,"fontStyle","normal",["span"],!0,!0,function(e){return e},null),new r(t.ns_tts,"fontWeight","normal",["span"],!0,!0,function(e){return e},null),new r(t.ns_tts,"lineHeight","normal",["p"],!0,!0,function(e){return"normal"===e?e:n.parseLength(e)},function(t,n,r,a,i){var o;if("normal"===a)o=a;else if("%"===a.unit)o=r.styleAttrs[e.byName.fontSize.qname]*a.value/100;else if("em"===a.unit)o=r.styleAttrs[e.byName.fontSize.qname]*a.value;else if("c"===a.unit)o=a.value/t.cellResolution.h;else{if("px"!==a.unit)return null;o=a.value/t.pxDimensions.h}return o}),new r(t.ns_tts,"opacity",1,["region"],!1,!0,parseFloat,null),new r(t.ns_tts,"origin","auto",["region"],!1,!0,function(e){if("auto"===e)return e;var t=e.split(" ");if(2!==t.length)return null;var r=n.parseLength(t[0]),a=n.parseLength(t[1]);return a&&r?{h:a,w:r}:null},function(e,t,n,r,a){var i,o;if("auto"===r)i=0;else if("%"===r.h.unit)i=r.h.value/100;else{if("px"!==r.h.unit)return null;i=r.h.value/e.pxDimensions.h}if("auto"===r)o=0;else if("%"===r.w.unit)o=r.w.value/100;else{if("px"!==r.w.unit)return null;o=r.w.value/e.pxDimensions.w}return{h:i,w:o}}),new r(t.ns_tts,"overflow","hidden",["region"],!1,!0,function(e){return e},null),new r(t.ns_tts,"padding","0px",["region"],!1,!0,function(e){var t=e.split(" ");if(t.length>4)return null;var r=[];for(var a in t){var i=n.parseLength(t[a]);if(!i)return null;r.push(i)}return r},function(t,n,r,a,i){var o;if(1===a.length)o=[a[0],a[0],a[0],a[0]];else if(2===a.length)o=[a[0],a[1],a[0],a[1]];else if(3===a.length)o=[a[0],a[1],a[2],a[1]];else{if(4!==a.length)return null;o=[a[0],a[1],a[2],a[3]]}var s=r.styleAttrs[e.byName.writingMode.qname];if("lrtb"===s||"lr"===s)o=[o[0],o[3],o[2],o[1]];else if("rltb"===s||"rl"===s)o=[o[0],o[1],o[2],o[3]];else if("tblr"===s)o=[o[3],o[0],o[1],o[2]];else{if("tbrl"!==s&&"tb"!==s)return null;o=[o[3],o[2],o[1],o[0]]}var u=[];for(var l in o)if(0===o[l].value)u[l]=0;else if("%"===o[l].unit)u[l]="0"===l||"2"===l?r.styleAttrs[e.byName.extent.qname].h*o[l].value/100:r.styleAttrs[e.byName.extent.qname].w*o[l].value/100;else if("em"===o[l].unit)u[l]=r.styleAttrs[e.byName.fontSize.qname]*o[l].value;else if("c"===o[l].unit)u[l]=o[l].value/t.cellResolution.h;else{if("px"!==o[l].unit)return null;u[l]="0"===l||"2"===l?o[l].value/t.pxDimensions.h:o[l].value/t.pxDimensions.w}return u}),new r(t.ns_tts,"showBackground","always",["region"],!1,!0,function(e){return e},null),new r(t.ns_tts,"textAlign","start",["p"],!0,!0,function(e){return e},function(e,t,n,r,a){return"left"===r?"start":"right"===r?"end":r}),new r(t.ns_tts,"textDecoration","none",["span"],!0,!0,function(e){return e.split(" ")},null),new r(t.ns_tts,"textOutline","none",["span"],!0,!0,function(e){if("none"===e)return e;var t={},r=e.split(" ");if(0===r.length||r.length>2)return null;var a=n.parseColor(r[0]);if(t.color=a,null!==a&&r.shift(),1!==r.length)return null;var i=n.parseLength(r[0]);return i?(t.thickness=i,t):null},function(t,n,r,a,i){if("none"===a)return a;var o={};if(null===a.color?o.color=r.styleAttrs[e.byName.color.qname]:o.color=a.color,"%"===a.thickness.unit)o.thickness=r.styleAttrs[e.byName.fontSize.qname]*a.thickness.value/100;else if("em"===a.thickness.unit)o.thickness=r.styleAttrs[e.byName.fontSize.qname]*a.thickness.value;else if("c"===a.thickness.unit)o.thickness=a.thickness.value/t.cellResolution.h;else{if("px"!==a.thickness.unit)return null;o.thickness=a.thickness.value/t.pxDimensions.h}return o}),new r(t.ns_tts,"unicodeBidi","normal",["span","p"],!1,!0,function(e){return e},null),new r(t.ns_tts,"visibility","visible",["body","div","p","region","span"],!0,!0,function(e){return e},null),new r(t.ns_tts,"wrapOption","wrap",["span"],!0,!0,function(e){return e},null),new r(t.ns_tts,"writingMode","lrtb",["region"],!1,!0,function(e){return e},null),new r(t.ns_tts,"zIndex","auto",["region"],!1,!0,function(e){var t;return"auto"===e?t=e:(t=parseInt(e),isNaN(t)&&(t=null)),t},null),new r(t.ns_ebutts,"linePadding","0c",["p"],!0,!1,n.parseLength,function(e,t,n,r,a){return"c"===r.unit?r.value/e.cellResolution.h:null}),new r(t.ns_ebutts,"multiRowAlign","auto",["p"],!0,!1,function(e){return e},null),new r(t.ns_smpte,"backgroundImage",null,["div"],!1,!1,function(e){return e},null),new r(t.ns_itts,"forcedDisplay","false",["body","div","p","region","span"],!0,!0,function(e){return"true"===e},null),new r(t.ns_itts,"fillLineGap","false",["p"],!0,!0,function(e){return"true"===e},null)],e.byQName={},e.all)e.byQName[e.all[a].qname]=e.all[a];for(var i in e.byName={},e.all)e.byName[e.all[i].name]=e.all[i]})(t,"undefined"==typeof imscNames?n("./node_modules/imsc/src/main/js/names.js"):imscNames,"undefined"==typeof imscUtils?n("./node_modules/imsc/src/main/js/utils.js"):imscUtils)},"./node_modules/imsc/src/main/js/utils.js":function(e,t,n){(function(e){var t=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/,n=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,r=/rgba\(\s*(\d+),\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,a={transparent:[0,0,0,0],black:[0,0,0,255],silver:[192,192,192,255],gray:[128,128,128,255],white:[255,255,255,255],maroon:[128,0,0,255],red:[255,0,0,255],purple:[128,0,128,255],fuchsia:[255,0,255,255],magenta:[255,0,255,255],green:[0,128,0,255],lime:[0,255,0,255],olive:[128,128,0,255],yellow:[255,255,0,255],navy:[0,0,128,255],blue:[0,0,255,255],teal:[0,128,128,255],aqua:[0,255,255,255],cyan:[0,255,255,255]};e.parseColor=function(e){var i,o=null,s=a[e.toLowerCase()];return void 0!==s?o=s:null!==(i=t.exec(e))?o=[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16),void 0!==i[4]?parseInt(i[4],16):255]:null!==(i=n.exec(e))?o=[parseInt(i[1]),parseInt(i[2]),parseInt(i[3]),255]:null!==(i=r.exec(e))&&(o=[parseInt(i[1]),parseInt(i[2]),parseInt(i[3]),parseInt(i[4])]),o};var i=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%)$/;e.parseLength=function(e){var t,n=null;return null!==(t=i.exec(e))&&(n={value:parseFloat(t[1]),unit:t[2]}),n}})(t)},"./node_modules/inherits/inherits_browser.js":function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},"./node_modules/isarray/index.js":function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},"./node_modules/node-libs-browser/node_modules/buffer/index.js":function(e,t,n){(function(e){function r(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}function a(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function i(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return o.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=o.prototype):(null===e&&(e=new o(t)),e.length=t),e}function o(e,t,n){if(!(o.TYPED_ARRAY_SUPPORT||this instanceof o))return new o(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return c(this,e)}return s(this,e,t,n)}function s(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?h(e,t,n,r):"string"==typeof t?f(e,t,n):g(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e,t,n,r){return u(t),t<=0?i(e,t):void 0!==n?"string"==typeof r?i(e,t).fill(n,r):i(e,t).fill(n):i(e,t)}function c(e,t){if(u(t),e=i(e,t<0?0:0|p(t)),!o.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!o.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|y(t,n);e=i(e,r);var a=e.write(t,n);return a!==r&&(e=e.slice(0,a)),e}function d(e,t){var n=t.length<0?0:0|p(t.length);e=i(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function h(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),o.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=o.prototype):e=d(e,t),e}function g(e,t){if(o.isBuffer(t)){var n=0|p(t.length);return e=i(e,n),0===e.length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||Q(t.length)?i(e,0):d(e,t);if("Buffer"===t.type&&Z(t.data))return d(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function p(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function m(e){return+e!=e&&(e=0),o.alloc(+e)}function y(e,t){if(o.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return K(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return z(e).length;default:if(r)return K(e).length;t=(""+t).toLowerCase(),r=!0}}function E(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,t>>>=0,n<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,n);case"utf8":case"utf-8":return D(this,t,n);case"ascii":return O(this,t,n);case"latin1":case"binary":return M(this,t,n);case"base64":return N(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function _(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function v(e,t,n,r,a){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=a?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(a)return-1;n=e.length-1}else if(n<0){if(!a)return-1;n=0}if("string"==typeof t&&(t=o.from(t,r)),o.isBuffer(t))return 0===t.length?-1:T(e,t,n,r,a);if("number"==typeof t)return t&=255,o.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):T(e,[t],n,r,a);throw new TypeError("val must be string, number or Buffer")}function T(e,t,n,r,a){function i(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}var o,s=1,u=e.length,l=t.length;if(void 0!==r&&(r=String(r).toLowerCase(),"ucs2"===r||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,u/=2,l/=2,n/=2}if(a){var c=-1;for(o=n;o<u;o++)if(i(e,o)===i(t,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===l)return c*s}else-1!==c&&(o-=o-c),c=-1}else for(n+l>u&&(n=u-l),o=n;o>=0;o--){for(var f=!0,d=0;d<l;d++)if(i(e,o+d)!==i(t,d)){f=!1;break}if(f)return o}return-1}function S(e,t,n,r){n=Number(n)||0;var a=e.length-n;r?(r=Number(r),r>a&&(r=a)):r=a;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");r>i/2&&(r=i/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function b(e,t,n,r){return X(K(t,e.length-n),e,n,r)}function A(e,t,n,r){return X(V(t),e,n,r)}function R(e,t,n,r){return A(e,t,n,r)}function I(e,t,n,r){return X(z(t),e,n,r)}function C(e,t,n,r){return X(W(t,e.length-n),e,n,r)}function N(e,t,n){return 0===t&&n===e.length?J.fromByteArray(e):J.fromByteArray(e.slice(t,n))}function D(e,t,n){n=Math.min(e.length,n);for(var r=[],a=t;a<n;){var i,o,s,u,l=e[a],c=null,f=l>239?4:l>223?3:l>191?2:1;if(a+f<=n)switch(f){case 1:l<128&&(c=l);break;case 2:i=e[a+1],128==(192&i)&&(u=(31&l)<<6|63&i,u>127&&(c=u));break;case 3:i=e[a+1],o=e[a+2],128==(192&i)&&128==(192&o)&&(u=(15&l)<<12|(63&i)<<6|63&o,u>2047&&(u<55296||u>57343)&&(c=u));break;case 4:i=e[a+1],o=e[a+2],s=e[a+3],128==(192&i)&&128==(192&o)&&128==(192&s)&&(u=(15&l)<<18|(63&i)<<12|(63&o)<<6|63&s,u>65535&&u<1114112&&(c=u))}null===c?(c=65533,f=1):c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),a+=f}return w(r)}function w(e){var t=e.length;if(t<=ee)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=ee));return n}function O(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(127&e[a]);return r}function M(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(e[a]);return r}function P(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var a="",i=t;i<n;++i)a+=Y(e[i]);return a}function L(e,t,n){for(var r=e.slice(t,n),a="",i=0;i<r.length;i+=2)a+=String.fromCharCode(r[i]+256*r[i+1]);return a}function F(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function j(e,t,n,r,a,i){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function x(e,t,n,r){t<0&&(t=65535+t+1);for(var a=0,i=Math.min(e.length-n,2);a<i;++a)e[n+a]=(t&255<<8*(r?a:1-a))>>>8*(r?a:1-a)}function k(e,t,n,r){t<0&&(t=4294967295+t+1);for(var a=0,i=Math.min(e.length-n,4);a<i;++a)e[n+a]=t>>>8*(r?a:3-a)&255}function B(e,t,n,r,a,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function U(e,t,n,r,a){return a||B(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),$.write(e,t,n,r,23,4),n+4}function G(e,t,n,r,a){return a||B(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),$.write(e,t,n,r,52,8),n+8}function H(e){if(e=q(e).replace(te,""),e.length<2)return"";for(;e.length%4!=0;)e+="=";return e}function q(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Y(e){return e<16?"0"+e.toString(16):e.toString(16)}function K(e,t){var n;t=t||1/0;for(var r=e.length,a=null,i=[],o=0;o<r;++o){if(n=e.charCodeAt(o),n>55295&&n<57344){if(!a){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&i.push(239,191,189);continue}a=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),a=n;continue}n=65536+(a-55296<<10|n-56320)}else a&&(t-=3)>-1&&i.push(239,191,189);if(a=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function V(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function W(e,t){for(var n,r,a,i=[],o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,a=n%256,i.push(a),i.push(r);return i}function z(e){return J.toByteArray(H(e))}function X(e,t,n,r){for(var a=0;a<r&&!(a+n>=t.length||a>=e.length);++a)t[a+n]=e[a];return a}function Q(e){return e!=e}var J=n("./node_modules/base64-js/index.js"),$=n("./node_modules/ieee754/index.js"),Z=n("./node_modules/isarray/index.js");t.Buffer=o,t.SlowBuffer=m,t.INSPECT_MAX_BYTES=50,o.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:r(),t.kMaxLength=a(),o.poolSize=8192,o._augment=function(e){return e.__proto__=o.prototype,e},o.from=function(e,t,n){return s(null,e,t,n)},o.TYPED_ARRAY_SUPPORT&&(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0})),o.alloc=function(e,t,n){return l(null,e,t,n)},o.allocUnsafe=function(e){return c(null,e)},o.allocUnsafeSlow=function(e){return c(null,e)},o.isBuffer=function(e){return!(null==e||!e._isBuffer)},o.compare=function(e,t){if(!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,a=0,i=Math.min(n,r);a<i;++a)if(e[a]!==t[a]){n=e[a],r=t[a];break}return n<r?-1:r<n?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Z(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=o.allocUnsafe(t),a=0;for(n=0;n<e.length;++n){var i=e[n];if(!o.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(r,a),a+=i.length}return r},o.byteLength=y,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)_(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)_(this,t,t+3),_(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)_(this,t,t+7),_(this,t+1,t+6),_(this,t+2,t+5),_(this,t+3,t+4);return this},o.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?D(this,0,e):E.apply(this,arguments)},o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},o.prototype.compare=function(e,t,n,r,a){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===a&&(a=this.length),t<0||n>e.length||r<0||a>this.length)throw new RangeError("out of range index");if(r>=a&&t>=n)return 0;if(r>=a)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,a>>>=0,this===e)return 0;for(var i=a-r,s=n-t,u=Math.min(i,s),l=this.slice(r,a),c=e.slice(t,n),f=0;f<u;++f)if(l[f]!==c[f]){i=l[f],s=c[f];break}return i<s?-1:s<i?1:0},o.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},o.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},o.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},o.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var a=this.length-t;if((void 0===n||n>a)&&(n=a),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return S(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return A(this,e,t,n);case"latin1":case"binary":return R(this,e,t,n);case"base64":return I(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var ee=4096;o.prototype.slice=function(e,t){var n,r=this.length;if(e=~~e,t=void 0===t?r:~~t,e<0?(e+=r,e<0&&(e=0)):e>r&&(e=r),t<0?(t+=r,t<0&&(t=0)):t>r&&(t=r),t<e&&(t=e),o.TYPED_ARRAY_SUPPORT)n=this.subarray(e,t),n.__proto__=o.prototype;else{var a=t-e;n=new o(a,void 0);for(var i=0;i<a;++i)n[i]=this[i+e]}return n},o.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||F(e,t,this.length);for(var r=this[e],a=1,i=0;++i<t&&(a*=256);)r+=this[e+i]*a;return r},o.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||F(e,t,this.length);for(var r=this[e+--t],a=1;t>0&&(a*=256);)r+=this[e+--t]*a;return r},o.prototype.readUInt8=function(e,t){return t||F(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return t||F(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return t||F(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return t||F(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,t){return t||F(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||F(e,t,this.length);for(var r=this[e],a=1,i=0;++i<t&&(a*=256);)r+=this[e+i]*a;return a*=128,r>=a&&(r-=Math.pow(2,8*t)),r},o.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||F(e,t,this.length);for(var r=t,a=1,i=this[e+--r];r>0&&(a*=256);)i+=this[e+--r]*a;return a*=128,i>=a&&(i-=Math.pow(2,8*t)),i},o.prototype.readInt8=function(e,t){return t||F(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){t||F(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt16BE=function(e,t){t||F(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt32LE=function(e,t){return t||F(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return t||F(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return t||F(e,4,this.length),$.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return t||F(e,4,this.length),$.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return t||F(e,8,this.length),$.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return t||F(e,8,this.length),$.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t|=0,n|=0,!r){var a=Math.pow(2,8*n)-1;j(this,e,t,n,a,0)}var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},o.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t|=0,n|=0,!r){var a=Math.pow(2,8*n)-1;j(this,e,t,n,a,0)}var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},o.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,1,255,0),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):x(this,e,t,!0),t+2},o.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):x(this,e,t,!1),t+2},o.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):k(this,e,t,!0),t+4},o.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):k(this,e,t,!1),t+4},o.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);j(this,e,t,n,a-1,-a)}var i=0,o=1,s=0;for(this[t]=255&e;++i<n&&(o*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+n},o.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);j(this,e,t,n,a-1,-a)}var i=n-1,o=1,s=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+n},o.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,1,127,-128),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):x(this,e,t,!0),t+2},o.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):x(this,e,t,!1),t+2},o.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):k(this,e,t,!0),t+4},o.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):k(this,e,t,!1),t+4},o.prototype.writeFloatLE=function(e,t,n){return U(this,e,t,!0,n)},o.prototype.writeFloatBE=function(e,t,n){return U(this,e,t,!1,n)},o.prototype.writeDoubleLE=function(e,t,n){return G(this,e,t,!0,n)},o.prototype.writeDoubleBE=function(e,t,n){return G(this,e,t,!1,n)},o.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var a,i=r-n;if(this===e&&n<t&&t<r)for(a=i-1;a>=0;--a)e[a+t]=this[a+n];else if(i<1e3||!o.TYPED_ARRAY_SUPPORT)for(a=0;a<i;++a)e[a+t]=this[a+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+i),t);return i},o.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var a=e.charCodeAt(0);a<256&&(e=a)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!o.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var s=o.isBuffer(e)?e:K(new o(e,r).toString()),u=s.length;for(i=0;i<n-t;++i)this[i+t]=s[i%u]}return this};var te=/[^+\/0-9A-Za-z-_]/g}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./node_modules/node-libs-browser/node_modules/events/events.js":function(e,t,n){function r(e){console&&console.warn&&console.warn(e)}function a(){a.init.call(this)}function i(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function o(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function s(e,t,n,a){var s,u,l;if(i(n),u=e._events,void 0===u?(u=e._events=Object.create(null),e._eventsCount=0):(void 0!==u.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),u=e._events),l=u[t]),void 0===l)l=u[t]=n,++e._eventsCount;else if("function"==typeof l?l=u[t]=a?[n,l]:[l,n]:a?l.unshift(n):l.push(n),s=o(e),s>0&&l.length>s&&!l.warned){l.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=l.length,r(c)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},a=u.bind(r);return a.listener=n,r.wrapFn=a,a}function c(e,t,n){var r=e._events;if(void 0===r)return[];var a=r[t];return void 0===a?[]:"function"==typeof a?n?[a.listener||a]:[a]:n?g(a):d(a,a.length)}function f(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function d(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function h(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function g(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function p(e,t){return new Promise(function(n,r){function a(n){e.removeListener(t,i),r(n)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",a),n([].slice.call(arguments))}y(e,t,i,{once:!0}),"error"!==t&&m(e,a,{once:!0})})}function m(e,t,n){"function"==typeof e.on&&y(e,"error",t,n)}function y(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function a(i){r.once&&e.removeEventListener(t,a),n(i)})}}var E,_="object"==typeof Reflect?Reflect:null,v=_&&"function"==typeof _.apply?_.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};E=_&&"function"==typeof _.ownKeys?_.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var T=Number.isNaN||function(e){return e!=e};e.exports=a,e.exports.once=p,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var S=10;Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return S},set:function(e){if("number"!=typeof e||e<0||T(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");S=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||T(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return o(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,a=this._events;if(void 0!==a)r=r&&void 0===a.error;else if(!r)return!1;if(r){var i
;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var o=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw o.context=i,o}var s=a[e];if(void 0===s)return!1;if("function"==typeof s)v(s,this,t);else{var u=s.length,l=d(s,u);for(n=0;n<u;++n)v(l[n],this,t)}return!0},a.prototype.addListener=function(e,t){return s(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return s(this,e,t,!0)},a.prototype.once=function(e,t){return i(t),this.on(e,l(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return i(t),this.prependListener(e,l(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,a,o,s;if(i(t),r=this._events,void 0===r)return this;if(n=r[e],void 0===n)return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(a=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,a=o;break}if(a<0)return this;0===a?n.shift():h(n,a),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(n=this._events,void 0===n)return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var a,i=Object.keys(n);for(r=0;r<i.length;++r)a=i[r],"removeListener"!==a&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],"function"==typeof t)this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return c(this,e,!0)},a.prototype.rawListeners=function(e){return c(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},a.prototype.listenerCount=f,a.prototype.eventNames=function(){return this._eventsCount>0?E(this._events):[]}},"./node_modules/node-libs-browser/node_modules/timers-browserify/main.js":function(e,t,n){(function(e){function r(e,t){this._id=e,this._clearFn=t}var a=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;t.setTimeout=function(){return new r(i.call(setTimeout,a,arguments),clearTimeout)},t.setInterval=function(){return new r(i.call(setInterval,a,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(a,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n("./node_modules/setimmediate/setImmediate.js"),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./node_modules/path-browserify/index.js":function(e,t,n){(function(e){function n(e,t){for(var n=0,r=e.length-1;r>=0;r--){var a=e[r];"."===a?e.splice(r,1):".."===a?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function r(e){"string"!=typeof e&&(e+="");var t,n=0,r=-1,a=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!a){n=t+1;break}}else-1===r&&(a=!1,r=t+1);return-1===r?"":e.slice(n,r)}function a(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}t.resolve=function(){for(var t="",r=!1,i=arguments.length-1;i>=-1&&!r;i--){var o=i>=0?arguments[i]:e.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(t=o+"/"+t,r="/"===o.charAt(0))}return t=n(a(t.split("/"),function(e){return!!e}),!r).join("/"),(r?"/":"")+t||"."},t.normalize=function(e){var r=t.isAbsolute(e),o="/"===i(e,-1);return e=n(a(e.split("/"),function(e){return!!e}),!r).join("/"),e||r||(e="."),e&&o&&(e+="/"),(r?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(a(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},t.relative=function(e,n){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=t.resolve(e).substr(1),n=t.resolve(n).substr(1);for(var a=r(e.split("/")),i=r(n.split("/")),o=Math.min(a.length,i.length),s=o,u=0;u<o;u++)if(a[u]!==i[u]){s=u;break}var l=[];for(u=s;u<a.length;u++)l.push("..");return l=l.concat(i.slice(s)),l.join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,r=-1,a=!0,i=e.length-1;i>=1;--i)if(t=e.charCodeAt(i),47===t){if(!a){r=i;break}}else a=!1;return-1===r?n?"/":".":n&&1===r?"/":e.slice(0,r)},t.basename=function(e,t){var n=r(e);return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},t.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,n=0,r=-1,a=!0,i=0,o=e.length-1;o>=0;--o){var s=e.charCodeAt(o);if(47!==s)-1===r&&(a=!1,r=o+1),46===s?-1===t?t=o:1!==i&&(i=1):-1!==t&&(i=-1);else if(!a){n=o+1;break}}return-1===t||-1===r||0===i||1===i&&t===r-1&&t===n+1?"":e.slice(t,r)};var i="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(this,n("./node_modules/process/browser.js"))},"./node_modules/process-nextick-args/index.js":function(e,t,n){(function(t){function n(e,n,r,a){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var i,o,s=arguments.length;switch(s){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick(function(){e.call(null,n)});case 3:return t.nextTick(function(){e.call(null,n,r)});case 4:return t.nextTick(function(){e.call(null,n,r,a)});default:for(i=new Array(s-1),o=0;o<i.length;)i[o++]=arguments[o];return t.nextTick(function(){e.apply(null,i)})}}!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:n}:e.exports=t}).call(this,n("./node_modules/process/browser.js"))},"./node_modules/process/browser.js":function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function a(e){if(c===setTimeout)return setTimeout(e,0);if((c===n||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function i(e){if(f===clearTimeout)return clearTimeout(e);if((f===r||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function o(){p&&h&&(p=!1,h.length?g=h.concat(g):m=-1,g.length&&s())}function s(){if(!p){var e=a(o);p=!0;for(var t=g.length;t;){for(h=g,g=[];++m<t;)h&&h[m].run();m=-1,t=g.length}h=null,p=!1,i(e)}}function u(e,t){this.fun=e,this.array=t}function l(){}var c,f,d=e.exports={};(function(){try{c="function"==typeof setTimeout?setTimeout:n}catch(e){c=n}try{f="function"==typeof clearTimeout?clearTimeout:r}catch(e){f=r}})();var h,g=[],p=!1,m=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];g.push(new u(e,t)),1!==g.length||p||a(s)},u.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=l,d.addListener=l,d.once=l,d.off=l,d.removeListener=l,d.removeAllListeners=l,d.emit=l,d.prependListener=l,d.prependOnceListener=l,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},"./node_modules/readable-stream/duplex-browser.js":function(e,t,n){e.exports=n("./node_modules/readable-stream/lib/_stream_duplex.js")},"./node_modules/readable-stream/lib/_stream_duplex.js":function(e,t,n){function r(e){if(!(this instanceof r))return new r(e);l.call(this,e),c.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",a)}function a(){this.allowHalfOpen||this._writableState.ended||o.nextTick(i,this)}function i(e){e.end()}var o=n("./node_modules/process-nextick-args/index.js"),s=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=r;var u=n("./node_modules/core-util-is/lib/util.js");u.inherits=n("./node_modules/inherits/inherits_browser.js");var l=n("./node_modules/readable-stream/lib/_stream_readable.js"),c=n("./node_modules/readable-stream/lib/_stream_writable.js");u.inherits(r,l);for(var f=s(c.prototype),d=0;d<f.length;d++){var h=f[d];r.prototype[h]||(r.prototype[h]=c.prototype[h])}Object.defineProperty(r.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(r.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),r.prototype._destroy=function(e,t){this.push(null),this.end(),o.nextTick(t,e)}},"./node_modules/readable-stream/lib/_stream_passthrough.js":function(e,t,n){function r(e){if(!(this instanceof r))return new r(e);a.call(this,e)}e.exports=r;var a=n("./node_modules/readable-stream/lib/_stream_transform.js"),i=n("./node_modules/core-util-is/lib/util.js");i.inherits=n("./node_modules/inherits/inherits_browser.js"),i.inherits(r,a),r.prototype._transform=function(e,t,n){n(null,e)}},"./node_modules/readable-stream/lib/_stream_readable.js":function(e,t,n){(function(t,r){function a(e){return x.from(e)}function i(e){return x.isBuffer(e)||e instanceof k}function o(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?L(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}function s(e,t){P=P||n("./node_modules/readable-stream/lib/_stream_duplex.js"),e=e||{};var r=t instanceof P;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var a=e.highWaterMark,i=e.readableHighWaterMark,o=this.objectMode?16:16384;this.highWaterMark=a||0===a?a:r&&(i||0===i)?i:o,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new q,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(H||(H=n("./node_modules/string_decoder/lib/string_decoder.js").StringDecoder),this.decoder=new H(e.encoding),this.encoding=e.encoding)}function u(e){if(P=P||n("./node_modules/readable-stream/lib/_stream_duplex.js"),!(this instanceof u))return new u(e);this._readableState=new s(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),j.call(this)}function l(e,t,n,r,i){var o,s=e._readableState;null===t?(s.reading=!1,p(e,s)):(i||(o=f(s,t)),o?e.emit("error",o):s.objectMode||t&&t.length>0?("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===x.prototype||(t=a(t)),r?s.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):c(e,s,t,!0):s.ended?e.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!n?(t=s.decoder.write(t),s.objectMode||0!==t.length?c(e,s,t,!1):E(e,s)):c(e,s,t,!1))):r||(s.reading=!1));return d(s)}function c(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&m(e)),E(e,t)}function f(e,t){var n;return i(t)||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function d(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function h(e){return e>=V?e=V:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function g(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=h(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function p(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,m(e)}}function m(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(G("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?M.nextTick(y,e):y(e))}function y(e){G("emit readable"),e.emit("readable"),A(e)}function E(e,t){t.readingMore||(t.readingMore=!0,M.nextTick(_,e,t))}function _(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(G("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function v(e){return function(){var t=e._readableState;G("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&F(e,"data")&&(t.flowing=!0,A(e))}}function T(e){G("readable nexttick read 0"),e.read(0)}function S(e,t){t.resumeScheduled||(t.resumeScheduled=!0,M.nextTick(b,e,t))}function b(e,t){t.reading||(G("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),A(e),t.flowing&&!t.reading&&e.read(0)}function A(e){var t=e._readableState;for(G("flow",t.flowing);t.flowing&&null!==e.read(););}function R(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=I(e,t.buffer,t.decoder),n);var n}function I(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?C(e,t):N(e,t),r}function C(e,t){var n=t.head,r=1,a=n.data;for(e-=a.length;n=n.next;){var i=n.data,o=e>i.length?i.length:e;if(o===i.length?a+=i:a+=i.slice(0,e),e-=o,0===e){o===i.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=i.slice(o));break}++r}return t.length-=r,a}function N(e,t){var n=x.allocUnsafe(e),r=t.head,a=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var i=r.data,o=e>i.length?i.length:e;if(i.copy(n,n.length-e,0,o),e-=o,0===e){o===i.length?(++a,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=i.slice(o));break}++a}return t.length-=a,n}function D(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,M.nextTick(w,t,e))}function w(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function O(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}var M=n("./node_modules/process-nextick-args/index.js");e.exports=u;var P,L=n("./node_modules/isarray/index.js");u.ReadableState=s;n("./node_modules/node-libs-browser/node_modules/events/events.js").EventEmitter;var F=function(e,t){return e.listeners(t).length},j=n("./node_modules/readable-stream/lib/internal/streams/stream-browser.js"),x=n("./node_modules/safe-buffer/index.js").Buffer,k=t.Uint8Array||function(){},B=n("./node_modules/core-util-is/lib/util.js");B.inherits=n("./node_modules/inherits/inherits_browser.js");var U=n(0),G=void 0;G=U&&U.debuglog?U.debuglog("stream"):function(){};var H,q=n("./node_modules/readable-stream/lib/internal/streams/BufferList.js"),Y=n("./node_modules/readable-stream/lib/internal/streams/destroy.js");B.inherits(u,j);var K=["error","close","destroy","pause","resume"];Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),u.prototype.destroy=Y.destroy,u.prototype._undestroy=Y.undestroy,u.prototype._destroy=function(e,t){this.push(null),t(e)},u.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&(t=t||r.defaultEncoding,t!==r.encoding&&(e=x.from(e,t),t=""),n=!0),l(this,e,t,!1,n)},u.prototype.unshift=function(e){return l(this,e,null,!0,!1)},u.prototype.isPaused=function(){return!1===this._readableState.flowing},u.prototype.setEncoding=function(e){return H||(H=n("./node_modules/string_decoder/lib/string_decoder.js").StringDecoder),this._readableState.decoder=new H(e),this._readableState.encoding=e,this};var V=8388608;u.prototype.read=function(e){G("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return G("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?D(this):m(this),null;if(e=g(e,t),0===e&&t.ended)return 0===t.length&&D(this),null;var r,a=t.needReadable;return G("need readable",a),(0===t.length||t.length-e<t.highWaterMark)&&(a=!0,G("length less than watermark",a)),t.ended||t.reading?(a=!1,G("reading or ended",a)):a&&(G("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=g(n,t))),r=e>0?R(e,t):null,null===r?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&D(this)),null!==r&&this.emit("data",r),r},u.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},u.prototype.pipe=function(e,t){function n(e,t){G("onunpipe"),e===d&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,i())}function a(){G("onend"),e.end()}function i(){G("cleanup"),e.removeListener("close",l),e.removeListener("finish",c),e.removeListener("drain",m),e.removeListener("error",u),e.removeListener("unpipe",n),d.removeListener("end",a),d.removeListener("end",f),d.removeListener("data",s),y=!0,!h.awaitDrain||e._writableState&&!e._writableState.needDrain||m()}function s(t){G("ondata"),E=!1;var n=e.write(t);!1!==n||E||((1===h.pipesCount&&h.pipes===e||h.pipesCount>1&&-1!==O(h.pipes,e))&&!y&&(G("false write response, pause",d._readableState.awaitDrain),d._readableState.awaitDrain++,E=!0),d.pause())}function u(t){G("onerror",t),f(),e.removeListener("error",u),0===F(e,"error")&&e.emit("error",t)}function l(){e.removeListener("finish",c),f()}function c(){G("onfinish"),e.removeListener("close",l),f()}function f(){G("unpipe"),d.unpipe(e)}var d=this,h=this._readableState;switch(h.pipesCount){case 0:h.pipes=e;break;case 1:h.pipes=[h.pipes,e];break;default:h.pipes.push(e)}h.pipesCount+=1,G("pipe count=%d opts=%j",h.pipesCount,t);var g=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr,p=g?a:f;h.endEmitted?M.nextTick(p):d.once("end",p),e.on("unpipe",n);var m=v(d);e.on("drain",m);var y=!1,E=!1;return d.on("data",s),o(e,"error",u),e.once("close",l),e.once("finish",c),e.emit("pipe",d),h.flowing||(G("pipe resume"),d.resume()),e},u.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n),this);if(!e){var r=t.pipes,a=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<a;i++)r[i].emit("unpipe",this,n);return this}var o=O(t.pipes,e);return-1===o?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n),this)},u.prototype.on=function(e,t){var n=j.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&m(this):M.nextTick(T,this))}return n},u.prototype.addListener=u.prototype.on,u.prototype.resume=function(){var e=this._readableState;return e.flowing||(G("resume"),e.flowing=!0,S(this,e)),this},u.prototype.pause=function(){return G("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(G("pause"),this._readableState.flowing=!1,this.emit("pause")),this},u.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var a in e.on("end",function(){if(G("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(a){if(G("wrapped data"),n.decoder&&(a=n.decoder.write(a)),(!n.objectMode||null!=a)&&(n.objectMode||a&&a.length)){var i=t.push(a);i||(r=!0,e.pause())}}),e)void 0===this[a]&&"function"==typeof e[a]&&(this[a]=function(t){return function(){return e[t].apply(e,arguments)}}(a));for(var i=0;i<K.length;i++)e.on(K[i],this.emit.bind(this,K[i]));return this._read=function(t){G("wrapped _read",t),r&&(r=!1,e.resume())},this},Object.defineProperty(u.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),u._fromList=R}).call(this,n("./node_modules/webpack/buildin/global.js"),n("./node_modules/process/browser.js"))},"./node_modules/readable-stream/lib/_stream_transform.js":function(e,t,n){function r(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var a=this._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}function a(e){if(!(this instanceof a))return new a(e);s.call(this,e),this._transformState={afterTransform:r.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",i)}function i(){var e=this;"function"==typeof this._flush?this._flush(function(t,n){o(e,t,n)}):o(this,null,null)}function o(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}e.exports=a;var s=n("./node_modules/readable-stream/lib/_stream_duplex.js"),u=n("./node_modules/core-util-is/lib/util.js");u.inherits=n("./node_modules/inherits/inherits_browser.js"),u.inherits(a,s),a.prototype.push=function(e,t){return this._transformState.needTransform=!1,s.prototype.push.call(this,e,t)},a.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},a.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var a=this._readableState;(r.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}},a.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},a.prototype._destroy=function(e,t){var n=this;s.prototype._destroy.call(this,e,function(e){t(e),n.emit("close")})}},"./node_modules/readable-stream/lib/_stream_writable.js":function(e,t,n){(function(t,r,a){function i(e){var t=this;this.next=null,this.entry=null,this.finish=function(){C(t,e)}}function o(e){return F.from(e)}function s(e){return F.isBuffer(e)||e instanceof j}function u(){}function l(e,t){D=D||n("./node_modules/readable-stream/lib/_stream_duplex.js"),e=e||{};var r=t instanceof D;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var a=e.highWaterMark,o=e.writableHighWaterMark,s=this.objectMode?16:16384;this.highWaterMark=a||0===a?a:r&&(o||0===o)?o:s,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var u=!1===e.decodeStrings;this.decodeStrings=!u,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){E(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new i(this)}function c(e){if(D=D||n("./node_modules/readable-stream/lib/_stream_duplex.js"),!(M.call(c,this)||this instanceof D))return new c(e);this._writableState=new l(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),L.call(this)}function f(e,t){var n=new Error("write after end");e.emit("error",n),N.nextTick(t,n)}function d(e,t,n,r){var a=!0,i=!1;return null===n?i=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(i=new TypeError("Invalid non-string/buffer chunk")),i&&(e.emit("error",i),N.nextTick(r,i),a=!1),a}function h(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=F.from(t,n)),t}function g(e,t,n,r,a,i){if(!n){var o=h(t,r,a);r!==o&&(n=!0,a="buffer",r=o)}var s=t.objectMode?1:r.length;t.length+=s;var u=t.length<t.highWaterMark;if(u||(t.needDrain=!0),t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:a,isBuf:n,callback:i,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else p(e,t,!1,s,r,a,i);return u}function p(e,t,n,r,a,i,o){t.writelen=r,t.writecb=o,t.writing=!0,t.sync=!0,n?e._writev(a,t.onwrite):e._write(a,i,t.onwrite),t.sync=!1}function m(e,t,n,r,a){--t.pendingcb,n?(N.nextTick(a,r),N.nextTick(R,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(a(r),e._writableState.errorEmitted=!0,e.emit("error",r),R(e,t))}function y(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function E(e,t){var n=e._writableState,r=n.sync,a=n.writecb;if(y(n),t)m(e,n,r,t,a);else{var i=S(n);i||n.corked||n.bufferProcessing||!n.bufferedRequest||T(e,n),r?w(_,e,n,i,a):_(e,n,i,a)}}function _(e,t,n,r){n||v(e,t),t.pendingcb--,r(),R(e,t)}function v(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function T(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,a=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var s=0,u=!0;n;)a[s]=n,n.isBuf||(u=!1),n=n.next,s+=1;a.allBuffers=u,p(e,t,!0,t.length,a,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new i(t),t.bufferedRequestCount=0}else{for(;n;){var l=n.chunk,c=n.encoding,f=n.callback,d=t.objectMode?1:l.length;if(p(e,t,!1,d,l,c,f),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function S(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function b(e,t){e._final(function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),R(e,t)})}function A(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,N.nextTick(b,e,t)):(t.prefinished=!0,e.emit("prefinish")))}function R(e,t){var n=S(t);return n&&(A(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}function I(e,t,n){t.ending=!0,R(e,t),n&&(t.finished?N.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}function C(e,t,n){var r=e.entry;for(e.entry=null;r;){var a=r.callback;t.pendingcb--,a(n),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}var N=n("./node_modules/process-nextick-args/index.js");e.exports=c;var D,w=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?r:N.nextTick;c.WritableState=l;var O=n("./node_modules/core-util-is/lib/util.js");O.inherits=n("./node_modules/inherits/inherits_browser.js");var M,P={deprecate:n("./node_modules/util-deprecate/browser.js")},L=n("./node_modules/readable-stream/lib/internal/streams/stream-browser.js"),F=n("./node_modules/safe-buffer/index.js").Buffer,j=a.Uint8Array||function(){},x=n("./node_modules/readable-stream/lib/internal/streams/destroy.js");O.inherits(c,L),l.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(l.prototype,"buffer",{get:P.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(M=Function.prototype[Symbol.hasInstance],Object.defineProperty(c,Symbol.hasInstance,{value:function(e){return!!M.call(this,e)||this===c&&(e&&e._writableState instanceof l)}})):M=function(e){return e instanceof this},c.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},c.prototype.write=function(e,t,n){var r=this._writableState,a=!1,i=!r.objectMode&&s(e);return i&&!F.isBuffer(e)&&(e=o(e)),"function"==typeof t&&(n=t,t=null),i?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=u),r.ended?f(this,n):(i||d(this,r,e,n))&&(r.pendingcb++,a=g(this,r,i,e,t,n)),a},c.prototype.cork=function(){var e=this._writableState;e.corked++},c.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||T(this,e))},c.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),c.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},c.prototype._writev=null,c.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||I(this,r,n)},Object.defineProperty(c.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),c.prototype.destroy=x.destroy,c.prototype._undestroy=x.undestroy,c.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,n("./node_modules/process/browser.js"),n("./node_modules/node-libs-browser/node_modules/timers-browserify/main.js").setImmediate,n("./node_modules/webpack/buildin/global.js"))},"./node_modules/readable-stream/lib/internal/streams/BufferList.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t,n){e.copy(t,n)}var i=n("./node_modules/safe-buffer/index.js").Buffer,o=n(1);e.exports=function(){function e(){r(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){
var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return i.alloc(0);if(1===this.length)return this.head.data;for(var t=i.allocUnsafe(e>>>0),n=this.head,r=0;n;)a(n.data,t,r),r+=n.data.length,n=n.next;return t},e}(),o&&o.inspect&&o.inspect.custom&&(e.exports.prototype[o.inspect.custom]=function(){var e=o.inspect({length:this.length});return this.constructor.name+" "+e})},"./node_modules/readable-stream/lib/internal/streams/destroy.js":function(e,t,n){function r(e,t){var n=this,r=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;return r||a?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||o.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(o.nextTick(i,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)}),this)}function a(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function i(e,t){e.emit("error",t)}var o=n("./node_modules/process-nextick-args/index.js");e.exports={destroy:r,undestroy:a}},"./node_modules/readable-stream/lib/internal/streams/stream-browser.js":function(e,t,n){e.exports=n("./node_modules/node-libs-browser/node_modules/events/events.js").EventEmitter},"./node_modules/readable-stream/passthrough.js":function(e,t,n){e.exports=n("./node_modules/readable-stream/readable-browser.js").PassThrough},"./node_modules/readable-stream/readable-browser.js":function(e,t,n){t=e.exports=n("./node_modules/readable-stream/lib/_stream_readable.js"),t.Stream=t,t.Readable=t,t.Writable=n("./node_modules/readable-stream/lib/_stream_writable.js"),t.Duplex=n("./node_modules/readable-stream/lib/_stream_duplex.js"),t.Transform=n("./node_modules/readable-stream/lib/_stream_transform.js"),t.PassThrough=n("./node_modules/readable-stream/lib/_stream_passthrough.js")},"./node_modules/readable-stream/transform.js":function(e,t,n){e.exports=n("./node_modules/readable-stream/readable-browser.js").Transform},"./node_modules/readable-stream/writable-browser.js":function(e,t,n){e.exports=n("./node_modules/readable-stream/lib/_stream_writable.js")},"./node_modules/safe-buffer/index.js":function(e,t,n){function r(e,t){for(var n in e)t[n]=e[n]}function a(e,t,n){return o(e,t,n)}var i=n("./node_modules/node-libs-browser/node_modules/buffer/index.js"),o=i.Buffer;o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?e.exports=i:(r(i,t),t.Buffer=a),r(o,a),a.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return o(e,t,n)},a.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=o(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},"./node_modules/sax/lib/sax.js":function(e,t,n){(function(e){(function(t){function r(e,n){if(!(this instanceof r))return new r(e,n);var a=this;i(a),a.q=a.c="",a.bufferCheckPosition=t.MAX_BUFFER_LENGTH,a.opt=n||{},a.opt.lowercase=a.opt.lowercase||a.opt.lowercasetags,a.looseCase=a.opt.lowercase?"toLowerCase":"toUpperCase",a.tags=[],a.closed=a.closedRoot=a.sawRoot=!1,a.tag=a.error=null,a.strict=!!e,a.noscript=!(!e&&!a.opt.noscript),a.state=X.BEGIN,a.strictEntities=a.opt.strictEntities,a.ENTITIES=a.strictEntities?Object.create(t.XML_ENTITIES):Object.create(t.ENTITIES),a.attribList=[],a.opt.xmlns&&(a.ns=Object.create(G)),a.trackPosition=!1!==a.opt.position,a.trackPosition&&(a.position=a.line=a.column=0),h(a,"onready")}function a(e){for(var n=Math.max(t.MAX_BUFFER_LENGTH,10),r=0,a=0,i=w.length;a<i;a++){var o=e[w[a]].length;if(o>n)switch(w[a]){case"textNode":p(e);break;case"cdata":g(e,"oncdata",e.cdata),e.cdata="";break;case"script":g(e,"onscript",e.script),e.script="";break;default:y(e,"Max buffer length exceeded: "+w[a])}r=Math.max(r,o)}var s=t.MAX_BUFFER_LENGTH-r;e.bufferCheckPosition=s+e.position}function i(e){for(var t=0,n=w.length;t<n;t++)e[w[t]]=""}function o(e){p(e),""!==e.cdata&&(g(e,"oncdata",e.cdata),e.cdata=""),""!==e.script&&(g(e,"onscript",e.script),e.script="")}function s(e,t){return new u(e,t)}function u(e,t){if(!(this instanceof u))return new u(e,t);D.apply(this),this._parser=new r(e,t),this.writable=!0,this.readable=!0;var n=this;this._parser.onend=function(){n.emit("end")},this._parser.onerror=function(e){n.emit("error",e),n._parser.error=null},this._decoder=null,O.forEach(function(e){Object.defineProperty(n,"on"+e,{get:function(){return n._parser["on"+e]},set:function(t){if(!t)return n.removeAllListeners(e),n._parser["on"+e]=t,t;n.on(e,t)},enumerable:!0,configurable:!1})})}function l(e){return e.split("").reduce(function(e,t){return e[t]=!0,e},{})}function c(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function f(e,t){return c(e)?!!t.match(e):e[t]}function d(e,t){return!f(e,t)}function h(e,t,n){e[t]&&e[t](n)}function g(e,t,n){e.textNode&&p(e),h(e,t,n)}function p(e){e.textNode=m(e.opt,e.textNode),e.textNode&&h(e,"ontext",e.textNode),e.textNode=""}function m(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function y(e,t){return p(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),t=new Error(t),e.error=t,h(e,"onerror",t),e}function E(e){return e.sawRoot&&!e.closedRoot&&_(e,"Unclosed root tag"),e.state!==X.BEGIN&&e.state!==X.BEGIN_WHITESPACE&&e.state!==X.TEXT&&y(e,"Unexpected end"),p(e),e.c="",e.closed=!0,h(e,"onend"),r.call(e,e.strict,e.opt),e}function _(e,t){if("object"!=typeof e||!(e instanceof r))throw new Error("bad call to strictFail");e.strict&&y(e,t)}function v(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,n=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(n.ns=t.ns),e.attribList.length=0,g(e,"onopentagstart",n)}function T(e,t){var n=e.indexOf(":"),r=n<0?["",e]:e.split(":"),a=r[0],i=r[1];return t&&"xmlns"===e&&(a="xmlns",i=""),{prefix:a,local:i}}function S(e){if(e.strict||(e.attribName=e.attribName[e.looseCase]()),-1!==e.attribList.indexOf(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName))e.attribName=e.attribValue="";else{if(e.opt.xmlns){var t=T(e.attribName,!0),n=t.prefix,r=t.local;if("xmlns"===n)if("xml"===r&&e.attribValue!==B)_(e,"xml: prefix must be bound to "+B+"\nActual: "+e.attribValue);else if("xmlns"===r&&e.attribValue!==U)_(e,"xmlns: prefix must be bound to "+U+"\nActual: "+e.attribValue);else{var a=e.tag,i=e.tags[e.tags.length-1]||e;a.ns===i.ns&&(a.ns=Object.create(i.ns)),a.ns[r]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,g(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}}function b(e,t){if(e.opt.xmlns){var n=e.tag,r=T(e.tagName);n.prefix=r.prefix,n.local=r.local,n.uri=n.ns[r.prefix]||"",n.prefix&&!n.uri&&(_(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),n.uri=r.prefix);var a=e.tags[e.tags.length-1]||e;n.ns&&a.ns!==n.ns&&Object.keys(n.ns).forEach(function(t){g(e,"onopennamespace",{prefix:t,uri:n.ns[t]})});for(var i=0,o=e.attribList.length;i<o;i++){var s=e.attribList[i],u=s[0],l=s[1],c=T(u,!0),f=c.prefix,d=c.local,h=""===f?"":n.ns[f]||"",p={name:u,value:l,prefix:f,local:d,uri:h};f&&"xmlns"!==f&&!h&&(_(e,"Unbound namespace prefix: "+JSON.stringify(f)),p.uri=f),e.tag.attributes[u]=p,g(e,"onattribute",p)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),g(e,"onopentag",e.tag),t||(e.noscript||"script"!==e.tagName.toLowerCase()?e.state=X.TEXT:e.state=X.SCRIPT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function A(e){if(!e.tagName)return _(e,"Weird empty close tag."),e.textNode+="</>",void(e.state=X.TEXT);if(e.script){if("script"!==e.tagName)return e.script+="</"+e.tagName+">",e.tagName="",void(e.state=X.SCRIPT);g(e,"onscript",e.script),e.script=""}var t=e.tags.length,n=e.tagName;e.strict||(n=n[e.looseCase]());for(var r=n;t--;){var a=e.tags[t];if(a.name===r)break;_(e,"Unexpected close tag")}if(t<0)return _(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",void(e.state=X.TEXT);e.tagName=n;for(var i=e.tags.length;i-- >t;){var o=e.tag=e.tags.pop();e.tagName=e.tag.name,g(e,"onclosetag",e.tagName);var s={};for(var u in o.ns)s[u]=o.ns[u];var l=e.tags[e.tags.length-1]||e;e.opt.xmlns&&o.ns!==l.ns&&Object.keys(o.ns).forEach(function(t){var n=o.ns[t];g(e,"onclosenamespace",{prefix:t,uri:n})})}0===t&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=X.TEXT}function R(e){var t,n=e.entity,r=n.toLowerCase(),a="";return e.ENTITIES[n]?e.ENTITIES[n]:e.ENTITIES[r]?e.ENTITIES[r]:(n=r,"#"===n.charAt(0)&&("x"===n.charAt(1)?(n=n.slice(2),t=parseInt(n,16),a=t.toString(16)):(n=n.slice(1),t=parseInt(n,10),a=t.toString(10))),n=n.replace(/^0+/,""),a.toLowerCase()!==n?(_(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(t))}function I(e,t){"<"===t?(e.state=X.OPEN_WAKA,e.startTagPosition=e.position):d(M,t)&&(_(e,"Non-whitespace before first tag."),e.textNode=t,e.state=X.TEXT)}function C(e,t){var n="";return t<e.length&&(n=e.charAt(t)),n}function N(e){var t=this;if(this.error)throw this.error;if(t.closed)return y(t,"Cannot write after close. Assign an onready handler.");if(null===e)return E(t);"object"==typeof e&&(e=e.toString());for(var n=0,r="";r=C(e,n++),t.c=r,r;)switch(t.trackPosition&&(t.position++,"\n"===r?(t.line++,t.column=0):t.column++),t.state){case X.BEGIN:if(t.state=X.BEGIN_WHITESPACE,"\ufeff"===r)continue;I(t,r);continue;case X.BEGIN_WHITESPACE:I(t,r);continue;case X.TEXT:if(t.sawRoot&&!t.closedRoot){for(var i=n-1;r&&"<"!==r&&"&"!==r;)r=C(e,n++),r&&t.trackPosition&&(t.position++,"\n"===r?(t.line++,t.column=0):t.column++);t.textNode+=e.substring(i,n-1)}"<"!==r||t.sawRoot&&t.closedRoot&&!t.strict?(!d(M,r)||t.sawRoot&&!t.closedRoot||_(t,"Text data outside of root node."),"&"===r?t.state=X.TEXT_ENTITY:t.textNode+=r):(t.state=X.OPEN_WAKA,t.startTagPosition=t.position);continue;case X.SCRIPT:"<"===r?t.state=X.SCRIPT_ENDING:t.script+=r;continue;case X.SCRIPT_ENDING:"/"===r?t.state=X.CLOSE_TAG:(t.script+="<"+r,t.state=X.SCRIPT);continue;case X.OPEN_WAKA:if("!"===r)t.state=X.SGML_DECL,t.sgmlDecl="";else if(f(M,r));else if(f(H,r))t.state=X.OPEN_TAG,t.tagName=r;else if("/"===r)t.state=X.CLOSE_TAG,t.tagName="";else if("?"===r)t.state=X.PROC_INST,t.procInstName=t.procInstBody="";else{if(_(t,"Unencoded <"),t.startTagPosition+1<t.position){var o=t.position-t.startTagPosition;r=new Array(o).join(" ")+r}t.textNode+="<"+r,t.state=X.TEXT}continue;case X.SGML_DECL:(t.sgmlDecl+r).toUpperCase()===x?(g(t,"onopencdata"),t.state=X.CDATA,t.sgmlDecl="",t.cdata=""):t.sgmlDecl+r==="--"?(t.state=X.COMMENT,t.comment="",t.sgmlDecl=""):(t.sgmlDecl+r).toUpperCase()===k?(t.state=X.DOCTYPE,(t.doctype||t.sawRoot)&&_(t,"Inappropriately located doctype declaration"),t.doctype="",t.sgmlDecl=""):">"===r?(g(t,"onsgmldeclaration",t.sgmlDecl),t.sgmlDecl="",t.state=X.TEXT):f(F,r)?(t.state=X.SGML_DECL_QUOTED,t.sgmlDecl+=r):t.sgmlDecl+=r;continue;case X.SGML_DECL_QUOTED:r===t.q&&(t.state=X.SGML_DECL,t.q=""),t.sgmlDecl+=r;continue;case X.DOCTYPE:">"===r?(t.state=X.TEXT,g(t,"ondoctype",t.doctype),t.doctype=!0):(t.doctype+=r,"["===r?t.state=X.DOCTYPE_DTD:f(F,r)&&(t.state=X.DOCTYPE_QUOTED,t.q=r));continue;case X.DOCTYPE_QUOTED:t.doctype+=r,r===t.q&&(t.q="",t.state=X.DOCTYPE);continue;case X.DOCTYPE_DTD:t.doctype+=r,"]"===r?t.state=X.DOCTYPE:f(F,r)&&(t.state=X.DOCTYPE_DTD_QUOTED,t.q=r);continue;case X.DOCTYPE_DTD_QUOTED:t.doctype+=r,r===t.q&&(t.state=X.DOCTYPE_DTD,t.q="");continue;case X.COMMENT:"-"===r?t.state=X.COMMENT_ENDING:t.comment+=r;continue;case X.COMMENT_ENDING:"-"===r?(t.state=X.COMMENT_ENDED,t.comment=m(t.opt,t.comment),t.comment&&g(t,"oncomment",t.comment),t.comment=""):(t.comment+="-"+r,t.state=X.COMMENT);continue;case X.COMMENT_ENDED:">"!==r?(_(t,"Malformed comment"),t.comment+="--"+r,t.state=X.COMMENT):t.state=X.TEXT;continue;case X.CDATA:"]"===r?t.state=X.CDATA_ENDING:t.cdata+=r;continue;case X.CDATA_ENDING:"]"===r?t.state=X.CDATA_ENDING_2:(t.cdata+="]"+r,t.state=X.CDATA);continue;case X.CDATA_ENDING_2:">"===r?(t.cdata&&g(t,"oncdata",t.cdata),g(t,"onclosecdata"),t.cdata="",t.state=X.TEXT):"]"===r?t.cdata+="]":(t.cdata+="]]"+r,t.state=X.CDATA);continue;case X.PROC_INST:"?"===r?t.state=X.PROC_INST_ENDING:f(M,r)?t.state=X.PROC_INST_BODY:t.procInstName+=r;continue;case X.PROC_INST_BODY:if(!t.procInstBody&&f(M,r))continue;"?"===r?t.state=X.PROC_INST_ENDING:t.procInstBody+=r;continue;case X.PROC_INST_ENDING:">"===r?(g(t,"onprocessinginstruction",{name:t.procInstName,body:t.procInstBody}),t.procInstName=t.procInstBody="",t.state=X.TEXT):(t.procInstBody+="?"+r,t.state=X.PROC_INST_BODY);continue;case X.OPEN_TAG:f(q,r)?t.tagName+=r:(v(t),">"===r?b(t):"/"===r?t.state=X.OPEN_TAG_SLASH:(d(M,r)&&_(t,"Invalid character in tag name"),t.state=X.ATTRIB));continue;case X.OPEN_TAG_SLASH:">"===r?(b(t,!0),A(t)):(_(t,"Forward-slash in opening tag not followed by >"),t.state=X.ATTRIB);continue;case X.ATTRIB:if(f(M,r))continue;">"===r?b(t):"/"===r?t.state=X.OPEN_TAG_SLASH:f(H,r)?(t.attribName=r,t.attribValue="",t.state=X.ATTRIB_NAME):_(t,"Invalid attribute name");continue;case X.ATTRIB_NAME:"="===r?t.state=X.ATTRIB_VALUE:">"===r?(_(t,"Attribute without value"),t.attribValue=t.attribName,S(t),b(t)):f(M,r)?t.state=X.ATTRIB_NAME_SAW_WHITE:f(q,r)?t.attribName+=r:_(t,"Invalid attribute name");continue;case X.ATTRIB_NAME_SAW_WHITE:if("="===r)t.state=X.ATTRIB_VALUE;else{if(f(M,r))continue;_(t,"Attribute without value"),t.tag.attributes[t.attribName]="",t.attribValue="",g(t,"onattribute",{name:t.attribName,value:""}),t.attribName="",">"===r?b(t):f(H,r)?(t.attribName=r,t.state=X.ATTRIB_NAME):(_(t,"Invalid attribute name"),t.state=X.ATTRIB)}continue;case X.ATTRIB_VALUE:if(f(M,r))continue;f(F,r)?(t.q=r,t.state=X.ATTRIB_VALUE_QUOTED):(_(t,"Unquoted attribute value"),t.state=X.ATTRIB_VALUE_UNQUOTED,t.attribValue=r);continue;case X.ATTRIB_VALUE_QUOTED:if(r!==t.q){"&"===r?t.state=X.ATTRIB_VALUE_ENTITY_Q:t.attribValue+=r;continue}S(t),t.q="",t.state=X.ATTRIB_VALUE_CLOSED;continue;case X.ATTRIB_VALUE_CLOSED:f(M,r)?t.state=X.ATTRIB:">"===r?b(t):"/"===r?t.state=X.OPEN_TAG_SLASH:f(H,r)?(_(t,"No whitespace between attributes"),t.attribName=r,t.attribValue="",t.state=X.ATTRIB_NAME):_(t,"Invalid attribute name");continue;case X.ATTRIB_VALUE_UNQUOTED:if(d(j,r)){"&"===r?t.state=X.ATTRIB_VALUE_ENTITY_U:t.attribValue+=r;continue}S(t),">"===r?b(t):t.state=X.ATTRIB;continue;case X.CLOSE_TAG:if(t.tagName)">"===r?A(t):f(q,r)?t.tagName+=r:t.script?(t.script+="</"+t.tagName,t.tagName="",t.state=X.SCRIPT):(d(M,r)&&_(t,"Invalid tagname in closing tag"),t.state=X.CLOSE_TAG_SAW_WHITE);else{if(f(M,r))continue;d(H,r)?t.script?(t.script+="</"+r,t.state=X.SCRIPT):_(t,"Invalid tagname in closing tag."):t.tagName=r}continue;case X.CLOSE_TAG_SAW_WHITE:if(f(M,r))continue;">"===r?A(t):_(t,"Invalid characters in closing tag");continue;case X.TEXT_ENTITY:case X.ATTRIB_VALUE_ENTITY_Q:case X.ATTRIB_VALUE_ENTITY_U:var s,u;switch(t.state){case X.TEXT_ENTITY:s=X.TEXT,u="textNode";break;case X.ATTRIB_VALUE_ENTITY_Q:s=X.ATTRIB_VALUE_QUOTED,u="attribValue";break;case X.ATTRIB_VALUE_ENTITY_U:s=X.ATTRIB_VALUE_UNQUOTED,u="attribValue"}";"===r?(t[u]+=R(t),t.entity="",t.state=s):f(t.entity.length?K:Y,r)?t.entity+=r:(_(t,"Invalid character in entity name"),t[u]+="&"+t.entity+r,t.entity="",t.state=s);continue;default:throw new Error(t,"Unknown state: "+t.state)}return t.position>=t.bufferCheckPosition&&a(t),t}t.parser=function(e,t){return new r(e,t)},t.SAXParser=r,t.SAXStream=u,t.createStream=s,t.MAX_BUFFER_LENGTH=65536;var D,w=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];t.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){}t.prototype=e;var n=new t;return n}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),r.prototype={end:function(){E(this)},write:N,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){o(this)}};try{D=n("./node_modules/stream-browserify/index.js").Stream}catch(e){D=function(){}}var O=t.EVENTS.filter(function(e){return"error"!==e&&"end"!==e});u.prototype=Object.create(D.prototype,{constructor:{value:u}}),u.prototype.write=function(t){if("function"==typeof e&&"function"==typeof e.isBuffer&&e.isBuffer(t)){if(!this._decoder){var r=n("./node_modules/string_decoder/lib/string_decoder.js").StringDecoder;this._decoder=new r("utf8")}t=this._decoder.write(t)}return this._parser.write(t.toString()),this.emit("data",t),!0},u.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},u.prototype.on=function(e,t){var n=this;return n._parser["on"+e]||-1===O.indexOf(e)||(n._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),n.emit.apply(n,t)}),D.prototype.on.call(n,e,t)};var M="\r\n\t ",P="0124356789",L="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",F="'\"",j=M+">",x="[CDATA[",k="DOCTYPE",B="http://www.w3.org/XML/1998/namespace",U="http://www.w3.org/2000/xmlns/",G={xml:B,xmlns:U};M=l(M),P=l(P),L=l(L);var H=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,q=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/,Y=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,K=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;F=l(F),j=l(j);var V,W,z,X=0;for(var Q in t.STATE={BEGIN:X++,BEGIN_WHITESPACE:X++,TEXT:X++,TEXT_ENTITY:X++,OPEN_WAKA:X++,SGML_DECL:X++,SGML_DECL_QUOTED:X++,DOCTYPE:X++,DOCTYPE_QUOTED:X++,DOCTYPE_DTD:X++,DOCTYPE_DTD_QUOTED:X++,COMMENT_STARTING:X++,COMMENT:X++,COMMENT_ENDING:X++,COMMENT_ENDED:X++,CDATA:X++,CDATA_ENDING:X++,CDATA_ENDING_2:X++,PROC_INST:X++,PROC_INST_BODY:X++,PROC_INST_ENDING:X++,OPEN_TAG:X++,OPEN_TAG_SLASH:X++,ATTRIB:X++,ATTRIB_NAME:X++,ATTRIB_NAME_SAW_WHITE:X++,ATTRIB_VALUE:X++,ATTRIB_VALUE_QUOTED:X++,ATTRIB_VALUE_CLOSED:X++,ATTRIB_VALUE_UNQUOTED:X++,ATTRIB_VALUE_ENTITY_Q:X++,ATTRIB_VALUE_ENTITY_U:X++,CLOSE_TAG:X++,CLOSE_TAG_SAW_WHITE:X++,SCRIPT:X++,SCRIPT_ENDING:X++},t.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},t.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(t.ENTITIES).forEach(function(e){var n=t.ENTITIES[e],r="number"==typeof n?String.fromCharCode(n):n;t.ENTITIES[e]=r}),t.STATE)t.STATE[t.STATE[Q]]=Q;X=t.STATE,String.fromCodePoint||(V=String.fromCharCode,W=Math.floor,z=function(){var e,t,n=16384,r=[],a=-1,i=arguments.length;if(!i)return"";for(var o="";++a<i;){var s=Number(arguments[a]);if(!isFinite(s)||s<0||s>1114111||W(s)!==s)throw RangeError("Invalid code point: "+s);s<=65535?r.push(s):(s-=65536,e=55296+(s>>10),t=s%1024+56320,r.push(e,t)),(a+1===i||r.length>n)&&(o+=V.apply(null,r),r.length=0)}return o},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:z,configurable:!0,writable:!0}):String.fromCodePoint=z)})(t)}).call(this,n("./node_modules/node-libs-browser/node_modules/buffer/index.js").Buffer)},"./node_modules/setimmediate/setImmediate.js":function(e,t,n){(function(e,t){(function(e,n){function r(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return p[g]=r,h(g),g++}function a(e){delete p[e]}function i(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}function o(e){if(m)setTimeout(o,0,e);else{var t=p[e];if(t){m=!0;try{i(t)}finally{a(e),m=!1}}}}function s(){h=function(e){t.nextTick(function(){o(e)})}}function u(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}function l(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&o(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),h=function(n){e.postMessage(t+n,"*")}}function c(){var e=new MessageChannel;e.port1.onmessage=function(e){var t=e.data;o(t)},h=function(t){e.port2.postMessage(t)}}function f(){var e=y.documentElement;h=function(t){var n=y.createElement("script");n.onreadystatechange=function(){o(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}function d(){h=function(e){setTimeout(o,0,e)}}if(!e.setImmediate){var h,g=1,p={},m=!1,y=e.document,E=Object.getPrototypeOf&&Object.getPrototypeOf(e);E=E&&E.setTimeout?E:e,"[object process]"==={}.toString.call(e.process)?s():u()?l():e.MessageChannel?c():y&&"onreadystatechange"in y.createElement("script")?f():d(),E.setImmediate=r,E.clearImmediate=a}})("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n("./node_modules/webpack/buildin/global.js"),n("./node_modules/process/browser.js"))},"./node_modules/stream-browserify/index.js":function(e,t,n){function r(){a.call(this)}e.exports=r;var a=n("./node_modules/node-libs-browser/node_modules/events/events.js").EventEmitter,i=n("./node_modules/inherits/inherits_browser.js");i(r,a),r.Readable=n("./node_modules/readable-stream/readable-browser.js"),r.Writable=n("./node_modules/readable-stream/writable-browser.js"),r.Duplex=n("./node_modules/readable-stream/duplex-browser.js"),r.Transform=n("./node_modules/readable-stream/transform.js"),r.PassThrough=n("./node_modules/readable-stream/passthrough.js"),r.Stream=r,r.prototype.pipe=function(e,t){function n(t){e.writable&&!1===e.write(t)&&l.pause&&l.pause()}function r(){l.readable&&l.resume&&l.resume()}function i(){c||(c=!0,e.end())}function o(){c||(c=!0,"function"==typeof e.destroy&&e.destroy())}function s(e){if(u(),0===a.listenerCount(this,"error"))throw e}function u(){l.removeListener("data",n),e.removeListener("drain",r),l.removeListener("end",i),l.removeListener("close",o),l.removeListener("error",s),e.removeListener("error",s),l.removeListener("end",u),l.removeListener("close",u),e.removeListener("close",u)}var l=this;l.on("data",n),e.on("drain",r),e._isStdio||t&&!1===t.end||(l.on("end",i),l.on("close",o));var c=!1;return l.on("error",s),e.on("error",s),l.on("end",u),l.on("close",u),e.on("close",u),e.emit("pipe",l),e}},"./node_modules/string_decoder/lib/string_decoder.js":function(e,t,n){function r(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function a(e){var t=r(e);if("string"!=typeof t&&(E.isEncoding===_||!_(e)))throw new Error("Unknown encoding: "+e);return t||e}function i(e){var t;switch(this.encoding=a(e),this.encoding){case"utf16le":this.text=d,this.end=h,t=4;break;case"utf8":this.fillLast=l,t=4;break;case"base64":this.text=g,this.end=p,t=3;break;default:return this.write=m,void(this.end=y)}this.lastNeed=0,this.lastTotal=0,this.lastChar=E.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function s(e,t,n){var r=t.length-1;if(r<n)return 0;var a=o(t[r]);return a>=0?(a>0&&(e.lastNeed=a-1),a):--r<n||-2===a?0:(a=o(t[r]),a>=0?(a>0&&(e.lastNeed=a-2),a):--r<n||-2===a?0:(a=o(t[r]),a>=0?(a>0&&(2===a?a=0:e.lastNeed=a-3),a):0))}function u(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}function l(e){var t=this.lastTotal-this.lastNeed,n=u(this,e,t);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){var n=s(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)}function f(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t}function d(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function h(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function g(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function p(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function m(e){return e.toString(this.encoding)}function y(e){return e&&e.length?this.write(e):""}var E=n("./node_modules/safe-buffer/index.js").Buffer,_=E.isEncoding||function(e){switch(e=""+e,e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};t.StringDecoder=i,i.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(t=this.fillLast(e),void 0===t)return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},i.prototype.end=f,i.prototype.text=c,i.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},"./node_modules/util-deprecate/browser.js":function(e,t,n){(function(t){function n(e,t){function n(){if(!a){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),a=!0}return e.apply(this,arguments)}if(r("noDeprecation"))return e;var a=!1;return n}function r(e){try{if(!t.localStorage)return!1}catch(e){return!1}var n=t.localStorage[e];return null!=n&&"true"===String(n).toLowerCase()}e.exports=n}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./node_modules/webpack/buildin/global.js":function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},"./src/core/Debug.js":function(e,t,n){function r(e){function t(){v=!0,T=!0,S=(new Date).getTime(),"undefined"!=typeof window&&window.console&&(I[u]=n(window.console.error),I[l]=n(window.console.error),I[c]=n(window.console.warn),I[f]=n(window.console.info),I[d]=n(window.console.debug))}function n(e){return e&&e.bind?e.bind(window.console):window.console.log.bind(window.console)}function r(e){return{fatal:h.bind(e),error:g.bind(e),warn:p.bind(e),info:m.bind(e),debug:y.bind(e)}}function o(e){v=e}function s(e){T=e}function h(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];E.apply(void 0,[u,this].concat(t))}function g(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];E.apply(void 0,[l,this].concat(t))}function p(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];E.apply(void 0,[c,this].concat(t))}function m(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];E.apply(void 0,[f,this].concat(t))}function y(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];E.apply(void 0,[d,this].concat(t))}function E(e,t){
var n="",r=null;v&&(r=(new Date).getTime(),n+="["+(r-S)+"]"),T&&t&&t.getClassName&&(n+="["+t.getClassName()+"]",t.getType&&(n+="["+t.getType()+"]")),n.length>0&&(n+=" ");for(var a=arguments.length,o=new Array(a>2?a-2:0),s=2;s<a;s++)o[s-2]=arguments[s];Array.apply(null,o).forEach(function(e){n+=e+" "}),I[e]&&R.get().debug.logLevel>=e&&I[e](n),R&&R.get().debug.dispatchEvent&&A.trigger(i.default.LOG,{message:n,level:e})}e=e||{};var _,v,T,S,b=this.context,A=Object(a.default)(b).getInstance(),R=e.settings,I=[];return _={getLogger:r,setLogTimestampVisible:o,setCalleeNameVisible:s},t(),_}n.r(t);var a=n("./src/core/EventBus.js"),i=n("./src/core/events/Events.js"),o=n("./src/core/FactoryMaker.js"),s=0,u=1,l=2,c=3,f=4,d=5;r.__dashjs_factory_name="Debug";var h=o.default.getSingletonFactory(r);h.LOG_LEVEL_NONE=s,h.LOG_LEVEL_FATAL=u,h.LOG_LEVEL_ERROR=l,h.LOG_LEVEL_WARNING=c,h.LOG_LEVEL_INFO=f,h.LOG_LEVEL_DEBUG=d,o.default.updateSingletonFactory(r.__dashjs_factory_name,h),t.default=h},"./src/core/EventBus.js":function(e,t,n){function r(){function e(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw new Error("event type cannot be null or undefined");if(!t||"function"!=typeof t)throw new Error("listener must be a function: "+t);var i=a.priority||o;if(!(r(e,t,n)>=0)){s[e]=s[e]||[];var u={callback:t,scope:n,priority:i};n&&n.getStreamId&&(u.streamId=n.getStreamId()),n&&n.getType&&(u.mediaType=n.getType()),a&&a.mode&&(u.mode=a.mode);var l=s[e].some(function(t,n){if(t&&i>t.priority)return s[e].splice(n,0,u),!0});l||s[e].push(u)}}function t(e,t,n){if(e&&t&&s[e]){var a=r(e,t,n);a<0||(s[e][a]=null)}}function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e&&s[e]){if(t=t||{},t.hasOwnProperty("type"))throw new Error("'type' is a reserved word for event dispatching");t.type=e,n.streamId&&(t.streamId=n.streamId),n.mediaType&&(t.mediaType=n.mediaType),s[e].filter(function(e){return!!e&&((!n.streamId||!e.streamId||e.streamId===n.streamId)&&((!n.mediaType||!e.mediaType||e.mediaType===n.mediaType)&&!(n.mode&&e.mode&&e.mode!==n.mode||!e.mode&&n.mode&&n.mode===i.default.EVENT_MODE_ON_RECEIVE)))}).forEach(function(e){return e&&e.callback.call(e.scope,t)})}}function r(e,t,n){var r=-1;return s[e]?(s[e].some(function(e,a){if(e&&e.callback===t&&(!n||n===e.scope))return r=a,!0}),r):r}function a(){s={}}var s={},u={on:e,off:t,trigger:n,reset:a};return u}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/MediaPlayerEvents.js"),o=0,s=5e3;r.__dashjs_factory_name="EventBus";var u=a.default.getSingletonFactory(r);u.EVENT_PRIORITY_LOW=o,u.EVENT_PRIORITY_HIGH=s,a.default.updateSingletonFactory(r.__dashjs_factory_name,u),t.default=u},"./src/core/FactoryMaker.js":function(e,t,n){n.r(t);var r=function(){function e(e,t,n,r){!r[e]&&t&&(r[e]={instance:t,override:n})}function t(e,t){for(var n in g){var r=g[n];if(r.context===e&&r.name===t)return r.instance}return null}function n(e,t,n){for(var r in g){var a=g[r];if(a.context===e&&a.name===t)return void(g[r].instance=n)}g.push({name:t,context:e,instance:n})}function r(e){g=g.filter(function(t){return t.context!==e})}function a(e,t){return t[e]}function i(e,t,n){e in n&&(n[e]=t)}function o(e,t){i(e,t,m)}function s(e){return a(e,m)}function u(e){var t=a(e.__dashjs_factory_name,m);return t||(t=function(t){return void 0===t&&(t={}),{create:function(){return d(e,t,arguments)}}},m[e.__dashjs_factory_name]=t),t}function l(e,t){i(e,t,p)}function c(e){return a(e,p)}function f(e){var n=a(e.__dashjs_factory_name,p);return n||(n=function(n){var r;return void 0===n&&(n={}),{getInstance:function(){return r||(r=t(n,e.__dashjs_factory_name)),r||(r=d(e,n,arguments),g.push({name:e.__dashjs_factory_name,context:n,instance:r})),r}}},p[e.__dashjs_factory_name]=n),n}function d(e,t,n){var r,a=e.__dashjs_factory_name,i=t[a];if(i){var o=i.instance;if(!i.override)return o.apply({context:t,factory:h},n);for(var s in r=e.apply({context:t},n),o=o.apply({context:t,factory:h,parent:r},n),o)r.hasOwnProperty(s)&&(r[s]=o[s])}else r=e.apply({context:t},n);return r.getClassName=function(){return a},r}var h,g=[],p={},m={};return h={extend:e,getSingletonInstance:t,setSingletonInstance:n,deleteSingletonInstances:r,getSingletonFactory:f,getSingletonFactoryByName:c,updateSingletonFactory:l,getClassFactory:u,getClassFactoryByName:s,updateClassFactory:o},h}();t.default=r},"./src/core/Settings.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(){function e(t,n,a){for(var i in t)t.hasOwnProperty(i)&&n.hasOwnProperty(i)&&("object"===r(t[i])&&null!==t[i]?e(t[i],n[i],a.slice()+i+"."):n[i]=s.default.clone(t[i]))}function t(){return g}function n(t){"object"===r(t)&&e(t,g,"")}function i(){g=s.default.clone(h)}var o,f,d,h={debug:{logLevel:u.default.LOG_LEVEL_WARNING,dispatchEvent:!1},streaming:{abandonLoadTimeout:1e4,wallclockTimeUpdateInterval:100,lowLatencyEnabled:!1,lowLatencyEnabledByManifest:!0,manifestUpdateRetryInterval:100,cacheInitSegments:!1,eventControllerRefreshDelay:150,capabilities:{filterUnsupportedEssentialProperties:!0,useMediaCapabilitiesApi:!1},timeShiftBuffer:{calcFromSegmentTimeline:!1,fallbackToSegmentTimeline:!0},metrics:{maxListDepth:100},delay:{liveDelayFragmentCount:NaN,liveDelay:NaN,useSuggestedPresentationDelay:!0,applyServiceDescription:!0},protection:{keepProtectionMediaKeys:!1,ignoreEmeEncryptedEvent:!1},buffer:{enableSeekDecorrelationFix:!1,fastSwitchEnabled:!0,flushBufferAtTrackSwitch:!1,reuseExistingSourceBuffers:!0,bufferPruningInterval:10,bufferToKeep:20,bufferTimeAtTopQuality:30,bufferTimeAtTopQualityLongForm:60,initialBufferLevel:NaN,stableBufferTime:12,longFormContentDurationThreshold:600,stallThreshold:.3,useAppendWindow:!0,setStallState:!0},gaps:{jumpGaps:!0,jumpLargeGaps:!0,smallGapLimit:1.5,threshold:.3,enableSeekFix:!1},utcSynchronization:{enabled:!0,useManifestDateHeaderTimeSource:!0,backgroundAttempts:2,timeBetweenSyncAttempts:30,maximumTimeBetweenSyncAttempts:600,minimumTimeBetweenSyncAttempts:2,timeBetweenSyncAttemptsAdjustmentFactor:2,maximumAllowedDrift:100,enableBackgroundSyncAfterSegmentDownloadError:!0,defaultTimingSource:{scheme:"urn:mpeg:dash:utc:http-xsdate:2014",value:"https://time.akamai.com/?iso&ms"}},scheduling:{defaultTimeout:500,lowLatencyTimeout:0,scheduleWhilePaused:!0},text:{defaultEnabled:!0},liveCatchup:{minDrift:.02,maxDrift:12,playbackRate:.5,latencyThreshold:60,playbackBufferMin:.5,enabled:!1,mode:l.default.LIVE_CATCHUP_MODE_DEFAULT},lastBitrateCachingInfo:{enabled:!0,ttl:36e4},lastMediaSettingsCachingInfo:{enabled:!0,ttl:36e4},cacheLoadThresholds:{video:50,audio:5},trackSwitchMode:{audio:l.default.TRACK_SWITCH_MODE_ALWAYS_REPLACE,video:l.default.TRACK_SWITCH_MODE_NEVER_REPLACE},selectionModeForInitialTrack:l.default.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY,fragmentRequestTimeout:0,retryIntervals:(o={},a(o,c.HTTPRequest.MPD_TYPE,500),a(o,c.HTTPRequest.XLINK_EXPANSION_TYPE,500),a(o,c.HTTPRequest.MEDIA_SEGMENT_TYPE,1e3),a(o,c.HTTPRequest.INIT_SEGMENT_TYPE,1e3),a(o,c.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,1e3),a(o,c.HTTPRequest.INDEX_SEGMENT_TYPE,1e3),a(o,c.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE,1e3),a(o,c.HTTPRequest.LICENSE,1e3),a(o,c.HTTPRequest.OTHER_TYPE,1e3),a(o,"lowLatencyReductionFactor",10),o),retryAttempts:(f={},a(f,c.HTTPRequest.MPD_TYPE,3),a(f,c.HTTPRequest.XLINK_EXPANSION_TYPE,1),a(f,c.HTTPRequest.MEDIA_SEGMENT_TYPE,3),a(f,c.HTTPRequest.INIT_SEGMENT_TYPE,3),a(f,c.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,3),a(f,c.HTTPRequest.INDEX_SEGMENT_TYPE,3),a(f,c.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE,3),a(f,c.HTTPRequest.LICENSE,3),a(f,c.HTTPRequest.OTHER_TYPE,3),a(f,"lowLatencyMultiplyFactor",5),f),abr:{movingAverageMethod:l.default.MOVING_AVERAGE_SLIDING_WINDOW,ABRStrategy:l.default.ABR_STRATEGY_DYNAMIC,additionalAbrRules:{insufficientBufferRule:!0,switchHistoryRule:!0,droppedFramesRule:!0,abandonRequestsRule:!1},bandwidthSafetyFactor:.9,useDefaultABRRules:!0,useDeadTimeLatency:!0,limitBitrateByPortal:!1,usePixelRatioInLimitBitrateByPortal:!1,maxBitrate:{audio:-1,video:-1},minBitrate:{audio:-1,video:-1},maxRepresentationRatio:{audio:1,video:1},initialBitrate:{audio:-1,video:-1},initialRepresentationRatio:{audio:-1,video:-1},autoSwitchBitrate:{audio:!0,video:!0},fetchThroughputCalculationMode:l.default.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING},cmcd:{enabled:!1,sid:null,cid:null,rtp:null,rtpSafetyFactor:5,mode:l.default.CMCD_MODE_QUERY}},errors:{recoverAttempts:{mediaErrorDecode:5}}},g=s.default.clone(h);return d={get:t,update:n,reset:i},d}n.r(t);var o=n("./src/core/FactoryMaker.js"),s=n("./src/core/Utils.js"),u=n("./src/core/Debug.js"),l=n("./src/streaming/constants/Constants.js"),c=n("./src/streaming/vo/metrics/HTTPRequest.js");i.__dashjs_factory_name="Settings";var f=o.default.getSingletonFactory(i);t.default=f},"./src/core/Utils.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}n.r(t);var s=n("./node_modules/path-browserify/index.js"),u=n.n(s),l=function(){function e(){a(this,e)}return o(e,null,[{key:"mixin",value:function(t,n,a){var i,o={};if(t)for(var s in n)n.hasOwnProperty(s)&&(i=n[s],s in t&&(t[s]===i||s in o&&o[s]===i)||("object"===r(t[s])&&null!==t[s]?t[s]=e.mixin(t[s],i,a):t[s]=a(i)));return t}},{key:"clone",value:function(t){if(!t||"object"!==r(t))return t;var n;if(t instanceof Array){n=[];for(var a=0,i=t.length;a<i;++a)a in t&&n.push(e.clone(t[a]))}else n={};return e.mixin(n,t,e.clone)}},{key:"addAditionalQueryParameterToUrl",value:function(e,t){try{if(!t||0===t.length)return e;var n=new URL(e);return t.forEach(function(e){e.key&&e.value&&n.searchParams.set(e.key,e.value)}),n.href}catch(t){return e}}},{key:"parseHttpHeaders",value:function(e){var t={};if(!e)return t;for(var n=e.trim().split("\r\n"),r=0,a=n.length;r<a;r++){var i=n[r],o=i.indexOf(": ");o>0&&(t[i.substring(0,o)]=i.substring(o+2))}return t}},{key:"generateUuid",value:function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)});return t}},{key:"generateHashCode",value:function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);t=(t<<5)-t+r,t|=0}return t}},{key:"getRelativeUrl",value:function(e,t){try{var n=new URL(e),r=new URL(t);if(n.protocol=r.protocol,n.origin!==r.origin)return t;var a=u.a.relative(n.pathname.substr(0,n.pathname.lastIndexOf("/")),r.pathname.substr(0,r.pathname.lastIndexOf("/"))),i=0===a.length?1:0;return a+=r.pathname.substr(r.pathname.lastIndexOf("/")+i,r.pathname.length-1),r.pathname.length<a.length?r.pathname:a}catch(e){return t}}}]),e}();t.default=l},"./src/core/Version.js":function(e,t,n){function r(){return a}n.r(t),n.d(t,"getVersionString",function(){return r});var a="4.2.0"},"./src/core/errors/Errors.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function s(e){var t=c();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}n.r(t);var d=n("./src/core/errors/ErrorsBase.js"),h=function(e){function t(){var e;return a(this,t),e=n.call(this),e.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE=10,e.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE=11,e.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE=12,e.SEGMENT_BASE_LOADER_ERROR_CODE=15,e.TIME_SYNC_FAILED_ERROR_CODE=16,e.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE=17,e.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE=18,e.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE=19,e.APPEND_ERROR_CODE=20,e.REMOVE_ERROR_CODE=21,e.DATA_UPDATE_FAILED_ERROR_CODE=22,e.CAPABILITY_MEDIASOURCE_ERROR_CODE=23,e.CAPABILITY_MEDIAKEYS_ERROR_CODE=24,e.DOWNLOAD_ERROR_ID_MANIFEST_CODE=25,e.DOWNLOAD_ERROR_ID_SIDX_CODE=26,e.DOWNLOAD_ERROR_ID_CONTENT_CODE=27,e.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE=28,e.DOWNLOAD_ERROR_ID_XLINK_CODE=29,e.MANIFEST_ERROR_ID_PARSE_CODE=31,e.MANIFEST_ERROR_ID_NOSTREAMS_CODE=32,e.TIMED_TEXT_ERROR_ID_PARSE_CODE=33,e.MANIFEST_ERROR_ID_MULTIPLEXED_CODE=34,e.MEDIASOURCE_TYPE_UNSUPPORTED_CODE=35,e.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE="parsing failed for ",e.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading manifest: ",e.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading Xlink element: ",e.SEGMENTS_UPDATE_FAILED_ERROR_MESSAGE="Segments update failed",e.SEGMENTS_UNAVAILABLE_ERROR_MESSAGE="no segments are available yet",e.SEGMENT_BASE_LOADER_ERROR_MESSAGE="error loading segment ranges from sidx",e.TIME_SYNC_FAILED_ERROR_MESSAGE="Failed to synchronize client and server time",e.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE="request is null",e.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE="Failed to resolve a valid URL",e.APPEND_ERROR_MESSAGE="chunk is not defined",e.REMOVE_ERROR_MESSAGE="Removing data from the SourceBuffer",e.DATA_UPDATE_FAILED_ERROR_MESSAGE="Data update failed",e.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE="mediasource is not supported",e.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE="mediakeys is not supported",e.TIMED_TEXT_ERROR_MESSAGE_PARSE="parsing error :",e.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE="Error creating source buffer of type : ",e}i(t,e);var n=s(t);return t}(d.default),g=new h;t.default=g},"./src/core/errors/ErrorsBase.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}n.r(t);var o=function(){function e(){r(this,e)}return i(e,[{key:"extend",value:function(e,t){if(e){var n=!!t&&t.override,r=!!t&&t.publicOnly;for(var a in e)!e.hasOwnProperty(a)||this[a]&&!n||r&&-1===e[a].indexOf("public_")||(this[a]=e[a])}}}]),e}();t.default=o},"./src/core/events/CoreEvents.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function s(e){var t=c();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}n.r(t);var d=n("./src/core/events/EventsBase.js"),h=function(e){function t(){var e;return a(this,t),e=n.call(this),e.ATTEMPT_BACKGROUND_SYNC="attemptBackgroundSync",e.BUFFERING_COMPLETED="bufferingCompleted",e.BUFFER_CLEARED="bufferCleared",e.BYTES_APPENDED_END_FRAGMENT="bytesAppendedEndFragment",e.BUFFER_REPLACEMENT_STARTED="bufferReplacementStarted",e.CHECK_FOR_EXISTENCE_COMPLETED="checkForExistenceCompleted",e.CURRENT_TRACK_CHANGED="currentTrackChanged",e.DATA_UPDATE_COMPLETED="dataUpdateCompleted",e.INBAND_EVENTS="inbandEvents",e.INITIAL_STREAM_SWITCH="initialStreamSwitch",e.INIT_FRAGMENT_LOADED="initFragmentLoaded",e.INIT_FRAGMENT_NEEDED="initFragmentNeeded",e.INTERNAL_MANIFEST_LOADED="internalManifestLoaded",e.ORIGINAL_MANIFEST_LOADED="originalManifestLoaded",e.LOADING_COMPLETED="loadingCompleted",e.LOADING_PROGRESS="loadingProgress",e.LOADING_DATA_PROGRESS="loadingDataProgress",e.LOADING_ABANDONED="loadingAborted",e.MANIFEST_UPDATED="manifestUpdated",e.MEDIA_FRAGMENT_LOADED="mediaFragmentLoaded",e.MEDIA_FRAGMENT_NEEDED="mediaFragmentNeeded",e.QUOTA_EXCEEDED="quotaExceeded",e.SEGMENT_LOCATION_BLACKLIST_ADD="segmentLocationBlacklistAdd",e.SEGMENT_LOCATION_BLACKLIST_CHANGED="segmentLocationBlacklistChanged",e.SERVICE_LOCATION_BLACKLIST_ADD="serviceLocationBlacklistAdd",e.SERVICE_LOCATION_BLACKLIST_CHANGED="serviceLocationBlacklistChanged",e.SET_FRAGMENTED_TEXT_AFTER_DISABLED="setFragmentedTextAfterDisabled",e.SET_NON_FRAGMENTED_TEXT="setNonFragmentedText",e.SOURCE_BUFFER_ERROR="sourceBufferError",e.STREAMS_COMPOSED="streamsComposed",e.STREAM_BUFFERING_COMPLETED="streamBufferingCompleted",e.STREAM_REQUESTING_COMPLETED="streamRequestingCompleted",e.TEXT_TRACKS_QUEUE_INITIALIZED="textTracksQueueInitialized",e.TIME_SYNCHRONIZATION_COMPLETED="timeSynchronizationComplete",e.UPDATE_TIME_SYNC_OFFSET="updateTimeSyncOffset",e.URL_RESOLUTION_FAILED="urlResolutionFailed",e.VIDEO_CHUNK_RECEIVED="videoChunkReceived",e.WALLCLOCK_TIME_UPDATED="wallclockTimeUpdated",e.XLINK_ELEMENT_LOADED="xlinkElementLoaded",e.XLINK_READY="xlinkReady",e.SEEK_TARGET="seekTarget",e}i(t,e);var n=s(t);return t}(d.default);t.default=h},"./src/core/events/Events.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function s(e){var t=c();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}n.r(t);var d=n("./src/core/events/CoreEvents.js"),h=function(e){function t(){return a(this,t),n.apply(this,arguments)}i(t,e);var n=s(t);return t}(d.default),g=new h;t.default=g},"./src/core/events/EventsBase.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}n.r(t);var o=function(){function e(){r(this,e)}return i(e,[{key:"extend",value:function(e,t){if(e){var n=!!t&&t.override,r=!!t&&t.publicOnly;for(var a in e)!e.hasOwnProperty(a)||this[a]&&!n||r&&-1===e[a].indexOf("public_")||(this[a]=e[a])}}}]),e}();t.default=o},"./src/dash/DashAdapter.js":function(e,t,n){function r(){function e(){fe=Object(f.default)(ye).getInstance(),de=Object(d.default)(ye).getInstance(),z()}function t(e){e&&(e.constants&&(pe=e.constants),e.cea608parser&&(me=e.cea608parser),e.errHandler&&fe.setConfig({errHandler:e.errHandler}),e.BASE64&&fe.setConfig({BASE64:e.BASE64}))}function n(e){if(e){var t=new i.default,n=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],r=fe.getRepresentationFor(e.index,n);return t.id=e.id,t.quality=e.index,t.bandwidth=fe.getBandwidth(r),t.fragmentDuration=e.segmentDuration||(e.segments&&e.segments.length>0?e.segments[0].duration:NaN),t.MSETimeOffset=e.MSETimeOffset,t.mediaInfo=ee(e.adaptation),t}return null}function r(e,t){if(0===he.length||!e)return null;var n=Z(e,he);if(!n)return null;var r=fe.getAdaptationsForPeriod(n),a=h(e.index,t,e);if(!a)return null;var i=fe.getIndexForAdaptation(a,he[0].mpd.manifest,e.index);return ee(r[i])}function c(e){return fe.getRolesForAdaptation(e).filter(function(e){return e.value===a.default.MAIN})[0]}function h(e,t,n){var r=fe.getAdaptationsForType(he[0].mpd.manifest,e,t);if(!r||0===r.length)return null;if(r.length>1&&n){var a=m(n,t);if(ge[n.id]&&ge[n.id][t])for(var i=0,o=r.length;i<o;i++)if(g(ge[n.id][t],a[i]))return r[i];for(var s=0,u=r.length;s<u;s++)if(c(r[s]))return r[s]}return r[0]}function g(e,t){if(!e||!t)return!1;var n=e.id===t.id,r=e.codec===t.codec,a=e.viewpoint===t.viewpoint,i=e.lang===t.lang,o=e.roles.toString()===t.roles.toString(),s=e.accessibility.toString()===t.accessibility.toString(),u=e.audioChannelConfiguration.toString()===t.audioChannelConfiguration.toString();return n&&r&&a&&i&&o&&s&&u}function p(e,t,n,r,a,i){var o,s,u,l,c,f,d=[];if(!r||0===r.length)return[];var h=fe.getAdaptationsForPeriod(t);for(l=0,f=r.length;l<f;l++)if(o=r[l],u=fe.getIndexForAdaptation(o,e,n.index),s=ee(h[u]),i){var g=s.accessibility.length;for(c=0;c<g;c++)if(s){var p=s.accessibility[c];if(0===p.indexOf("cea-608:")){var m=p.substring(8),y=m.split(";");if("CC"===y[0].substring(0,2))for(c=0;c<y.length;c++)s||(s=ee.call(this,h[u])),te(s,y[c].substring(0,3),y[c].substring(4)),d.push(s),s=null;else for(c=0;c<y.length;c++)s||(s=ee.call(this,h[u])),te(s,"CC"+(c+1),y[c]),d.push(s),s=null}else 0===p.indexOf("cea-608")&&(te(s,pe.CC1,"eng"),d.push(s),s=null)}}else a===pe.IMAGE?(ne(s),d.push(s),s=null):s&&d.push(s);return d}function m(e,t,n){var r=he,a=n,i=[];if(a)ie(),r=M(a);else{if(!(he.length>0))return i;a=he[0].mpd.manifest}var o=Z(e,r),s=fe.getAdaptationsForType(a,e?e.index:null,t);return i=p(a,o,e,s,t),t===pe.TEXT&&(s=fe.getAdaptationsForType(a,e?e.index:null,pe.VIDEO),i=i.concat(p(a,o,e,s,t,!0))),i}function y(e){if(!e)return null;ie(),he=M(e)}function E(e,t){var n=[],r=he;if(e&&(ie(),r=M(e)),r.length>0){(!t||t>r.length)&&(t=r.length);for(var a=0;a<t;a++)n.push(re(r[a]))}return n}function _(e,t){var n,r,a=Z(e,he);return n=t?t.id:null,he.length>0&&a&&(r=n?fe.getAdaptationForId(n,he[0].mpd.manifest,a.index):fe.getAdaptationForIndex(t?t.index:null,he[0].mpd.manifest,a.index)),r}function v(e){try{return fe.getEssentialPropertiesForRepresentation(e)}catch(e){return[]}}function T(e){return fe.getRealPeriodForIndex(e,he[0].mpd.manifest)}function S(e){var t,n=$(e);return t=fe.getRepresentationsForAdaptation(n),t}function b(e,t,n,r){try{if(!e||!t||isNaN(n)||!r)return null;var a=e.scheme_id_uri,i=e.value;if(!t[a+"/"+i])return null;var o,s=new l.default,u=e.timescale||1,c=r.adaptation.period.start,f=t[a+"/"+i],d=isNaN(r.presentationTimeOffset)?isNaN(f.presentationTimeOffset)?0:f.presentationTimeOffset:r.presentationTimeOffset,h=e.presentation_time_delta/u;o=0===e.version?c+n-d+h:c-d+h;var g=e.event_duration,p=e.id,m=e.message_data;return s.eventStream=f,s.eventStream.value=i,s.eventStream.timescale=u,s.duration=g,s.id=p,s.calculatedPresentationTime=o,s.messageData=m,s.presentationTimeDelta=h,s}catch(e){return null}}function A(e,t){var n=[];if(he.length>0){var r=he[0].mpd.manifest;e instanceof s.default?n=fe.getEventsForPeriod(Z(e,he)):e instanceof o.default?n=fe.getEventStreamForAdaptationSet(r,$(e)):e instanceof i.default&&(n=fe.getEventStreamForRepresentation(r,t))}return n}function R(e,t,n){ge[e]=ge[e]||{},ge[e][t]=ge[e][t]||{},ge[e][t]=n}function I(e){return fe.getIsText(e)}function C(){var e=J();return fe.getUTCTimingSources(e)}function N(){var e=he.length>0?he[0].mpd:null;return fe.getSuggestedPresentationDelay(e)}function D(e){var t=P(e);return fe.getAvailabilityStartTime(t)}function w(e){var t=J(e);return fe.getIsDynamic(t)}function O(e){var t=J(e);return fe.getDuration(t)}function M(e){var t=P(e);return fe.getRegularPeriods(t)}function P(e){var t=J(e);return fe.getMpd(t)}function L(e){return fe.getLocation(e)}function F(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return fe.getManifestUpdatePeriod(e,t)}function j(e){return fe.getPublishTime(e)}function x(e){var t=fe.getPatchLocation(e),n=fe.getPublishTime(e);if(!t||!n)return null;if(t.hasOwnProperty("ttl")&&n){var r=1e3*parseFloat(t.ttl);if(n.getTime()+r<=(new Date).getTime())return null}return t.__text}function k(e){return fe.hasProfile(e,Ee)}function B(e){return de.getIsPatch(e)}function U(e){return fe.getBaseURLsFromElement(e)}function G(){return fe.getRepresentationSortFunction()}function H(e,t,n){return fe.getCodec(e,t,n)}function q(e,t){var n,r=oe(t);return n=ue(r,e),n?n.bandwidth:null}function Y(e,t){var n=oe(t);return se(n,e)}function K(e,t){var n=oe(t);return le(n,e)}function V(e){if(!e||0===he.length)return null;var t=he.filter(function(t){return t.id===e});return t&&t.length>0?t[0]:null}function W(e,t){return fe.getIsTypeOf(e,t)}function z(){he=[],ge={}}function X(e,t){var n=fe.getId(e),r=de.getMpdId(t),a=fe.getPublishTime(e),i=de.getPublishTime(t),o=de.getOriginalPublishTime(t);return!!(n&&r&&n==r&&a&&o&&a.getTime()==o.getTime()&&i&&a.getTime()<i.getTime())}function Q(e,t){de.getPatchOperations(t).forEach(function(t){var n=t.getMpdTarget(e);if(null!==n){var r=n.name,a=n.target,i=n.leaf;if(t.xpath.findsAttribute())switch(t.action){case"add":case"replace":a[r]=t.value;break;case"remove":delete a[r]}else{var o=(a[r+"_asArray"]||[]).indexOf(i),s="prepend"===t.position||"before"===t.position;if(("remove"===t.action||"replace"===t.action)&&(delete a[r],-1!=o)){var u=a[r+"_asArray"];u.splice(o,1),u.length>1?a[r]=u:1==u.length?a[r]=u[0]:delete a[r+"_asArray"]}"add"!==t.action&&"replace"!==t.action||Object.keys(t.value).forEach(function(e){var n=t.value[e],i=a[e+"_asArray"]||[];if(0===i.length&&a[e]&&i.push(a[e]),0===i.length)i=n;else{var u=i.length;u=e==r&&-1!=o?o+(s?0:1)+("replace"==t.action?-1:0):s?0:i.length,i.splice.apply(i,[u,0].concat(n))}a[e+"_asArray"]=i,a[e]=1==i.length?i[0]:i})}}})}function J(e){return e||(he.length>0?he[0].mpd.manifest:null)}function $(e){try{var t=Z(e.streamInfo,he),n=fe.getAdaptationsForPeriod(t);return e&&e.streamInfo&&void 0!==e.streamInfo.id&&n?n[e.index]:null}catch(e){return null}}function Z(e,t){for(var n=t.length,r=0;r<n;r++){var a=t[r];if(e&&e.id===a.id)return a}return null}function ee(e){if(!e)return null;var t,n=new o.default,r=e.period.mpd.manifest.Period_asArray[e.period.index].AdaptationSet_asArray[e.index];if(n.id=e.id,n.index=e.index,n.type=e.type,n.streamInfo=re(e.period),n.representationCount=fe.getRepresentationCount(r),n.labels=fe.getLabelsForAdaptation(r),n.lang=fe.getLanguageForAdaptation(r),t=fe.getViewpointForAdaptation(r),n.viewpoint=t?t.value:void 0,n.accessibility=fe.getAccessibilityForAdaptation(r).map(function(e){var t=e.value,r=t;return e.schemeIdUri&&e.schemeIdUri.search("cea-608")>=0&&void 0!==me&&(r=t?"cea-608:"+t:"cea-608",n.embeddedCaptions=!0),r}),n.audioChannelConfiguration=fe.getAudioChannelConfigurationForAdaptation(r).map(function(e){return e.value}),0===n.audioChannelConfiguration.length&&Array.isArray(r.Representation_asArray)&&r.Representation_asArray.length>0&&(n.audioChannelConfiguration=fe.getAudioChannelConfigurationForRepresentation(r.Representation_asArray[0]).map(function(e){return e.value})),n.roles=fe.getRolesForAdaptation(r).map(function(e){return e.value}),n.codec=fe.getCodec(r),n.mimeType=fe.getMimeType(r),n.contentProtection=fe.getContentProtectionData(r),n.bitrateList=fe.getBitrateListForAdaptation(r),n.selectionPriority=fe.getSelectionPriority(r),n.contentProtection){var a=n.contentProtection.map(function(e){return fe.getKID(e)}).filter(function(e){return null!==e});if(a.length){var i=a[0];n.contentProtection.forEach(function(e){e.keyId=i})}}return n.isText=fe.getIsText(r),n.supplementalProperties=fe.getSupplementalProperties(r),n.isFragmented=fe.getIsFragmented(r),n.isEmbedded=!1,n}function te(e,t,n){e.id=t,e.index=100+parseInt(t.substring(2,3)),e.type=pe.TEXT,e.codec="cea-608-in-SEI",e.isEmbedded=!0,e.isFragmented=!1,e.lang=n,e.roles=["caption"]}function ne(e){e.type=pe.IMAGE}function re(e){var t=new s.default,n=1;return t.id=e.id,t.index=e.index,t.start=e.start,t.duration=e.duration,t.manifestInfo=ae(e.mpd),t.isLast=1===e.mpd.manifest.Period_asArray.length||Math.abs(t.start+t.duration-t.manifestInfo.duration)<n,t}function ae(e){var t=new u.default;return t.dvrWindowSize=e.timeShiftBufferDepth,t.loadedTime=e.manifest.loadedTime,t.availableFrom=e.availabilityStartTime,t.minBufferTime=e.manifest.minBufferTime,t.maxFragmentDuration=e.maxSegmentDuration,t.duration=fe.getDuration(e.manifest),t.isDynamic=fe.getIsDynamic(e.manifest),t.serviceDescriptions=fe.getServiceDescriptions(e.manifest),t.protocol=e.manifest.protocol,t}function ie(){if(!pe)throw new Error("setConfig function has to be called previously")}function oe(e){return he.length>0?he[0].mpd.manifest.Period_asArray[e]:null}function se(e,t){var n=ue(e,t,!0);return null!==n?n:-1}function ue(e,t,n){var r,a,i,o,s,u;if(e)for(a=e.AdaptationSet_asArray,s=0;s<a.length;s+=1)for(r=a[s],o=r.Representation_asArray,u=0;u<o.length;u+=1)if(i=o[u],t===i.id)return n?u:i;return null}function le(e,t){var n,r,a,i;if(!e||!t)return-1;for(r=e.AdaptationSet_asArray,i=0;i<r.length;i+=1)if(n=r[i],a=n.Representation_asArray,fe.getIsTypeOf(n,t))return a.length;return-1}var ce,fe,de,he,ge,pe,me,ye=this.context,Ee="urn:dvb:dash:profile:dvb-dash:2014";return ce={getBandwidthForRepresentation:q,getIndexForRepresentation:Y,
getMaxIndexForBufferType:K,convertRepresentationToRepresentationInfo:n,getStreamsInfo:E,getMediaInfoForType:r,getAllMediaInfoForType:m,getAdaptationForType:h,getRealAdaptation:_,getRealPeriodByIndex:T,getEssentialPropertiesForRepresentation:v,getVoRepresentations:S,getEventsFor:A,getEvent:b,getMpd:P,setConfig:t,updatePeriods:y,getIsTextTrack:I,getUTCTimingSources:C,getSuggestedPresentationDelay:N,getAvailabilityStartTime:D,getIsTypeOf:W,getIsDynamic:w,getDuration:O,getRegularPeriods:M,getLocation:L,getPatchLocation:x,getManifestUpdatePeriod:F,getPublishTime:j,getIsDVB:k,getIsPatch:B,getBaseURLsFromElement:U,getRepresentationSortFunction:G,getCodec:H,getPeriodById:V,setCurrentMediaInfo:R,isPatchValid:X,applyPatchToManifest:Q,areMediaInfosEqual:g,reset:z},e(),ce}n.r(t);var a=n("./src/dash/constants/DashConstants.js"),i=n("./src/dash/vo/RepresentationInfo.js"),o=n("./src/dash/vo/MediaInfo.js"),s=n("./src/dash/vo/StreamInfo.js"),u=n("./src/dash/vo/ManifestInfo.js"),l=n("./src/dash/vo/Event.js"),c=n("./src/core/FactoryMaker.js"),f=n("./src/dash/models/DashManifestModel.js"),d=n("./src/dash/models/PatchManifestModel.js");r.__dashjs_factory_name="DashAdapter",t.default=c.default.getSingletonFactory(r)},"./src/dash/DashHandler.js":function(e,t,n){function r(e){function t(){I=O.getLogger(R),d(),w.on(s.default.DYNAMIC_TO_STATIC,A,R)}function n(e){N=e,D=!1,F.initialize(e)}function r(){return L.id}function o(){return P}function f(){return L}function d(){C=null}function h(){d(),w.off(s.default.DYNAMIC_TO_STATIC,A,R)}function g(e,t,n){var r,a,i=x.resolve(n.path);return i&&t!==i.url&&M.isRelative(t)?(r=i.url,a=i.serviceLocation,t&&(r=M.resolve(t,r))):r=t,!M.isRelative(r)&&(e.url=r,e.serviceLocation=a,!0)}function p(e,t){return t?m(e,t,o()):null}function m(e,t,n){var r=new a.default,o=t.adaptation.period,s=o.start;if(r.mediaType=n,r.type=i.HTTPRequest.INIT_SEGMENT_TYPE,r.range=t.range,r.availabilityStartTime=j.calcAvailabilityStartTimeFromPresentationTime(s,t,N),r.availabilityEndTime=j.calcAvailabilityEndTimeFromPresentationTime(s+o.duration,t,N),r.quality=t.index,r.mediaInfo=e,r.representationId=t.id,g(r,t.initialization,t))return r.url=Object(u.replaceTokenForTemplate)(r.url,"Bandwidth",t.bandwidth),r}function y(e,t){if(null==t)return null;var n=new a.default,r=t.representation,s=r.adaptation.period.mpd.manifest.Period_asArray[r.adaptation.period.index].AdaptationSet_asArray[r.adaptation.index].Representation_asArray[r.index].bandwidth,l=t.media;return l=Object(u.replaceTokenForTemplate)(l,"Number",t.replacementNumber),l=Object(u.replaceTokenForTemplate)(l,"Time",t.replacementTime),l=Object(u.replaceTokenForTemplate)(l,"Bandwidth",s),l=Object(u.replaceIDForTemplate)(l,r.id),l=Object(u.unescapeDollarsInTemplate)(l),n.mediaType=o(),n.type=i.HTTPRequest.MEDIA_SEGMENT_TYPE,n.range=t.mediaRange,n.startTime=t.presentationStartTime,n.mediaStartTime=t.mediaStartTime,n.duration=t.duration,n.timescale=r.timescale,n.availabilityStartTime=t.availabilityStartTime,n.availabilityEndTime=t.availabilityEndTime,n.wallStartTime=t.wallStartTime,n.quality=r.index,n.index=t.index,n.mediaInfo=e,n.adaptationIndex=r.adaptation.index,n.representationId=r.id,g(n,l,r)?n:void 0}function E(e,t){if(!e||!C)return!1;if(D)return!0;if(!isFinite(e.adaptation.period.duration))return!1;if(C.presentationStartTime+C.duration>t)return!1;if(e.mediaFinishedInformation&&!isNaN(e.mediaFinishedInformation.numberOfSegments)&&!isNaN(C.index)&&C.index>=e.mediaFinishedInformation.numberOfSegments-1){if(!N||e.segmentInfoType===l.default.SEGMENT_TEMPLATE)return!0;if(N&&e.segmentInfoType===l.default.SEGMENT_LIST&&e.adaptation.period.nextPeriodId)return!0}return!!(N&&e.adaptation.period.nextPeriodId&&e.segmentInfoType===l.default.SEGMENT_TIMELINE&&e.mediaFinishedInformation&&!isNaN(e.mediaFinishedInformation.mediaTimeOfLastSignaledSegment)&&C&&!isNaN(C.mediaStartTime)&&!isNaN(C.duration)&&C.mediaStartTime+C.duration>=e.mediaFinishedInformation.mediaTimeOfLastSignaledSegment-.05)}function _(e,t,n){var r=null;if(!t||!t.segmentInfoType)return r;var a=F.getSegmentByTime(t,n);return a&&(C=a,I.debug("Index for time "+n+" is "+a.index),r=y(e,a)),r}function v(e,t){var n=null,r=C?C.index+1:0,a=F.getSegmentByIndex(t,r,C?C.mediaStartTime:-1);return a?(n=y(e,a),n):null}function T(e,t){var n=null;if(!t||!t.segmentInfoType)return null;var r=C?C.index+1:0,a=F.getSegmentByIndex(t,r,C?C.mediaStartTime:-1);if(a)n=y(e,a),C=a;else{if(N&&!D)return I.debug(o()+" No segment found at index: "+r+". Wait for next loop"),null;D=!0}return n}function S(e,t,n,r){try{if(isNaN(e)||!t||!n)return NaN;if(e<0&&(e=0),isNaN(r)&&(r=c),_(t,n,e))return e;for(var a=n.adaptation.period.start,i=n.adaptation.period.start+n.adaptation.period.duration,o=Math.min(e+r,i),s=Math.max(e-r,a),u=NaN,l=null;o<=i||s>=a;){var f=null,d=null;if(o<=i&&(f=_(t,n,o)),s>=a&&(d=_(t,n,s)),d){u=s,l=d;break}if(f){u=o,l=f;break}o+=r,s-=r}if(l){var h=l.startTime+l.duration;return e>=l.startTime&&h-e>r?e:e<l.startTime?l.startTime:Math.min(h-r,u)}return u}catch(e){return NaN}}function b(){return C?C.index:-1}function A(){I.debug("Dynamic stream complete"),D=!0}e=e||{};var R,I,C,N,D,w=e.eventBus,O=e.debug,M=e.urlUtils,P=e.type,L=e.streamInfo,F=e.segmentsController,j=e.timelineConverter,x=e.baseURLController;return R={initialize:n,getStreamId:r,getType:o,getStreamInfo:f,getInitRequest:p,getSegmentRequestForTime:_,getCurrentIndex:b,getNextSegmentRequest:T,isLastSegmentRequested:E,reset:h,getNextSegmentRequestIdempotent:v,getValidSeekTimeCloseToTargetTime:S},t(),R}n.r(t);var a=n("./src/streaming/vo/FragmentRequest.js"),i=n("./src/streaming/vo/metrics/HTTPRequest.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/streaming/MediaPlayerEvents.js"),u=n("./src/dash/utils/SegmentsUtils.js"),l=n("./src/dash/constants/DashConstants.js"),c=.5;r.__dashjs_factory_name="DashHandler",t.default=o.default.getClassFactory(r)},"./src/dash/DashMetrics.js":function(e,t,n){function r(e){function t(){V=V||Object(l.default)(K).getInstance({settings:e.settings}),n()}function n(){H=!0,q=null,Y=null}function r(e){var t=V.getMetricsFor(e,!0);return v(t,s.default.TRACK_SWITCH)}function o(e,t,n,r,a){V.addRepresentationSwitch(e,t,n,r,a)}function d(e){var t=V.getMetricsFor(e,!0);return v(t,s.default.BUFFER_STATE)}function h(e){var t=V.getMetricsFor(e,!0),n=v(t,s.default.BUFFER_LEVEL);return n?u.default.round10(n.level/1e3,-3):0}function g(e,t,n){V.addBufferLevel(e,t,n)}function p(e,t,n){V.addBufferState(e,t,n)}function m(){V.clearAllCurrentMetrics()}function y(e){var t=V.getMetricsFor(e,!0);if(!t)return null;var n,r=t.HttpList,a=null;if(!r||r.length<=0)return null;for(n=r.length-1;n>=0;){if(r[n].responsecode){a=r[n];break}n--}return a}function E(e){var t=V.getMetricsFor(e,!0);return t&&t.HttpList?t.HttpList:[]}function _(e,t,n){V.addRequestsQueue(e,t,n)}function v(e,t){if(!e)return null;var n=e[t];return n&&0!==n.length?n[n.length-1]:null}function T(){var e=V.getMetricsFor(a.default.VIDEO,!0);return v(e,s.default.DROPPED_FRAMES)}function S(e){V.addDroppedFrames(a.default.VIDEO,e)}function b(e){var t=V.getMetricsFor(e,!0);return v(t,s.default.SCHEDULING_INFO)}function A(e,t){V.addSchedulingInfo(e.mediaType,new Date,e.type,e.startTime,e.availabilityStartTime,e.duration,e.quality,e.range,t)}function R(){var e=V.getMetricsFor(a.default.STREAM);return v(e,s.default.MANIFEST_UPDATE)}function I(e){var t=this.getCurrentManifestUpdate();V.updateManifestUpdateInfo(t,e)}function C(e){if(e){var t=this.getCurrentManifestUpdate();V.addManifestUpdateStreamInfo(t,e.id,e.index,e.start,e.duration)}}function N(e){V.addManifestUpdate(a.default.STREAM,e.type,e.requestStartDate,e.requestEndDate)}function D(e,t,n,r,a){V.addHttpRequest(e.mediaType,null,e.type,e.url,e.quality,t,e.serviceLocation||null,e.range||null,e.requestStartDate,e.firstByteDate,e.requestEndDate,n,e.duration,r,a)}function w(e,t){if(e){var n=this.getCurrentManifestUpdate();V.addManifestUpdateRepresentationInfo(n,e.id,e.index,e.streamIndex,t,e.presentationTimeOffset,e.startNumber,e.fragmentInfoType)}}function O(e){var t=e?V.getMetricsFor(e,!0):V.getMetricsFor(a.default.VIDEO,!0)||V.getMetricsFor(a.default.AUDIO,!0);return v(t,s.default.DVR_INFO)}function M(e,t,n,r){V.addDVRInfo(e,t,n,r)}function P(e){if(!e)return null;var t,n,r,o={};for(t=E(a.default.STREAM),r=t.length-1;r>=0;r--)if(n=t[r],n.type===i.HTTPRequest.MPD_TYPE){o=c.default.parseHttpHeaders(n._responseHeaders);break}var s=o[e.toLowerCase()];return void 0===s?null:s}function L(e,t){if(!t)return null;var n={},r=y(e);r&&(n=c.default.parseHttpHeaders(r._responseHeaders));var a=n[t.toLowerCase()];return void 0===a?null:a}function F(){Y&&(V.addPlayList(Y),Y=null)}function j(e,t){Y=new f.PlayList,Y.start=new Date,Y.mstart=e,Y.starttype=t}function x(e,t,n){!0===H&&(H=!1,q=new f.PlayListTrace,q.representationid=e,q.start=new Date,q.mstart=t,q.playbackspeed=null!==n?n.toString():null)}function k(e){if(q)for(var t in q)q[t]=e[t]}function B(e,t){if(!1===H&&Y&&q&&q.start){var n=q.start,r=e.getTime()-n.getTime();q.duration=r,q.stopreason=t,Y.trace.push(q),H=!0}}function U(e){V.addDVBErrors(e)}e=e||{};var G,H,q,Y,K=this.context,V=e.metricsModel;return G={getCurrentRepresentationSwitch:r,getCurrentBufferState:d,getCurrentBufferLevel:h,getCurrentHttpRequest:y,getHttpRequests:E,getCurrentDroppedFrames:T,getCurrentSchedulingInfo:b,getCurrentDVRInfo:O,getCurrentManifestUpdate:R,getLatestFragmentRequestHeaderValueByID:L,getLatestMPDRequestHeaderValueByID:P,addRepresentationSwitch:o,addDVRInfo:M,updateManifestUpdateInfo:I,addManifestUpdateStreamInfo:C,addManifestUpdateRepresentationInfo:w,addManifestUpdate:N,addHttpRequest:D,addSchedulingInfo:A,addRequestsQueue:_,addBufferLevel:g,addBufferState:p,addDroppedFrames:S,addPlayList:F,addDVBErrors:U,createPlaylistMetrics:j,createPlaylistTraceMetrics:x,updatePlayListTraceMetrics:k,pushPlayListTraceMetrics:B,clearAllCurrentMetrics:m},t(),G}n.r(t);var a=n("./src/streaming/constants/Constants.js"),i=n("./src/streaming/vo/metrics/HTTPRequest.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/streaming/constants/MetricsConstants.js"),u=n("./src/dash/utils/Round10.js"),l=n("./src/streaming/models/MetricsModel.js"),c=n("./src/core/Utils.js"),f=n("./src/streaming/vo/metrics/PlayList.js");r.__dashjs_factory_name="DashMetrics",t.default=o.default.getSingletonFactory(r)},"./src/dash/SegmentBaseLoader.js":function(e,t,n){function r(){function e(){T=Object(u.default)(C).create({errHandler:m,dashMetrics:_,mediaPlayerModel:v,requestModifier:E,boxParser:y,errors:S,urlUtils:R,constants:b,dashConstants:A})}function t(e){e.baseURLController&&(I=e.baseURLController),e.dashMetrics&&(_=e.dashMetrics),e.mediaPlayerModel&&(v=e.mediaPlayerModel),e.errHandler&&(m=e.errHandler),e.boxParser&&(y=e.boxParser),e.debug&&(p=e.debug.getLogger(g)),e.requestModifier&&(E=e.requestModifier),e.errors&&(S=e.errors),e.urlUtils&&(R=e.urlUtils),e.constants&&(b=e.constants),e.dashConstants&&(A=e.dashConstants)}function n(e,t){return new Promise(function(n){r(e,t,n)})}function r(e,t,n,a){var i=null,o=e?I.resolve(e.path):null,s=a||{init:!0,url:o?o.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500,mediaType:t};p.debug("Start searching for initialization.");var u=h(s),l=function(a){if(s.bytesLoaded=s.range.end,i=y.findInitRange(a),!i)return s.range.end=s.bytesLoaded+s.bytesToLoad,r(e,t,n,s);e.range=i,n(e)},c=function(){n(e)};T.load({request:u,success:l,error:c}),p.debug("Perform init search: "+s.url)}function o(e,t,n){return new Promise(function(r){l(e,t,n,r)})}function l(e,t,n,r,a,i){if(n&&(void 0===n.start||void 0===n.end)){var o=n?n.toString().split("-"):null;n=o?{start:parseFloat(o[0]),end:parseFloat(o[1])}:null}a=a||c;var s=null,u=null,f=!!n,g=e?I.resolve(e.path):null,m={init:!1,url:g?g.url:void 0,range:f?n:{start:0,end:1500},searching:!f,bytesLoaded:i?i.bytesLoaded:0,bytesToLoad:1500,mediaType:t},E=h(m),_=function(n){var i=m.bytesToLoad,o=n.byteLength;if(m.bytesLoaded=m.range.end-m.range.start,s=y.parse(n),u=s.getBox("sidx"),u&&u.isComplete){var c,f,h=u.references;if(null!=h&&h.length>0&&(c=1===h[0].reference_type),c){var g,E,_,v,T;p.debug("Initiate multiple SIDX load."),m.range.end=m.range.start+u.size;var S=[],b=0,A=(u.offset||m.range.start)+u.size,R=function(t){t?(S=S.concat(t),b++,b>=E&&(S.sort(function(e,t){return e.startTime-t.startTime<0?-1:0}),a(S,e,r))):a(null,e,r)};for(g=0,E=h.length;g<E;g++)_=A,v=A+h[g].referenced_size-1,A+=h[g].referenced_size,T={start:_,end:v},l(e,t,T,r,R,m)}else p.debug("Parsing segments from SIDX. representation "+t+" - id: "+e.id+" for range : "+m.range.start+" - "+m.range.end),f=d(u,m),a(f,e,r)}else{if(u)m.range.start=u.offset||m.range.start,m.range.end=m.range.start+(u.size||i);else{if(o<m.bytesLoaded)return void a(null,e,r);var I=s.getLastBox();I&&I.size?(m.range.start=I.offset+I.size,m.range.end=m.range.start+i):m.range.end+=i}l(e,t,m.range,r,null,m)}},v=function(){a(null,e,r)};T.load({request:E,success:_,error:v}),p.debug("Perform SIDX load for type ".concat(t," : ").concat(m.url," with range ").concat(m.range.start," - ").concat(m.range.end))}function c(e,t,n){n({segments:e,representation:t,error:e?void 0:new i.default(S.SEGMENT_BASE_LOADER_ERROR_CODE,S.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}function f(){T&&(T.abort(),T=null)}function d(e,t){for(var n,r,i,o,s=e.references,u=s.length,l=e.timescale,c=e.earliest_presentation_time,f=t.range.start+e.offset+e.first_offset+e.size,d=[],h=0;h<u;h++)i=s[h].subsegment_duration,o=s[h].referenced_size,n=new a.default,n.duration=i,n.startTime=c,n.timescale=l,r=f+o-1,n.mediaRange=f+"-"+r,d.push(n),c+=i,f+=o;return d}function h(e){if(e.url){var t=new s.default;return t.setInfo(e),t}}var g,p,m,y,E,_,v,T,S,b,A,R,I,C=this.context;return g={setConfig:t,initialize:e,loadInitialization:n,loadSegments:o,reset:f},g}n.r(t);var a=n("./src/dash/vo/Segment.js"),i=n("./src/streaming/vo/DashJSError.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/streaming/vo/FragmentRequest.js"),u=n("./src/streaming/net/URLLoader.js");r.__dashjs_factory_name="SegmentBaseLoader",t.default=o.default.getSingletonFactory(r)},"./src/dash/WebmSegmentBaseLoader.js":function(e,t,n){function r(){function e(){E={EBML:{tag:440786851,required:!0},Segment:{tag:408125543,required:!0,SeekHead:{tag:290298740,required:!0},Info:{tag:357149030,required:!0,TimecodeScale:{tag:2807729,required:!0,parse:"getMatroskaUint"},Duration:{tag:17545,required:!0,parse:"getMatroskaFloat"}},Tracks:{tag:374648427,required:!0},Cues:{tag:475249515,required:!0,CuePoint:{tag:187,required:!0,CueTime:{tag:179,required:!0,parse:"getMatroskaUint"},CueTrackPositions:{tag:183,required:!0,CueTrack:{tag:247,required:!0,parse:"getMatroskaUint"},CueClusterPosition:{tag:241,required:!0,parse:"getMatroskaUint"}}}}},Void:{tag:236,required:!0}}}function t(){b=Object(l.default)(I).create({errHandler:_,dashMetrics:T,mediaPlayerModel:S,requestModifier:v,errors:A})}function n(e){if(!(e.baseURLController&&e.dashMetrics&&e.mediaPlayerModel&&e.errHandler))throw new Error(i.default.MISSING_CONFIG_ERROR);R=e.baseURLController,T=e.dashMetrics,S=e.mediaPlayerModel,_=e.errHandler,A=e.errors,y=e.debug.getLogger(m),v=e.requestModifier}function r(e){var t,n,r=[],i=Object(a.default)(I).create({data:e});for(i.consumeTagAndSize(E.Segment.Cues);i.moreData()&&i.consumeTagAndSize(E.Segment.Cues.CuePoint,!0);){for(t={},t.CueTime=i.parseTag(E.Segment.Cues.CuePoint.CueTime),t.CueTracks=[];i.moreData()&&i.consumeTag(E.Segment.Cues.CuePoint.CueTrackPositions,!0);){var o=i.getMatroskaCodedNum(),s=i.getPos();if(n={},n.Track=i.parseTag(E.Segment.Cues.CuePoint.CueTrackPositions.CueTrack),0===n.Track)throw new Error("Cue track cannot be 0");n.ClusterPosition=i.parseTag(E.Segment.Cues.CuePoint.CueTrackPositions.CueClusterPosition),t.CueTracks.push(n),i.setPos(s+o)}if(0===t.CueTracks.length)throw new Error("Mandatory cuetrack not found");r.push(t)}if(0===r.length)throw new Error("mandatory cuepoint not found");return r}function o(e,t,n,a){var i,o,u,l,c,f,d,h;for(o=r(e),u=[],c=0,f=o.length;c<f;c+=1)l=new s.default,i=0,i=c<o.length-1?o[c+1].CueTime-o[c].CueTime:a-o[c].CueTime,l.duration=i,l.startTime=o[c].CueTime,l.timescale=1e3,d=o[c].CueTracks[0].ClusterPosition+t,h=c<o.length-1?o[c+1].CueTracks[0].ClusterPosition+t-1:n-1,l.mediaRange=d+"-"+h,u.push(l);return y.debug("Parsed cues: "+u.length+" cues."),u}function f(e,t,n,r){if(e&&0!==e.byteLength){var i,s,u,l,c=Object(a.default)(I).create({data:e}),f=n?n.split("-"):null,d=null,h={url:t,range:{start:f?parseFloat(f[0]):null,end:f?parseFloat(f[1]):null},request:d};for(y.debug("Parse EBML header: "+h.url),c.skipOverElement(E.EBML),c.consumeTag(E.Segment),u=c.getMatroskaCodedNum(),u+=c.getPos(),l=c.getPos();c.moreData()&&!c.consumeTagAndSize(E.Segment.Info,!0);)if(!(c.skipOverElement(E.Segment.SeekHead,!0)||c.skipOverElement(E.Segment.Tracks,!0)||c.skipOverElement(E.Segment.Cues,!0)||c.skipOverElement(E.Void,!0)))throw new Error("no valid top level element found");for(;void 0===i;){var p=c.getMatroskaCodedNum(!0),m=c.getMatroskaCodedNum();switch(p){case E.Segment.Info.Duration.tag:i=c[E.Segment.Info.Duration.parse](m);break;default:c.setPos(c.getPos()+m)}}d=g(h);var _=function(e){s=o(e,l,u,i),r(s)},v=function(){y.error("Download Error: Cues "+h.url),r(null)};b.load({request:d,success:_,error:v}),y.debug("Perform cues load: "+h.url+" bytes="+h.range.start+"-"+h.range.end)}else r(null)}function d(e,t){return new Promise(function(n){var r=null,a=e?R.resolve(e.path):null,i=e?e.range.split("-"):null,o={range:{start:i?parseFloat(i[0]):null,end:i?parseFloat(i[1]):null},request:r,url:a?a.url:void 0,init:!0,mediaType:t};y.info("Start loading initialization."),r=g(o);var s=function(){n(e)},u=function(){n(e)};b.load({request:r,success:s,error:u}),y.debug("Perform init load: "+o.url)})}function h(e,t,n){return new Promise(function(r){var a=null,i=e?R.resolve(e.path):null,o=i?i.url:void 0,s=8192,u={bytesLoaded:0,bytesToLoad:s,range:{start:0,end:s},request:a,url:o,init:!1,mediaType:t};a=g(u),y.debug("Parsing ebml header");var l=function(t){f(t,o,n,function(t){r({segments:t,representation:e,error:t?void 0:new c.default(A.SEGMENT_BASE_LOADER_ERROR_CODE,A.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})})},d=function(){r({representation:e,error:new c.default(A.SEGMENT_BASE_LOADER_ERROR_CODE,A.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})};b.load({request:a,success:l,error:d})})}function g(e){var t=new u.default;return t.setInfo(e),t}function p(){b&&(b.abort(),b=null)}var m,y,E,_,v,T,S,b,A,R,I=this.context;return m={setConfig:n,initialize:t,loadInitialization:d,loadSegments:h,reset:p},e(),m}n.r(t);var a=n("./src/streaming/utils/EBMLParser.js"),i=n("./src/streaming/constants/Constants.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/dash/vo/Segment.js"),u=n("./src/streaming/vo/FragmentRequest.js"),l=n("./src/streaming/net/URLLoader.js"),c=n("./src/streaming/vo/DashJSError.js");r.__dashjs_factory_name="WebmSegmentBaseLoader",t.default=o.default.getSingletonFactory(r)},"./src/dash/constants/DashConstants.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}n.r(t);var o=function(){function e(){r(this,e),this.init()}return i(e,[{key:"init",value:function(){this.BASE_URL="BaseURL",this.SEGMENT_BASE="SegmentBase",this.SEGMENT_TEMPLATE="SegmentTemplate",this.SEGMENT_LIST="SegmentList",this.SEGMENT_URL="SegmentURL",this.SEGMENT_TIMELINE="SegmentTimeline",this.SEGMENT_PROFILES="segmentProfiles",this.ADAPTATION_SET="AdaptationSet",this.REPRESENTATION="Representation",this.REPRESENTATION_INDEX="RepresentationIndex",this.SUB_REPRESENTATION="SubRepresentation",this.INITIALIZATION="Initialization",this.INITIALIZATION_MINUS="initialization",this.MPD="MPD",this.PERIOD="Period",this.ASSET_IDENTIFIER="AssetIdentifier",this.EVENT_STREAM="EventStream",this.ID="id",this.PROFILES="profiles",this.SERVICE_LOCATION="serviceLocation",this.RANGE="range",this.INDEX="index",this.MEDIA="media",this.BYTE_RANGE="byteRange",this.INDEX_RANGE="indexRange",this.MEDIA_RANGE="mediaRange",this.VALUE="value",this.CONTENT_TYPE="contentType",this.MIME_TYPE="mimeType",this.BITSTREAM_SWITCHING="BitstreamSwitching",this.BITSTREAM_SWITCHING_MINUS="bitstreamSwitching",this.CODECS="codecs",this.DEPENDENCY_ID="dependencyId",this.MEDIA_STREAM_STRUCTURE_ID="mediaStreamStructureId",this.METRICS="Metrics",this.METRICS_MINUS="metrics",this.REPORTING="Reporting",this.WIDTH="width",this.HEIGHT="height",this.SAR="sar",this.FRAMERATE="frameRate",this.AUDIO_SAMPLING_RATE="audioSamplingRate",this.MAXIMUM_SAP_PERIOD="maximumSAPPeriod",this.START_WITH_SAP="startWithSAP",this.MAX_PLAYOUT_RATE="maxPlayoutRate",this.CODING_DEPENDENCY="codingDependency",this.SCAN_TYPE="scanType",this.FRAME_PACKING="FramePacking",this.AUDIO_CHANNEL_CONFIGURATION="AudioChannelConfiguration",this.CONTENT_PROTECTION="ContentProtection",this.ESSENTIAL_PROPERTY="EssentialProperty",this.SUPPLEMENTAL_PROPERTY="SupplementalProperty",this.INBAND_EVENT_STREAM="InbandEventStream",this.ACCESSIBILITY="Accessibility",this.ROLE="Role",this.RATING="Rating",this.CONTENT_COMPONENT="ContentComponent",this.SUBSET="Subset",this.LANG="lang",this.VIEWPOINT="Viewpoint",this.ROLE_ASARRAY="Role_asArray",this.ACCESSIBILITY_ASARRAY="Accessibility_asArray",this.AUDIOCHANNELCONFIGURATION_ASARRAY="AudioChannelConfiguration_asArray",this.CONTENTPROTECTION_ASARRAY="ContentProtection_asArray",this.MAIN="main",this.DYNAMIC="dynamic",this.STATIC="static",this.MEDIA_PRESENTATION_DURATION="mediaPresentationDuration",this.MINIMUM_UPDATE_PERIOD="minimumUpdatePeriod",this.CODEC_PRIVATE_DATA="codecPrivateData",this.BANDWITH="bandwidth",this.SOURCE_URL="sourceURL",this.TIMESCALE="timescale",this.DURATION="duration",this.START_NUMBER="startNumber",this.PRESENTATION_TIME_OFFSET="presentationTimeOffset",this.AVAILABILITY_START_TIME="availabilityStartTime",this.AVAILABILITY_END_TIME="availabilityEndTime",this.TIMESHIFT_BUFFER_DEPTH="timeShiftBufferDepth",this.MAX_SEGMENT_DURATION="maxSegmentDuration",this.PRESENTATION_TIME="presentationTime",this.MIN_BUFFER_TIME="minBufferTime",this.MAX_SUBSEGMENT_DURATION="maxSubsegmentDuration",this.START="start",this.AVAILABILITY_TIME_OFFSET="availabilityTimeOffset",this.AVAILABILITY_TIME_COMPLETE="availabilityTimeComplete",this.CENC_DEFAULT_KID="cenc:default_KID",this.DVB_PRIORITY="dvb:priority",this.DVB_WEIGHT="dvb:weight",this.SUGGESTED_PRESENTATION_DELAY="suggestedPresentationDelay",this.SERVICE_DESCRIPTION="ServiceDescription",this.SERVICE_DESCRIPTION_SCOPE="Scope",this.SERVICE_DESCRIPTION_LATENCY="Latency",this.SERVICE_DESCRIPTION_PLAYBACK_RATE="PlaybackRate",this.PATCH_LOCATION="PatchLocation",this.PUBLISH_TIME="publishTime",this.ORIGINAL_PUBLISH_TIME="originalPublishTime",this.ORIGINAL_MPD_ID="mpdId"}}]),e}(),s=new o;t.default=s},"./src/dash/controllers/RepresentationController.js":function(e,t,n){function r(e){function t(){f(),M.on(o.default.MANIFEST_VALIDITY_CHANGED,I,C)}function n(){return B.id}function r(){return k}function i(){if(!(L&&F&&j&&x))throw new Error(a.default.MISSING_CONFIG_ERROR)}function u(){return N}function l(){return D}function c(){return O}function f(){N=null,D=!0,w=[]}function d(){M.off(o.default.MANIFEST_VALIDITY_CHANGED,I,C),f()}function h(e,t,n,r,o){i(),D=!0,w=t;var s=_(o);if(R(s),N=e,n!==a.default.VIDEO&&n!==a.default.AUDIO&&(n!==a.default.TEXT||!r))return S(),Promise.resolve();for(var u=[],l=0,c=w.length;l<c;l++){var f=w[l];u.push(g(f))}return Promise.all(u)}function g(e){return new Promise(function(t,n){var r=e.hasInitialization(),a=e.hasSegments(),i=[];i.push(G.updateInitData(e,r)),i.push(G.updateSegmentData(e,a)),Promise.all(i).then(function(n){n[0]&&!n[0].error&&(e=m(e,n[0])),n[1]&&!n[1].error&&(e=y(e,n[1])),p(e),b(e),t()}).catch(function(e){n(e)})})}function p(e){e.mediaFinishedInformation=G.getMediaFinishedInformation(e)}function m(e,t){return t&&!t.error&&t.representation?t.representation:e}function y(e,t){if(t&&!t.error){var n,r,a,i,o=t.segments,u=[],l=0;for(n=0,r=o?o.length:0;n<r;n++)a=o[n],i=Object(s.getTimeBasedSegment)(x,H,e,a.startTime,a.duration,a.timescale,a.media,a.mediaRange,l),i&&(u.push(i),i=null,l++);return u.length>0&&(e.segments=u),e}}function E(){i();var e=new Date,t=c(),n=1e3*j.getTime();t&&F.addRepresentationSwitch(t.adaptation.type,e,n,t.id),M.trigger(o.default.REPRESENTATION_SWITCH,{mediaType:k,streamId:B.id,currentRepresentation:t,numberOfRepresentations:w.length},{streamId:B.id,mediaType:k})}function _(e){return null==e||e>=w.length?null:w[e]}function v(e){return w.indexOf(e)}function T(){for(var e=0,t=w.length;e<t;e++){var n=w[e].segmentInfoType;if(!w[e].hasInitialization()||(n===U.SEGMENT_BASE||n===U.BASE_URL)&&!w[e].segments)return!1}return!0}function S(e){D=!1,M.trigger(P.DATA_UPDATE_COMPLETED,{data:N,currentRepresentation:O,error:e},{streamId:B.id,mediaType:k})}function b(e){if(l()){var t,n,a=F.getCurrentManifestUpdate(),i=!1;if(a){for(var o=0;o<a.representationInfo.length;o++)if(t=a.representationInfo[o],t.index===e.index&&t.mediaType===r()){i=!0;break}i||F.addManifestUpdateRepresentationInfo(e,r())}if(T()){L.setPlaybackQuality(k,B,v(O));var s=F.getCurrentDVRInfo(k);s&&F.updateManifestUpdateInfo({latency:s.range.end-j.getTime()}),n=F.getCurrentRepresentationSwitch(c().adaptation.type),n||E(),S()}}}function A(e){var t=_(e);R(t),E()}function R(e){O=e}function I(e){if(e.newDuration){var t=c();if(t&&t.adaptation.period){var n=t.adaptation.period;n.duration=e.newDuration}}}e=e||{};var C,N,D,w,O,M=e.eventBus,P=e.events,L=e.abrController,F=e.dashMetrics,j=e.playbackController,x=e.timelineConverter,k=e.type,B=e.streamInfo,U=e.dashConstants,G=e.segmentsController,H=e.isDynamic;return C={getStreamId:n,getType:r,getData:u,isUpdating:l,updateData:h,getCurrentRepresentation:c,getRepresentationForQuality:_,prepareQualityChange:A,reset:d},t(),C}n.r(t);var a=n("./src/streaming/constants/Constants.js"),i=n("./src/core/FactoryMaker.js"),o=n("./src/streaming/MediaPlayerEvents.js"),s=n("./src/dash/utils/SegmentsUtils.js");r.__dashjs_factory_name="RepresentationController",t.default=i.default.getClassFactory(r)},"./src/dash/controllers/SegmentBaseController.js":function(e,t,n){function r(e){function t(){c=Object(i.default)(d).getInstance(),f=Object(o.default)(d).getInstance(),c.setConfig({baseURLController:E,dashMetrics:p,mediaPlayerModel:m,errHandler:y,eventBus:h,events:g,errors:S,debug:_,boxParser:v,requestModifier:T}),f.setConfig({baseURLController:E,dashMetrics:p,mediaPlayerModel:m,errHandler:y,eventBus:h,events:g,errors:S,debug:_,requestModifier:T})}function n(e){var t=e?e.split("/")[1]:"";return"webm"===t.toLowerCase()}function r(){c.initialize(),f.initialize()}function a(e){return n(e.representation.mimeType)?f.loadInitialization(e.representation,e.mediaType):c.loadInitialization(e.representation,e.mediaType)}function s(e){return n(e.mimeType)?f.loadSegments(e.representation,e.mediaType,e.representation?e.representation.indexRange:null):c.loadSegments(e.representation,e.mediaType,e.representation?e.representation.indexRange:null)}function u(){c.reset(),f.reset()}e=e||{};var l,c,f,d=this.context,h=e.eventBus,g=e.events,p=e.dashMetrics,m=e.mediaPlayerModel,y=e.errHandler,E=e.baseURLController,_=e.debug,v=e.boxParser,T=e.requestModifier,S=e.errors;return l={initialize:r,getSegmentBaseInitSegment:a,getSegmentList:s,reset:u},t(),l}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/dash/SegmentBaseLoader.js"),o=n("./src/dash/WebmSegmentBaseLoader.js");r.__dashjs_factory_name="SegmentBaseController";var s=a.default.getSingletonFactory(r);t.default=s},"./src/dash/controllers/SegmentsController.js":function(e,t,n){function r(e){function t(){g={}}function n(t){g[m.SEGMENT_TIMELINE]=Object(i.default)(p).create(e,t),g[m.SEGMENT_TEMPLATE]=Object(o.default)(p).create(e,t),g[m.SEGMENT_LIST]=Object(s.default)(p).create(e,t),g[m.SEGMENT_BASE]=Object(u.default)(p).create(e,t)}function r(e,t){return t?Promise.resolve():E.getSegmentBaseInitSegment({representation:e,mediaType:y})}function a(e,t){return t?Promise.resolve():E.getSegmentList({mimeType:e.mimeType,representation:e,mediaType:y})}function l(e){return e?e.segments?g[m.SEGMENT_BASE]:g[e.segmentInfoType]:null}function c(e,t,n){var r=l(e);return r?r.getSegmentByIndex(e,t,n):null}function f(e,t){var n=l(e);return n?n.getSegmentByTime(e,t):null}function d(e){var t=l(e);return t?t.getMediaFinishedInformation(e):{numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN}}e=e||{};var h,g,p=this.context,m=e.dashConstants,y=e.type,E=e.segmentBaseController;return h={initialize:n,updateInitData:r,updateSegmentData:a,getSegmentByIndex:c,getSegmentByTime:f,getMediaFinishedInformation:d},t(),h}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/dash/utils/TimelineSegmentsGetter.js"),o=n("./src/dash/utils/TemplateSegmentsGetter.js"),s=n("./src/dash/utils/ListSegmentsGetter.js"),u=n("./src/dash/utils/SegmentBaseGetter.js");r.__dashjs_factory_name="SegmentsController";var l=a.default.getClassFactory(r);t.default=l},"./src/dash/models/DashManifestModel.js":function(e,t,n){function r(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=a(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}}function a(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(){function e(){Ce=Object(v.default)(we).getInstance().getLogger(Ie)}function t(e,t){if(!e)throw new Error("adaptation is not defined");if(!t)throw new Error("type is not defined");if(e.Representation_asArray&&e.Representation_asArray.length){var n=te(e.Representation_asArray[0]);if(n&&n.length>0&&b.THUMBNAILS_SCHEME_ID_URIS.indexOf(n[0].schemeIdUri)>=0)return t===s.default.IMAGE}if(e.ContentComponent_asArray&&e.ContentComponent_asArray.length>0){if(e.ContentComponent_asArray.length>1)return t===s.default.MUXED;if(e.ContentComponent_asArray[0].contentType===t)return!0}var r=t===s.default.TEXT?new RegExp("(ttml|vtt|wvtt|stpp)"):new RegExp(t);if(e.Representation_asArray&&e.Representation_asArray.length){var a=e.Representation_asArray[0].codecs;if(r.test(a))return!0}if(e.hasOwnProperty(u.default.MIME_TYPE))return r.test(e.mimeType);if(e.Representation_asArray)for(var i,o=0;o<e.Representation_asArray.length;o++)if(i=e.Representation_asArray[o],i.hasOwnProperty(u.default.MIME_TYPE))return r.test(i.mimeType);return!1}function n(e){if(!e)throw new Error("adaptation is not defined");if(e.hasOwnProperty(u.default.SEGMENT_TEMPLATE)||e.hasOwnProperty(u.default.SEGMENT_TIMELINE)||e.hasOwnProperty(u.default.SEGMENT_LIST)||e.hasOwnProperty(u.default.SEGMENT_BASE))return!0;if(e.Representation_asArray&&e.Representation_asArray.length>0){var t=e.Representation_asArray[0];if(t.hasOwnProperty(u.default.SEGMENT_TEMPLATE)||t.hasOwnProperty(u.default.SEGMENT_TIMELINE)||t.hasOwnProperty(u.default.SEGMENT_LIST)||t.hasOwnProperty(u.default.SEGMENT_BASE))return!0}return!1}function a(e){return t(e,s.default.AUDIO)}function i(e){return t(e,s.default.VIDEO)}function o(e){return t(e,s.default.TEXT)}function _(e){return t(e,s.default.MUXED)}
function A(e){return t(e,s.default.IMAGE)}function R(e){var t="";return e&&e.hasOwnProperty(u.default.LANG)&&(t=e.lang.replace(/[^A-Za-z0-9-]/g,"")),t}function I(e){return e&&e.hasOwnProperty(u.default.VIEWPOINT)?e.Viewpoint:null}function C(e){return e&&e.hasOwnProperty(u.default.ROLE_ASARRAY)?e.Role_asArray:[]}function N(e){return e&&e.hasOwnProperty(u.default.ACCESSIBILITY_ASARRAY)?e.Accessibility_asArray:[]}function D(e){return e&&e.hasOwnProperty(u.default.AUDIOCHANNELCONFIGURATION_ASARRAY)?e.AudioChannelConfiguration_asArray:[]}function w(e){return e&&e.hasOwnProperty(u.default.AUDIOCHANNELCONFIGURATION_ASARRAY)?e.AudioChannelConfiguration_asArray:[]}function O(){return function(e,t){return e.bandwidth-t.bandwidth}}function M(e){return e&&Array.isArray(e.Representation_asArray)&&e.Representation_asArray.sort(O()),e}function P(e,t){return e&&e.Period_asArray&&Me(t)&&e.Period_asArray[t]?e.Period_asArray[t].AdaptationSet_asArray:[]}function L(e){return e&&e.Period_asArray?e.Period_asArray:[]}function F(e,t){var n=L(t);return n.length>0&&Me(e)?n[e]:null}function j(e,t,n){var r,a,i=P(t,n);for(r=0,a=i.length;r<a;r++)if(i[r].hasOwnProperty(u.default.ID)&&i[r].id===e)return i[r];return null}function x(e,t,n){var r=P(t,n);return r.length>0&&Me(e)?r[e]:null}function k(e,t,n){if(!e)return-1;for(var r=P(t,n),a=0;a<r.length;a++){var i=Object(y.default)(we).getInstance();if(i.areEqual(r[a],e))return a}return-1}function B(e,n,r){var a,i,o=P(e,n),s=[];for(a=0,i=o.length;a<i;a++)t(o[a],r)&&s.push(M(o[a]));return s}function U(e,t,n){var r=null;if(e&&e.Representation_asArray&&e.Representation_asArray.length>0){var a=Me(t)&&t>=0&&t<e.Representation_asArray.length?e.Representation_asArray[t]:e.Representation_asArray[0];a&&(r=a.mimeType+';codecs="'+a.codecs+'"',n&&void 0!==a.width&&(r+=';width="'+a.width+'";height="'+a.height+'"'))}return r&&(r=r.replace(/\sprofiles=[^;]*/g,"")),r}function G(e){return e&&e.Representation_asArray&&e.Representation_asArray.length>0?e.Representation_asArray[0].mimeType:null}function H(e){return e&&e.hasOwnProperty(u.default.CENC_DEFAULT_KID)?e[u.default.CENC_DEFAULT_KID]:null}function q(e){if(!e||!Array.isArray(e.Label_asArray))return[];for(var t=[],n=0;n<e.Label_asArray.length;n++)t.push({lang:e.Label_asArray[n].lang,text:e.Label_asArray[n].__text||e.Label_asArray[n]});return t}function Y(e){return e&&e.hasOwnProperty(u.default.CONTENTPROTECTION_ASARRAY)&&0!==e.ContentProtection_asArray.length?e.ContentProtection_asArray:null}function K(e){var t=!1;return e&&e.hasOwnProperty("type")&&(t=e.type===u.default.DYNAMIC),t}function V(e){return e&&e[u.default.ID]||null}function W(e,t){var n=!1;return e&&e.profiles&&e.profiles.length>0&&(n=-1!==e.profiles.indexOf(t)),n}function z(e){var t;return t=e&&e.hasOwnProperty(u.default.MEDIA_PRESENTATION_DURATION)?e.mediaPresentationDuration:e&&"dynamic"==e.type?Number.POSITIVE_INFINITY:Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,t}function X(e){return e&&e.bandwidth?e.bandwidth:NaN}function Q(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=NaN;return e&&e.hasOwnProperty(u.default.MINIMUM_UPDATE_PERIOD)&&(n=e.minimumUpdatePeriod),isNaN(n)?n:Math.max(n-t,1)}function J(e){return e&&e.hasOwnProperty(u.default.PUBLISH_TIME)?new Date(e[u.default.PUBLISH_TIME]):null}function $(e){return e&&Array.isArray(e.Representation_asArray)?e.Representation_asArray.length:0}function Z(e){var t=M(e),n=t&&Array.isArray(t.Representation_asArray)?t.Representation_asArray:[];return n.map(function(e){return{bandwidth:e.bandwidth,width:e.width||0,height:e.height||0,scanType:e.scanType||null,id:e.id||null}})}function ee(e){try{var t=e&&void 0!==e.selectionPriority?parseInt(e.selectionPriority):1;return isNaN(t)?1:t}catch(e){return 1}}function te(e){return e&&e.EssentialProperty_asArray&&e.EssentialProperty_asArray.length?e.EssentialProperty_asArray.map(function(e){return{schemeIdUri:e.schemeIdUri,value:e.value}}):null}function ne(e,t){return t&&t.Representation_asArray&&t.Representation_asArray.length>0&&Me(e)?t.Representation_asArray[e]:null}function re(e){if(e&&e.period&&Me(e.period.index)){var t=e.period.mpd.manifest.Period_asArray[e.period.index];if(t&&t.AdaptationSet_asArray&&Me(e.index))return M(t.AdaptationSet_asArray[e.index])}}function ae(e){var t,r,a=[],i=re(e);if(i&&i.Representation_asArray){if(e&&e.period&&Me(e.period.index)){var s=Ee(e.period.mpd.manifest);s&&(r=s[0])}for(var c=0,f=i.Representation_asArray.length;c<f;++c){var d=i.Representation_asArray[c],h=new l.default;if(h.index=c,h.adaptation=e,d.hasOwnProperty(u.default.ID)&&(h.id=d.id),d.hasOwnProperty(u.default.CODECS)&&(h.codecs=d.codecs),d.hasOwnProperty(u.default.MIME_TYPE)&&(h.mimeType=d[u.default.MIME_TYPE]),d.hasOwnProperty(u.default.CODEC_PRIVATE_DATA)&&(h.codecPrivateData=d.codecPrivateData),d.hasOwnProperty(u.default.BANDWITH)&&(h.bandwidth=d.bandwidth),d.hasOwnProperty(u.default.WIDTH)&&(h.width=d.width),d.hasOwnProperty(u.default.HEIGHT)&&(h.height=d.height),d.hasOwnProperty(u.default.SCAN_TYPE)&&(h.scanType=d.scanType),d.hasOwnProperty(u.default.MAX_PLAYOUT_RATE)&&(h.maxPlayoutRate=d.maxPlayoutRate),d.hasOwnProperty(u.default.SEGMENT_BASE)?(t=d.SegmentBase,h.segmentInfoType=u.default.SEGMENT_BASE):d.hasOwnProperty(u.default.SEGMENT_LIST)?(t=d.SegmentList,t.hasOwnProperty(u.default.SEGMENT_TIMELINE)?h.segmentInfoType=u.default.SEGMENT_TIMELINE:h.segmentInfoType=u.default.SEGMENT_LIST):d.hasOwnProperty(u.default.SEGMENT_TEMPLATE)?(t=d.SegmentTemplate,t.hasOwnProperty(u.default.SEGMENT_TIMELINE)?h.segmentInfoType=u.default.SEGMENT_TIMELINE:h.segmentInfoType=u.default.SEGMENT_TEMPLATE,t.hasOwnProperty(u.default.INITIALIZATION_MINUS)&&(h.initialization=t.initialization.split("$Bandwidth$").join(d.bandwidth).split("$RepresentationID$").join(d.id))):h.segmentInfoType=u.default.BASE_URL,h.essentialProperties=te(d),t){if(t.hasOwnProperty(u.default.INITIALIZATION)){var g=t.Initialization;g.hasOwnProperty(u.default.SOURCE_URL)&&(h.initialization=g.sourceURL),g.hasOwnProperty(u.default.RANGE)&&(h.range=g.range)}else o(i)&&n(i)&&i.mimeType&&-1===i.mimeType.indexOf("application/mp4")&&(h.range=0);t.hasOwnProperty(u.default.TIMESCALE)&&(h.timescale=t.timescale),t.hasOwnProperty(u.default.DURATION)?h.segmentDuration=t.duration/h.timescale:d.hasOwnProperty(u.default.SEGMENT_TEMPLATE)&&(t=d.SegmentTemplate,t.hasOwnProperty(u.default.SEGMENT_TIMELINE)&&(h.segmentDuration=ie(t.SegmentTimeline)/h.timescale)),t.hasOwnProperty(u.default.MEDIA)&&(h.media=t.media),t.hasOwnProperty(u.default.START_NUMBER)&&(h.startNumber=t.startNumber),t.hasOwnProperty(u.default.INDEX_RANGE)&&(h.indexRange=t.indexRange),t.hasOwnProperty(u.default.PRESENTATION_TIME_OFFSET)&&(h.presentationTimeOffset=t.presentationTimeOffset/h.timescale),t.hasOwnProperty(u.default.AVAILABILITY_TIME_OFFSET)?h.availabilityTimeOffset=t.availabilityTimeOffset:r&&void 0!==r.availabilityTimeOffset&&(h.availabilityTimeOffset=r.availabilityTimeOffset),t.hasOwnProperty(u.default.AVAILABILITY_TIME_COMPLETE)?h.availabilityTimeComplete="false"!==t.availabilityTimeComplete:r&&void 0!==r.availabilityTimeComplete&&(h.availabilityTimeComplete=r.availabilityTimeComplete)}h.MSETimeOffset=oe(h),h.path=[e.period.index,e.index,c],a.push(h)}}return a}function ie(e){if(!e||!e.S_asArray)return NaN;var t=e.S_asArray[0],n=e.S_asArray[1];return t.hasOwnProperty("d")?t.d:n.t-t.t}function oe(e){var t=e.presentationTimeOffset,n=e.adaptation.period.start;return n-t}function se(e){var t,n,r,l=e&&Me(e.index)?e.mpd.manifest.Period_asArray[e.index]:null,f=[];if(l&&l.AdaptationSet_asArray)for(r=0;r<l.AdaptationSet_asArray.length;r++)n=l.AdaptationSet_asArray[r],t=new c.default,n.hasOwnProperty(u.default.ID)&&(t.id=n.id),t.index=r,t.period=e,_(n)?t.type=s.default.MUXED:a(n)?t.type=s.default.AUDIO:i(n)?t.type=s.default.VIDEO:o(n)?t.type=s.default.TEXT:A(n)?t.type=s.default.IMAGE:Ce.warn("Unknown Adaptation stream type"),f.push(t);return f}function ue(e){var t,n,r=!!e&&K(e.manifest),a=[],i=null,o=null,s=null,l=null;for(n=0,t=e&&e.manifest&&e.manifest.Period_asArray?e.manifest.Period_asArray.length:0;n<t;n++)o=e.manifest.Period_asArray[n],o.hasOwnProperty(u.default.START)?(l=new f.default,l.start=o.start):null!==i&&i.hasOwnProperty(u.default.DURATION)&&null!==s?(l=new f.default,l.start=parseFloat((s.start+s.duration).toFixed(5))):0!==n||r||(l=new f.default,l.start=0),null!==s&&isNaN(s.duration)&&(null!==l?s.duration=parseFloat((l.start-s.start).toFixed(5)):Ce.warn("First period duration could not be calculated because lack of start and duration period properties. This will cause timing issues during playback")),null!==l&&(l.id=le(o,n),l.index=n,l.mpd=e,o.hasOwnProperty(u.default.DURATION)&&(l.duration=o.duration),s&&(s.nextPeriodId=l.id),a.push(l),i=o,s=l),o=null,l=null;return 0===a.length?a:(null!==s&&isNaN(s.duration)&&(s.duration=parseFloat((de(s)-s.start).toFixed(5))),a)}function le(e,t){if(!e)throw new Error("Period cannot be null or undefined");var n=f.default.DEFAULT_ID+"_"+t;return e.hasOwnProperty(u.default.ID)&&e.id.length>0&&"__proto__"!==e.id&&(n=e.id),n}function ce(e){var t=new d.default;return e&&(t.manifest=e,e.hasOwnProperty(u.default.AVAILABILITY_START_TIME)?t.availabilityStartTime=new Date(e.availabilityStartTime.getTime()):e.loadedTime&&(t.availabilityStartTime=new Date(e.loadedTime.getTime())),e.hasOwnProperty(u.default.AVAILABILITY_END_TIME)&&(t.availabilityEndTime=new Date(e.availabilityEndTime.getTime())),e.hasOwnProperty(u.default.MINIMUM_UPDATE_PERIOD)&&(t.minimumUpdatePeriod=e.minimumUpdatePeriod),e.hasOwnProperty(u.default.MEDIA_PRESENTATION_DURATION)&&(t.mediaPresentationDuration=e.mediaPresentationDuration),e.hasOwnProperty(u.default.SUGGESTED_PRESENTATION_DELAY)&&(t.suggestedPresentationDelay=e.suggestedPresentationDelay),e.hasOwnProperty(u.default.TIMESHIFT_BUFFER_DEPTH)&&(t.timeShiftBufferDepth=e.timeShiftBufferDepth),e.hasOwnProperty(u.default.MAX_SEGMENT_DURATION)&&(t.maxSegmentDuration=e.maxSegmentDuration),e.hasOwnProperty(u.default.PUBLISH_TIME)&&(t.publishTime=new Date(e.publishTime))),t}function fe(){if(!Ne||!Ne.hasOwnProperty("error"))throw new Error(s.default.MISSING_CONFIG_ERROR)}function de(e){fe();var t,n=K(e.mpd.manifest);return e.mpd.manifest.mediaPresentationDuration?t=e.mpd.manifest.mediaPresentationDuration:e.duration?t=e.duration:n?t=Number.POSITIVE_INFINITY:Ne.error(new T.default(S.default.MANIFEST_ERROR_ID_PARSE_CODE,"Must have @mediaPresentationDuration on MPD or an explicit @duration on the last period.",e)),t}function he(e){var t,n,r=e&&e.mpd&&e.mpd.manifest?e.mpd.manifest:null,a=r?r.Period_asArray:null,i=a&&e&&Me(e.index)?a[e.index].EventStream_asArray:null,o=[];if(i)for(t=0;t<i.length;t++){var l=new m.default;if(l.period=e,l.timescale=1,!i[t].hasOwnProperty(s.default.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");for(l.schemeIdUri=i[t][s.default.SCHEME_ID_URI],i[t].hasOwnProperty(u.default.TIMESCALE)&&(l.timescale=i[t][u.default.TIMESCALE]),i[t].hasOwnProperty(u.default.VALUE)&&(l.value=i[t][u.default.VALUE]),i[t].hasOwnProperty(u.default.PRESENTATION_TIME_OFFSET)&&(l.presentationTimeOffset=i[t][u.default.PRESENTATION_TIME_OFFSET]),n=0;i[t].Event_asArray&&n<i[t].Event_asArray.length;n++){var c=i[t].Event_asArray[n],f=new g.default;if(f.presentationTime=0,f.eventStream=l,c.hasOwnProperty(u.default.PRESENTATION_TIME)){f.presentationTime=c.presentationTime;var d=l.presentationTimeOffset?l.presentationTimeOffset/l.timescale:0;f.calculatedPresentationTime=f.presentationTime/l.timescale+e.start-d}c.hasOwnProperty(u.default.DURATION)&&(f.duration=c.duration/l.timescale),c.hasOwnProperty(u.default.ID)&&(f.id=c.id),c.Signal&&c.Signal.Binary?f.messageData=De.decodeArray(c.Signal.Binary.toString()):f.messageData=c.messageData||c.__text,o.push(f)}}return o}function ge(e,t){var n,r=[];if(!e)return r;for(n=0;n<e.length;n++){var a=new m.default;if(a.timescale=1,a.representation=t,!e[n].hasOwnProperty(s.default.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");a.schemeIdUri=e[n].schemeIdUri,e[n].hasOwnProperty(u.default.TIMESCALE)&&(a.timescale=e[n].timescale),e[n].hasOwnProperty(u.default.VALUE)&&(a.value=e[n].value),r.push(a)}return r}function pe(e,t){var n,r,a;return e&&e.Period_asArray&&t&&t.period&&Me(t.period.index)&&(r=e.Period_asArray[t.period.index],r&&r.AdaptationSet_asArray&&Me(t.index)&&(a=r.AdaptationSet_asArray[t.index],a&&(n=a.InbandEventStream_asArray))),ge(n,null)}function me(e,t){var n,r,a,i;return e&&e.Period_asArray&&t&&t.adaptation&&t.adaptation.period&&Me(t.adaptation.period.index)&&(r=e.Period_asArray[t.adaptation.period.index],r&&r.AdaptationSet_asArray&&Me(t.adaptation.index)&&(a=r.AdaptationSet_asArray[t.adaptation.index],a&&a.Representation_asArray&&Me(t.index)&&(i=a.Representation_asArray[t.index],i&&(n=i.InbandEventStream_asArray)))),ge(n,t)}function ye(e){var t=K(e),n=!!e&&e.hasOwnProperty(u.default.AVAILABILITY_START_TIME),r=e?e.UTCTiming_asArray:null,a=[];return(t||n)&&r&&r.forEach(function(e){var t=new h.default;e.hasOwnProperty(s.default.SCHEME_ID_URI)&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty(u.default.VALUE)&&(t.value=e.value.toString(),a.push(t)))}),a}function Ee(e){var t=[],n=e.BaseURL_asArray||[e.baseUri],r=!1;return n.some(function(n){if(n){var a=new p.default,i=n.__text||n;return Oe.isRelative(i)&&(r=!0,e.baseUri&&(i=Oe.resolve(i,e.baseUri))),a.url=i,n.hasOwnProperty(u.default.SERVICE_LOCATION)&&n.serviceLocation.length?a.serviceLocation=n.serviceLocation:a.serviceLocation=i,n.hasOwnProperty(u.default.DVB_PRIORITY)&&(a.dvb_priority=n[u.default.DVB_PRIORITY]),n.hasOwnProperty(u.default.DVB_WEIGHT)&&(a.dvb_weight=n[u.default.DVB_WEIGHT]),n.hasOwnProperty(u.default.AVAILABILITY_TIME_OFFSET)&&(a.availabilityTimeOffset=n[u.default.AVAILABILITY_TIME_OFFSET]),n.hasOwnProperty(u.default.AVAILABILITY_TIME_COMPLETE)&&(a.availabilityTimeComplete="false"!==n[u.default.AVAILABILITY_TIME_COMPLETE]),t.push(a),r}}),t}function _e(e){if(e&&e.hasOwnProperty(s.default.LOCATION))return e.Location=e.Location_asArray[0],e.Location}function ve(e){if(e&&e.hasOwnProperty(u.default.PATCH_LOCATION))return e.PatchLocation=e.PatchLocation_asArray[0],e.PatchLocation}function Te(e){return e&&e.hasOwnProperty(u.default.SUGGESTED_PRESENTATION_DELAY)?e.suggestedPresentationDelay:null}function Se(e){return e&&e.hasOwnProperty(u.default.AVAILABILITY_START_TIME)&&null!==e.availabilityStartTime?e.availabilityStartTime.getTime():null}function be(e){var t=[];if(e&&e.hasOwnProperty(u.default.SERVICE_DESCRIPTION)){var n,a=r(e.ServiceDescription_asArray);try{for(a.s();!(n=a.n()).done;){var i=n.value,o=void 0,l=void 0,c=void 0,f=void 0;for(var d in i)i.hasOwnProperty(d)&&(d===u.default.ID?o=i[d]:d===u.default.SERVICE_DESCRIPTION_SCOPE?l=i[d].schemeIdUri:d===u.default.SERVICE_DESCRIPTION_LATENCY?c={target:i[d].target,max:i[d].max,min:i[d].min}:d===u.default.SERVICE_DESCRIPTION_PLAYBACK_RATE&&(f={max:i[d].max,min:i[d].min}));l===s.default.SERVICE_DESCRIPTION_LL_SCHEME&&(c||f)&&t.push({id:o,schemeIdUri:l,latency:c,playbackRate:f})}}catch(e){a.e(e)}finally{a.f()}}return t}function Ae(e){var t={};if(e&&e.hasOwnProperty(u.default.SUPPLEMENTAL_PROPERTY)){var n,a=r(e.SupplementalProperty_asArray);try{for(a.s();!(n=a.n()).done;){var i=n.value;i.hasOwnProperty(s.default.SCHEME_ID_URI)&&i.hasOwnProperty(u.default.VALUE)&&(t[i[s.default.SCHEME_ID_URI]]=i[u.default.VALUE])}}catch(e){a.e(e)}finally{a.f()}}return t}function Re(e){e&&(e.errHandler&&(Ne=e.errHandler),e.BASE64&&(De=e.BASE64))}var Ie,Ce,Ne,De,we=this.context,Oe=Object(E.default)(we).getInstance(),Me=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};return Ie={getIsTypeOf:t,getIsText:o,getIsFragmented:n,getLanguageForAdaptation:R,getViewpointForAdaptation:I,getRolesForAdaptation:C,getAccessibilityForAdaptation:N,getAudioChannelConfigurationForAdaptation:D,getAudioChannelConfigurationForRepresentation:w,getAdaptationForIndex:x,getIndexForAdaptation:k,getAdaptationForId:j,getAdaptationsForType:B,getRealPeriods:L,getRealPeriodForIndex:F,getCodec:U,getSelectionPriority:ee,getMimeType:G,getKID:H,getLabelsForAdaptation:q,getContentProtectionData:Y,getIsDynamic:K,getId:V,hasProfile:W,getDuration:z,getBandwidth:X,getManifestUpdatePeriod:Q,getPublishTime:J,getRepresentationCount:$,getBitrateListForAdaptation:Z,getRepresentationFor:ne,getRepresentationsForAdaptation:ae,getAdaptationsForPeriod:se,getRegularPeriods:ue,getMpd:ce,getEventsForPeriod:he,getEssentialPropertiesForRepresentation:te,getEventStreamForAdaptationSet:pe,getEventStreamForRepresentation:me,getUTCTimingSources:ye,getBaseURLsFromElement:Ee,getRepresentationSortFunction:O,getLocation:_e,getPatchLocation:ve,getSuggestedPresentationDelay:Te,getAvailabilityStartTime:Se,getServiceDescriptions:be,getSupplementalProperties:Ae,setConfig:Re},e(),Ie}n.r(t);var s=n("./src/streaming/constants/Constants.js"),u=n("./src/dash/constants/DashConstants.js"),l=n("./src/dash/vo/Representation.js"),c=n("./src/dash/vo/AdaptationSet.js"),f=n("./src/dash/vo/Period.js"),d=n("./src/dash/vo/Mpd.js"),h=n("./src/dash/vo/UTCTiming.js"),g=n("./src/dash/vo/Event.js"),p=n("./src/dash/vo/BaseURL.js"),m=n("./src/dash/vo/EventStream.js"),y=n("./src/streaming/utils/ObjectUtils.js"),E=n("./src/streaming/utils/URLUtils.js"),_=n("./src/core/FactoryMaker.js"),v=n("./src/core/Debug.js"),T=n("./src/streaming/vo/DashJSError.js"),S=n("./src/core/errors/Errors.js"),b=n("./src/streaming/thumbnail/ThumbnailTracks.js");o.__dashjs_factory_name="DashManifestModel",t.default=_.default.getSingletonFactory(o)},"./src/dash/models/PatchManifestModel.js":function(e,t,n){function r(){function e(){f=Object(o.default)(d).getInstance().getLogger(c)}function t(e){return e&&e.hasOwnProperty(a.default.ORIGINAL_MPD_ID)||!1}function n(e){return e&&e.hasOwnProperty(a.default.PUBLISH_TIME)?new Date(e[a.default.PUBLISH_TIME]):null}function r(e){return e&&e.hasOwnProperty(a.default.ORIGINAL_PUBLISH_TIME)?new Date(e[a.default.ORIGINAL_PUBLISH_TIME]):null}function i(e){return e&&e[a.default.ORIGINAL_MPD_ID]||null}function l(e){return e?(e.__children||[]).map(function(e){var t=Object.keys(e)[0];if("add"!==t&&"remove"!==t&&"replace"!==t)return f.warn("Ignoring node of invalid action: ".concat(t)),null;var n=e[t],r=n.sel;if("add"===t&&n.type){if(!n.type.startsWith("@"))return f.warn("Ignoring add action for prefixed namespace declaration: ".concat(n.type,"=").concat(n.__text)),null;r="".concat(r,"/").concat(n.type)}var a=new s.default(r);if(!a.isValid())return f.warn("Ignoring action with invalid selector: ".concat(t," - ").concat(r)),null;var i=null;a.findsAttribute()?i=n.__text||"":"remove"!==t&&(i=n.__children.reduce(function(e,t){var n=Object.keys(t)[0];return"#text"!==n&&(e[n]=e[n]||[],e[n].push(t[n])),e},{}));var o=new u.default(t,a,i);return"add"===t&&(o.position=n.pos),o}).filter(function(e){return!!e}):[]}var c,f,d=this.context;return c={getIsPatch:t,getPublishTime:n,getOriginalPublishTime:r,getMpdId:i,getPatchOperations:l},e(),c}n.r(t);var a=n("./src/dash/constants/DashConstants.js"),i=n("./src/core/FactoryMaker.js"),o=n("./src/core/Debug.js"),s=n("./src/dash/vo/SimpleXPath.js"),u=n("./src/dash/vo/PatchOperation.js");r.__dashjs_factory_name="PatchManifestModel",t.default=i.default.getSingletonFactory(r)},"./src/dash/parser/DashParser.js":function(e,t,n){function r(e){function t(){g=_.getLogger(h),p=[new u.default,new l.default,new c.default,new s.default],m=new o.default({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!0,ignoreRoot:!1,matchers:p}),y=Object(i.default)(E).create({adaptationset:new f.default,period:new d.default})}function n(){return p}function r(){return y}function a(e){var t,n=window.performance.now();if(t=m.xml_str2json(e),!t)throw new Error("parsing the manifest failed");var r=window.performance.now();t.Patch?(t=t.Patch,t.add_asArray&&t.add_asArray.forEach(function(e){return y.run(e)}),t.replace_asArray&&t.replace_asArray.forEach(function(e){return y.run(e)})):(t=t.MPD,y.run(t));var a=window.performance.now();return g.info("Parsing complete: ( xml2json: "+(r-n).toPrecision(3)+"ms, objectiron: "+(a-r).toPrecision(3)+"ms, total: "+((a-n)/1e3).toPrecision(3)+"s)"),t.protocol="DASH",t}e=e||{};var h,g,p,m,y,E=this.context,_=e.debug;return h={parse:a,getMatchers:n,getIron:r},t(),h}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/dash/parser/objectiron.js"),o=n("./externals/xml2json.js"),s=n("./src/dash/parser/matchers/StringMatcher.js"),u=n("./src/dash/parser/matchers/DurationMatcher.js"),l=n("./src/dash/parser/matchers/DateTimeMatcher.js"),c=n("./src/dash/parser/matchers/NumericMatcher.js"),f=n("./src/dash/parser/maps/RepresentationBaseValuesMap.js"),d=n("./src/dash/parser/maps/SegmentValuesMap.js");r.__dashjs_factory_name="DashParser",t.default=a.default.getClassFactory(r)},"./src/dash/parser/maps/CommonProperty.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}n.r(t);var o=function(){function e(t){r(this,e);var n=function(e){return e&&e.length&&e.charAt(0)===e.charAt(0).toUpperCase()};this._name=t,this._merge=n(t)}return i(e,[{key:"name",get:function(){return this._name}},{key:"merge",get:function(){return this._merge}}]),e}();t.default=o},"./src/dash/parser/maps/MapNode.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}n.r(t);var o=n("./src/dash/parser/maps/CommonProperty.js"),s=function(){function e(t,n,a){var i=this;r(this,e),this._name=t||"",this._properties=[],this._children=a||[],Array.isArray(n)&&n.forEach(function(e){i._properties.push(new o.default(e))})}return i(e,[{key:"name",get:function(){return this._name}},{key:"children",get:function(){return this._children}},{key:"properties",get:function(){return this._properties}}]),e}();t.default=s},"./src/dash/parser/maps/RepresentationBaseValuesMap.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function s(e){var t=c();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}n.r(t);var d=n("./src/dash/parser/maps/MapNode.js"),h=n("./src/dash/constants/DashConstants.js"),g=function(e){function t(){a(this,t);var e=[h.default.PROFILES,h.default.WIDTH,h.default.HEIGHT,h.default.SAR,h.default.FRAMERATE,h.default.AUDIO_SAMPLING_RATE,h.default.MIME_TYPE,h.default.SEGMENT_PROFILES,h.default.CODECS,h.default.MAXIMUM_SAP_PERIOD,h.default.START_WITH_SAP,h.default.MAX_PLAYOUT_RATE,h.default.CODING_DEPENDENCY,h.default.SCAN_TYPE,h.default.FRAME_PACKING,h.default.AUDIO_CHANNEL_CONFIGURATION,h.default.CONTENT_PROTECTION,h.default.ESSENTIAL_PROPERTY,h.default.SUPPLEMENTAL_PROPERTY,h.default.INBAND_EVENT_STREAM];return n.call(this,h.default.ADAPTATION_SET,e,[new d.default(h.default.REPRESENTATION,e,[new d.default(h.default.SUB_REPRESENTATION,e)])])}i(t,e);var n=s(t);return t}(d.default);t.default=g},"./src/dash/parser/maps/SegmentValuesMap.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function s(e){var t=c();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}n.r(t);var d=n("./src/dash/parser/maps/MapNode.js"),h=n("./src/dash/constants/DashConstants.js"),g=function(e){function t(){a(this,t);var e=[h.default.SEGMENT_BASE,h.default.SEGMENT_TEMPLATE,h.default.SEGMENT_LIST];return n.call(this,h.default.PERIOD,e,[new d.default(h.default.ADAPTATION_SET,e,[new d.default(h.default.REPRESENTATION,e)])])}i(t,e);var n=s(t);return t}(d.default);t.default=g},"./src/dash/parser/matchers/BaseMatcher.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}n.r(t);var o=function(){function e(t,n){r(this,e),this._test=t,this._converter=n}return i(e,[{key:"test",get:function(){return this._test}},{key:"converter",get:function(){return this._converter}}]),e}();t.default=o},"./src/dash/parser/matchers/DateTimeMatcher.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function s(e){var t=c();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}n.r(t);var d=n("./src/dash/parser/matchers/BaseMatcher.js"),h=60,g=60,p=1e3,m=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})(?::?)([0-9]{2}))?/,y=function(e){function t(){return a(this,t),n.call(this,function(e){return m.test(e.value)},function(e){var t,n=m.exec(e);if(t=Date.UTC(parseInt(n[1],10),parseInt(n[2],10)-1,parseInt(n[3],10),parseInt(n[4],10),parseInt(n[5],10),n[6]&&parseInt(n[6],10)||0,n[7]&&parseFloat(n[7])*p||0),n[9]&&n[10]){var r=parseInt(n[9],10)*g+parseInt(n[10],10);t+=("+"===n[8]?-1:1)*r*h*p}return new Date(t)})}i(t,e);var n=s(t);return t}(d.default);t.default=y},"./src/dash/parser/matchers/DurationMatcher.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function s(e){var t=c();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}n.r(t);var d=n("./src/dash/parser/matchers/BaseMatcher.js"),h=n("./src/streaming/constants/Constants.js"),g=n("./src/dash/constants/DashConstants.js"),p=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,m=31536e3,y=2592e3,E=86400,_=3600,v=60,T=function(e){function t(){return a(this,t),n.call(this,function(e){for(var t=[g.default.MIN_BUFFER_TIME,g.default.MEDIA_PRESENTATION_DURATION,g.default.MINIMUM_UPDATE_PERIOD,g.default.TIMESHIFT_BUFFER_DEPTH,g.default.MAX_SEGMENT_DURATION,g.default.MAX_SUBSEGMENT_DURATION,g.default.SUGGESTED_PRESENTATION_DELAY,g.default.START,h.default.START_TIME,g.default.DURATION],n=t.length,r=0;r<n;r++)if(e.nodeName===t[r])return p.test(e.value);return!1},function(e){var t=p.exec(e),n=parseFloat(t[3]||0)*m+parseFloat(t[5]||0)*y+parseFloat(t[7]||0)*E+parseFloat(t[9]||0)*_+parseFloat(t[11]||0)*v+parseFloat(t[13]||0);return void 0!==t[1]&&(n=-n),n})}i(t,e);var n=s(t);return t}(d.default);t.default=T},"./src/dash/parser/matchers/NumericMatcher.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}
function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function s(e){var t=c();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}n.r(t);var d=n("./src/dash/parser/matchers/BaseMatcher.js"),h=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,g=function(e){function t(){return a(this,t),n.call(this,function(e){return h.test(e.value)},function(e){return parseFloat(e)})}i(t,e);var n=s(t);return t}(d.default);t.default=g},"./src/dash/parser/matchers/StringMatcher.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function s(e,t){return s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},s(e,t)}function u(e){var t=f();return function(){var n,r=d(e);if(t){var a=d(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return l(this,n)}}function l(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?c(e):t}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}n.r(t);var h=n("./src/dash/parser/matchers/BaseMatcher.js"),g=n("./src/dash/constants/DashConstants.js"),p=function(e){function t(){return i(this,t),n.call(this,function(e,t){var n,r=(n={},a(n,g.default.MPD,[g.default.ID,g.default.PROFILES]),a(n,g.default.PERIOD,[g.default.ID]),a(n,g.default.BASE_URL,[g.default.SERVICE_LOCATION,g.default.BYTE_RANGE]),a(n,g.default.SEGMENT_BASE,[g.default.INDEX_RANGE]),a(n,g.default.INITIALIZATION,[g.default.RANGE]),a(n,g.default.REPRESENTATION_INDEX,[g.default.RANGE]),a(n,g.default.SEGMENT_LIST,[g.default.INDEX_RANGE]),a(n,g.default.BITSTREAM_SWITCHING,[g.default.RANGE]),a(n,g.default.SEGMENT_URL,[g.default.MEDIA_RANGE,g.default.INDEX_RANGE]),a(n,g.default.SEGMENT_TEMPLATE,[g.default.INDEX_RANGE,g.default.MEDIA,g.default.INDEX,g.default.INITIALIZATION_MINUS,g.default.BITSTREAM_SWITCHING_MINUS]),a(n,g.default.ASSET_IDENTIFIER,[g.default.VALUE,g.default.ID]),a(n,g.default.EVENT_STREAM,[g.default.VALUE]),a(n,g.default.ADAPTATION_SET,[g.default.PROFILES,g.default.MIME_TYPE,g.default.SEGMENT_PROFILES,g.default.CODECS,g.default.CONTENT_TYPE]),a(n,g.default.FRAME_PACKING,[g.default.VALUE,g.default.ID]),a(n,g.default.AUDIO_CHANNEL_CONFIGURATION,[g.default.VALUE,g.default.ID]),a(n,g.default.CONTENT_PROTECTION,[g.default.VALUE,g.default.ID]),a(n,g.default.ESSENTIAL_PROPERTY,[g.default.VALUE,g.default.ID]),a(n,g.default.SUPPLEMENTAL_PROPERTY,[g.default.VALUE,g.default.ID]),a(n,g.default.INBAND_EVENT_STREAM,[g.default.VALUE,g.default.ID]),a(n,g.default.ACCESSIBILITY,[g.default.VALUE,g.default.ID]),a(n,g.default.ROLE,[g.default.VALUE,g.default.ID]),a(n,g.default.RATING,[g.default.VALUE,g.default.ID]),a(n,g.default.VIEWPOINT,[g.default.VALUE,g.default.ID]),a(n,g.default.CONTENT_COMPONENT,[g.default.CONTENT_TYPE]),a(n,g.default.REPRESENTATION,[g.default.ID,g.default.DEPENDENCY_ID,g.default.MEDIA_STREAM_STRUCTURE_ID]),a(n,g.default.SUBSET,[g.default.ID]),a(n,g.default.METRICS,[g.default.METRICS_MINUS]),a(n,g.default.REPORTING,[g.default.VALUE,g.default.ID]),n);if(r.hasOwnProperty(t)){var i=r[t];return void 0!==i&&i.indexOf(e.name)>=0}return!1},function(e){return String(e)})}o(t,e);var n=u(t);return t}(h.default);t.default=p},"./src/dash/parser/objectiron.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e){function t(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function n(e,n,a){for(var i=0,o=e.length;i<o;++i){var s=e[i];if(n[s.name])if(a[s.name]){if(s.merge){var u=n[s.name],l=a[s.name];"object"===r(u)&&"object"===r(l)?t(u,l):a[s.name]=u+l}}else a[s.name]=n[s.name]}}function a(e,t){for(var r=0,i=e.children.length;r<i;++r){var o=e.children[r],s=t[o.name+"_asArray"];if(s)for(var u=0,l=s.length;u<l;++u){var c=s[u];n(e.properties,t,c),a(o,c)}}}function i(t){if(null===t||"object"!==r(t))return t;if(t.Period_asArray&&"period"in e)for(var n=e.period,i=t.Period_asArray,o=0,s=i.length;o<s;++o){var u=i[o];if(a(n,u),"adaptationset"in e){var l=u.AdaptationSet_asArray;if(l)for(var c=e.adaptationset,f=0,d=l.length;f<d;++f)a(c,l[f])}}return t}return{run:i}}n.r(t);var i=n("./src/core/FactoryMaker.js");a.__dashjs_factory_name="ObjectIron";var o=i.default.getClassFactory(a);t.default=o},"./src/dash/utils/ListSegmentsGetter.js":function(e,t,n){function r(e,t){function n(){if(!l||!l.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(i.default.MISSING_CONFIG_ERROR)}function r(e){var t={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};if(!e)return t;var n=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,r=e&&!isNaN(e.startNumber)?e.startNumber:1,a=Math.max(r-1,0);return t.numberOfSegments=a+n.SegmentURL_asArray.length,t}function a(e,r){if(n(),!e)return null;var a=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,i=a.SegmentURL_asArray.length,s=e&&!isNaN(e.startNumber)?e.startNumber:1,u=Math.max(s-1,0),c=Math.max(r-u,0),f=null;if(c<i){var d=a.SegmentURL_asArray[c];f=Object(o.getIndexBasedSegment)(l,t,e,r),f&&(f.replacementTime=(s+r-1)*e.segmentDuration,f.media=d.media?d.media:"",f.mediaRange=d.mediaRange,f.indexRange=d.indexRange)}return f}function s(e,t){if(n(),!e)return null;var r=e.segmentDuration;if(isNaN(r))return null;var i=l.calcPeriodRelativeTimeFromMpdRelativeTime(e,t),o=Math.floor(i/r);return a(e,o)}e=e||{};var u,l=e.timelineConverter;return u={getSegmentByIndex:a,getSegmentByTime:s,getMediaFinishedInformation:r},u}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/constants/Constants.js"),o=n("./src/dash/utils/SegmentsUtils.js");r.__dashjs_factory_name="ListSegmentsGetter";var s=a.default.getClassFactory(r);t.default=s},"./src/dash/utils/Round10.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function o(e,t,n){return void 0===n||0==+n?Math[e](t):(t=+t,n=+n,null===t||isNaN(t)||"number"!=typeof n||n%1!=0?NaN:(t=t.toString().split("e"),t=Math[e](+(t[0]+"e"+(t[1]?+t[1]-n:-n))),t=t.toString().split("e"),+(t[0]+"e"+(t[1]?+t[1]+n:n))))}n.r(t),n.d(t,"default",function(){return s});var s=function(){function e(){r(this,e)}return i(e,null,[{key:"round10",value:function(e,t){return o("round",e,t)}}]),e}()},"./src/dash/utils/SegmentBaseGetter.js":function(e,t,n){function r(e){function t(){if(!u||!u.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(i.default.MISSING_CONFIG_ERROR)}function n(e){var t={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};return e&&e.segments?(t.numberOfSegments=e.segments.length,t):t}function r(e,n){if(t(),!e)return null;var r,a=e.segments?e.segments.length:-1;if(n<a&&(r=e.segments[n],r&&r.index===n))return r;for(var i=0;i<a;i++)if(r=e.segments[i],r&&r.index===n)return r;return null}function a(e,n){t();var a=o(e,n);return r(e,a)}function o(e,t){if(!e)return-1;var n,r,a,i,o,s=e.segments,u=s?s.length:null,l=-1;if(s&&u>0)for(o=0;o<u;o++)if(r=s[o],a=r.presentationStartTime,i=r.duration,n=i/2,t+n>=a&&t-n<a+i){l=r.index;break}return l}e=e||{};var s,u=e.timelineConverter;return s={getSegmentByIndex:r,getSegmentByTime:a,getMediaFinishedInformation:n},s}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/constants/Constants.js");r.__dashjs_factory_name="SegmentBaseGetter";var o=a.default.getClassFactory(r);t.default=o},"./src/dash/utils/SegmentsUtils.js":function(e,t,n){function r(e,t){for(;e.length<t;)e="0"+e;return e}function a(e,t){return e.representation.startNumber+t}function i(e){return e?e.split("$$").join("$"):e}function o(e,t){if(!t||!e||-1===e.indexOf("$RepresentationID$"))return e;var n=t.toString();return e.split("$RepresentationID$").join(n)}function s(e,t,n){var a,i,o,s,u,l,c="%0",f=t.length,d=c.length;if(!e)return e;for(;;){if(a=e.indexOf("$"+t),a<0)return e;if(i=e.indexOf("$",a+f),i<0)return e;if(o=e.indexOf(c,a+f),o>a&&o<i)switch(s=e.charAt(i-1),u=parseInt(e.substring(o+d,i-1),10),s){case"d":case"i":case"u":l=r(n.toString(),u);break;case"x":l=r(n.toString(16),u);break;case"X":l=r(n.toString(16),u).toUpperCase();break;case"o":l=r(n.toString(8),u);break;default:return e}else l=n;e=e.substring(0,a)+l+e.substring(i+1)}}function u(e,t,n,r,i,o,s,u){var l=new d.default;return l.representation=e,l.duration=t,l.presentationStartTime=n,l.mediaStartTime=r,l.availabilityStartTime=i.calcAvailabilityStartTimeFromPresentationTime(o,e,s),l.availabilityEndTime=i.calcAvailabilityEndTimeFromPresentationTime(o+t,e,s),l.wallStartTime=i.calcWallTimeForSegment(l,s),l.replacementNumber=a(l,u),l.index=u,l}function l(e,t,n,r){var a=t.adaptation.period;if(isFinite(a.duration)&&a.start+a.duration<=n.presentationStartTime)return!1;if(r){if("INF"===t.availabilityTimeOffset)return!0;var i=e.getClientReferenceTime();return n.availabilityStartTime.getTime()<=i&&(!isFinite(n.availabilityEndTime)||n.availabilityEndTime.getTime()>=i)}return!0}function c(e,t,n,r){var a,i,o;a=n.segmentDuration,isNaN(a)&&(a=n.adaptation.period.duration),i=parseFloat((n.adaptation.period.start+r*a).toFixed(5)),o=parseFloat((i+a).toFixed(5));var s=e.calcMediaTimeFromPresentationTime(i,n),c=u(n,a,i,s,e,o,t,r);return l(e,n,c,t)?c:null}function f(e,t,n,r,a,i,o,c,f,d){var h,g,p,m=r/i,y=a/i;return h=e.calcPresentationTimeFromMediaTime(m,n),g=h+y,p=u(n,y,h,m,e,g,t,f),l(e,n,p,t)?(p.replacementTime=d||r,o=s(o,"Number",p.replacementNumber),o=s(o,"Time",p.replacementTime),p.media=o,p.mediaRange=c,p):null}n.r(t),n.d(t,"unescapeDollarsInTemplate",function(){return i}),n.d(t,"replaceIDForTemplate",function(){return o}),n.d(t,"replaceTokenForTemplate",function(){return s}),n.d(t,"getIndexBasedSegment",function(){return c}),n.d(t,"getTimeBasedSegment",function(){return f});var d=n("./src/dash/vo/Segment.js")},"./src/dash/utils/TemplateSegmentsGetter.js":function(e,t,n){function r(e,t){function n(){if(!l||!l.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(i.default.MISSING_CONFIG_ERROR)}function r(e){var t={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};if(!e)return t;var n=e.segmentDuration;return isNaN(n)?t.numberOfSegments=1:t.numberOfSegments=Math.ceil(e.adaptation.period.duration/n),t}function a(e,r){if(n(),!e)return null;var a=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate;r=Math.max(r,0);var i=Object(o.getIndexBasedSegment)(l,t,e,r);if(i){i.replacementTime=Math.round((r-1)*e.segmentDuration*e.timescale,10);var s=a.media;s=Object(o.replaceTokenForTemplate)(s,"Number",i.replacementNumber),s=Object(o.replaceTokenForTemplate)(s,"Time",i.replacementTime),i.media=s}return i}function s(e,t){if(n(),!e)return null;var r=e.segmentDuration;if(isNaN(r))return null;var i=l.calcPeriodRelativeTimeFromMpdRelativeTime(e,t),o=Math.floor(i/r);return a(e,o)}e=e||{};var u,l=e.timelineConverter;return u={getSegmentByIndex:a,getSegmentByTime:s,getMediaFinishedInformation:r},u}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/constants/Constants.js"),o=n("./src/dash/utils/SegmentsUtils.js");r.__dashjs_factory_name="TemplateSegmentsGetter";var s=a.default.getClassFactory(r);t.default=s},"./src/dash/utils/TimelineConverter.js":function(e,t,n){function r(){function e(){M=Object(u.default)(F).getInstance(),w()}function t(){D(),j.on(i.default.UPDATE_TIME_SYNC_OFFSET,N,this)}function n(){return L}function r(e){L=e}function o(){return Date.now()-1e3*P+1e3*L}function h(e,t,n,r){var a,i=t.adaptation.period.mpd,o=i.availabilityStartTime;if(r)a=n&&i.timeShiftBufferDepth!==Number.POSITIVE_INFINITY?new Date(o.getTime()+1e3*(e+i.timeShiftBufferDepth)):i.availabilityEndTime;else if(n){var s=t.availabilityTimeOffset;a=new Date(o.getTime()+1e3*(e-s))}else a=o;return a}function g(e,t,n){return h(e,t,n)}function p(e,t,n){return h(e,t,n,!0)}function m(e,t){return(e.getTime()-t.mpd.availabilityStartTime.getTime()+1e3*L)/1e3}function y(e,t){var n=t.adaptation.period.start,r=t.presentationTimeOffset;return e+(n-r)}function E(e,t){var n=t.adaptation.period.start,r=t.presentationTimeOffset;return e-n+r}function _(e,t){var n,r,a;return t&&(n=e.representation.adaptation.period.mpd.suggestedPresentationDelay,r=e.presentationStartTime+n,a=new Date(e.availabilityStartTime.getTime()+1e3*r)),a}function v(e,t){if(!t)return T(e);if(x.get().streaming.timeShiftBuffer.calcFromSegmentTimeline){var n=b(e);return A(n.now,n.range),n.range}return S(e)}function T(e){var t={start:NaN,end:NaN},n=0,r=NaN;return e.forEach(function(e){var t=e.getStreamInfo();n+=t.duration,(isNaN(r)||t.start<r)&&(r=t.start)}),t.start=r,t.end=r+n,t}function S(e){var t={start:NaN,end:NaN};if(!e||0===e.length)return t;var n=e[0].getAdapter().getRegularPeriods()[0],r=m(new Date,n),a=n.mpd.timeShiftBufferDepth,i=isNaN(a)?0:r-a;if(t.start=R(e,i),t.end=!isNaN(t.start)&&r<t.start?r:R(e,r,!0),!isNaN(a)&&t.end<r-a&&(t.end=NaN),x.get().streaming.timeShiftBuffer.fallbackToSegmentTimeline){var o=b(e);if(o.range.end<t.start)return j.trigger(f.default.CONFORMANCE_VIOLATION,{level:d.default.LEVELS.WARNING,event:d.default.EVENTS.INVALID_DVR_WINDOW}),A(o.now,o.range),o.range}return t}function b(e){var t={start:NaN,end:NaN},n=e[0].getAdapter().getRegularPeriods()[0],r=m(new Date,n);if(!e||0===e.length)return{range:t,now:r};e.forEach(function(e){var n=e.getAdapter(),a=n.getMediaInfoForType(e.getStreamInfo(),c.default.VIDEO)||n.getMediaInfoForType(e.getStreamInfo(),c.default.AUDIO),i=n.getVoRepresentations(a),o=i[0],u={start:NaN,end:NaN};if(o)if(o.segmentInfoType===s.default.SEGMENT_TIMELINE)u=I(o);else{var l=o.adaptation.period;u.start=l.start,u.end=Math.max(r,l.start+l.duration)}!isNaN(u.start)&&(isNaN(t.start)||t.start>u.start)&&(t.start=u.start),!isNaN(u.end)&&(isNaN(t.end)||t.end<u.end)&&(t.end=u.end)}),t.end=Math.min(r,t.end);var a=R(e,t.end,!0);return t.end=isNaN(a)?t.end:a,t.start=n&&n.mpd&&n.mpd.timeShiftBufferDepth&&!isNaN(n.mpd.timeShiftBufferDepth)&&!isNaN(t.end)?Math.max(t.end-n.mpd.timeShiftBufferDepth,t.start):t.start,t.start=R(e,t.start),{range:t,now:r}}function A(e,t){P=e-t.end}function R(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{for(var r=0,a=!1,i=NaN;!a&&r<e.length;){var o=e[r].getStreamInfo();o.start<=t&&(!isFinite(o.duration)||o.start+o.duration>=t)?(i=t,a=!0):!n&&o.start>t&&(isNaN(i)||o.start<i)?i=o.start:n&&o.start+o.duration<t&&(isNaN(i)||o.start+o.duration>i)&&(i=o.start+o.duration),r+=1}return i}catch(e){return t}}function I(e){var t,n,r,a,i=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],o=M.getRepresentationFor(e.index,i),s=o.SegmentTemplate.SegmentTimeline,u=o.SegmentTemplate.timescale,l=s.S_asArray,c={start:0,end:0},f=0;for(c.start=y(l[0].t/u,e),r=0,a=l.length;r<a;r++)t=l[r],n=0,t.hasOwnProperty("r")&&(n=t.r),f+=t.d/u*(1+n);return c.end=c.start+f,c}function C(e,t){var n=e.adaptation.period.start;return t-n}function N(e){void 0===e.offset||isNaN(e.offset)||r(e.offset/1e3)}function D(){L=0,P=0}function w(){j.off(i.default.UPDATE_TIME_SYNC_OFFSET,N,this),D()}var O,M,P,L,F=this.context,j=Object(a.default)(F).getInstance(),x=Object(l.default)(F).getInstance();return O={initialize:t,getClientTimeOffset:n,setClientTimeOffset:r,getClientReferenceTime:o,calcAvailabilityStartTimeFromPresentationTime:g,calcAvailabilityEndTimeFromPresentationTime:p,calcPresentationTimeFromWallTime:m,calcPresentationTimeFromMediaTime:y,calcPeriodRelativeTimeFromMpdRelativeTime:C,calcMediaTimeFromPresentationTime:E,calcWallTimeForSegment:_,calcTimeShiftBufferWindow:v,reset:w},e(),O}n.r(t);var a=n("./src/core/EventBus.js"),i=n("./src/core/events/Events.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/dash/constants/DashConstants.js"),u=n("./src/dash/models/DashManifestModel.js"),l=n("./src/core/Settings.js"),c=n("./src/streaming/constants/Constants.js"),f=n("./src/streaming/MediaPlayerEvents.js"),d=n("./src/streaming/constants/ConformanceViolationConstants.js");r.__dashjs_factory_name="TimelineConverter",t.default=o.default.getSingletonFactory(r)},"./src/dash/utils/TimelineSegmentsGetter.js":function(e,t,n){function r(e,t){function n(){if(!f)throw new Error(i.default.MISSING_CONFIG_ERROR)}function r(e){if(!e)return 0;var t,n,r,a,i,o,u,l=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate||e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,c=l.SegmentTimeline,f=0,d=0,h=0;for(u=e.timescale,t=c.S_asArray,a=t.length,r=0;r<a;r++){if(n=t[r],o=0,n.hasOwnProperty("r")&&(o=n.r),n.hasOwnProperty("t")&&(f=n.t,d=f/u),o<0){var g=t[r+1];o=s(e,g,n,u,d)}for(i=0;i<=o;i++)h++,f+=n.d,d=f/u}return{numberOfSegments:h,mediaTimeOfLastSignaledSegment:d}}function a(e,t){var n,r,a,i,o,u,l,c=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate||e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,f=c.SegmentTimeline,d=c.SegmentURL_asArray,h=0,g=0,p=-1;l=e.timescale,n=f.S_asArray;var m=!1;for(a=0,i=n.length;a<i&&!m;a++){if(r=n[a],u=0,r.hasOwnProperty("r")&&(u=r.r),r.hasOwnProperty("t")&&(h=r.t,g=h/l),u<0){var y=n[a+1];u=s(e,y,r,l,g)}for(o=0;o<=u&&!m;o++)p++,m=t(h,g,c,d,r,l,p,a),m&&(e.segmentDuration=r.d/l),h+=r.d,g=h/l}}function s(e,t,n,r,a){var i;if(t&&t.hasOwnProperty("t"))i=t.t/r;else try{var o=0;if(isNaN(e.adaptation.period.start)||isNaN(e.adaptation.period.duration)||!isFinite(e.adaptation.period.duration)){var s=d.getCurrentDVRInfo();o=isNaN(s.end)?0:s.end}else o=e.adaptation.period.start+e.adaptation.period.duration;i=f.calcMediaTimeFromPresentationTime(o,e),e.segmentDuration=n.d/r}catch(e){i=0}return Math.max(Math.ceil((i-a)/(n.d/r))-1,0)}function u(e,r,i){if(n(),!e)return null;var s=null,u=!1;return a(e,function(n,r,a,l,c,d,h,g){if(u||i<0){var p=a.media,m=c.mediaRange;return l&&(p=l[g].media||"",m=l[g].mediaRange),s=Object(o.getTimeBasedSegment)(f,t,e,n,c.d,d,p,m,h,c.tManifest),!0}return r>=i-.5*c.d/d&&(u=!0),!1}),s}function l(e,r){if(n(),!e)return null;void 0===r&&(r=null);var i=null,s=f.calcMediaTimeFromPresentationTime(r,e);return a(e,function(n,r,a,u,l,c,d,h){if(s<r+l.d/c){var g=a.media,p=l.mediaRange;return u&&(g=u[h].media||"",p=u[h].mediaRange),i=Object(o.getTimeBasedSegment)(f,t,e,n,l.d,c,g,p,d,l.tManifest),!0}return!1}),i}e=e||{};var c,f=e.timelineConverter,d=e.dashMetrics;return c={getSegmentByIndex:u,getSegmentByTime:l,getMediaFinishedInformation:r},c}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/constants/Constants.js"),o=n("./src/dash/utils/SegmentsUtils.js");r.__dashjs_factory_name="TimelineSegmentsGetter";var s=a.default.getClassFactory(r);t.default=s},"./src/dash/vo/AdaptationSet.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.period=null,this.index=-1,this.type=null};t.default=a},"./src/dash/vo/BaseURL.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=1,i=1,o=function e(t,n,o,s){r(this,e),this.url=t||"",this.serviceLocation=n||t||"",this.dvb_priority=o||a,this.dvb_weight=s||i,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0};o.DEFAULT_DVB_PRIORITY=a,o.DEFAULT_DVB_WEIGHT=i,t.default=o},"./src/dash/vo/Event.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN};t.default=a},"./src/dash/vo/EventStream.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri="",this.presentationTimeOffset=0};t.default=a},"./src/dash/vo/ManifestInfo.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.dvrWindowSize=NaN,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=NaN,this.duration=NaN,this.isDynamic=!1,this.maxFragmentDuration=null};t.default=a},"./src/dash/vo/MediaInfo.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.representationCount=0,this.labels=null,this.lang=null,this.viewpoint=null,this.accessibility=null,this.audioChannelConfiguration=null,this.roles=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.KID=null,this.bitrateList=null,this.isFragmented=null,this.isEmbedded=null,this.selectionPriority=1};t.default=a},"./src/dash/vo/Mpd.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.publishTime=null,this.minimumUpdatePeriod=NaN,this.mediaPresentationDuration=NaN};t.default=a},"./src/dash/vo/PatchOperation.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}n.r(t);var o=function(){function e(t,n,a){r(this,e),this.action=t,this.xpath=n,this.value=a,this.position=null}return i(e,[{key:"getMpdTarget",value:function(e){var t="remove"===this.action||"replace"===this.action||"before"===this.position||"after"===this.position;return this.xpath.getMpdTarget(e,t)}}]),e}();t.default=o},"./src/dash/vo/Period.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null,this.nextPeriodId=null};a.DEFAULT_ID="defaultId",t.default=a},"./src/dash/vo/Representation.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}n.r(t);var o=n("./src/dash/constants/DashConstants.js"),s=function(){function e(){r(this,e),this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.codecs=null,this.mimeType=null,this.codecPrivateData=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.mediaFinishedInformation={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN},this.bandwidth=NaN,this.width=NaN,this.height=NaN,this.scanType=null,this.maxPlayoutRate=NaN,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0}return i(e,[{key:"hasInitialization",value:function(){return null!==this.initialization||null!==this.range}},{key:"hasSegments",value:function(){return this.segmentInfoType!==o.default.BASE_URL&&this.segmentInfoType!==o.default.SEGMENT_BASE&&!this.indexRange}}]),e}();t.default=s},"./src/dash/vo/RepresentationInfo.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.id=null,this.quality=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null};t.default=a},"./src/dash/vo/Segment.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.wallStartTime=NaN,this.representation=null};t.default=a},"./src/dash/vo/SimpleXPath.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}n.r(t);var o=function(){function e(t){var n=this;r(this,e),this.valid="/"==t[0],this.path=t.split("/").filter(function(e){return 0!==e.length}).map(function(e){var t={name:e},r=e.indexOf("[");if(-1!=r){t.name=e.substring(0,r);var a=e.substring(r+1,e.length-1);n.valid=n.valid&&-1==a.indexOf("[");var i=a.indexOf("=");-1!=i?(t.attribute={name:a.substring(1,i),value:a.substring(i+1)},-1!=["'",'"'].indexOf(t.attribute.value[0])&&(t.attribute.value=t.attribute.value.substring(1,t.attribute.value.length-1))):t.position=parseInt(a,10)-1}return t})}return i(e,[{key:"isValid",value:function(){return this.valid}},{key:"findsElement",value:function(){return!this.findsAttribute()}},{key:"findsAttribute",value:function(){return this.path[this.path.length-1].name.startsWith("@")}},{key:"getMpdTarget",value:function(e,t){for(var n=null,r=e,a=1,i="MPD";a<this.path.length&&null!==r;){n=r;var o=this.path[a];if(i=o.name,a!==this.path.length-1||!i.startsWith("@")){var s=n[i+"_asArray"]||[];0===s.length&&n[i]&&s.push(n[i]),o.position?r=s[o.position]||null:o.attribute?function(){var e=o.attribute;r=s.filter(function(t){return t[e.name]==e.value})[0]||null}():r=s[0]||null}a++}return null===r?null:i.startsWith("@")?{name:i.substring(1),leaf:r,target:r}:{name:i,leaf:r,target:t?n:r}}}]),e}();t.default=o},"./src/dash/vo/StreamInfo.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null,this.isLast=!0};t.default=a},"./src/dash/vo/UTCTiming.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.schemeIdUri="",this.value=""};t.default=a},"./src/streaming/FragmentLoader.js":function(e,t,n){function r(e){function t(){f=Object(i.default)(d).create({errHandler:e.errHandler,errors:m,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,urlUtils:p,constants:a.default,boxParser:e.boxParser,dashConstants:e.dashConstants,requestTimeout:e.settings.get().streaming.fragmentRequestTimeout})}function n(e){var t=function(t){h.trigger(g.CHECK_FOR_EXISTENCE_COMPLETED,{request:e,exists:t})};if(e){var n=new o.default(e.url);f.load({request:n,success:function(){t(!0)},error:function(){t(!1)}})}else t(!1)}function r(e){var t=function(t,n){h.trigger(g.LOADING_COMPLETED,{request:e,response:t||null,error:n||null,sender:c})};e?f.load({request:e,progress:function(t){h.trigger(g.LOADING_PROGRESS,{request:e,stream:t.stream,streamId:y}),t.data&&h.trigger(g.LOADING_DATA_PROGRESS,{request:e,response:t.data||null,error:null,sender:c})},success:function(e){t(e)},error:function(e,n,r){t(void 0,new s.default(m.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE,r,n))},abort:function(e){e&&h.trigger(g.LOADING_ABANDONED,{mediaType:e.mediaType,request:e,sender:c})}}):t(void 0,new s.default(m.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE,m.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE))}function u(){f&&f.abort()}function l(){f&&(f.abort(),f=null)}e=e||{};var c,f,d=this.context,h=e.eventBus,g=e.events,p=e.urlUtils,m=e.errors,y=e.streamId;return c={checkForExistence:n,load:r,abort:u,reset:l},t(),c}n.r(t);var a=n("./src/streaming/constants/Constants.js"),i=n("./src/streaming/net/URLLoader.js"),o=n("./src/streaming/vo/HeadRequest.js"),s=n("./src/streaming/vo/DashJSError.js"),u=n("./src/core/FactoryMaker.js");r.__dashjs_factory_name="FragmentLoader",t.default=u.default.getClassFactory(r)},"./src/streaming/ManifestLoader.js":function(e,t,n){function r(e){function t(){_=A.getLogger(E),R.on(h.default.XLINK_READY,n,E),v=Object(s.default)(b).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,urlUtils:I,constants:a.default,dashConstants:i.default,errors:g.default}),T=Object(o.default)(b).create({errHandler:N,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,settings:e.settings}),S=null}function n(e){R.trigger(h.default.INTERNAL_MANIFEST_LOADED,{manifest:e.manifest})}function r(e){var t=null;return e.indexOf("SmoothStreamingMedia")>-1?(C&&(t=C.createMssParser(),C.registerEvents()),t):e.indexOf("MPD")>-1||e.indexOf("Patch")>-1?Object(m.default)(b).create({debug:A}):t}function p(e){
var t=new l.default(e,f.HTTPRequest.MPD_TYPE);v.load({request:t,success:function(t,n,i){var o,s,u;if(T)if(i&&i!==e?(s=I.parseBaseUrl(i),o=i):(I.isRelative(e)&&(e=I.resolve(e,window.location.href)),s=I.parseBaseUrl(e)),"No Content"!=n)if(null===S&&(S=r(t)),null!==S){T.setMatchers(S.getMatchers()),T.setIron(S.getIron());try{u=S.parse(t)}catch(t){return void R.trigger(h.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new c.default(g.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,g.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(e))})}u?(u.url=o||e,u.originalUrl||(u.originalUrl=u.url),u.hasOwnProperty(a.default.LOCATION)&&(s=I.parseBaseUrl(u.Location_asArray[0]),_.debug("BaseURI set by Location to: "+s)),u.baseUri=s,u.loadedTime=new Date,T.resolveManifestOnLoad(u),R.trigger(h.default.ORIGINAL_MANIFEST_LOADED,{originalManifest:t})):R.trigger(h.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new c.default(g.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,g.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(e))})}else R.trigger(h.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new c.default(g.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,g.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(e))});else R.trigger(h.default.INTERNAL_MANIFEST_LOADED,{manifest:null})},error:function(t,n,r){R.trigger(h.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new c.default(g.default.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE,g.default.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE+"".concat(e,", ").concat(r))})}})}function y(){R.off(h.default.XLINK_READY,n,E),C&&C.reset(),T&&(T.reset(),T=null),v&&(v.abort(),v=null)}e=e||{};var E,_,v,T,S,b=this.context,A=e.debug,R=Object(d.default)(b).getInstance(),I=Object(u.default)(b).getInstance(),C=e.mssHandler,N=e.errHandler;return E={load:p,reset:y},t(),E}n.r(t);var a=n("./src/streaming/constants/Constants.js"),i=n("./src/dash/constants/DashConstants.js"),o=n("./src/streaming/controllers/XlinkController.js"),s=n("./src/streaming/net/URLLoader.js"),u=n("./src/streaming/utils/URLUtils.js"),l=n("./src/streaming/vo/TextRequest.js"),c=n("./src/streaming/vo/DashJSError.js"),f=n("./src/streaming/vo/metrics/HTTPRequest.js"),d=n("./src/core/EventBus.js"),h=n("./src/core/events/Events.js"),g=n("./src/core/errors/Errors.js"),p=n("./src/core/FactoryMaker.js"),m=n("./src/dash/parser/DashParser.js");r.__dashjs_factory_name="ManifestLoader";var y=p.default.getClassFactory(r);t.default=y},"./src/streaming/ManifestUpdater.js":function(e,t,n){function r(){function e(){A=Object(u.default)(F).getInstance().getLogger(b)}function t(e){e&&(e.manifestModel&&(O=e.manifestModel),e.adapter&&(M=e.adapter),e.manifestLoader&&(w=e.manifestLoader),e.errHandler&&(P=e.errHandler),e.settings&&(L=e.settings))}function n(){s(),j.on(i.default.STREAMS_COMPOSED,T,this),j.on(o.default.PLAYBACK_STARTED,_,this),j.on(o.default.PLAYBACK_PAUSED,v,this),j.on(i.default.INTERNAL_MANIFEST_LOADED,E,this)}function r(e){m(e)}function s(){R=NaN,D=!1,C=!0,N=!1,h()}function d(){j.off(o.default.PLAYBACK_STARTED,_,this),j.off(o.default.PLAYBACK_PAUSED,v,this),j.off(i.default.STREAMS_COMPOSED,T,this),j.off(i.default.INTERNAL_MANIFEST_LOADED,E,this),s()}function h(){null!==I&&(clearTimeout(I),I=null)}function g(e){h(),N||(isNaN(e)&&!isNaN(R)&&(e=1e3*R),isNaN(e)||(A.debug("Refresh manifest in "+e+" milliseconds."),I=setTimeout(y,e)))}function p(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];D=!0;var t=O.getValue(),n=t.url,r=M.getPatchLocation(t),a=M.getLocation(t);r&&!e?n=r:a&&(n=a),x.isRelative(n)&&(n=x.resolve(n,t.url)),w.load(n)}function m(e){if(e){if(M.getIsPatch(e)){var t=e;e=O.getValue();var n=M.isPatchValid(e,t),r=n;if(n){var a=M.getPublishTime(e);r=M.applyPatchToManifest(e,t);var o=M.getPublishTime(e);r=a.getTime()!=o.getTime()}if(!r)return A.debug("Patch provided is invalid, performing full manifest refresh"),void p(!0);e.loadedTime=new Date}}else e=O.getValue(),e.loadedTime=new Date;if(O.getValue()&&O.getValue().type===c.default.DYNAMIC&&e.type===c.default.STATIC)return j.trigger(i.default.DYNAMIC_TO_STATIC),D=!1,void(N=!0);O.setValue(e);var s=new Date,u=(s.getTime()-e.loadedTime.getTime())/1e3;R=M.getManifestUpdatePeriod(e,u),1e3*R>2147483647&&(R=2147483.647),j.trigger(i.default.MANIFEST_UPDATED,{manifest:e}),A.info("Manifest has been refreshed at "+s+"["+s.getTime()/1e3+"] "),C||g()}function y(){C||(D?g(L.get().streaming.manifestUpdateRetryInterval):p())}function E(e){e.error?e.error.code===l.default.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE&&P.error(e.error):m(e.manifest)}function _(){C=!1,g()}function v(){C=!L.get().streaming.scheduling.scheduleWhilePaused,C&&h()}function T(){D=!1}function S(){return D}var b,A,R,I,C,N,D,w,O,M,P,L,F=this.context,j=Object(a.default)(F).getInstance(),x=Object(f.default)(F).getInstance();return b={initialize:n,setManifest:r,refreshManifest:p,getIsUpdating:S,setConfig:t,reset:d},e(),b}n.r(t);var a=n("./src/core/EventBus.js"),i=n("./src/core/events/Events.js"),o=n("./src/streaming/MediaPlayerEvents.js"),s=n("./src/core/FactoryMaker.js"),u=n("./src/core/Debug.js"),l=n("./src/core/errors/Errors.js"),c=n("./src/dash/constants/DashConstants.js"),f=n("./src/streaming/utils/URLUtils.js");r.__dashjs_factory_name="ManifestUpdater",t.default=s.default.getClassFactory(r)},"./src/streaming/MediaPlayer.js":function(e,t,n){function r(){function e(){Lt=An.getLogger(Pt),xt=!1,Bt=!1,kt=!1,Ut=!0,Kt=null,zt=null,jt=null,Xt=null,dn=null,w.default.extend(O.default),Qt=Object(T.default)(Tn).getInstance(),ln=Object(A.default)(Tn).getInstance(),cn=Object(_.default)(Tn).getInstance(),hn=[],gn=[],pn=[]}function t(e){e&&(e.capabilities&&(Zt=e.capabilities),e.capabilitiesFilter&&(en=e.capabilitiesFilter),e.streamController&&(tn=e.streamController),e.textController&&(nn=e.textController),e.gapController&&(rn=e.gapController),e.playbackController&&(an=e.playbackController),e.mediaPlayerModel&&(Qt=e.mediaPlayerModel),e.abrController&&(Gt=e.abrController),e.schemeLoaderFactory&&(Ht=e.schemeLoaderFactory),e.mediaController&&(Yt=e.mediaController),e.settings&&(bn=e.settings))}function n(e,t,n){Zt||(Zt=Object(m.default)(Tn).getInstance(),Zt.setConfig({settings:bn})),Jt||(Jt=Object(p.default)(Tn).getInstance()),Zt.supportsMediaSource()?(xt||(xt=!0,qt=Object(k.default)(Tn).getInstance(),Gt||(Gt=Object(S.default)(Tn).getInstance(),Gt.setConfig({settings:bn})),Ht||(Ht=Object(b.default)(Tn).getInstance()),an||(an=Object(l.default)(Tn).getInstance()),Yt||(Yt=Object(d.default)(Tn).getInstance()),tn||(tn=Object(c.default)(Tn).getInstance()),rn||(rn=Object(f.default)(Tn).getInstance()),en||(en=Object(y.default)(Tn).getInstance()),Xt=Object(j.default)(Tn).getInstance(),sn=Object(v.default)(Tn).getInstance(),un=Object(R.default)(Tn).getInstance(),on=Object(x.default)(Tn).getInstance({settings:bn}),fn=Object(I.default)(Tn).getInstance({settings:bn}),Xt.setConfig({constants:o.default,cea608parser:i.a,errHandler:Jt,BASE64:G.a}),$t||($t=Object(h.default)(Tn).create()),$t.setConfig({adapter:Xt}),dn||(dn=Object(F.default)(Tn).getInstance({dashMetrics:on,mediaPlayerModel:Qt,errHandler:Jt,baseURLController:$t,events:w.default,eventBus:Sn,debug:An,boxParser:Object(z.default)(Tn).getInstance(),requestModifier:Object(E.default)(Tn).getInstance(),errors:N.default})),Yt.setConfig({domStorage:fn,settings:bn}),Oe(),Se(void 0===n||n),wt()),e&&qe(e),t&&pt(t),Lt.info("[dash.js "+J()+"] MediaPlayer has been initialized")):Jt.error(new Y.default(N.default.CAPABILITY_MEDIASOURCE_ERROR_CODE,N.default.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE))}function r(){pt(null),qe(null),jt=null,Kt&&(Kt.reset(),Kt=null),Vt&&(Vt.reset(),Vt=null),bn.reset(),zt&&(zt.reset(),zt=null)}function a(){r(),hn=[],gn=[],pn=[],M.default.deleteSingletonInstances(Tn)}function U(){return!!Ft&&!!ln.getElement()}function H(e,t,n,r){Sn.on(e,t,n,r)}function Q(e,t,n){Sn.off(e,t,n)}function J(){return Object(L.getVersionString)()}function $(){return An}function Z(){if(!Bt)throw yn;(!Ut||te()&&Bt)&&an.play()}function ee(){if(!Bt)throw yn;an.pause()}function te(){if(!Bt)throw yn;return an.isPaused()}function ne(e){if(!Bt)throw yn;if(Object(K.checkParameterType)(e,"number"),isNaN(e))throw o.default.BAD_ARGUMENT_ERROR;var t=an.getIsDynamic()?he(e):e;an.seek(t)}function re(){if(!Bt)throw yn;return an.isSeeking()}function ae(){if(!Bt)throw yn;return an.getIsDynamic()}function ie(e){He().playbackRate=e}function oe(){return He().playbackRate}function se(e){Object(K.checkParameterType)(e,"boolean"),He().muted=e}function ue(){return He().muted}function le(e){if("number"!=typeof e||isNaN(e)||e<0||e>1)throw o.default.BAD_ARGUMENT_ERROR;He().volume=e}function ce(){return He().volume}function fe(e){var t=[o.default.VIDEO,o.default.AUDIO,o.default.TEXT];if(e){if(-1!==t.indexOf(e)){var n=je().getCurrentBufferLevel(e);return n||NaN}return Lt.warn("getBufferLength requested for invalid type"),NaN}var r=t.map(function(e){return ze(e).length>0?je().getCurrentBufferLevel(e):Number.MAX_VALUE}).reduce(function(e,t){return Math.min(e,t)});return r===Number.MAX_VALUE?NaN:r}function de(){var e=tn&&tn.hasVideoTrack()?o.default.VIDEO:o.default.AUDIO,t=on.getCurrentDVRInfo(e);return t?t.manifestInfo.dvrWindowSize:0}function he(e){var t=tn&&tn.hasVideoTrack()?o.default.VIDEO:o.default.AUDIO,n=on.getCurrentDVRInfo(t);if(!n)return 0;var r=an.getLiveDelay(),a=n.range.start+e;return a>n.range.end-r&&(a=n.range.end-r),a}function ge(e){if(!Bt)throw yn;var t=He().currentTime;if(void 0!==e)t=tn.getTimeRelativeToStreamId(t,e);else if(an.getIsDynamic()){var n=tn&&tn.hasVideoTrack()?o.default.VIDEO:o.default.AUDIO,r=on.getCurrentDVRInfo(n);t=null===r||0===t?0:Math.max(0,t-r.range.start)}return t}function pe(){if(!Bt)throw yn;var e=He().duration;if(an.getIsDynamic()){var t=tn&&tn.hasVideoTrack()?o.default.VIDEO:o.default.AUDIO,n=on.getCurrentDVRInfo(t);e=n?n.range.end-n.range.start:0}return e}function me(){if(!Bt)throw yn;return ge()<0?NaN:Ot(ge())}function ye(){if(!Bt)throw yn;return Ot(pe())}function Ee(e){if(!kt)throw mn;return Gt.getTopBitrateInfoFor(e)}function _e(e){if(!kt)throw mn;if(e===o.default.IMAGE){var t=St();if(!t)return-1;var n=t.getThumbnailController();return n?n.getCurrentTrackIndex():-1}return Gt.getQualityFor(e)}function ve(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!kt)throw mn;if(e===o.default.IMAGE){var r=St();if(!r)return;var a=r.getThumbnailController();a&&a.setTrackByIndex(t)}Gt.setPlaybackQuality(e,tn.getActiveStreamInfo(),t,{forceReplace:n})}function Te(){Gt.setElementSize(),Gt.setWindowResizeEventCalled(!0)}function Se(e){Object(K.checkParameterType)(e,"boolean"),Ut=e}function be(){return Ut}function Ae(){if(!xt)throw vn;return Bt?an.getCurrentLiveLatency():NaN}function Re(e,t,n){Qt.addABRCustomRule(e,t,n)}function Ie(e){Qt.removeABRCustomRule(e)}function Ce(){Qt.removeABRCustomRule()}function Ne(e,t){Qt.addUTCTimingSource(e,t)}function De(e,t){Qt.removeUTCTimingSource(e,t)}function we(){Qt.clearDefaultUTCTimingSources()}function Oe(){Qt.restoreDefaultUTCTimingSources()}function Me(e){var t=Gt.getThroughputHistory(),n=an.getIsDynamic();return t?t.getAverageThroughput(e,n):0}function Pe(e,t){Qt.setXHRWithCredentialsForType(e,t)}function Le(e){return Qt.getXHRWithCredentialsForType(e)}function Fe(){return wt()}function je(){return on}function xe(e){var t=tn.getActiveStreamInfo();return!(!t||!nn)&&nn.enableText(t.id,e)}function ke(e){var t=tn.getActiveStreamInfo();return!(!t||!nn)&&nn.enableForcedTextStreaming(e)}function Be(){var e=tn.getActiveStreamInfo();return!(!e||!nn)&&nn.isTextEnabled(e)}function Ue(e){if(!Bt)throw yn;var t=tn.getActiveStreamInfo();t&&nn&&nn.setTextTrack(t.id,e)}function Ge(){var e=NaN,t=tn.getActiveStreamInfo();if(t&&nn)return e=nn.getCurrentTrackIdx(t.id),e}function He(){if(!ln.getElement())throw En;return ln.getElement()}function qe(e){if(!xt)throw vn;ln.setElement(e),e&&(Ct(),Nt(),Dt(),tn&&tn.switchToVideoElement()),Bt&&At(),Mt()}function Ye(){return ln?ln.getTTMLRenderingDiv():null}function Ke(e){if(!ln.getElement())throw En;ln.setTTMLRenderingDiv(e)}function Ve(e){if(!kt)throw mn;var t=St();return t?t.getBitrateListFor(e):[]}function We(e){if(!kt)throw mn;return Xt.getStreamsInfo(e)}function ze(e){if(!kt)throw mn;var t=tn.getActiveStreamInfo();return t?Yt.getTracksFor(e,t.id):[]}function Xe(e,t,n){if(!kt)throw mn;return n=n||Xt.getStreamsInfo(t,1)[0],n?Xt.getAllMediaInfoForType(n,e,t):[]}function Qe(e){if(!kt)throw mn;var t=tn.getActiveStreamInfo();return Yt.getCurrentTrackFor(e,t.id)}function Je(e,t){if(!xt)throw vn;Yt.setInitialSettings(e,t)}function $e(e){if(!xt)throw vn;return Yt.getInitialSettings(e)}function Ze(e){if(!kt)throw mn;Yt.setTrack(e)}function et(){return Ct()}function tt(e){Kt=e}function nt(e){jt=e,tn&&tn.setProtectionData(jt)}function rt(e){hn.push(e),Kt&&Kt.setLicenseRequestFilters(hn)}function at(e){gn.push(e),Kt&&Kt.setLicenseResponseFilters(gn)}function it(e){lt(hn,e),Kt&&Kt.setLicenseRequestFilters(hn)}function ot(e){lt(gn,e),Kt&&Kt.setLicenseResponseFilters(gn)}function st(e){pn.push(e),en&&en.setCustomCapabilitiesFilters(pn)}function ut(e){lt(pn,e),en&&en.setCustomCapabilitiesFilters(pn)}function lt(e,t){var n=-1;e.some(function(e,r){if(e===t)return n=r,!0}),n<0||e.splice(n,1)}function ct(e){Yt&&Yt.setCustomInitialTrackSelectionFunction(e)}function ft(){Yt&&Yt.setCustomInitialTrackSelectionFunction(null)}function dt(e,t){if("function"==typeof t)if(e<0)t(null);else{var n=an.getIsDynamic()?he(e):e,r=tn.getStreamForTime(n);if(null!==r){var a=r.getThumbnailController();if(a){var i=tn.getTimeRelativeToStreamId(n,r.getId());return a.provide(i,t)}t(null)}else t(null)}}function ht(e,t){var n=It(),r=this,a=function e(a){a.error?t(null,a.error):t(a.manifest),Sn.off(w.default.INTERNAL_MANIFEST_LOADED,e,r),n.reset()};Sn.on(w.default.INTERNAL_MANIFEST_LOADED,a,r),cn.initialize(e),n.load(e)}function gt(){if(!Ft)throw _n;return Ft}function pt(e){if(!xt)throw vn;"string"==typeof e&&cn.initialize(e),Ft=e,(kt||Bt)&&At(),U()&&Mt()}function mt(){return bn.get()}function yt(e){bn.update(e)}function Et(){bn.reset()}function _t(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=new Date(1e3*e),i=a.toLocaleDateString(t),o=a.toLocaleTimeString(t,{hour12:n});return r?o+" "+i:o}function vt(e){e=Math.max(e,0);var t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%3600%60);return(0===t?"":t<10?"0"+t.toString()+":":t.toString()+":")+(n<10?"0"+n.toString():n.toString())+":"+(r<10?"0"+r.toString():r.toString())}function Tt(e,t,n){M.default.extend(e,t,n,Tn)}function St(){if(!kt)throw mn;var e=tn.getActiveStreamInfo();return e?tn.getStreamById(e.id):null}function bt(){return Xt}function At(){Bt=!1,kt=!1,Xt.reset(),tn.reset(),rn.reset(),an.reset(),Gt.reset(),Yt.reset(),dn.reset(),Kt&&(bn.get().streaming.protection.keepProtectionMediaKeys?Kt.stop():(Kt.reset(),Kt=null,Ct())),nn.reset(),un.reset()}function Rt(){var e=It();tn||(tn=Object(c.default)(Tn).getInstance()),nn||(nn=Object(X.default)(Tn).create({errHandler:Jt,manifestModel:sn,adapter:Xt,mediaController:Yt,videoModel:ln,settings:bn})),en.setConfig({capabilities:Zt,adapter:Xt,settings:bn,manifestModel:sn,errHandler:Jt}),en.setCustomCapabilitiesFilters(pn),tn.setConfig({capabilities:Zt,capabilitiesFilter:en,manifestLoader:e,manifestModel:sn,mediaPlayerModel:Qt,protectionController:Kt,textController:nn,adapter:Xt,dashMetrics:on,errHandler:Jt,timelineConverter:qt,videoModel:ln,playbackController:an,abrController:Gt,mediaController:Yt,settings:bn,baseURLController:$t,uriFragmentModel:cn,segmentBaseController:dn}),rn.setConfig({settings:bn,playbackController:an,streamController:tn,videoModel:ln,timelineConverter:qt,adapter:Xt}),an.setConfig({streamController:tn,dashMetrics:on,mediaPlayerModel:Qt,adapter:Xt,videoModel:ln,timelineConverter:qt,settings:bn}),Gt.setConfig({streamController:tn,domStorage:fn,mediaPlayerModel:Qt,dashMetrics:on,adapter:Xt,videoModel:ln,settings:bn}),un.setConfig({abrController:Gt,dashMetrics:on,playbackController:an}),Gt.initialize(),tn.initialize(Ut,jt),nn.initialize(),rn.initialize(),un.initialize(),dn.initialize()}function It(){return Object(g.default)(Tn).create({debug:An,errHandler:Jt,dashMetrics:on,mediaPlayerModel:Qt,requestModifier:Object(E.default)(Tn).getInstance(),mssHandler:Wt,settings:bn})}function Ct(){if(Kt)return Kt;var e=dashjs.Protection;if("function"==typeof e){var t=e(Tn).create();return w.default.extend(e.events),O.default.extend(e.events,{publicOnly:!0}),N.default.extend(e.errors),Zt||(Zt=Object(m.default)(Tn).getInstance()),Kt=t.createProtectionSystem({debug:An,errHandler:Jt,videoModel:ln,capabilities:Zt,eventBus:Sn,events:w.default,BASE64:G.a,constants:o.default,cmcdModel:un,settings:bn}),Kt&&(Kt.setLicenseRequestFilters(hn),Kt.setLicenseResponseFilters(gn)),Kt}return null}function Nt(){if(!Vt){var e=dashjs.MetricsReporting;if("function"==typeof e){var t=e(Tn).create();Vt=t.createMetricsReporting({debug:An,eventBus:Sn,mediaElement:He(),adapter:Xt,dashMetrics:on,events:w.default,constants:o.default,metricsConstants:u.default})}}}function Dt(){if(!Wt){var e=dashjs.MssHandler;"function"==typeof e&&(N.default.extend(e.errors),Wt=e(Tn).create({eventBus:Sn,mediaPlayerModel:Qt,dashMetrics:on,manifestModel:sn,playbackController:an,streamController:tn,protectionController:Kt,baseURLController:$t,errHandler:Jt,events:w.default,constants:o.default,debug:An,initSegmentType:B.HTTPRequest.INIT_SEGMENT_TYPE,BASE64:G.a,ISOBoxer:q.a,settings:bn}))}}function wt(){if(!xt)throw vn;if(zt)return zt;var e=dashjs.OfflineController;if("function"==typeof e){w.default.extend(e.events),O.default.extend(e.events,{publicOnly:!0}),N.default.extend(e.errors);var t=It(),n=Object(V.default)(Tn).create();return n.setConfig({manifestModel:sn,adapter:Xt,manifestLoader:t,errHandler:Jt}),zt=e(Tn).create({debug:An,manifestUpdater:n,baseURLController:$t,manifestLoader:t,manifestModel:sn,mediaPlayerModel:Qt,abrController:Gt,playbackController:an,adapter:Xt,errHandler:Jt,dashMetrics:on,timelineConverter:qt,segmentBaseController:dn,schemeLoaderFactory:Ht,eventBus:Sn,events:w.default,errors:N.default,constants:o.default,settings:bn,dashConstants:s.default,urlUtils:Object(W.default)(Tn).getInstance()}),zt}return null}function Ot(e){var t,n,r=tn&&tn.hasVideoTrack()?o.default.VIDEO:o.default.AUDIO,a=on.getCurrentDVRInfo(r);return a?(t=a.manifestInfo.availableFrom.getTime()/1e3,n=e+(t+a.range.start),n):0}function Mt(){zt&&zt.resetRecords(),!kt&&Ft&&(kt=!0,Lt.info("Streaming Initialized"),Rt(),"string"==typeof Ft?tn.load(Ft):tn.loadWithManifest(Ft)),!Bt&&U()&&(Bt=!0,Lt.info("Playback Initialized"))}var Pt,Lt,Ft,jt,xt,kt,Bt,Ut,Gt,Ht,qt,Yt,Kt,Vt,Wt,zt,Xt,Qt,Jt,$t,Zt,en,tn,nn,rn,an,on,sn,un,ln,cn,fn,dn,hn,gn,pn,mn="You must first call initialize() and set a source before calling this method",yn="You must first call initialize() and set a valid source and view before calling this method",En="You must first call attachView() to set the video element before calling this method",_n="You must first call attachSource() with a valid source before calling this method",vn="MediaPlayer not initialized!",Tn=this.context,Sn=Object(D.default)(Tn).getInstance(),bn=Object(P.default)(Tn).getInstance(),An=Object(C.default)(Tn).getInstance({settings:bn});return Pt={initialize:n,setConfig:t,on:H,off:Q,extend:Tt,attachView:qe,attachSource:pt,isReady:U,play:Z,isPaused:te,pause:ee,isSeeking:re,isDynamic:ae,seek:ne,setPlaybackRate:ie,getPlaybackRate:oe,setMute:se,isMuted:ue,setVolume:le,getVolume:ce,time:ge,duration:pe,timeAsUTC:me,durationAsUTC:ye,getActiveStream:St,getDVRWindowSize:de,getDVRSeekOffset:he,convertToTimeCode:vt,formatUTC:_t,getVersion:J,getDebug:$,getBufferLength:fe,getTTMLRenderingDiv:Ye,getVideoElement:He,getSource:gt,getCurrentLiveLatency:Ae,getTopBitrateInfoFor:Ee,setAutoPlay:Se,getAutoPlay:be,getDashMetrics:je,getQualityFor:_e,setQualityFor:ve,updatePortalSize:Te,enableText:xe,enableForcedTextStreaming:ke,isTextEnabled:Be,setTextTrack:Ue,getBitrateInfoListFor:Ve,getStreamsFromManifest:We,getTracksFor:ze,getTracksForTypeFromManifest:Xe,getCurrentTrackFor:Qe,setInitialMediaSettingsFor:Je,getInitialMediaSettingsFor:$e,setCurrentTrack:Ze,addABRCustomRule:Re,removeABRCustomRule:Ie,removeAllABRCustomRule:Ce,getAverageThroughput:Me,retrieveManifest:ht,addUTCTimingSource:Ne,removeUTCTimingSource:De,clearDefaultUTCTimingSources:we,restoreDefaultUTCTimingSources:Oe,setXHRWithCredentialsForType:Pe,getXHRWithCredentialsForType:Le,getProtectionController:et,attachProtectionController:tt,setProtectionData:nt,registerLicenseRequestFilter:rt,registerLicenseResponseFilter:at,unregisterLicenseRequestFilter:it,unregisterLicenseResponseFilter:ot,registerCustomCapabilitiesFilter:st,unregisterCustomCapabilitiesFilter:ut,setCustomInitialTrackSelectionFunction:ct,resetCustomInitialTrackSelectionFunction:ft,attachTTMLRenderingDiv:Ke,getCurrentTextTrackIndex:Ge,provideThumbnail:dt,getDashAdapter:bt,getOfflineController:Fe,getSettings:mt,updateSettings:yt,resetSettings:Et,reset:r,destroy:a},e(),Pt}n.r(t);var a=n("./externals/cea608-parser.js"),i=n.n(a),o=n("./src/streaming/constants/Constants.js"),s=n("./src/dash/constants/DashConstants.js"),u=n("./src/streaming/constants/MetricsConstants.js"),l=n("./src/streaming/controllers/PlaybackController.js"),c=n("./src/streaming/controllers/StreamController.js"),f=n("./src/streaming/controllers/GapController.js"),d=n("./src/streaming/controllers/MediaController.js"),h=n("./src/streaming/controllers/BaseURLController.js"),g=n("./src/streaming/ManifestLoader.js"),p=n("./src/streaming/utils/ErrorHandler.js"),m=n("./src/streaming/utils/Capabilities.js"),y=n("./src/streaming/utils/CapabilitiesFilter.js"),E=n("./src/streaming/utils/RequestModifier.js"),_=n("./src/streaming/models/URIFragmentModel.js"),v=n("./src/streaming/models/ManifestModel.js"),T=n("./src/streaming/models/MediaPlayerModel.js"),S=n("./src/streaming/controllers/AbrController.js"),b=n("./src/streaming/net/SchemeLoaderFactory.js"),A=n("./src/streaming/models/VideoModel.js"),R=n("./src/streaming/models/CmcdModel.js"),I=n("./src/streaming/utils/DOMStorage.js"),C=n("./src/core/Debug.js"),N=n("./src/core/errors/Errors.js"),D=n("./src/core/EventBus.js"),w=n("./src/core/events/Events.js"),O=n("./src/streaming/MediaPlayerEvents.js"),M=n("./src/core/FactoryMaker.js"),P=n("./src/core/Settings.js"),L=n("./src/core/Version.js"),F=n("./src/dash/controllers/SegmentBaseController.js"),j=n("./src/dash/DashAdapter.js"),x=n("./src/dash/DashMetrics.js"),k=n("./src/dash/utils/TimelineConverter.js"),B=n("./src/streaming/vo/metrics/HTTPRequest.js"),U=n("./externals/base64.js"),G=n.n(U),H=n("./node_modules/codem-isoboxer/dist/iso_boxer.js"),q=n.n(H),Y=n("./src/streaming/vo/DashJSError.js"),K=n("./src/streaming/utils/SupervisorTools.js"),V=n("./src/streaming/ManifestUpdater.js"),W=n("./src/streaming/utils/URLUtils.js"),z=n("./src/streaming/utils/BoxParser.js"),X=n("./src/streaming/text/TextController.js");r.__dashjs_factory_name="MediaPlayer";var Q=M.default.getClassFactory(r);Q.events=O.default,Q.errors=N.default,M.default.updateClassFactory(r.__dashjs_factory_name,Q),t.default=Q},"./src/streaming/MediaPlayerEvents.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function s(e){var t=c();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}n.r(t);var d=n("./src/core/events/EventsBase.js"),h=function(e){function t(){var e;return a(this,t),e=n.call(this),e.AST_IN_FUTURE="astInFuture",e.BUFFER_EMPTY="bufferStalled",e.BUFFER_LOADED="bufferLoaded",e.BUFFER_LEVEL_STATE_CHANGED="bufferStateChanged",e.BUFFER_LEVEL_UPDATED="bufferLevelUpdated",e.DYNAMIC_TO_STATIC="dynamicToStatic",e.ERROR="error",e.FRAGMENT_LOADING_COMPLETED="fragmentLoadingCompleted",e.FRAGMENT_LOADING_PROGRESS="fragmentLoadingProgress",e.FRAGMENT_LOADING_STARTED="fragmentLoadingStarted",e.FRAGMENT_LOADING_ABANDONED="fragmentLoadingAbandoned",e.LOG="log",e.MANIFEST_LOADED="manifestLoaded",e.METRICS_CHANGED="metricsChanged",e.METRIC_CHANGED="metricChanged",e.METRIC_ADDED="metricAdded",e.METRIC_UPDATED="metricUpdated",e.PERIOD_SWITCH_STARTED="periodSwitchStarted",e.PERIOD_SWITCH_COMPLETED="periodSwitchCompleted",e.QUALITY_CHANGE_REQUESTED="qualityChangeRequested",e.QUALITY_CHANGE_RENDERED="qualityChangeRendered",e.TRACK_CHANGE_RENDERED="trackChangeRendered",e.STREAM_INITIALIZING="streamInitializing",e.STREAM_UPDATED="streamUpdated",e.STREAM_ACTIVATED="streamActivated",e.STREAM_DEACTIVATED="streamDeactivated",e.STREAM_INITIALIZED="streamInitialized",e.STREAM_TEARDOWN_COMPLETE="streamTeardownComplete",e.TEXT_TRACKS_ADDED="allTextTracksAdded",e.TEXT_TRACK_ADDED="textTrackAdded",e.TTML_PARSED="ttmlParsed",e.TTML_TO_PARSE="ttmlToParse",e.CAPTION_RENDERED="captionRendered",e.CAPTION_CONTAINER_RESIZE="captionContainerResize",e.CAN_PLAY="canPlay",e.CAN_PLAY_THROUGH="canPlayThrough",e.PLAYBACK_ENDED="playbackEnded",e.PLAYBACK_ERROR="playbackError",e.PLAYBACK_NOT_ALLOWED="playbackNotAllowed",e.PLAYBACK_METADATA_LOADED="playbackMetaDataLoaded",e.PLAYBACK_LOADED_DATA="playbackLoadedData",e.PLAYBACK_PAUSED="playbackPaused",e.PLAYBACK_PLAYING="playbackPlaying",e.PLAYBACK_PROGRESS="playbackProgress",e.PLAYBACK_RATE_CHANGED="playbackRateChanged",e.PLAYBACK_SEEKED="playbackSeeked",e.PLAYBACK_SEEKING="playbackSeeking",e.PLAYBACK_SEEK_ASKED="playbackSeekAsked",e.PLAYBACK_STALLED="playbackStalled",e.PLAYBACK_STARTED="playbackStarted",e.PLAYBACK_TIME_UPDATED="playbackTimeUpdated",e.PLAYBACK_WAITING="playbackWaiting",e.MANIFEST_VALIDITY_CHANGED="manifestValidityChanged",e.EVENT_MODE_ON_START="eventModeOnStart",e.EVENT_MODE_ON_RECEIVE="eventModeOnReceive",e.CONFORMANCE_VIOLATION="conformanceViolation",e.REPRESENTATION_SWITCH="representationSwitch",e}i(t,e);var n=s(t);return t}(d.default),g=new h;t.default=g},"./src/streaming/MediaPlayerFactory.js":function(e,t,n){function r(){function e(e,t,n){if(!e||!/^VIDEO$/i.test(e.nodeName))return null;if(e._dashjs_player)return e._dashjs_player;var i,o=e.id||e.name||"video element";if(t=t||[].slice.call(e.querySelectorAll("source")).filter(function(e){return e.type==a})[0],!t&&e.src)t=document.createElement("source"),t.src=e.src;else if(!t&&!e.src)return null;return n=n||{},i=Object(s.default)(n).create(),i.initialize(e,t.src,e.autoplay),r||(r=i.getDebug().getLogger()),r.debug("Converted "+o+" to dash.js player and added content: "+t.src),e._dashjs_player=i,i}function t(t,r){var i=[];t=t||"[data-dashjs-player]",r=r||document;for(var o=r.querySelectorAll(t),s=0;s<o.length;s++){var u=e(o[s],null);i.push(u)}for(var l=r.querySelectorAll('source[type="'+a+'"]'),c=0;c<l.length;c++){var f=n(l[c]),d=e(f,null);i.push(d)}return i}function n(e){return/^VIDEO$/i.test(e.nodeName)?e:n(e.parentNode)}var r,a="application/dash+xml";return{create:e,createAll:t}}function a(){window.removeEventListener("load",a),u.createAll()}function i(){window.dashjs&&(window.clearInterval(o),u.createAll())}n.r(t);var o,s=n("./src/streaming/MediaPlayer.js"),u=r(),l="undefined"!=typeof window&&window&&window.dashjs&&window.dashjs.skipAutoCreate;!l&&"undefined"!=typeof window&&window&&window.addEventListener&&("complete"===window.document.readyState?window.dashjs?u.createAll():o=window.setInterval(i,500):window.addEventListener("load",a)),t.default=u},"./src/streaming/SourceBufferSink.js":function(e,t,n){function r(e){function t(){x=Object(a.default)(G).getInstance().getLogger(F)}function n(e,t,n){B=e,j=B.type;var a=B.codec;o(n),y();var i=[];return i.push(I),i.push(v(B.streamInfo)),i.push(r(a)),t&&void 0!==t.MSETimeOffset&&i.push(T(t.MSETimeOffset)),Promise.all(i)}function r(e){return new Promise(function(t){L(function(){k.changeType&&k.changeType(e),t()})})}function o(e){k=e.getBuffer()}function p(e,t,n){B=t,j=B.type;var r=B.codec;try{if(r.match(/application\/mp4;\s*codecs="(stpp|wvtt).*"/i))return m(e);k=z.addSourceBuffer(r),y();var a=[];return a.push(v(B.streamInfo)),n&&void 0!==n.MSETimeOffset&&a.push(T(n.MSETimeOffset)),Promise.all(a)}catch(t){return B.type==l.default.TEXT&&!B.isFragmented||-1!==r.indexOf('codecs="stpp')||-1!==r.indexOf('codecs="vtt')?m(e):Promise.reject(t)}}function m(e){return k=q.getTextSourceBuffer(e),Promise.resolve()}function y(){if("function"==typeof k.addEventListener)try{k.addEventListener("updateend",O,!1),k.addEventListener("error",M,!1),k.addEventListener("abort",M,!1)}catch(e){U=setInterval(O,g)}else U=setInterval(O,g)}function E(){return j}function _(){try{"function"==typeof k.removeEventListener&&(k.removeEventListener("updateend",O,!1),k.removeEventListener("error",M,!1),k.removeEventListener("abort",M,!1)),clearInterval(U)}catch(e){x.error(e)}}function v(e){return new Promise(function(t){k&&H.get().streaming.buffer.useAppendWindow?L(function(){try{if(!k)return void t();var n=z.duration,r=0;e&&!isNaN(e.start)&&!isNaN(e.duration)&&isFinite(e.duration)&&(n=e.start+e.duration),e&&!isNaN(e.start)&&(r=e.start),k.appendWindowEnd===n&&k.appendWindowStart===r||(k.appendWindowStart=0,k.appendWindowEnd=n+h,k.appendWindowStart=Math.max(r-d,0),x.debug("Updated append window for ".concat(B.type,". Set start to ").concat(k.appendWindowStart," and end to ").concat(k.appendWindowEnd))),t()}catch(e){x.warn("Failed to set append window"),t()}}):t()})}function T(e){return new Promise(function(t){k?L(function(){try{k.timestampOffset===e||isNaN(e)||(k.timestampOffset=e,x.debug("Set MSE timestamp offset to ".concat(e))),t()}catch(e){t()}}):t()})}function S(){if(k){try{K=[],_(),W=!1,V=[],k.getClassName&&"TextSourceBuffer"===k.getClassName()||(x.debug("Removing sourcebuffer from media source"),z.removeSourceBuffer(k))}catch(e){}k=null}X=null}function b(){return k}function A(){try{return k.buffered}catch(e){return x.error("getAllBufferRanges exception: "+e.message),null}}function R(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise(function(r,a){e?(V.push({data:e,promise:{resolve:r,reject:a},request:n}),L(N.bind(t))):a({chunk:e,error:new i.default(s.default.APPEND_ERROR_CODE,s.default.APPEND_ERROR_MESSAGE)})})}function I(){return new Promise(function(e){L(function(){var t=k.appendWindowStart,n=k.appendWindowEnd;k&&(k.abort(),k.appendWindowStart=t,k.appendWindowEnd=n),e()})})}function C(e){return new Promise(function(t,n){var r=e.start,a=e.end;r>=0&&a>r?L(function(){try{k.remove(r,a),L(function(){t({from:r,to:a,unintended:!1}),e.resolve&&e.resolve()})}catch(t){n({from:r,to:a,unintended:!1,error:new i.default(s.default.REMOVE_ERROR_CODE,s.default.REMOVE_ERROR_MESSAGE)}),e.reject&&e.reject(t)}}):t()})}function N(){if(!W&&V.length>0){W=!0;var e=V[0];V.splice(0,1);var t=function(){W=!1,V.length>0&&N.call(this),
e&&e.data&&e.data.segmentType&&e.data.segmentType!==c.HTTPRequest.INIT_SEGMENT_TYPE&&delete e.data.bytes,e.promise.resolve({chunk:e.data})};try{X=e.request,0===e.data.bytes.byteLength?t.call(this):(k.appendBuffer?k.appendBuffer(e.data.bytes):k.append(e.data.bytes,e.data),L(t.bind(this)))}catch(t){x.fatal('SourceBuffer append failed "'+t+'"'),V.length>0?N():W=!1,delete e.data.bytes,e.promise.reject({chunk:e.data,error:new i.default(t.code,t.message)})}}}function D(){return new Promise(function(e){try{V=[],"open"===z.readyState?L(function(){try{k&&k.abort(),e()}catch(t){e()}}):k&&k.setTextTrack&&"ended"===z.readyState?(k.abort(),e()):e()}catch(t){e()}})}function w(){if(K.length>0&&!k.updating){var e=K.shift();e(),w()}}function O(){k.updating||w()}function M(e){var t=e.target||{};P(f.default.SOURCE_BUFFER_ERROR,{error:t,lastRequestAppended:X})}function P(e,t){var n=t||{};Y.trigger(e,n,{streamId:B.streamInfo.id,mediaType:j})}function L(e){K.push(e),k.updating||w()}var F,j,x,k,B,U,G=this.context,H=Object(u.default)(G).getInstance(),q=e.textController,Y=e.eventBus,K=[],V=[],W=!1,z=e.mediaSource,X=null;return F={getType:E,getAllBufferRanges:A,getBuffer:b,append:R,remove:C,abort:D,reset:S,updateTimestampOffset:T,initializeForStreamSwitch:n,initializeForFirstUse:p,updateAppendWindow:v,changeType:r},t(),F}n.r(t);var a=n("./src/core/Debug.js"),i=n("./src/streaming/vo/DashJSError.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/core/errors/Errors.js"),u=n("./src/core/Settings.js"),l=n("./src/streaming/constants/Constants.js"),c=n("./src/streaming/vo/metrics/HTTPRequest.js"),f=n("./src/core/events/Events.js"),d=.1,h=.01,g=50;r.__dashjs_factory_name="SourceBufferSink";var p=o.default.getClassFactory(r);t.default=p},"./src/streaming/Stream.js":function(e,t,n){function r(e){function t(){try{we=Object(f.default)(Pe).getInstance(),me=we.getLogger(pe),P(),De=Object(p.default)(Pe).getInstance(),Ce=Object(y.default)(Pe).create({updateEventName:c.default.SEGMENT_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:c.default.SEGMENT_LOCATION_BLACKLIST_ADD}),Re=Object(s.default)(Pe).create({streamInfo:Je,mediaPlayerModel:xe,dashMetrics:ke,errHandler:qe,settings:$e,boxParser:De,dashConstants:i.default,urlUtils:Fe})}catch(e){throw e}}function n(){r(),_(),Xe.initializeForStream(Je),Le.trigger(c.default.STREAM_UPDATED,{streamInfo:Je})}function r(){Le.on(c.default.BUFFERING_COMPLETED,$,pe),Le.on(c.default.DATA_UPDATE_COMPLETED,Z,pe),Le.on(c.default.INBAND_EVENTS,ee,pe)}function h(){Le.off(c.default.DATA_UPDATE_COMPLETED,Z,pe),Le.off(c.default.BUFFERING_COMPLETED,$,pe),Le.off(c.default.INBAND_EVENTS,ee,pe)}function _(){ze&&(Le.on(c.default.KEY_ERROR,V,pe),Le.on(c.default.SERVER_CERTIFICATE_UPDATED,V,pe),Le.on(c.default.LICENSE_REQUEST_COMPLETE,V,pe),Le.on(c.default.KEY_SYSTEM_SELECTED,V,pe),Le.on(c.default.KEY_SESSION_CREATED,V,pe),Le.on(c.default.KEY_STATUSES_CHANGED,V,pe))}function v(){ze&&(Le.off(c.default.KEY_ERROR,V,pe),Le.off(c.default.SERVER_CERTIFICATE_UPDATED,V,pe),Le.off(c.default.LICENSE_REQUEST_COMPLETE,V,pe),Le.off(c.default.KEY_SYSTEM_SELECTED,V,pe),Le.off(c.default.KEY_SESSION_CREATED,V,pe),Le.off(c.default.KEY_STATUSES_CHANGED,V,pe))}function T(){return Je?Je.id:null}function S(e,t){return new Promise(function(n,r){if(!_e)return de()?(_e=!0,Le.trigger(c.default.STREAM_ACTIVATED,{streamInfo:Je}),void n(t)):void b(e,t).then(function(e){_e=!0,Le.trigger(c.default.STREAM_ACTIVATED,{streamInfo:Je}),n(e)}).catch(function(e){r(e)});n(t)})}function b(e,t){return R(e,t)}function A(e,t){return new Promise(function(n,r){de()?r():(me.info("[startPreloading] Preloading next stream with id ".concat(B())),fe(!0),R(e,t).then(function(){for(var e=0;e<ye.length&&ye[e];e++)ye[e].setExplicitBufferingTime(k()),ye[e].getScheduleController().startScheduleTimer();n()}).catch(function(){fe(!1),r()}))})}function R(e,t){return new Promise(function(n,r){Y(),Ae=!0,X();var i=Qe.getElement();E.forEach(function(t){(t!==a.default.VIDEO||!i||i&&/^VIDEO$/i.test(i.nodeName))&&I(t,e)}),D(t).then(function(e){if(Ae=!1,0===ye.length){var t="No streams to play.";qe.error(new g.default(d.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,t,je.getValue())),me.fatal(t)}else Q();Xe.createTracks(Je),n(e)}).catch(function(e){r(e)})})}function I(t,n){var r,o=Ue.getAllMediaInfoForType(Je,t),s=[],l=null;if(o&&0!==o.length){t===a.default.VIDEO&&(Te=!0),t===a.default.AUDIO&&(Se=!0);for(var f=0,d=o.length;f<d;f++)l=o[f],t===a.default.TEXT&&l.isEmbedded&&(Xe.addEmbeddedTrack(Je,l),s.push(l)),C(l)&&We.addTrack(l);if(s.length>0&&(We.setInitialMediaSettingsForType(t,Je),Xe.setInitialSettings(We.getInitialSettings(t)),Xe.addMediaInfosToBuffer(Je,t,s)),o=o.filter(function(e){return!e.isEmbedded}),0!==o.length){if(t===a.default.IMAGE)return Ie=Object(u.default)(Pe).create({streamInfo:Je,adapter:Ue,baseURLController:e.baseURLController,timelineConverter:e.timelineConverter,debug:we,eventBus:Le,events:c.default,dashConstants:i.default,dashMetrics:e.dashMetrics,segmentBaseController:e.segmentBaseController}),void Ie.initialize();Le.trigger(c.default.STREAM_INITIALIZING,{streamInfo:Je,mediaInfo:l}),We.setInitialMediaSettingsForType(t,Je);var h=N(o,n);r=We.getCurrentTrackFor(t,Je.id),r&&(Ye.updateTopQualityIndex(r),h.selectMediaInfo(t===a.default.TEXT&&r.isEmbedded?o[0]:r))}}else me.info("No "+t+" data.")}function C(e){var t,n=e?e.type:null;return n===a.default.MUXED?(t="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines",me.fatal(t),qe.error(new g.default(d.default.MANIFEST_ERROR_ID_MULTIPLEXED_CODE,t,je.getValue())),!1):n===a.default.TEXT||n===a.default.IMAGE||(!(e.contentProtection&&!He.supportsEncryptedMedia())||(qe.error(new g.default(d.default.CAPABILITY_MEDIAKEYS_ERROR_CODE,d.default.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE)),!1))}function N(t,n){var r=t&&t.length>0?t[0]:null,i=Re.getModel(r?r.type:null),s=r?r.type:null,u=r?r.mimeType:null,l=r?r.isFragmented:null,c=Object(o.default)(Pe).create({streamInfo:Je,type:s,mimeType:u,timelineConverter:Ge,adapter:Ue,manifestModel:je,mediaPlayerModel:xe,fragmentModel:i,dashMetrics:e.dashMetrics,baseURLController:e.baseURLController,segmentBaseController:e.segmentBaseController,abrController:Ye,playbackController:Ke,mediaController:We,textController:Xe,errHandler:qe,settings:$e,boxParser:De,segmentBlacklistController:Ce});c.initialize(n,Te,l),ye.push(c);for(var f=0;f<t.length;f++)c.addMediaInfo(t[f]);return s===a.default.TEXT&&Xe.addMediaInfosToBuffer(Je,s,t,i),c}function D(e){return new Promise(function(t){var n={},r=ye.map(function(t){return t.createBufferSinks(e)});Promise.all(r).then(function(e){e.forEach(function(e){e&&(n[e.getType()]=e)}),t(n)}).catch(function(){t(n)})})}function w(e){for(var t=ye?ye.length:0,n=!1,r=0;r<t;r++){var a=ye[r].getFragmentModel();a.abortRequests(),a.resetInitialSettings(),ye[r].reset(n,e)}Xe&&Xe.deactivateStream(Je),ye=[],_e=!1,ve=!1,fe(!1),x(!1),Le.trigger(c.default.STREAM_DEACTIVATED,{streamInfo:Je})}function O(){return _e}function M(e){for(var t=0;t<ye.length;)C(ye[t].getMediaInfo())?(ye[t].setMediaSource(e),t++):(ye[t].reset(),ye.splice(t,1));if(0===ye.length){var n="No streams to play.";qe.error(new g.default(d.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,n+"nostreams",je.getValue())),me.fatal(n)}}function P(e){w(e),Ee=!1,Te=!1,Se=!1,be={},Ae=!1,Oe=!1,Me=[]}function L(e){Re&&(Re.reset(),Re=null),Ye&&Je&&Ye.clearDataForStream(Je.id),Ce&&(Ce.reset(),Ce=null),P(e),Je=null,h(),v()}function F(){return Je?Je.duration:NaN}function j(){return Oe}function x(e){Oe=e}function k(){return Je?Je.start:NaN}function B(){return Je?Je.id:null}function U(){return Je}function G(){return Se}function H(){return Te}function q(){return Ie}function Y(){if(!Qe||!Ye)throw new Error(a.default.MISSING_CONFIG_ERROR)}function K(e){if(Y(),e===a.default.IMAGE)return Ie?Ie.getBitrateList():[];var t=J(e);return Ye.getBitrateList(t)}function V(e){e.error&&(qe.error(e.error),me.fatal(e.error.message))}function W(e){if(_e&&Je){ve=!1;var t=e.newMediaInfo,n=je.getValue();Ue.setCurrentMediaInfo(Je.id,t.type,t);var r=te(t);if(r){var i=Ke.getTime();me.info("Stream -  Process track changed at current time "+i),n.refreshManifestOnSwitchTrack?(Me.push(e),Be.getIsUpdating()||(me.debug("Stream -  Refreshing manifest for switch track"),Be.refreshManifest())):r.selectMediaInfo(t).then(function(){t.type!==a.default.VIDEO&&t.type!==a.default.AUDIO||Ye.updateTopQualityIndex(t),r.prepareTrackSwitch()})}}}function z(e){var t=ne(e.mediaType);t&&t.prepareQualityChange(e)}function X(){if(Ve){var e=Ue.getEventsFor(Je);Ve.addInlineEvents(e)}}function Q(){for(var e=ye.length,t=!!be.audio||!!be.video,n=t?new g.default(d.default.DATA_UPDATE_FAILED_ERROR_CODE,d.default.DATA_UPDATE_FAILED_ERROR_MESSAGE):null,r=0;r<e;r++)if(ye[r].isUpdating()||Ae)return;if(ze){ze.clearMediaInfoArray();for(var i=0;i<e&&ye[i];i++){var o=ye[i].getType(),s=ye[i].getMediaInfo();if(o===a.default.AUDIO||o===a.default.VIDEO||o===a.default.TEXT&&s.isFragmented){var u=ye[i].getMediaInfo();u&&ze.initializeForMedia(u)}}}n?qe.error(n):Ee||(Ee=!0,Le.trigger(c.default.STREAM_INITIALIZED,{streamInfo:Je}))}function J(e){for(var t=null,n=0;n<ye.length;n++)if(t=ye[n],t.getType()===e)return t.getMediaInfo();return null}function $(){var e=re(),t=e.length;if(0!==t){for(var n=0;n<t;n++)if(!e[n].isBufferingCompleted()&&(e[n].getType()===a.default.AUDIO||e[n].getType()===a.default.VIDEO))return void me.debug("onBufferingCompleted - One streamProcessor has finished but",e[n].getType(),"one is not buffering completed");me.debug("onBufferingCompleted - trigger STREAM_BUFFERING_COMPLETED"),ve=!0,Le.trigger(c.default.STREAM_BUFFERING_COMPLETED,{streamInfo:Je},{streamInfo:Je})}else me.warn("onBufferingCompleted - can't trigger STREAM_BUFFERING_COMPLETED because no streamProcessor is defined")}function Z(e){be[e.mediaType]=e.error,Q()}function ee(e){Ve&&Ve.addInbandEvents(e.events)}function te(e){return e&&e.type?ne(e.type):null}function ne(e){if(!e)return null;var t=re();return t.filter(function(t){return t.getType()===e})[0]}function re(){for(var e,t,n=[],r=0;r<ye.length;r++)t=ye[r],e=t.getType(),e!==a.default.AUDIO&&e!==a.default.VIDEO&&e!==a.default.TEXT||n.push(t);return n}function ae(){for(var e=ye.length,t=0;t<e&&ye[t];t++)ye[t].getScheduleController().startScheduleTimer()}function ie(e){return new Promise(function(t){Ae=!0,Je=e,Ve&&X();for(var n=[],r=0,a=ye.length;r<a;r++){var i=ye[r],o=i.getMediaInfo();n.push(i.updateStreamInfo(Je));var s=Ue.getAllMediaInfoForType(Je,i.getType());if(s){i.clearMediaInfoArray();for(var u=0;u<s.length;u++){var l=s[u];i.addMediaInfo(s[u]),Ue.areMediaInfosEqual(o,l)&&(Ye.updateTopQualityIndex(l),n.push(i.selectMediaInfo(l)))}}}Promise.all(n).then(function(){for(n=[];Me.length>0;){var e=Me.pop(),t=e.newMediaInfo,r=te(e.oldMediaInfo);if(!r)return;n.push(r.prepareTrackSwitch()),r.selectMediaInfo(t)}return Promise.all(n)}).then(function(){Ae=!1,Q(),Le.trigger(c.default.STREAM_UPDATED,{streamInfo:Je}),t()})})}function oe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return ce(e,a.default.VIDEO,t)&&ce(e,a.default.AUDIO,t)}function se(e){return!e||ue(a.default.VIDEO,e)&&ue(a.default.AUDIO,e)}function ue(e,t){var n=U(),r=t.getStreamInfo();if(!r||!n)return!0;var a=Ue.getAdaptationForType(r.index,e,r),i=Ue.getAdaptationForType(n.index,e,n);return a&&i?!(!le(i)&&le(a)):!a&&!i}function le(e){return!!e&&!!(e.ContentProtection||e.Representation&&e.Representation.length>0&&e.Representation[0].ContentProtection)}function ce(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e||!e.hasOwnProperty("getStreamInfo"))return!1;var r=e.getStreamInfo(),a=n?n.getStreamInfo():U();if(!r||!a)return!1;var i=Ue.getAdaptationForType(r.index,t,r),o=Ue.getAdaptationForType(a.index,t,a);if(!i||!o)return!i&&!o;var s=i&&o&&i.mimeType===o.mimeType,u=o.Representation_asArray.map(function(e){return e.codecs}),l=i.Representation_asArray.map(function(e){return e.codecs}),c=l.some(function(e){return u.indexOf(e)>-1}),f=l.some(function(e){return u.some(function(t){return He.codecRootCompatibleWithCodec(t,e)})});return c||f&&s}function fe(e){Ne=e}function de(){return Ne}function he(){return ve}function ge(){return Ue}e=e||{};var pe,me,ye,Ee,_e,ve,Te,Se,be,Ae,Re,Ie,Ce,Ne,De,we,Oe,Me,Pe=this.context,Le=Object(l.default)(Pe).getInstance(),Fe=Object(m.default)(Pe).getInstance(),je=e.manifestModel,xe=e.mediaPlayerModel,ke=e.dashMetrics,Be=e.manifestUpdater,Ue=e.adapter,Ge=e.timelineConverter,He=e.capabilities,qe=e.errHandler,Ye=e.abrController,Ke=e.playbackController,Ve=e.eventController,We=e.mediaController,ze=e.protectionController,Xe=e.textController,Qe=e.videoModel,Je=e.streamInfo,$e=e.settings;return pe={initialize:n,getStreamId:T,activate:S,deactivate:w,getIsActive:O,getDuration:F,getStartTime:k,getId:B,getStreamInfo:U,getHasAudioTrack:G,getHasVideoTrack:H,startPreloading:A,getThumbnailController:q,getBitrateListFor:K,updateData:ie,reset:L,getProcessors:re,setMediaSource:M,isMediaCodecCompatible:oe,isProtectionCompatible:se,getPreloaded:de,getIsEndedEventSignaled:j,setIsEndedEventSignaled:x,getAdapter:ge,getHasFinishedBuffering:he,setPreloaded:fe,startScheduleControllers:ae,prepareTrackChange:W,prepareQualityChange:z},t(),pe}n.r(t);var a=n("./src/streaming/constants/Constants.js"),i=n("./src/dash/constants/DashConstants.js"),o=n("./src/streaming/StreamProcessor.js"),s=n("./src/streaming/controllers/FragmentController.js"),u=n("./src/streaming/thumbnail/ThumbnailController.js"),l=n("./src/core/EventBus.js"),c=n("./src/core/events/Events.js"),f=n("./src/core/Debug.js"),d=n("./src/core/errors/Errors.js"),h=n("./src/core/FactoryMaker.js"),g=n("./src/streaming/vo/DashJSError.js"),p=n("./src/streaming/utils/BoxParser.js"),m=n("./src/streaming/utils/URLUtils.js"),y=n("./src/streaming/controllers/BlacklistController.js"),E=[a.default.VIDEO,a.default.AUDIO,a.default.TEXT,a.default.MUXED,a.default.IMAGE];r.__dashjs_factory_name="Stream",t.default=h.default.getClassFactory(r)},"./src/streaming/StreamProcessor.js":function(e,t,n){function r(e){function t(){Ce=Object(_.default)(Be).getInstance().getLogger(Ie),C(),Ue.on(p.default.DATA_UPDATE_COMPLETED,B,Ie,{priority:g.default.EVENT_PRIORITY_HIGH}),Ue.on(p.default.INIT_FRAGMENT_NEEDED,M,Ie),Ue.on(p.default.MEDIA_FRAGMENT_NEEDED,P,Ie),Ue.on(p.default.MEDIA_FRAGMENT_LOADED,me,Ie),Ue.on(p.default.BUFFER_LEVEL_STATE_CHANGED,U,Ie),Ue.on(p.default.BUFFER_CLEARED,G,Ie),Ue.on(p.default.SEEK_TARGET,be,Ie),Ue.on(p.default.FRAGMENT_LOADING_ABANDONED,W,Ie),Ue.on(p.default.FRAGMENT_LOADING_COMPLETED,z,Ie),Ue.on(p.default.QUOTA_EXCEEDED,$,Ie),Ue.on(p.default.SET_FRAGMENTED_TEXT_AFTER_DISABLED,Q,Ie),Ue.on(p.default.SET_NON_FRAGMENTED_TEXT,J,Ie),Ue.on(p.default.SOURCE_BUFFER_ERROR,H,Ie)}function n(t,n,r){xe=Object(A.default)(Be).create({events:p.default,eventBus:Ue,streamInfo:Ge,timelineConverter:Ke,dashConstants:i.default,segmentBaseController:e.segmentBaseController,type:He}),je=Object(m.default)(Be).create({streamInfo:Ge,type:He,timelineConverter:Ke,dashMetrics:et,mediaPlayerModel:ze,baseURLController:e.baseURLController,errHandler:qe,segmentsController:xe,settings:tt,boxParser:nt,events:p.default,eventBus:Ue,errors:y.default,debug:Object(_.default)(Be).getInstance(),requestModifier:Object(v.default)(Be).getInstance(),dashConstants:i.default,constants:a.default,urlUtils:Object(T.default)(Be).getInstance()}),Ne=Ge.manifestInfo.isDynamic,je.initialize(Ne),Qe.registerStreamType(He,Ie),Pe=Object(f.default)(Be).create({streamInfo:Ge,type:He,abrController:Qe,dashMetrics:et,playbackController:Je,timelineConverter:Ke,dashConstants:i.default,events:p.default,eventBus:Ue,errors:y.default,isDynamic:Ne,segmentsController:xe}),Oe=Se(He,r),Oe&&Oe.initialize(t),Me=Object(c.default)(Be).create({streamInfo:Ge,type:He,mimeType:Ye,adapter:Ve,dashMetrics:et,mediaPlayerModel:ze,fragmentModel:Xe,abrController:Qe,playbackController:Je,textController:Ze,mediaController:$e,bufferController:Oe,settings:tt}),Me.initialize(n),ke=0,Le=!1}function r(){return Ge.id}function d(){return He}function I(){return Ve.getIsTextTrack(Pe.getData())}function C(){we=[],De=null,ke=0,Le=!1,Fe=!1}function N(e,t){je&&je.reset(),Oe&&(Oe.reset(e,t),Oe=null),Me&&(Me.reset(),Me=null),Pe&&(Pe.reset(),Pe=null),xe&&(xe=null),Qe&&Qe.unRegisterStreamType(r(),He),Ue.off(p.default.DATA_UPDATE_COMPLETED,B,Ie),Ue.off(p.default.INIT_FRAGMENT_NEEDED,M,Ie),Ue.off(p.default.MEDIA_FRAGMENT_NEEDED,P,Ie),Ue.off(p.default.MEDIA_FRAGMENT_LOADED,me,Ie),Ue.off(p.default.BUFFER_LEVEL_STATE_CHANGED,U,Ie),Ue.off(p.default.BUFFER_CLEARED,G,Ie),Ue.off(p.default.SEEK_TARGET,be,Ie),Ue.off(p.default.FRAGMENT_LOADING_ABANDONED,W,Ie),Ue.off(p.default.FRAGMENT_LOADING_COMPLETED,z,Ie),Ue.off(p.default.SET_FRAGMENTED_TEXT_AFTER_DISABLED,Q,Ie),Ue.off(p.default.SET_NON_FRAGMENTED_TEXT,J,Ie),Ue.off(p.default.QUOTA_EXCEEDED,$,Ie),Ue.off(p.default.SOURCE_BUFFER_ERROR,H,Ie),C(),He=null,Ge=null}function D(){return!!Pe&&Pe.isUpdating()}function w(e){return new Promise(function(t){Me.clearScheduleTimer(),Xe.abortRequests(),Oe.prepareForPlaybackSeek().then(function(){var t=Oe.getAllRangesWithSafetyFactor(e.seekTime);return Oe.clearBuffers(t)}).then(function(){var n=Oe.getContinuousBufferTimeForTargetTime(e.seekTime);if(!isNaN(Ge.duration)&&isFinite(Ge.duration)&&n>=Ge.start+Ge.duration)Oe.setIsBufferingCompleted(!0),t();else{Ae(n),Oe.setSeekTarget(n);var r=[];r.push(Oe.updateAppendWindow());var a=de();r.push(Oe.updateBufferTimestampOffset(a)),Promise.all(r).then(function(){Me.setInitSegmentRequired(!0),Me.setCheckPlaybackQuality(!1),Me.startScheduleTimer(),t()})}}).catch(function(e){Ce.error(e)})})}function O(){return new Promise(function(e,t){try{Me.clearScheduleTimer(),Xe.abortRequests(),Oe.prepareForPlaybackSeek().then(function(){return Oe.pruneAllSafely()}).then(function(){e()})}catch(e){t(e)}})}function M(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.sender)if(Je.getIsManifestUpdateInProgress())k();else if((!I()||Ze.isTextEnabled())&&Oe&&e.representationId&&!Oe.appendInitSegmentFromCache(e.representationId)){var n=Pe.getCurrentRepresentation();if(0===n.range)return void P();var r=je?je.getInitRequest(De,n):null;r?Xe.executeRequest(r):t&&(Me.setInitSegmentRequired(!0),k())}}function P(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Je.getIsManifestUpdateInProgress()||Oe.getIsPruningInProgress())k();else{var n=x();n?(Le=!1,L(n)):F(t)}}function L(e){isNaN(e.startTime+e.duration)||(ke=e.startTime+e.duration),e.delayLoadingTime=(new Date).getTime()+Me.getTimeToLoadDelay(),Me.setTimeToLoadDelay(0),j(e)?(Ce.warn("Fragment request url ".concat(e.url," for stream id ").concat(Ge.id," and media type ").concat(He," is on the ignore list and will be skipped")),k()):(Ce.debug("Next fragment request url for stream id ".concat(Ge.id," and media type ").concat(He," is ").concat(e.url)),Xe.executeRequest(e))}function F(e){var t=Pe.getCurrentRepresentation();if(tt.get().streaming.gaps.enableSeekFix&&!Ne&&Le&&Je.isSeeking()){var n=je.getValidSeekTimeCloseToTargetTime(ke,De,t,tt.get().streaming.gaps.threshold);if(!isNaN(n))return void Je.seek(n,!1,!1)}var r=je.isLastSegmentRequested(t,ke);if(r){var a=je.getCurrentIndex();return Ce.debug("Segment requesting for stream ".concat(Ge.id," has finished")),Ue.trigger(p.default.STREAM_REQUESTING_COMPLETED,{segmentIndex:a},{streamId:Ge.id,mediaType:He}),Oe.segmentRequestingCompleted(a),void Me.clearScheduleTimer()}e&&k()}function j(e){var t=e.url;return e.range&&(t=t.concat("_",e.range)),rt.contains(t)}function x(){var e,t=de();if(isNaN(ke)||d()===a.default.TEXT&&!Ze.isTextEnabled())return null;var n=Le;if(je){var r=Pe&&t?Pe.getRepresentationForQuality(t.quality):null;e=n?je.getSegmentRequestForTime(De,r,ke):je.getNextSegmentRequest(De,r)}return e}function k(){Me.startScheduleTimer(tt.get().streaming.lowLatencyEnabled?tt.get().streaming.scheduling.lowLatencyTimeout:tt.get().streaming.scheduling.defaultTimeout)}function B(e){e.error||(Me.setCurrentRepresentation(Ve.convertRepresentationToRepresentationInfo(e.currentRepresentation)),Oe.getIsBufferingCompleted()||Oe.updateBufferTimestampOffset(e.currentRepresentation))}function U(e){et.addBufferState(He,e.state,Me.getBufferTarget()),e.state!==o.default.BUFFER_EMPTY||Je.isSeeking()||(Ce.info("Buffer is empty! Stalling!"),et.pushPlayListTraceMetrics(new Date,b.PlayListTrace.REBUFFERING_REASON))}function G(e){Xe.syncExecutedRequestsWithBufferedRange(Oe.getBuffer().getAllBufferRanges(),Ge.duration),e.quotaExceeded&&e.from>Je.getTime()&&Ae(e.from),e.hasEnoughSpaceToAppend&&e.quotaExceeded&&Me.startScheduleTimer()}function H(e){if(e&&e.lastRequestAppended&&e.lastRequestAppended.url){var t=e.lastRequestAppended.url;e.lastRequestAppended.range&&(t=t.concat("_",e.lastRequestAppended.range)),Ce.warn("Blacklisting segment with url ".concat(t)),rt.add(t)}}function q(e){Ce.debug("Preparing quality switch for type ".concat(He));var t=e.newQuality;Fe=!0,Me.clearScheduleTimer();var n=de(t);Me.setCurrentRepresentation(n),Pe.prepareQualityChange(t),Xe.abortRequests(),Oe.updateBufferTimestampOffset(n).then(function(){e.reason&&e.reason.forceReplace?Y():tt.get().streaming.buffer.fastSwitchEnabled?K(n):V(),et.pushPlayListTraceMetrics(new Date,b.PlayListTrace.REPRESENTATION_SWITCH_STOP_REASON),et.createPlaylistTraceMetrics(n.id,1e3*Je.getTime(),Je.getPlaybackRate())})}function Y(){Ue.trigger(p.default.BUFFER_REPLACEMENT_STARTED,{mediaType:He,streamId:Ge.id},{mediaType:He,streamId:Ge.id}),Oe.prepareForReplacementQualitySwitch().then(function(){ve(),Fe=!1}).catch(function(){ve(),Fe=!1})}function K(e){var t=Je.getTime(),n=1.5,r=Xe.getRequests({state:s.default.FRAGMENT_MODEL_EXECUTED,time:t+n,threshold:0})[0];if(r&&!I()){var a=Oe.getBufferLevel(),i=Qe.getAbandonmentStateFor(Ge.id,He);if(r.quality<e.quality&&a>=n&&i!==o.default.ABANDON_LOAD){var u=t+n;Ae(u),Me.setCheckPlaybackQuality(!1),Me.startScheduleTimer()}else V()}else Me.startScheduleTimer();Fe=!1}function V(){Te(),Fe=!1}function W(e){Ce.info("onFragmentLoadingAbandoned request: "+e.request.url+" has been aborted"),Je.isSeeking()||Me.getSwitchStrack()||Fe||(Ce.info("onFragmentLoadingAbandoned request: "+e.request.url+" has to be downloaded again, origin is not seeking process or switch track call"),e.request&&e.request.isInitializationRequest()?Me.setInitSegmentRequired(!0):Ae(e.request.startTime+e.request.duration/2),Me.startScheduleTimer(0))}function z(e){Ce.info("OnFragmentLoadingCompleted for stream id "+Ge.id+" and media type "+He+" - Url:",e.request?e.request.url:"undefined",e.request.range?", Range:"+e.request.range:""),I()&&Me.startScheduleTimer(0),e.error&&e.request.serviceLocation&&X(e)}function X(e){Ce.info("Fragment loading completed with an error"),e&&e.request&&e.request.type&&(e.request.type===R.HTTPRequest.INIT_SEGMENT_TYPE?M({representationId:e.request.representationId,sender:{}},!1):e.request.type===R.HTTPRequest.MEDIA_SEGMENT_TYPE&&(Ae(e.request.startTime+e.request.duration/2),P({},!1)))}function Q(){Ae(Je.getTime()),fe().startScheduleTimer()}function J(e){var t=e.currentTrackInfo;if(t){var n=we.find(function(e){return e.index===t.index&&e.lang===t.lang});n&&ie(n).then(function(){Oe.setIsBufferingCompleted(!1),Ae(Je.getTime()),Me.setInitSegmentRequired(!0),Me.startScheduleTimer()})}}function $(e){Ae(e.quotaExceededTime),Me.clearScheduleTimer()}function Z(){return Pe}function ee(){return Oe?Oe.getBuffer():null}function te(){return Oe}function ne(){return Xe}function re(e){return Ge=e,he()?Promise.resolve():Oe.updateAppendWindow()}function ae(){return Ge}function ie(e){e===De||e&&De&&e.type!==De.type||(De=e);var t=Ve.getRealAdaptation(Ge,De),n=Ve.getVoRepresentations(De);if(Pe){var r,i,o=Pe.getData(),s=Qe.getMaxAllowedIndexFor(He,Ge.id),u=Qe.getMinAllowedIndexFor(He,Ge.id),l=null;return null!==o&&(o&&t&&o.id===t.id)||He===a.default.TEXT?r=Qe.getQualityFor(He,Ge.id):(i=Qe.getThroughputHistory().getAverageThroughput(He,Ne),l=i||Qe.getInitialBitrateFor(He,Ge.id),r=Qe.getQualityForBitrate(De,l,Ge.id)),void 0!==u&&r<u&&(r=u),r>s&&(r=s),Pe.updateData(t,n,He,De.isFragmented,r)}return Promise.resolve()}function oe(e){-1===we.indexOf(e)&&we.push(e)}function se(){we=[]}function ue(){return De}function le(){return Oe.getMediaSource()}function ce(e){Oe.setMediaSource(e)}function fe(){return Me}function de(e){var t;return void 0!==e?(Object(h.checkInteger)(e),t=Pe?Pe.getRepresentationForQuality(e):null):t=Pe?Pe.getCurrentRepresentation():null,Ve.convertRepresentationToRepresentationInfo(t)}function he(){return!!Oe&&Oe.getIsBufferingCompleted()}function ge(){return Oe?Oe.getBufferLevel():0}function pe(){var e=de(),t=Pe&&e?Pe.getRepresentationForQuality(e.quality):null,n=je.getNextSegmentRequestIdempotent(De,t);return n}function me(e){var t=e.chunk,n=t.bytes,r=t.quality,a=de(r),i=Pe&&a?Pe.getRepresentationForQuality(a.quality):null;if(a&&i){var o=Ve.getEventsFor(a.mediaInfo),u=Ve.getEventsFor(a,i);if(o&&o.length>0||u&&u.length>0){var l=Xe.getRequests({state:s.default.FRAGMENT_MODEL_EXECUTED,quality:r,index:t.index})[0],c=ye(n,l,o,u);Ue.trigger(p.default.INBAND_EVENTS,{events:c},{streamId:Ge.id})}}}function ye(e,t,n,r){try{for(var a={},i=[],o=n.concat(r),s=0,u=o.length;s<u;s++)a[o[s].schemeIdUri+"/"+o[s].value]=o[s];var l=Object(S.default)(Be).getInstance().parse(e),c=l.getBoxes("emsg");if(!c||0===c.length)return i;for(var f=l.getBox("sidx"),d=!f||isNaN(f.earliest_presentation_time)||isNaN(f.timescale)?t&&!isNaN(t.mediaStartTime)?t.mediaStartTime:0:f.earliest_presentation_time/f.timescale,h=Math.max(d,0),g=Pe.getCurrentRepresentation(),p=0,m=c.length;p<m;p++){var y=Ve.getEvent(c[p],a,h,g);y&&i.push(y)}return i}catch(e){return[]}}function Ee(e){var t=ee();return t?Promise.resolve(t):Oe?Oe.createBufferSink(De,e):Promise.resolve(null)}function _e(){return new Promise(function(e){Ce.debug("Preparing track switch for type ".concat(He));var t=He===a.default.TEXT||tt.get().streaming.trackSwitchMode[He]===a.default.TRACK_SWITCH_MODE_ALWAYS_REPLACE&&Je.getTimeToStreamEnd(Ge)>tt.get().streaming.buffer.stallThreshold;if(Oe.getIsBufferingCompleted()&&!t)return Oe.prepareForNonReplacementTrackSwitch(De.codec).then(function(){Ue.trigger(p.default.BUFFERING_COMPLETED,{},{streamId:Ge.id,mediaType:He})}).catch(function(){Ue.trigger(p.default.BUFFERING_COMPLETED,{},{streamId:Ge.id,mediaType:He})}),void e();Me.clearScheduleTimer(),Me.setSwitchTrack(!0),t?(Ue.trigger(p.default.BUFFER_REPLACEMENT_STARTED,{mediaType:He,streamId:Ge.id},{mediaType:He,streamId:Ge.id}),Xe.abortRequests(),Oe.prepareForReplacementTrackSwitch(De.codec).then(function(){var e=de();return Oe.updateBufferTimestampOffset(e)}).then(function(){ve(),e()}).catch(function(){ve(),e()})):Oe.prepareForNonReplacementTrackSwitch(De.codec).then(function(){Te(),e()}).catch(function(){Te(),e()})})}function ve(){var e=Je.getTime();tt.get().streaming.buffer.flushBufferAtTrackSwitch&&Je.seek(e+.001,!1,!0),Ae(e),Oe.setSeekTarget(e),Me.startScheduleTimer()}function Te(){var e=Je.getTime(),t=Oe.getContinuousBufferTimeForTargetTime(e);Ae(t),Me.startScheduleTimer()}function Se(e,t){var n=null;return e?(n=e!==a.default.TEXT||t?Object(u.default)(Be).create({streamInfo:Ge,type:e,mediaPlayerModel:ze,manifestModel:We,fragmentModel:Xe,errHandler:qe,mediaController:$e,representationController:Pe,adapter:Ve,textController:Ze,abrController:Qe,playbackController:Je,settings:tt}):Object(l.default)(Be).create({streamInfo:Ge,type:e,mimeType:Ye,fragmentModel:Xe,textController:Ze,errHandler:qe,settings:tt}),n):(qe.error(new E.default(y.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,y.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+"not properly defined")),null)}function be(e){e&&!isNaN(e.time)&&(Ae(e.time),Oe.setSeekTarget(e.time))}function Ae(e){ke=e,Le=!0}function Re(e,t){et.pushPlayListTraceMetrics(e,t)}e=e||{};var Ie,Ce,Ne,De,we,Oe,Me,Pe,Le,Fe,je,xe,ke,Be=this.context,Ue=Object(g.default)(Be).getInstance(),Ge=e.streamInfo,He=e.type,qe=e.errHandler,Ye=e.mimeType,Ke=e.timelineConverter,Ve=e.adapter,We=e.manifestModel,ze=e.mediaPlayerModel,Xe=e.fragmentModel,Qe=e.abrController,Je=e.playbackController,$e=e.mediaController,Ze=e.textController,et=e.dashMetrics,tt=e.settings,nt=e.boxParser,rt=e.segmentBlacklistController;return Ie={initialize:n,getStreamId:r,getType:d,isUpdating:D,getBufferController:te,getFragmentModel:ne,getScheduleController:fe,getRepresentationController:Z,getRepresentationInfo:de,getBufferLevel:ge,isBufferingCompleted:he,createBufferSinks:Ee,updateStreamInfo:re,getStreamInfo:ae,selectMediaInfo:ie,clearMediaInfoArray:se,addMediaInfo:oe,prepareTrackSwitch:_e,prepareQualityChange:q,getMediaInfo:ue,getMediaSource:le,setMediaSource:ce,getBuffer:ee,setExplicitBufferingTime:Ae,finalisePlayList:Re,probeNextRequest:pe,prepareInnerPeriodPlaybackSeeking:w,prepareOuterPeriodPlaybackSeeking:O,reset:N},t(),Ie}n.r(t);var a=n("./src/streaming/constants/Constants.js"),i=n("./src/dash/constants/DashConstants.js"),o=n("./src/streaming/constants/MetricsConstants.js"),s=n("./src/streaming/models/FragmentModel.js"),u=n("./src/streaming/controllers/BufferController.js"),l=n("./src/streaming/text/NotFragmentedTextBufferController.js"),c=n("./src/streaming/controllers/ScheduleController.js"),f=n("./src/dash/controllers/RepresentationController.js"),d=n("./src/core/FactoryMaker.js"),h=n("./src/streaming/utils/SupervisorTools.js"),g=n("./src/core/EventBus.js"),p=n("./src/core/events/Events.js"),m=n("./src/dash/DashHandler.js"),y=n("./src/core/errors/Errors.js"),E=n("./src/streaming/vo/DashJSError.js"),_=n("./src/core/Debug.js"),v=n("./src/streaming/utils/RequestModifier.js"),T=n("./src/streaming/utils/URLUtils.js"),S=n("./src/streaming/utils/BoxParser.js"),b=n("./src/streaming/vo/metrics/PlayList.js"),A=n("./src/dash/controllers/SegmentsController.js"),R=n("./src/streaming/vo/metrics/HTTPRequest.js");r.__dashjs_factory_name="StreamProcessor",t.default=d.default.getClassFactory(r)},"./src/streaming/XlinkLoader.js":function(e,t,n){function r(e){function t(e,t,n){var r=function(r,i){t.resolved=!0,t.resolvedContent=r||null,h.trigger(l.default.XLINK_ELEMENT_LOADED,{element:t,resolveObject:n,error:r||i?null:new a.default(f.default.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE,f.default.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE+e)})};if(e===c)r(null,!0);else{var i=new s.default(e,o.HTTPRequest.XLINK_EXPANSION_TYPE);g.load({request:i,success:function(e){r(e)},error:function(){r(null)}})}}function n(){g&&(g.abort(),g=null)}e=e||{};var r,c="urn:mpeg:dash:resolve-to-zero:2013",d=this.context,h=Object(u.default)(d).getInstance(),g=Object(i.default)(d).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,errors:f.default});return r={load:t,reset:n},r}n.r(t);var a=n("./src/streaming/vo/DashJSError.js"),i=n("./src/streaming/net/URLLoader.js"),o=n("./src/streaming/vo/metrics/HTTPRequest.js"),s=n("./src/streaming/vo/TextRequest.js"),u=n("./src/core/EventBus.js"),l=n("./src/core/events/Events.js"),c=n("./src/core/FactoryMaker.js"),f=n("./src/core/errors/Errors.js");r.__dashjs_factory_name="XlinkLoader",t.default=c.default.getClassFactory(r)},"./src/streaming/constants/ConformanceViolationConstants.js":function(e,t,n){n.r(t),t.default={LEVELS:{SUGGESTION:"Suggestion",WARNING:"Warning",ERROR:"Error"},EVENTS:{NO_UTC_TIMING_ELEMENT:{key:"NO_UTC_TIMING_ELEMENT",message:"No UTCTiming element is present in the manifest. You may experience playback failures. For a detailed validation use https://conformance.dashif.org/"},NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE:{key:"NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE",message:'SMPTE 2052-1:2013 defines the attribute name as "imageType" and does not define "imagetype"'},INVALID_DVR_WINDOW:{key:"INVALID_DVR_WINDOW",message:"No valid segment found when applying a specification compliant DVR window calculation. Using SegmentTimeline entries as a fallback."}}}},"./src/streaming/constants/Constants.js":function(e,t,n){function r(e,t){
if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}n.r(t);var o=function(){function e(){r(this,e),this.init()}return i(e,[{key:"init",value:function(){this.STREAM="stream",this.VIDEO="video",this.AUDIO="audio",this.TEXT="text",this.MUXED="muxed",this.IMAGE="image",this.STPP="stpp",this.TTML="ttml",this.VTT="vtt",this.WVTT="wvtt",this.ABR_STRATEGY_DYNAMIC="abrDynamic",this.ABR_STRATEGY_BOLA="abrBola",this.ABR_STRATEGY_L2A="abrL2A",this.ABR_STRATEGY_LoLP="abrLoLP",this.ABR_STRATEGY_THROUGHPUT="abrThroughput",this.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA="abrFetchThroughputCalculationDownloadedData",this.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING="abrFetchThroughputCalculationMoofParsing",this.ABR_FETCH_THROUGHPUT_CALCULATION_AAST="abrFetchThroughputCalculationAAST",this.LIVE_CATCHUP_MODE_DEFAULT="liveCatchupModeDefault",this.LIVE_CATCHUP_MODE_LOLP="liveCatchupModeLoLP",this.MOVING_AVERAGE_SLIDING_WINDOW="slidingWindow",this.MOVING_AVERAGE_EWMA="ewma",this.BAD_ARGUMENT_ERROR="Invalid Arguments",this.MISSING_CONFIG_ERROR="Missing config parameter(s)",this.TRACK_SWITCH_MODE_ALWAYS_REPLACE="alwaysReplace",this.TRACK_SWITCH_MODE_NEVER_REPLACE="neverReplace",this.TRACK_SELECTION_MODE_FIRST_TRACK="firstTrack",this.TRACK_SELECTION_MODE_HIGHEST_BITRATE="highestBitrate",this.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY="highestEfficiency",this.TRACK_SELECTION_MODE_WIDEST_RANGE="widestRange",this.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY="highestSelectionPriority",this.CMCD_MODE_QUERY="query",this.CMCD_MODE_HEADER="header",this.LOCATION="Location",this.INITIALIZE="initialize",this.TEXT_SHOWING="showing",this.TEXT_HIDDEN="hidden",this.CC1="CC1",this.CC3="CC3",this.UTF8="utf-8",this.SCHEME_ID_URI="schemeIdUri",this.START_TIME="starttime",this.SERVICE_DESCRIPTION_LL_SCHEME="urn:dvb:dash:lowlatency:scope:2019",this.SUPPLEMENTAL_PROPERTY_LL_SCHEME="urn:dvb:dash:lowlatency:critical:2019",this.XML="XML",this.ARRAY_BUFFER="ArrayBuffer",this.DVB_REPORTING_URL="dvb:reportingUrl",this.DVB_PROBABILITY="dvb:probability",this.VIDEO_ELEMENT_READY_STATES={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4}}}]),e}(),s=new o;t.default=s},"./src/streaming/constants/MetricsConstants.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}n.r(t);var o=function(){function e(){r(this,e),this.init()}return i(e,[{key:"init",value:function(){this.TCP_CONNECTION="TcpList",this.HTTP_REQUEST="HttpList",this.TRACK_SWITCH="RepSwitchList",this.BUFFER_LEVEL="BufferLevel",this.BUFFER_LOADED="bufferLoaded",this.ABANDON_LOAD="abandonload",this.ALLOW_LOAD="allowload",this.BUFFER_EMPTY="bufferStalled",this.BUFFER_STATE="BufferState",this.DVR_INFO="DVRInfo",this.DROPPED_FRAMES="DroppedFrames",this.SCHEDULING_INFO="SchedulingInfo",this.REQUESTS_QUEUE="RequestsQueue",this.MANIFEST_UPDATE="ManifestUpdate",this.MANIFEST_UPDATE_STREAM_INFO="ManifestUpdatePeriodInfo",this.MANIFEST_UPDATE_TRACK_INFO="ManifestUpdateRepresentationInfo",this.PLAY_LIST="PlayList",this.DVB_ERRORS="DVBErrors"}}]),e}(),s=new o;t.default=s},"./src/streaming/constants/ProtectionConstants.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}n.r(t);var o=function(){function e(){r(this,e),this.init()}return i(e,[{key:"init",value:function(){this.CLEARKEY_KEYSTEM_STRING="org.w3.clearkey",this.WIDEVINE_KEYSTEM_STRING="com.widevine.alpha",this.PLAYREADY_KEYSTEM_STRING="com.microsoft.playready",this.INITIALIZATION_DATA_TYPE_CENC="cenc",this.INITIALIZATION_DATA_TYPE_KEYIDS="keyids",this.INITIALIZATION_DATA_TYPE_WEBM="webm"}}]),e}(),s=new o;t.default=s},"./src/streaming/controllers/AbrController.js":function(e,t,n){function r(){function e(){re=Ne.getLogger(ne),A()}function t(){ve=Object(p.default)(Ce).create(),Te=Object(m.default)(Ce).create({settings:Ie}),ae=Object(a.default)(Ce).create({dashMetrics:Re,mediaPlayerModel:me,settings:Ie}),ae.initialize(),De.on(v.default.QUALITY_CHANGE_RENDERED,D,ne),De.on(v.default.METRIC_ADDED,w,ne),De.on(c.default.LOADING_PROGRESS,N,ne)}function n(e,t){var n=t.getStreamInfo().id;ue[n]||(ue[n]={}),_e[n]||(_e[n]={}),le[n]||(le[n]={}),_e[n][e]=Object(g.default)(Ce).create(),ue[n][e]=t,le[n][e]={},le[n][e].state=o.default.ALLOW_LOAD,r(e),e===i.default.VIDEO&&ee()}function r(e){var t=Ie.get().streaming.abr.ABRStrategy;t===i.default.ABR_STRATEGY_L2A?(Se[e]=!1,Ae[e]=!1,be[e]=!0):t===i.default.ABR_STRATEGY_LoLP?(Se[e]=!1,Ae[e]=!0,be[e]=!1):t===i.default.ABR_STRATEGY_BOLA?(Se[e]=!0,Ae[e]=!1,be[e]=!1):t===i.default.ABR_STRATEGY_THROUGHPUT?(Se[e]=!1,Ae[e]=!1,be[e]=!1):t===i.default.ABR_STRATEGY_DYNAMIC&&(Se[e]=!(!Se||!Se[e])&&Se[e],Ae[e]=!1,be[e]=!1)}function f(e,t){try{ue[e]&&ue[e][t]&&delete ue[e][t],_e[e]&&_e[e][t]&&delete _e[e][t],le[e]&&le[e][t]&&delete le[e][t]}catch(e){}}function A(){oe={},se={},le={},ue={},_e={},Se={},be={},Ae={},void 0===fe&&(fe=!1),ve&&ve.reset(),Ee=void 0,ve=void 0,Te=void 0,clearTimeout(ce),ce=null}function R(){A(),De.off(c.default.LOADING_PROGRESS,N,ne),De.off(v.default.QUALITY_CHANGE_RENDERED,D,ne),De.off(v.default.METRIC_ADDED,w,ne),ae&&ae.reset()}function I(e){e&&(e.streamController&&(ie=e.streamController),e.domStorage&&(ye=e.domStorage),e.mediaPlayerModel&&(me=e.mediaPlayerModel),e.dashMetrics&&(Re=e.dashMetrics),e.adapter&&(ge=e.adapter),e.videoModel&&(pe=e.videoModel),e.settings&&(Ie=e.settings))}function C(){if(!ye||!ye.hasOwnProperty("getSavedBitrateSettings"))throw new Error(i.default.MISSING_CONFIG_ERROR)}function N(e){var t=e.request.mediaType,n=e.streamId;if(t&&n&&ue[n]&&Ie.get().streaming.abr.autoSwitchBitrate[t]){var r=ue[n][t];if(r){var a=Object(d.default)(Ce).create({abrController:ne,streamProcessor:r,currentRequest:e.request,useBufferOccupancyABR:Se[t],useL2AABR:be[t],useLoLPABR:Ae[t],videoModel:pe}),i=ae.shouldAbandonFragment(a,n);if(i.quality>h.default.NO_CHANGE){var s=r.getFragmentModel(),l=s.getRequests({state:u.default.FRAGMENT_MODEL_LOADING,index:e.request.index})[0];l&&(s.abortRequests(),le[n][t].state=o.default.ABANDON_LOAD,_e[n][t].reset(),_e[n][t].push({oldValue:G(t,n),newValue:i.quality,confidence:1,reason:i.reason}),H(t,ie.getActiveStreamInfo(),i.quality,i.reason),clearTimeout(ce),ce=setTimeout(function(){le[n][t].state=o.default.ALLOW_LOAD,ce=null},Ie.get().streaming.abandonLoadTimeout))}}}}function D(e){e.mediaType===i.default.VIDEO&&(void 0!==Ee&&ve.push(e.streamId,Ee,pe.getPlaybackQuality()),Ee=e.newQuality)}function w(e){e.metric!==o.default.HTTP_REQUEST||!e.value||e.value.type!==E.HTTPRequest.MEDIA_SEGMENT_TYPE||e.mediaType!==i.default.AUDIO&&e.mediaType!==i.default.VIDEO||Te.push(e.mediaType,e.value,Ie.get().streaming.abr.useDeadTimeLatency),e.metric!==o.default.BUFFER_LEVEL||e.mediaType!==i.default.AUDIO&&e.mediaType!==i.default.VIDEO||z(e.mediaType,.001*e.value.level)}function O(e,t){try{var n;return oe[t]=oe[t]||{},oe[t].hasOwnProperty(e)||(oe[t][e]=0),n=F(e,t),n=j(n,e,t),n=x(n,e,t),n}catch(e){return}}function M(e,t){try{return L(e,t)}catch(e){return}}function P(e,t){try{var n=Ie.get().streaming.abr.maxBitrate[e];return n>-1?V(ue[t][e].getMediaInfo(),n,t):void 0}catch(e){return}}function L(e,t){try{var n=Ie.get().streaming.abr.minBitrate[e];if(n>-1){var r=ue[t][e].getMediaInfo(),a=W(r),i=V(r,n,t);return a[i]&&i<a.length-1&&a[i].bitrate<1e3*n&&i++,i}return}catch(e){return}}function F(e,t){var n=oe[t][e],r=n;if(!ue[t]||!ue[t][e])return r;var a=M(e,t);void 0!==a&&(r=Math.max(n,a));var i=P(e,t);return void 0!==i&&(r=Math.min(r,i)),r}function j(e,t,n){var r=oe[n][t],a=Ie.get().streaming.abr.maxRepresentationRatio[t];return isNaN(a)||a>=1||a<0?e:Math.min(e,Math.round(r*a))}function x(e,t,n){if(t!==i.default.VIDEO||!Ie.get().streaming.abr.limitBitrateByPortal||!ue[n]||!ue[n][t])return e;fe||ee();var r=ue[n][t].getStreamInfo(),a=ge.getAdaptationForType(r.index,t,r).Representation,o=e;if(de>0&&he>0){for(;o>0&&a[o]&&de<a[o].width&&de-a[o-1].width<a[o].width-de;)o-=1;for(;o<a.length-1&&a[o].width===a[o+1].width;)o+=1}return o}function k(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t||(t=ie.getActiveStreamInfo().id),e&&ue&&ue[t]&&ue[t][e]){var n=O(e,t),r=W(ue[t][e].getMediaInfo());return r[n]?r[n]:null}return null}function B(e,t){if(C(),e===i.default.TEXT)return NaN;var n=ye.getSavedBitrateSettings(e),r=Ie.get().streaming.abr.initialBitrate[e],a=Ie.get().streaming.abr.initialRepresentationRatio[e];if(-1===r)if(a>-1){var o=ue[t][e].getStreamInfo(),s=ge.getAdaptationForType(o.index,e,o).Representation;if(Array.isArray(s)){var u=Math.max(Math.round(s.length*a)-1,0);r=s[u].bandwidth/1e3}else r=0}else r=isNaN(n)?e===i.default.VIDEO?T:S:n;return r}function U(e,t){try{if(!(e&&ue&&ue[t]&&ue[t][e]))return!1;if(ve){var n=pe.getPlaybackQuality();n&&ve.push(t,Ee,n)}if(!Ie.get().streaming.abr.autoSwitchBitrate[e])return!1;var r=G(e,t),a=Object(d.default)(Ce).create({abrController:ne,switchHistory:_e[t][e],droppedFramesHistory:ve,streamProcessor:ue[t][e],currentValue:r,useBufferOccupancyABR:Se[e],useL2AABR:be[e],useLoLPABR:Ae[e],videoModel:pe}),i=M(e,t),s=O(e,t),u=ae.getMaxQuality(a),l=u.quality;return void 0!==i&&(l>h.default.NO_CHANGE?l:r)<i&&(l=i),l>s&&(l=s),_e[t][e].push({oldValue:r,newValue:l}),l>h.default.NO_CHANGE&&l!==r&&(le[t][e].state===o.default.ALLOW_LOAD||l>r)&&(Y(e,r,l,s,u.reason,t),!0)}catch(e){return!1}}function G(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{var n;if(t||(t=ie.getActiveStreamInfo().id),e&&ue[t]&&ue[t][e])if(t)return se[t]=se[t]||{},se[t].hasOwnProperty(e)||(se[t][e]=b),n=se[t][e],n;return b}catch(e){return b}}function H(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(t&&t.id&&e){var a=t.id,i=G(e,a);Object(_.checkInteger)(n);var o=O(e,a);n!==i&&n>=0&&n<=o&&Y(e,i,n,o,r,a)}}function q(e,t){return le[e]&&le[e][t]?le[e][t].state:null}function Y(e,t,n,r,a,i){if(e&&ue[i]&&ue[i][e]){var o=ue[i][e].getStreamInfo(),s=o&&o.manifestInfo&&o.manifestInfo.isDynamic,u=Re.getCurrentBufferLevel(e);re.info("Stream ID: "+i+" ["+e+"] switch from "+t+" to "+n+"/"+r+" (buffer: "+u+") "+(a?JSON.stringify(a):".")),se[i]=se[i]||{},se[i][e]=n;var l=K(i,e,n);De.trigger(c.default.QUALITY_CHANGE_REQUESTED,{oldQuality:t,newQuality:n,reason:a,streamInfo:o,bitrateInfo:l,maxIdx:r,mediaType:e},{streamId:o.id,mediaType:e});var f=Te.getAverageThroughput(e,s);isNaN(f)||ye.setSavedBitrateSettings(e,f)}}function K(e,t,n){if(t&&ue&&ue[e]&&ue[e][t]){var r=W(ue[e][t].getMediaInfo());return r[n]?r[n]:null}return null}function V(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=e&&e.type?ue[n][e.type].getRepresentationInfo():null;if(Ie.get().streaming.abr.useDeadTimeLatency&&r&&a&&a.fragmentDuration){r/=1e3;var i=a.fragmentDuration;if(r>i)return 0;var o=r/i;t*=1-o}for(var s=W(e),u=s.length-1;u>=0;u--){var l=s[u];if(1e3*t>=l.bitrate)return u}return b}function W(e){var t=[];if(!e||!e.bitrateList)return t;for(var n,r=e.bitrateList,a=e.type,i=0,o=r.length;i<o;i++)n=new s.default,n.mediaType=a,n.qualityIndex=i,n.bitrate=r[i].bandwidth,n.width=r[i].width,n.height=r[i].height,n.scanType=r[i].scanType,t.push(n);return t}function z(e,t){var n=Ie.get().streaming.abr.ABRStrategy;n===i.default.ABR_STRATEGY_DYNAMIC&&X(e,t)}function X(e,t){var n=me.getStableBufferTime(),r=n,a=.5*n,i=Se[e],o=t>(i?a:r);Se[e]=o,o!==i&&(o?re.info("["+e+"] switching from throughput to buffer occupancy ABR rule (buffer: "+t.toFixed(3)+")."):re.info("["+e+"] switching from buffer occupancy to throughput ABR rule (buffer: "+t.toFixed(3)+")."))}function Q(){return Te}function J(e){var t=e.type,n=e.streamInfo.id,r=e.representationCount-1;return oe[n]=oe[n]||{},oe[n][t]=r,r}function $(e){var t=e?e.id:null,n=G(i.default.AUDIO,t),r=G(i.default.VIDEO,t),a=n===O(i.default.AUDIO,t)&&r===O(i.default.VIDEO,t);return a}function Z(e){fe=e}function ee(){if(pe){var e=Ie.get().streaming.abr.usePixelRatioInLimitBitrateByPortal&&window.hasOwnProperty("devicePixelRatio"),t=e?window.devicePixelRatio:1;de=pe.getClientWidth()*t,he=pe.getClientHeight()*t}}function te(e){ve&&ve.clearForStream(e),ue[e]&&delete ue[e],_e[e]&&delete _e[e],le[e]&&delete le[e]}var ne,re,ae,ie,oe,se,ue,le,ce,fe,de,he,ge,pe,me,ye,Ee,_e,ve,Te,Se,be,Ae,Re,Ie,Ce=this.context,Ne=Object(y.default)(Ce).getInstance(),De=Object(l.default)(Ce).getInstance();return ne={initialize:t,isPlayingAtTopQuality:$,updateTopQualityIndex:J,clearDataForStream:te,getThroughputHistory:Q,getBitrateList:W,getQualityForBitrate:V,getTopBitrateInfoFor:k,getMinAllowedIndexFor:M,getMaxAllowedIndexFor:O,getInitialBitrateFor:B,getQualityFor:G,getAbandonmentStateFor:q,setPlaybackQuality:H,checkPlaybackQuality:U,setElementSize:ee,setWindowResizeEventCalled:Z,registerStreamType:n,unRegisterStreamType:f,setConfig:I,reset:R},e(),ne}n.r(t);var a=n("./src/streaming/rules/abr/ABRRulesCollection.js"),i=n("./src/streaming/constants/Constants.js"),o=n("./src/streaming/constants/MetricsConstants.js"),s=n("./src/streaming/vo/BitrateInfo.js"),u=n("./src/streaming/models/FragmentModel.js"),l=n("./src/core/EventBus.js"),c=n("./src/core/events/Events.js"),f=n("./src/core/FactoryMaker.js"),d=n("./src/streaming/rules/RulesContext.js"),h=n("./src/streaming/rules/SwitchRequest.js"),g=n("./src/streaming/rules/SwitchRequestHistory.js"),p=n("./src/streaming/rules/DroppedFramesHistory.js"),m=n("./src/streaming/rules/ThroughputHistory.js"),y=n("./src/core/Debug.js"),E=n("./src/streaming/vo/metrics/HTTPRequest.js"),_=n("./src/streaming/utils/SupervisorTools.js"),v=n("./src/streaming/MediaPlayerEvents.js"),T=1e3,S=100,b=0;r.__dashjs_factory_name="AbrController";var A=f.default.getSingletonFactory(r);A.QUALITY_DEFAULT=b,f.default.updateSingletonFactory(r.__dashjs_factory_name,A),t.default=A},"./src/streaming/controllers/BaseURLController.js":function(e,t,n){function r(){function e(e){p.invalidateSelectedIndexes(e.entry)}function t(){p=Object(a.default)(y).create(),m=Object(i.default)(y).create(),E.on(c.default.SERVICE_LOCATION_BLACKLIST_CHANGED,e,h)}function n(e){e.baseURLTreeModel&&(p=e.baseURLTreeModel),e.baseURLSelector&&(m=e.baseURLSelector),e.adapter&&(g=e.adapter)}function r(e){p.update(e),m.chooseSelector(g.getIsDVB(e))}function u(e){var t=p.getForPath(e),n=t.reduce(function(e,t){var n=m.select(t);return n?(_.isRelative(n.url)?e.url=_.resolve(n.url,e.url):(e.url=n.url,e.serviceLocation=n.serviceLocation),e.availabilityTimeOffset=n.availabilityTimeOffset,e.availabilityTimeComplete=n.availabilityTimeComplete,e):new s.default},new s.default);if(!_.isRelative(n.url))return n}function f(){p.reset(),m.reset()}function d(e){p.setConfig({adapter:g}),r(e)}var h,g,p,m,y=this.context,E=Object(l.default)(y).getInstance(),_=Object(o.default)(y).getInstance();return h={reset:f,initialize:d,resolve:u,setConfig:n},t(),h}n.r(t);var a=n("./src/streaming/models/BaseURLTreeModel.js"),i=n("./src/streaming/utils/BaseURLSelector.js"),o=n("./src/streaming/utils/URLUtils.js"),s=n("./src/dash/vo/BaseURL.js"),u=n("./src/core/FactoryMaker.js"),l=n("./src/core/EventBus.js"),c=n("./src/core/events/Events.js");r.__dashjs_factory_name="BaseURLController",t.default=u.default.getClassFactory(r)},"./src/streaming/controllers/BlacklistController.js":function(e,t,n){function r(e){function t(e){return!!(u.length&&e&&e.length)&&-1!==u.indexOf(e)}function n(e){-1===u.indexOf(e)&&(u.push(e),l.trigger(c,{entry:e}))}function r(e){n(e.entry)}function a(){f&&l.on(f,r,s)}function o(){u=[]}var s;e=e||{};var u=[],l=Object(i.default)(this.context).getInstance(),c=e.updateEventName,f=e.addBlacklistEventName;return s={add:n,contains:t,reset:o},a(),s}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/core/EventBus.js");r.__dashjs_factory_name="BlackListController",t.default=a.default.getClassFactory(r)},"./src/streaming/controllers/BufferController.js":function(e,t,n){function r(e){function t(){Se=Object(f.default)(Be).getInstance().getLogger(Te),Fe=Object(d.default)(Be).getInstance(),_e()}function n(e){S(e),Ue.on(l.default.INIT_FRAGMENT_LOADED,I,Te),Ue.on(l.default.MEDIA_FRAGMENT_LOADED,N,Te),Ue.on(l.default.WALLCLOCK_TIME_UPDATED,oe,Te),Ue.on(m.default.PLAYBACK_PLAYING,Y,Te),Ue.on(m.default.PLAYBACK_PROGRESS,H,Te),Ue.on(m.default.PLAYBACK_TIME_UPDATED,H,Te),Ue.on(m.default.PLAYBACK_RATE_CHANGED,se,Te),Ue.on(m.default.PLAYBACK_STALLED,q,Te)}function r(){return ze.id}function c(){return Xe}function T(){return v}function S(e){Ie=e}function b(e){return Ye.convertRepresentationToRepresentationInfo(qe.getRepresentationForQuality(e))}function A(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return new Promise(function(n,r){if(Fe&&e&&Ie){var a=Ve.getQualityFor(Xe,ze.id);De=Object(s.default)(Be).create({mediaSource:Ie,textController:Ke,eventBus:Ue}),R(e,t,a).then(function(){return re(b(a))}).then(function(){n(De)}).catch(function(e){Se.fatal("Caught error on create SourceBuffer: "+e),Ge.error(new h.default(g.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,g.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+Xe)),r(e)})}else n(null)})}function R(e,t,n){var r=b(n);return t&&t[Xe]&&(Xe===a.default.VIDEO||Xe===a.default.AUDIO)?De.initializeForStreamSwitch(e,r,t[Xe]):De.initializeForFirstUse(ze,e,r)}function I(e){Qe.get().streaming.cacheInitSegments&&(Se.info("Init fragment finished loading saving to",Xe+"'s init cache"),Fe.save(e.chunk)),Se.debug("Append Init fragment",Xe," with representationId:",e.chunk.representationId," and quality:",e.chunk.quality,", data size:",e.chunk.bytes.byteLength),D(e.chunk)}function C(e){var t=Fe.extract(ze.id,e);return!!t&&(Se.info("Append Init fragment",Xe," with representationId:",t.representationId," and quality:",t.quality,", data size:",t.bytes.byteLength),D(t),!0)}function N(e){D(e.chunk,e.request)}function D(e,t){t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var n=t?t.mediaStartTime-t.startTime:0;De.append(e,t).then(function(e){O(e)}).catch(function(e){O(e)}),e.mediaInfo.type===a.default.VIDEO&&Ee(l.default.VIDEO_CHUNK_RECEIVED,{chunk:e,timeOffset:n})}function w(e){if(e&&e.length>0)for(var t=0,n=e.length;t<n;t++)Se.debug("Buffered range: "+e.start(t)+" - "+e.end(t)+", currentTime = ",We.getTime())}function O(e){if(e.error)return e.error.code===_&&P(),void(e.error.code!==_&&me()||(Se.warn("Clearing playback buffer to overcome quota exceed situation"),Ee(l.default.QUOTA_EXCEEDED,{criticalBufferLevel:Re,quotaExceededTime:e.chunk.start}),Z($())));if(De&&(W(),Le=!1,Oe=e.chunk,Oe&&Oe.endFragment)){Oe&&!isNaN(Oe.index)&&(Ce=Math.max(Oe.index,Ce),z());var t=De.getAllBufferRanges();Oe.segmentType===p.HTTPRequest.MEDIA_SEGMENT_TYPE&&(w(t),H(),M()),Oe&&Ee(l.default.BYTES_APPENDED_END_FRAGMENT,{quality:Oe.quality,startTime:Oe.start,index:Oe.index,bufferedRanges:t,segmentType:Oe.segmentType,mediaType:Xe})}}function M(){if(!isNaN(ke))if(Xe===a.default.AUDIO||Xe===a.default.VIDEO){var e=We.getTime(),t=K(ke,0);if(e===ke&&t)ke=NaN;else{var n=qe.getCurrentRepresentation().segmentDuration;t=K(ke,n),t&&(Qe.get().streaming.buffer.enableSeekDecorrelationFix&&Math.abs(e-ke)>n?ke<=t.end&&(We.seek(Math.max(ke,t.start),!1,!0),ke=NaN):e<t.start&&(We.seek(t.start,!1,!0),ke=NaN))}}else ke=NaN}function P(){if(Le=!0,Re=.8*ge(),Se.warn("Quota exceeded, Critical Buffer: "+Re),Re>0){var e=Math.max(.2*Re,1),t=Re-e,n=Math.min(Qe.get().streaming.buffer.bufferTimeAtTopQuality,.9*t),r=Math.min(Qe.get().streaming.buffer.bufferTimeAtTopQualityLongForm,.9*t),a={streaming:{buffer:{bufferToKeep:parseFloat(e.toFixed(5)),bufferTimeAtTopQuality:parseFloat(n.toFixed(5)),bufferTimeAtTopQualityLongForm:parseFloat(r.toFixed(5))}}};Qe.update(a)}}function L(){return be&&de(!1),De.abort()}function F(e){return new Promise(function(t,n){De.abort().then(function(){return ae()}).then(function(){return De.changeType(e)}).then(function(){return k()}).then(function(){de(!1),t()}).catch(function(e){n(e)})})}function j(){return new Promise(function(e,t){De.abort().then(function(){return ae()}).then(function(){return k()}).then(function(){de(!1),e()}).catch(function(e){t(e)})})}function x(e){return new Promise(function(t,n){ae().then(function(){return De.changeType(e)}).then(function(){t()}).catch(function(e){n(e)})})}function k(){return new Promise(function(e,t){var n=B();if(!n||0===n.length)return H(),void e();Z(n).then(function(){e()}).catch(function(e){t(e)})})}function B(e){var t=[],n=De.getAllBufferRanges();if(!n||0===n.length)return t;if(!e&&0!==e||isNaN(e))t.push({start:n.start(0),end:n.end(n.length-1)+y});else{var r=U(e,n),a=G(e,n);r&&t.push(r),a&&t.push(a)}return t}function U(e,t){var n=Qe.get().streaming.buffer.bufferToKeep,r=t.start(0),a=e-r;if(a>n){var i=Math.max(0,e-n),s=He.getRequests({state:o.default.FRAGMENT_MODEL_EXECUTED,time:e,threshold:E})[0];if(s&&(i=Math.min(s.startTime,i)),i>0)return{start:r,end:i}}return null}function G(e,t){var n=t.end(t.length-1)+y,r=ze.manifestInfo.duration>=Qe.get().streaming.buffer.longFormContentDurationThreshold,a=r?Qe.get().streaming.buffer.bufferTimeAtTopQualityLongForm:Qe.get().streaming.buffer.bufferTimeAtTopQuality,i=n-e;if(i>a){var s=e+a,u=He.getRequests({state:o.default.FRAGMENT_MODEL_EXECUTED,time:e,threshold:E})[0];if(u&&(s=Math.max(u.startTime+u.duration,s)),s<n)return{start:s,end:n}}return null}function H(){(!xe||Xe===a.default.TEXT&&Ke.isTextEnabled())&&W()}function q(){X()}function Y(){X(),ke=NaN}function K(e,t){var n,r,a=De.getAllBufferRanges(),i=0,o=0,s=null,u=null,l=0,c=isNaN(t)?.15:t;if(null!=a){for(r=0,n=a.length;r<n;r++)if(i=a.start(r),o=a.end(r),null===s)l=Math.abs(i-e),e>=i&&e<o?(s=i,u=o):l<=c&&(s=i,u=o);else{if(l=i-u,!(l<=c))break;u=o}if(null!==s)return{start:s,end:u}}return null}function V(e,t){var n,r;return Qe.get().streaming.gaps.jumpGaps&&(t=Qe.get().streaming.gaps.smallGapLimit),n=K(e,t),r=null===n?0:n.end-e,r}function W(){if(We){var e=Qe.get().streaming.gaps.jumpGaps&&!isNaN(Qe.get().streaming.gaps.smallGapLimit)?Qe.get().streaming.gaps.smallGapLimit:NaN;Ae=Math.max(V(We.getTime()||0,e),0),Ee(l.default.BUFFER_LEVEL_UPDATED,{mediaType:Xe,bufferLevel:Ae}),X()}}function z(){var e=Ce>=Ne-1,t=We.getTimeToStreamEnd(ze)-Ae<=0;!e&&!t||be||(de(!0),Se.debug("checkIfBufferingCompleted trigger BUFFERING_COMPLETED for stream id ".concat(ze.id," and type ").concat(Xe)))}function X(){Xe!==a.default.AUDIO&&Xe!==a.default.VIDEO||((!Qe.get().streaming.lowLatencyEnabled&&Ae<Qe.get().streaming.buffer.stallThreshold||0===Ae)&&!be?Q(i.default.BUFFER_EMPTY):(be||Ae>=Qe.get().streaming.buffer.stallThreshold||Qe.get().streaming.lowLatencyEnabled&&Ae>0)&&Q(i.default.BUFFER_LOADED))}function Q(e){we===e||e===i.default.BUFFER_EMPTY&&0===We.getTime()||Xe===a.default.TEXT&&!Ke.isTextEnabled()||(we=e,Ee(l.default.BUFFER_LEVEL_STATE_CHANGED,{state:e}),Ee(e===i.default.BUFFER_LOADED?l.default.BUFFER_LOADED:l.default.BUFFER_EMPTY),Se.debug(e===i.default.BUFFER_LOADED?"Got enough buffer to start":"Waiting for more buffer before starting playback"))}function J(){De&&Xe!==a.default.TEXT&&(be||Z($()))}function $(){var e=[],t=De.getAllBufferRanges();if(!t||0===t.length)return e;var n=We.getTime(),r=Math.max(0,n-Qe.get().streaming.buffer.bufferToKeep),a=He.getRequests({state:o.default.FRAGMENT_MODEL_EXECUTED,time:n,threshold:E})[0];if(a)r=Math.min(a.startTime,r);else if(0===n&&We.getIsDynamic())return[];if(t.start(0)<=r){for(var i={start:0,end:r},s=0;s<t.length&&t.end(s)<=r;s++)i.end=t.end(s);i.start<i.end&&e.push(i)}return e}function Z(e){return new Promise(function(t,n){if(e&&De&&0!==e.length){var r=[];e.forEach(function(e){r.push(ee(e))}),Pe||te(),Promise.all(r).then(function(){t()}).catch(function(e){n(e)})}else t()})}function ee(e){return new Promise(function(t,n){e.resolve=t,e.reject=n,je.push(e)})}function te(){try{if(0===je.length||!De)return Se.debug("Nothing to prune, halt pruning"),je=[],void(Pe=!1);var e=De.getBuffer();if(!e||!e.buffered||0===e.buffered.length)return Se.debug("SourceBuffer is empty (or does not exist), halt pruning"),je=[],void(Pe=!1);var t=je.shift();Se.debug("".concat(Xe,": Removing buffer from: ").concat(t.start," to ").concat(t.end)),Pe=!0;var n=We.getTime();n<t.end&&de(!1),De.remove(t).then(function(e){ne(e)}).catch(function(e){ne(e)})}catch(e){Pe=!1}}function ne(e){Se.debug("onRemoved buffer from:",e.from,"to",e.to);var t=De.getAllBufferRanges();w(t),0===je.length&&(Pe=!1,W()),e.unintended&&(Se.warn("Detected unintended removal from:",e.from,"to",e.to,"setting streamprocessor time to",e.from),Ee(l.default.SEEK_TARGET,{time:e.from})),Pe?te():(xe?xe=!1:W(),Ee(l.default.BUFFER_CLEARED,{from:e.from,to:e.to,unintended:e.unintended,hasEnoughSpaceToAppend:me(),quotaExceeded:Le}))}function re(e){return new Promise(function(t){e&&void 0!==e.MSETimeOffset&&De&&De.updateTimestampOffset?De.updateTimestampOffset(e.MSETimeOffset).then(function(){t()}).catch(function(){t()}):t()})}function ae(){return De&&!be?De.updateAppendWindow(ze):Promise.resolve()}function ie(e){isNaN(e)||(Ne=e,z())}function oe(){Me++;var e=Me*(Qe.get().streaming.wallclockTimeUpdateInterval/1e3);e>=Qe.get().streaming.buffer.bufferPruningInterval&&(Me=0,J())}function se(){X()}function ue(){return De}function le(){return Ae}function ce(){return Ie}function fe(){return be}function de(e){be!==e&&(be=e,be?Ee(l.default.BUFFERING_COMPLETED):Ne=Number.POSITIVE_INFINITY)}function he(){return Pe}function ge(){try{var e,t,n=De.getAllBufferRanges(),r=0;if(!n)return r;for(t=0,e=n.length;t<e;t++)r+=n.end(t)-n.start(t);return r}catch(e){return 0}}function pe(e){try{var t=e,n=De.getAllBufferRanges();if(!n||0===n.length)return e;for(var r=0;t===e&&r<n.length;){var a=n.start(r),i=n.end(r);t>=a&&t<=i&&(t=i),r+=1}return t}catch(e){}}function me(){var e=ge();return isNaN(e)||e<Re}function ye(e){ke=e}function Ee(e,t){var n=t||{};Ue.trigger(e,n,{streamId:ze.id,mediaType:Xe})}function _e(e,t){Re=Number.POSITIVE_INFINITY,we=void 0,Ne=Number.POSITIVE_INFINITY,Ce=0,Oe=null,be=!1,Pe=!1,Le=!1,Ae=0,Me=0,je=[],ke=NaN,De&&(e||t?De=null:De.abort().then(function(){De.reset(t),De=null})),xe=!1}function ve(e,t){Ue.off(l.default.INIT_FRAGMENT_LOADED,I,this),Ue.off(l.default.MEDIA_FRAGMENT_LOADED,N,this),Ue.off(l.default.WALLCLOCK_TIME_UPDATED,oe,this),Ue.off(m.default.PLAYBACK_PLAYING,Y,this),Ue.off(m.default.PLAYBACK_PROGRESS,H,this),Ue.off(m.default.PLAYBACK_TIME_UPDATED,H,this),Ue.off(m.default.PLAYBACK_RATE_CHANGED,se,this),Ue.off(m.default.PLAYBACK_STALLED,q,this),_e(e,t)}e=e||{};var Te,Se,be,Ae,Re,Ie,Ce,Ne,De,we,Oe,Me,Pe,Le,Fe,je,xe,ke,Be=this.context,Ue=Object(u.default)(Be).getInstance(),Ge=e.errHandler,He=e.fragmentModel,qe=e.representationController,Ye=e.adapter,Ke=e.textController,Ve=e.abrController,We=e.playbackController,ze=e.streamInfo,Xe=e.type,Qe=e.settings;return Te={initialize:n,getStreamId:r,getType:c,getBufferControllerType:T,createBufferSink:A,getBuffer:ue,getBufferLevel:le,getRangeAt:K,setMediaSource:S,getMediaSource:ce,appendInitSegmentFromCache:C,getIsBufferingCompleted:fe,setIsBufferingCompleted:de,getIsPruningInProgress:he,reset:ve,prepareForPlaybackSeek:L,prepareForReplacementTrackSwitch:F,prepareForNonReplacementTrackSwitch:x,prepareForReplacementQualitySwitch:j,updateAppendWindow:ae,getAllRangesWithSafetyFactor:B,getContinuousBufferTimeForTargetTime:pe,clearBuffers:Z,pruneAllSafely:k,updateBufferTimestampOffset:re,setSeekTarget:ye,segmentRequestingCompleted:ie},t(),Te}n.r(t);var a=n("./src/streaming/constants/Constants.js"),i=n("./src/streaming/constants/MetricsConstants.js"),o=n("./src/streaming/models/FragmentModel.js"),s=n("./src/streaming/SourceBufferSink.js"),u=n("./src/core/EventBus.js"),l=n("./src/core/events/Events.js"),c=n("./src/core/FactoryMaker.js"),f=n("./src/core/Debug.js"),d=n("./src/streaming/utils/InitCache.js"),h=n("./src/streaming/vo/DashJSError.js"),g=n("./src/core/errors/Errors.js"),p=n("./src/streaming/vo/metrics/HTTPRequest.js"),m=n("./src/streaming/MediaPlayerEvents.js"),y=.5,E=.01,_=22,v="BufferController";r.__dashjs_factory_name=v,t.default=c.default.getClassFactory(r)},"./src/streaming/controllers/EventController.js":function(e,t,n){function r(){function e(){D=Object(i.default)(K).getInstance().getLogger(N),n()}function t(){if(!L||!F)throw new Error("setConfig function has to be called previously")}function n(){k=!1,w={},O={},M=null,x=!1,P=Date.now()/1e3}function r(){try{null!==M&&k&&(clearInterval(M),M=null,k=!1,g())}catch(e){throw e}}function a(){try{t(),D.debug("Start Event Controller");var e=j.get().streaming.eventControllerRefreshDelay;k||isNaN(e)||(k=!0,M=setInterval(h,e))}catch(e){throw e}}function l(e){try{if(t(),e)for(var n=0;n<e.length;n++){var r=e[n],a=f(r,w,!0);a===Y.ADDED?(D.debug("Added inline event with id ".concat(r.id)),v(r,e,s.default.EVENT_MODE_ON_RECEIVE)):a===Y.UPDATED&&D.debug("Updated inline event with id ".concat(r.id))}}catch(e){throw e}}function c(e){try{t();for(var n=0;n<e.length;n++){var r=e[n],a=f(r,O,!1);a===Y.ADDED?(r.eventStream.schemeIdUri===B&&void 0===O[r.id]&&d(r),D.debug("Added inband event with id "+r.id),v(r,e,s.default.EVENT_MODE_ON_RECEIVE)):D.debug("Inband event with scheme_id_uri ".concat(r.eventStream.schemeIdUri,", value ").concat(r.eventStream.value," and id ").concat(r.id," was ignored because it has been added before."))}h()}catch(e){throw e}}function f(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.eventStream.schemeIdUri,a=e.eventStream.value,i=e.id,o=Y.DISCARDED;t[r]||(t[r]=[]);var s=t[r].findIndex(function(e){return(!a||e.eventStream.value&&e.eventStream.value===a)&&e.id===i});return-1===s?(t[r].push(e),o=Y.ADDED):n&&(t[r][s]=e,o=Y.UPDATED),o}function d(e){try{if(e.eventStream.value==U){var t,n=e.calculatedPresentationTime;t=4294967295==e.calculatedPresentationTime?NaN:e.calculatedPresentationTime+e.duration,V.trigger(s.default.MANIFEST_VALIDITY_CHANGED,{id:e.id,validUntil:n,newDuration:t,newManifestValidAfter:NaN},{mode:s.default.EVENT_MODE_ON_START})}}catch(e){}}function h(){try{if(!x){x=!0;var e=F.getTime(),t=e-P;t=P>0?Math.max(0,t):0,p(O,t,e),p(w,t,e),P=e,x=!1}}catch(e){x=!1}}function g(){try{m(O),m(w)}catch(e){}}function p(e,t,n){try{var r=function(r){if(void 0!==r){var a=isNaN(r.duration)?0:r.duration;r.calculatedPresentationTime<=n&&r.calculatedPresentationTime+t+a>=n?v(r,e,s.default.EVENT_MODE_ON_START):(E(n,a+t,r.calculatedPresentationTime)||_(r))&&(D.debug("Deleting event ".concat(r.id," as it is expired or invalid")),T(e,r))}};y(e,r)}catch(e){}}function m(e){try{var t=F.getTime(),n=function(n){var r=n.eventStream&&n.eventStream.period&&!isNaN(n.eventStream.period.duration)?n.eventStream.period.duration:NaN,a=n.eventStream&&n.eventStream.period&&!isNaN(n.eventStream.period.start)?n.eventStream.period.start:NaN;if(!isNaN(r)&&!isNaN(a)){var i=n.calculatedPresentationTime;Math.abs(i-t)<q&&v(n,e,s.default.EVENT_MODE_ON_START)}};y(e,n)}catch(e){}}function y(e,t){try{if(e)for(var n=Object.keys(e),r=0;r<n.length;r++){var a=e[n[r]];a.forEach(function(e){void 0!==e&&t(e)})}}catch(e){}}function E(e,t,n){try{return e-t>n}catch(e){return!1}}function _(e){try{var t=e.eventStream.period.start+e.eventStream.period.duration;return e.calculatedPresentationTime>t}catch(e){return!1}}function v(e,t,n){try{var r=F.getTime(),a=e.id;if(n===s.default.EVENT_MODE_ON_RECEIVE)return D.debug("Received event ".concat(a)),void V.trigger(e.eventStream.schemeIdUri,{event:e},{mode:n})
;e.eventStream.schemeIdUri===B&&e.eventStream.value==U?0===e.duration&&0===e.presentationTimeDelta||(D.debug("Starting manifest refresh event ".concat(a," at ").concat(r)),T(t,e),S()):e.eventStream.schemeIdUri===G&&e.eventStream.value==H?(D.debug("Starting callback event ".concat(a," at ").concat(r)),T(t,e),b(e.messageData)):(D.debug("Starting event ".concat(a," at ").concat(r)),T(t,e),V.trigger(e.eventStream.schemeIdUri,{event:e},{mode:n}))}catch(e){}}function T(e,t){var n=t.eventStream.schemeIdUri,r=t.eventStream.value,a=t.id;e[n]=e[n].filter(function(e){return r&&e.eventStream.value&&e.eventStream.value!==r||e.id!==a}),0===e[n].length&&delete e[n]}function S(){try{t(),L.refreshManifest()}catch(e){}}function b(e){try{var t=Object(u.default)(K).create({});t.load({method:"get",url:e,request:{responseType:"arraybuffer"}})}catch(e){throw e}}function A(e){try{if(!e)return;e.manifestUpdater&&(L=e.manifestUpdater),e.playbackController&&(F=e.playbackController),e.settings&&(j=e.settings)}catch(e){throw e}}function R(){return w}function I(){return O}function C(){r(),n()}var N,D,w,O,M,P,L,F,j,x,k,B="urn:mpeg:dash:event:2012",U=1,G="urn:mpeg:dash:event:callback:2015",H=1,q=300,Y={DISCARDED:"discarded",UPDATED:"updated",ADDED:"added"},K=this.context,V=Object(o.default)(K).getInstance();return N={addInlineEvents:l,addInbandEvents:c,getInbandEvents:I,getInlineEvents:R,start:a,setConfig:A,reset:C},e(),N}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js"),o=n("./src/core/EventBus.js"),s=n("./src/streaming/MediaPlayerEvents.js"),u=n("./src/streaming/net/XHRLoader.js");r.__dashjs_factory_name="EventController",t.default=a.default.getSingletonFactory(r)},"./src/streaming/controllers/FragmentController.js":function(e,t,n){function r(e){function t(){_=I.getLogger(E),h(),S.on(f.default.FRAGMENT_LOADING_COMPLETED,y,E),S.on(f.default.FRAGMENT_LOADING_PROGRESS,y,E)}function n(){return C.id}function r(t){var r=v[t];return r||(r=Object(o.default)(T).create({streamInfo:C,type:t,dashMetrics:R,fragmentLoader:Object(s.default)(T).create({dashMetrics:R,mediaPlayerModel:A,errHandler:b,requestModifier:Object(u.default)(T).getInstance(),settings:e.settings,boxParser:e.boxParser,eventBus:S,events:c.default,errors:d.default,dashConstants:e.dashConstants,urlUtils:e.urlUtils,streamId:n()}),debug:I,eventBus:S,events:c.default}),v[t]=r),r}function h(){for(var e in v)v[e].reset();v={}}function p(){S.off(f.default.FRAGMENT_LOADING_COMPLETED,y,this),S.off(f.default.FRAGMENT_LOADING_PROGRESS,y,this),h()}function m(e,t,n,r){var a=new i.default;return a.streamId=n,a.mediaInfo=t.mediaInfo,a.segmentType=t.type,a.start=t.startTime,a.duration=t.duration,a.end=a.start+a.duration,a.bytes=e,a.index=t.index,a.quality=t.quality,a.representationId=t.representationId,a.endFragment=r,a}function y(e){if(e.sender){var t=e.request,n=e.response,r=t.isInitializationRequest(),i=t.mediaInfo.streamInfo;if(e.error&&(t.mediaType===a.default.AUDIO||t.mediaType===a.default.VIDEO||t.mediaType===a.default.TEXT&&t.mediaInfo.isFragmented)&&S.trigger(c.default.SERVICE_LOCATION_BLACKLIST_ADD,{entry:e.request.serviceLocation}),n&&i){var o=m(n,t,C.id,e.type!==c.default.FRAGMENT_LOADING_PROGRESS);S.trigger(r?c.default.INIT_FRAGMENT_LOADED:c.default.MEDIA_FRAGMENT_LOADED,{chunk:o,request:t},{streamId:i.id,mediaType:t.mediaType})}else _.warn("No "+t.mediaType+" bytes to push or stream is inactive.")}}e=e||{};var E,_,v,T=this.context,S=Object(l.default)(T).getInstance(),b=e.errHandler,A=e.mediaPlayerModel,R=e.dashMetrics,I=Object(g.default)(T).getInstance(),C=e.streamInfo;return E={getStreamId:n,getModel:r,reset:p},t(),E}n.r(t);var a=n("./src/streaming/constants/Constants.js"),i=n("./src/streaming/vo/DataChunk.js"),o=n("./src/streaming/models/FragmentModel.js"),s=n("./src/streaming/FragmentLoader.js"),u=n("./src/streaming/utils/RequestModifier.js"),l=n("./src/core/EventBus.js"),c=n("./src/core/events/Events.js"),f=n("./src/streaming/MediaPlayerEvents.js"),d=n("./src/core/errors/Errors.js"),h=n("./src/core/FactoryMaker.js"),g=n("./src/core/Debug.js");r.__dashjs_factory_name="FragmentController",t.default=h.default.getClassFactory(r)},"./src/streaming/controllers/GapController.js":function(e,t,n){function r(){function e(){f()}function t(){F=Object(i.default)(j).getInstance().getLogger(A),n()}function n(){S(),d(),r()}function r(){N=null,D=NaN,C=0,P=null,L={}}function a(e){e&&(e.settings&&(I=e.settings),e.playbackController&&(w=e.playbackController),e.streamController&&(O=e.streamController),e.videoModel&&(M=e.videoModel))}function f(){x.on(o.default.WALLCLOCK_TIME_UPDATED,y,this),x.on(o.default.INITIAL_STREAM_SWITCH,m,this),x.on(o.default.PLAYBACK_SEEKING,h,this),x.on(o.default.BUFFER_REPLACEMENT_STARTED,g,A),x.on(o.default.TRACK_CHANGE_RENDERED,p,A)}function d(){x.off(o.default.WALLCLOCK_TIME_UPDATED,y,this),x.off(o.default.INITIAL_STREAM_SWITCH,m,this),x.off(o.default.PLAYBACK_SEEKING,h,this),x.off(o.default.BUFFER_REPLACEMENT_STARTED,g,A),x.off(o.default.TRACK_CHANGE_RENDERED,p,A)}function h(){P&&(clearTimeout(P),P=null)}function g(e){try{if(e.streamId!==O.getActiveStreamInfo().id||!e.mediaType)return;e.streamId===O.getActiveStreamInfo().id&&(L[e.mediaType]=!0)}catch(e){F.error(e)}}function p(e){e&&e.mediaType&&(L[e.mediaType]=!1)}function m(){N||T()}function y(){if(E(I.get().streaming.gaps.enableSeekFix)&&(C++,C>=l)){var e=w.getTime();R===e?b(e,!0):(R=e,D=NaN),C=0}}function E(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Object.keys(L).some(function(e){return L[e]}),n=!!e&&_();return!t&&I.get().streaming.gaps.jumpGaps&&O.getActiveStreamProcessors().length>0&&(!w.isSeeking()||n)&&!w.isPaused()&&!O.getIsStreamSwitchInProgress()&&!O.getHasMediaOrInitialisationError()}function _(){var e=O.getActiveStream(),t=parseFloat((e.getStartTime()+e.getDuration()).toFixed(5));return w.getTime()+I.get().streaming.gaps.threshold>=t}function v(e,t){try{if(!e||e.length<=1&&t>0)return NaN;for(var n=NaN,r=0;isNaN(n)&&r<e.length;){var a=r>0?e.end(r-1):0;t<e.start(r)&&a-t<I.get().streaming.gaps.threshold&&(n=r),r+=1}return n}catch(e){return null}}function T(){try{N||(F.debug("Starting the gap controller"),N=setInterval(function(){if(E()){var e=w.getTime();b(e)}},u))}catch(e){}}function S(){F.debug("Stopping the gap controller"),N&&(clearInterval(N),N=null)}function b(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=I.get().streaming.gaps.smallGapLimit,a=I.get().streaming.gaps.jumpLargeGaps,i=M.getBufferRange(),o=NaN,s=!1;if(t=v(i,e),!isNaN(t)){var u=i.start(t),l=u-e;l>0&&(l<=r||a)&&(o=u)}var f=w.getTimeToStreamEnd();if(isNaN(o)&&n&&isFinite(f)&&!isNaN(f)&&f<r&&(o=parseFloat(w.getStreamEndTime().toFixed(5)),s=!0),o>0&&D!==o&&o>e&&!P){var d=o-e;if(s){var h=O.getStreamForTime(o),g=h&&!!h.getPreloaded();F.warn("Jumping to end of stream because of gap from ".concat(e," to ").concat(o,". Gap duration: ").concat(d)),w.seek(o,!0,g)}else{var p=w.getIsDynamic(),m=t>0?i.end(t-1):e,y=p?1e3*Math.max(0,d-c):0;P=window.setTimeout(function(){w.seek(o,!0,!0),F.warn("Jumping gap occuring in period ".concat(O.getActiveStream().getStreamId()," starting at ").concat(m," and ending at ").concat(o,". Jumping by: ").concat(d-y/1e3)),P=null},y)}D=o}}var A,R,I,C,N,D,w,O,M,P,L,F,j=this.context,x=Object(s.default)(j).getInstance();return A={reset:n,setConfig:a,initialize:e},t(),A}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js"),o=n("./src/core/events/Events.js"),s=n("./src/core/EventBus.js"),u=100,l=10,c=.1;r.__dashjs_factory_name="GapController",t.default=a.default.getSingletonFactory(r)},"./src/streaming/controllers/MediaController.js":function(e,t,n){function r(){function e(){L=Object(u.default)(G).getInstance().getLogger(P),y()}function t(e,t){var n=k[e]||d(e),a=r(e,t.id),i=[];n||(n=B.getSavedMediaSettings(e),f(e,n)),a&&0!==a.length&&(n&&a.forEach(function(t){_(n,t,!!k[e])&&i.push(t)}),0===i.length?c(I(e,a),!0):i.length>1?c(I(e,i,!!k[e])):c(i[0]))}function n(e){if(e){var t=e.type;if(g(t)){var n=e.streamInfo.id;F[n]||(F[n]=M());for(var r=F[n][t].list,a=0,i=r.length;a<i;++a)if(p(r[a],e))return;r.push(e)}}}function r(e,t){return e&&F[t]&&F[t][e]?F[t][e].list:[]}function s(e,t){return e&&F[t]&&F[t][e]?F[t][e].current:null}function l(e){if(!e)return!1;var t=e.type,n=e.streamInfo.id;return F[n]&&F[n][t]&&p(F[n][t].current,e)}function c(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e&&e.streamInfo){var n=e.type,r=e.streamInfo,o=r.id,u=s(n,o);if(F[o]&&F[o][n]&&!p(e,u)&&(F[o][n].current=e,F[o][n].current&&(n!==a.default.TEXT||n===a.default.TEXT&&e.isFragmented)&&H.trigger(i.default.CURRENT_TRACK_CHANGED,{oldMediaInfo:u,newMediaInfo:e,switchMode:j.get().streaming.trackSwitchMode[n]},{streamId:o}),!t)){var l=E(e);if(!l||!F[o][n].storeLastSettings)return;l.roles&&(l.role=l.roles[0],delete l.roles),l.accessibility&&(l.accessibility=l.accessibility[0]),l.audioChannelConfiguration&&(l.audioChannelConfiguration=l.audioChannelConfiguration[0]),k[n]=l,B.setSavedMediaSettings(n,l)}}}function f(e,t){e&&t&&(x[e]=t)}function d(e){return e?x[e]:null}function h(){B.setSavedMediaSettings(a.default.TEXT,null)}function g(e){return e===a.default.AUDIO||e===a.default.VIDEO||e===a.default.TEXT||e===a.default.IMAGE}function p(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;var n=e.id===t.id,r=e.viewpoint===t.viewpoint,a=e.lang===t.lang,i=e.codec===t.codec,o=e.roles.toString()===t.roles.toString(),s=e.accessibility.toString()===t.accessibility.toString(),u=e.audioChannelConfiguration.toString()===t.audioChannelConfiguration.toString();return n&&i&&r&&a&&o&&s&&u}function m(e){e&&(e.domStorage&&(B=e.domStorage),e.settings&&(j=e.settings))}function y(){F={},k={},U=null,v()}function E(e){var t={lang:e.lang,viewpoint:e.viewpoint,roles:e.roles,accessibility:e.accessibility,audioChannelConfiguration:e.audioChannelConfiguration},n=t.lang||t.viewpoint||t.role&&t.role.length>0||t.accessibility&&t.accessibility.length>0||t.audioChannelConfiguration&&t.audioChannelConfiguration.length>0;return n?t:null}function _(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!e.lang||t.lang.match(e.lang),i=void 0===e.index||null===e.index||t.index===e.index,o=!e.viewpoint||e.viewpoint===t.viewpoint,s=!e.role||!!t.roles.filter(function(t){return t===e.role})[0],u=!e.accessibility||!!t.accessibility.filter(function(t){return t===e.accessibility})[0],l=!e.audioChannelConfiguration||!!t.audioChannelConfiguration.filter(function(t){return t===e.audioChannelConfiguration})[0];return r&&i&&o&&(s||t.type===a.default.AUDIO&&n)&&u&&l}function v(){x={audio:null,video:null,text:null}}function T(e){var t=0,n=[];return e.forEach(function(e){isNaN(e.selectionPriority)||(e.selectionPriority>t?(t=e.selectionPriority,n=[e]):e.selectionPriority===t&&n.push(e))}),n}function S(e){var t,n=0,r=[];return e.forEach(function(e){t=Math.max.apply(Math,e.bitrateList.map(function(e){return e.bandwidth})),t>n?(n=t,r=[e]):t===n&&r.push(e)}),r}function b(e){var t,n=1/0,r=[];return e.forEach(function(e){var a=e.bitrateList.reduce(function(e,t){var n=Math.max(1,t.width*t.height),r=t.bandwidth/n;return e+r},0);t=a/e.bitrateList.length,t<n?(n=t,r=[e]):t===n&&r.push(e)}),r}function A(e){var t,n=0,r=[];return e.forEach(function(e){t=e.representationCount,t>n?(n=t,r=[e]):t===n&&r.push(e)}),r}function R(e){U=e}function I(e,t){if(e===a.default.TEXT)return t[0];var n,r=j.get().streaming.selectionModeForInitialTrack;if(U&&"function"==typeof U)n=U(t);else switch(r){case a.default.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY:n=C(t);break;case a.default.TRACK_SELECTION_MODE_HIGHEST_BITRATE:n=N(t);break;case a.default.TRACK_SELECTION_MODE_FIRST_TRACK:n=D(t);break;case a.default.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY:n=w(t);break;case a.default.TRACK_SELECTION_MODE_WIDEST_RANGE:n=O(t);break;default:L.warn("Track selection mode ".concat(r," is not supported. Falling back to TRACK_SELECTION_MODE_FIRST_TRACK")),n=D(t)}return n.length>0?n[0]:t[0]}function C(e){var t=T(e);return t.length>1&&(t=S(t)),t.length>1&&(t=A(t)),t}function N(e){var t=S(e);return t.length>1&&(t=A(t)),t}function D(e){return e[0]}function w(e){var t=b(e);return t.length>1&&(t=S(t)),t}function O(e){var t=A(e);return t.length>1&&(t=S(e)),t}function M(){return{audio:{list:[],storeLastSettings:!0,current:null},video:{list:[],storeLastSettings:!0,current:null},text:{list:[],storeLastSettings:!0,current:null},image:{list:[],storeLastSettings:!0,current:null}}}var P,L,F,j,x,k,B,U,G=this.context,H=Object(o.default)(G).getInstance();return P={setInitialMediaSettingsForType:t,addTrack:n,getTracksFor:r,getCurrentTrackFor:s,isCurrentTrack:l,setTrack:c,selectInitialTrack:I,setCustomInitialTrackSelectionFunction:R,setInitialSettings:f,getInitialSettings:d,getTracksWithHighestBitrate:S,getTracksWithHighestEfficiency:b,getTracksWithWidestRange:A,isTracksEqual:p,matchSettings:_,saveTextSettingsDisabled:h,setConfig:m,reset:y},e(),P}n.r(t);var a=n("./src/streaming/constants/Constants.js"),i=n("./src/core/events/Events.js"),o=n("./src/core/EventBus.js"),s=n("./src/core/FactoryMaker.js"),u=n("./src/core/Debug.js");r.__dashjs_factory_name="MediaController";var l=s.default.getSingletonFactory(r);s.default.updateSingletonFactory(r.__dashjs_factory_name,l),t.default=l},"./src/streaming/controllers/MediaSourceController.js":function(e,t,n){function r(){function e(){f=Object(i.default)(d).getInstance().getLogger(l)}function t(){var e="WebKitMediaSource"in window,t="MediaSource"in window;return t?c=new MediaSource:e&&(c=new WebKitMediaSource),c}function n(e){var t=window.URL.createObjectURL(c);return e.setSource(t),t}function r(e){e.setSource(null)}function a(e){c&&"open"===c.readyState&&(null===e&&isNaN(e)||c.duration!==e&&(u(c)?setTimeout(a.bind(null,e),50):(f.info("Set MediaSource duration:"+e),c.duration=e)))}function o(e,t){c&&"function"==typeof c.setLiveSeekableRange&&"function"==typeof c.clearLiveSeekableRange&&"open"===c.readyState&&e>=0&&e<t&&(c.clearLiveSeekableRange(),c.setLiveSeekableRange(e,t))}function s(e){if(e&&"open"===e.readyState){for(var t=e.sourceBuffers,n=0;n<t.length;n++){if(t[n].updating)return;if(0===t[n].buffered.length)return}f.info("call to mediaSource endOfStream"),e.endOfStream()}}function u(e){for(var t=e.sourceBuffers,n=0;n<t.length;n++)if(t[n].updating)return!0;return!1}var l,c,f,d=this.context;return l={createMediaSource:t,attachMediaSource:n,detachMediaSource:r,setDuration:a,setSeekable:o,signalEndOfStream:s},e(),l}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js");r.__dashjs_factory_name="MediaSourceController",t.default=a.default.getSingletonFactory(r)},"./src/streaming/controllers/PlaybackController.js":function(e,t,n){function r(){function e(){Re=Object(l.default)(Ve).getInstance().getLogger(Ae),M()}function t(e,t){Pe=e,!0!==t&&n()}function n(){Se(),Le=Pe.manifestInfo.isDynamic,Ge=!1,He=!1,Ue=!1;var e="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",t=/safari/.test(e)&&!/chrome/.test(e);qe=t?.25:.02,We.on(s.default.DATA_UPDATE_COMPLETED,k,Ae),We.on(s.default.LOADING_PROGRESS,ge,Ae),We.on(s.default.MANIFEST_UPDATED,_e,Ae),We.on(s.default.STREAMS_COMPOSED,ve,Ae),We.on(c.default.BUFFER_LEVEL_STATE_CHANGED,pe,Ae),We.on(c.default.PLAYBACK_PROGRESS,re,Ae),We.on(c.default.PLAYBACK_TIME_UPDATED,re,Ae),We.on(c.default.PLAYBACK_ENDED,Z,Ae,{priority:o.default.EVENT_PRIORITY_HIGH}),We.on(c.default.STREAM_INITIALIZING,ye,Ae),We.on(c.default.REPRESENTATION_SWITCH,Ee,Ae),je&&(je=!1,d())}function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return parseFloat((u(e)-_()).toFixed(5))}function u(e){var t=e||Pe;return t.start+t.duration}function d(){Pe&&De&&De.getElement()?De.play():je=!0}function h(){return Pe&&De?De.isPaused():null}function g(){Pe&&De&&De.pause()}function p(){return Pe&&De?De.isSeeking():null}function m(){return Pe&&De?De.isStalled():null}function y(e,t,n){if(Pe&&De){var r=isNaN(Be)?De.getTime():Be;e!==r&&(Ue=!0===n,Ue||(Be=e,We.trigger(s.default.PLAYBACK_SEEK_ASKED)),Re.info("Requesting seek to time: "+e+(Ue?" (internal)":"")),De.setCurrentTime(e,t))}}function E(){var e=Ie&&Ie.hasVideoTrack()?a.default.VIDEO:a.default.AUDIO,t=Ce.getCurrentDVRInfo(e),n=t?t.range:null;n&&!isNaN(n.end)&&y(n.end-Fe.getLiveDelay(),!0,!1)}function _(){return Pe&&De?De.getTime():null}function v(){var e=_();if(Le&&!isNaN(ke)){var t=ke/1e3;e>t&&(e-=t)}return e}function T(){return Pe&&De?De.getPlaybackRate():null}function S(){return Pe&&De?De.getPlayedRanges():null}function b(){return Pe&&De?De.getEnded():null}function A(){return Le}function R(){return Ie}function I(){return Ye}function C(e,t){var n,r,a,i=10,o=4,s=4,u=!isNaN(e)&&isFinite(e)?e:NaN,l=Ne.getSuggestedPresentationDelay();if(Ke.get().streaming.delay.applyServiceDescription&&isNaN(Ke.get().streaming.delay.liveDelay)&&isNaN(Ke.get().streaming.delay.liveDelayFragmentCount)&&N(t),n=Fe.getLiveDelay()?Fe.getLiveDelay():null===Ke.get().streaming.delay.liveDelayFragmentCount||isNaN(Ke.get().streaming.delay.liveDelayFragmentCount)||isNaN(u)?!0===Ke.get().streaming.delay.useSuggestedPresentationDelay&&null!==l&&!isNaN(l)&&l>0?l:isNaN(u)?t&&!isNaN(t.minBufferTime)?t.minBufferTime*o:Pe.manifestInfo.minBufferTime*o:u*s:u*Ke.get().streaming.delay.liveDelayFragmentCount,a=Ne.getAvailabilityStartTime(),null!==a&&(ke=a),t&&t.dvrWindowSize>0){var c=Math.max(t.dvrWindowSize-i,t.dvrWindowSize/2);r=Math.min(n,c)}else r=n;return Me=r,r}function N(e){if(e&&e.serviceDescriptions){for(var t=null,n=0;n<e.serviceDescriptions.length;n++){var r=e.serviceDescriptions[n];if(r.schemeIdUri===a.default.SERVICE_DESCRIPTION_LL_SCHEME){t=r;break}}t&&(t.latency&&t.latency.target>0&&(Re.debug("Apply LL properties coming from service description. Target Latency (ms):",t.latency.target),Ke.update({streaming:{delay:{liveDelay:t.latency.target/1e3},liveCatchup:{minDrift:(t.latency.target+500)/1e3,maxDrift:t.latency.max>t.latency.target?(t.latency.max-t.latency.target+500)/1e3:void 0}}})),t.playbackRate&&t.playbackRate.max>1&&(Re.debug("Apply LL properties coming from service description. Max PlaybackRate:",t.playbackRate.max),Ke.update({streaming:{liveCatchup:{playbackRate:t.playbackRate.max-1}}})))}}function D(){return ke}function w(){return Me}function O(){if(!Le||isNaN(ke))return NaN;var e=v();if(isNaN(e)||0===e)return 0;var t=(new Date).getTime()+1e3*we.getClientTimeOffset();return Math.max(((t-ke-1e3*e)/1e3).toFixed(3),0)}function M(){g(),je=!1,Me=0,ke=0,Ye=!1,Be=NaN,De&&(We.off(s.default.DATA_UPDATE_COMPLETED,k,Ae),We.off(s.default.LOADING_PROGRESS,ge,Ae),We.off(s.default.MANIFEST_UPDATED,_e,Ae),We.off(s.default.STREAMS_COMPOSED,ve,Ae),We.off(c.default.BUFFER_LEVEL_STATE_CHANGED,pe,Ae),We.off(c.default.PLAYBACK_PROGRESS,re,Ae),We.off(c.default.PLAYBACK_TIME_UPDATED,re,Ae),We.off(c.default.PLAYBACK_ENDED,Z,Ae),We.off(c.default.STREAM_INITIALIZING,ye,Ae),We.off(c.default.REPRESENTATION_SWITCH,Ee,Ae),De.setPlaybackRate(1,!0),j(),be()),Oe=null,De=null,Pe=null,Le=null}function P(e){e&&(e.streamController&&(Ie=e.streamController),e.dashMetrics&&(Ce=e.dashMetrics),e.mediaPlayerModel&&(Fe=e.mediaPlayerModel),e.adapter&&(Ne=e.adapter),e.videoModel&&(De=e.videoModel),e.timelineConverter&&(we=e.timelineConverter),e.settings&&(Ke=e.settings))}function L(e,t){var n,r=Ce.getCurrentDVRInfo(t),a=r?r.range:null;return a?(n=e>a.end?Math.max(a.end-Me,a.start):e>0&&e+.25<a.start&&Math.abs(e-a.start)<31536e4?Ke.get().streaming.lowLatencyEnabled?Math.max(a.end-Me,a.start):a.start:e,n):NaN}function F(){if(null===Oe){var e=function(){te()};Oe=setInterval(e,Ke.get().streaming.wallclockTimeUpdateInterval)}}function j(){clearInterval(Oe),Oe=null}function x(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!h()&&Le&&0!==De.getReadyState()&&!p()&&!Ye){e||(e=Ie.hasVideoTrack()?a.default.VIDEO:a.default.AUDIO);var t=v(),n=L(t,e),r=!isNaN(n)&&n!==t;r&&!p()&&(m()||He||1===De.getReadyState())&&(Re.debug("UpdateCurrentTime: Seek to actual time: ".concat(n," from currentTime: ").concat(t)),y(n))}}function k(e){var t=Ne.convertRepresentationToRepresentationInfo(e.currentRepresentation),n=t?t.mediaInfo.streamInfo:null;null!==n&&Pe.id===n.id&&(Pe=n)}function B(){We.trigger(s.default.CAN_PLAY)}function U(){We.trigger(s.default.CAN_PLAY_THROUGH)}function G(){Re.info("Native video element event: play"),x(),F(),We.trigger(s.default.PLAYBACK_STARTED,{startTime:_()})}function H(){Re.info("Native video element event: waiting"),We.trigger(s.default.PLAYBACK_WAITING,{playingTime:_()})}function q(){Re.info("Native video element event: playing"),We.trigger(s.default.PLAYBACK_PLAYING,{playingTime:_()})}function Y(){Re.info("Native video element event: pause"),We.trigger(s.default.PLAYBACK_PAUSED,{ended:b()})}function K(){if(Ue)Ue=!1;else{var e=_();isNaN(Be)||Be===e||(e=Be),Be=NaN,Re.info("Seeking to: "+e),F(),We.trigger(s.default.PLAYBACK_SEEKING,{seekTime:e,streamId:Pe.id})}}function V(){Re.info("Native video element event: seeked"),We.trigger(s.default.PLAYBACK_SEEKED)}function W(){Pe&&We.trigger(s.default.PLAYBACK_TIME_UPDATED,{timeToEnd:r(),time:_(),streamId:Pe.id})}function z(){We.trigger(s.default.PLAYBACK_PROGRESS,{streamId:Pe.id})}function X(){var e=T();Re.info("Native video element event: ratechange: ",e),We.trigger(s.default.PLAYBACK_RATE_CHANGED,{playbackRate:e})}function Q(){Re.info("Native video element event: loadedmetadata"),We.trigger(s.default.PLAYBACK_METADATA_LOADED),F()}function J(){Re.info("Native video element event: loadeddata"),We.trigger(s.default.PLAYBACK_LOADED_DATA)}function $(){Re.info("Native video element event: ended"),g(),j();var e=Ie?Ie.getActiveStreamInfo():null;e&&We.trigger(s.default.PLAYBACK_ENDED,{isLast:e.isLast})}function Z(e){if(Oe&&e.isLast){Re.info("onPlaybackEnded -- PLAYBACK_ENDED but native video element didn't fire ended");var t=e.seekTime?e.seekTime:u();De.setCurrentTime(t),g(),j()}}function ee(e){var t=e.target||e.srcElement;We.trigger(s.default.PLAYBACK_ERROR,{error:t.error})}function te(){We.trigger(s.default.WALLCLOCK_TIME_UPDATED,{isDynamic:Le,time:new Date}),A()&&(Ie.addDVRMetric(),h()?ne():x())}function ne(){var e=Date.now();(!xe||e>xe+f)&&(xe=e,W())}function re(){Le&&ae()&&Ke.get().streaming.liveCatchup.playbackRate>0&&!h()&&!p()&&(se()?ce():he())}function ae(){return Ke.get().streaming.liveCatchup.enabled||Ke.get().streaming.lowLatencyEnabled}function ie(){var e=null;return Ie.getActiveStreamProcessors().forEach(function(t){var n=t.getBufferLevel();e=null===e?n:Math.min(e,n)}),e}function oe(){var e=Ke.get().streaming.liveCatchup.playbackBufferMin;return Ke.get().streaming.liveCatchup.mode!==a.default.LIVE_CATCHUP_MODE_LOLP||null===e||isNaN(e)?a.default.LIVE_CATCHUP_MODE_DEFAULT:a.default.LIVE_CATCHUP_MODE_LOLP}function se(){try{if(ae()&&Ke.get().streaming.liveCatchup.playbackRate>0&&_()>0){var e=oe(),t=O(),n=Fe.getLiveDelay(),r=Fe.getLiveCatchupLatencyThreshold(),i=Ke.get().streaming.liveCatchup.minDrift;if(e===a.default.LIVE_CATCHUP_MODE_LOLP){var o=ie(),s=Ke.get().streaming.liveCatchup.playbackBufferMin;return le(t,n,i,o,s,r)}return ue(t,n,r,i)}}catch(e){return!1}}function ue(e,t,n,r){try{var a=Math.abs(e-t);return a>r&&(isNaN(n)||e<=n)}catch(e){return!1}}function le(e,t,n,r,a,i){try{var o=Math.abs(e-t);return(isNaN(i)||e<=i)&&(o>n||r<a)}catch(e){return!1}}function ce(){if(De){var e,t=De.getPlaybackRate(),n=Ke.get().streaming.liveCatchup.playbackRate,r=O(),i=Fe.getLiveDelay(),o=ie();if(oe()===a.default.LIVE_CATCHUP_MODE_LOLP){var s=Ke.get().streaming.liveCatchup.minDrift,u=Ke.get().streaming.liveCatchup.playbackBufferMin;e=de(n,r,i,s,u,o,t)}else e=fe(n,r,i,o,t);var l=e.newRate;l&&De.setPlaybackRate(l);var c=r-i;Ke.get().streaming.liveCatchup.maxDrift>0&&!Ge&&c>Ke.get().streaming.liveCatchup.maxDrift?(Re.info("Low Latency catchup mechanism. Latency too high, doing a seek to live point"),Ge=!0,E()):Ge=!1}}function fe(e,t,n,r,a){var i=e,o=t-n,s=5*o,u=2*i/(1+Math.pow(Math.E,-s)),l=1-i+u;return He&&(r>n/2?He=!1:o>0&&(l=1)),Math.abs(a-l)<=qe&&(l=null),{newRate:l}}function de(e,t,n,r,a,i,o){var s,u=e;if(i<a){var l=i-a,c=5*l,f=2*u/(1+Math.pow(Math.E,-c));s=1-u+f,Re.debug("[LoL+ playback control_buffer-based] bufferLevel: "+i+", newRate: "+s)}else{var d=.02;if(Math.abs(t-n)<=d*n)s=1;else{var h=t-n,g=5*h,p=2*u/(1+Math.pow(Math.E,-g));s=1-u+p}Re.debug("[LoL+ playback control_latency-based] latency: "+t+", newRate: "+s)}return He&&i>n/2&&(He=!1),Math.abs(o-s)<=qe&&(s=null),{newRate:s}}function he(){De&&De.setPlaybackRate(1)}function ge(e){if(!1===e.stream&&Ke.get().streaming.lowLatencyEnabled&&!isNaN(e.request.duration)){var t=1.2*e.request.duration;t>Fe.getLiveDelay()&&(Re.warn("Browser does not support fetch API with StreamReader. Increasing live delay to be 20% higher than segment duration:",t.toFixed(2)),Ke.update({streaming:{delay:{liveDelay:t}}}))}}function pe(e){e.streamId===Pe.id&&(ae()?e.state!==i.default.BUFFER_EMPTY||p()||He||(He=!0,he()):Ke.get().streaming.buffer.setStallState&&De.setStallState(e.mediaType,e.state===i.default.BUFFER_EMPTY))}function me(e){We.trigger(s.default.PLAYBACK_STALLED,{e:e})}function ye(e){Te(e.mediaInfo)}function Ee(e){var t=Ie.getActiveStreamInfo();if(Ke.get().streaming.lowLatencyEnabledByManifest&&e&&t&&e.currentRepresentation&&e.streamId&&e.streamId===t.id&&e.mediaType&&(e.mediaType===a.default.VIDEO||e.mediaType===a.default.AUDIO)){var n=!e.currentRepresentation.availabilityTimeComplete;n&&Ke.update({streaming:{lowLatencyEnabled:n}})}}function _e(){Ye=!0}function ve(){Ye=!1}function Te(e){e&&e.supplementalProperties&&"true"===e.supplementalProperties[a.default.SUPPLEMENTAL_PROPERTY_LL_SCHEME]&&(Re.debug("Low Latency critical SupplementalProperty set: Enabling low Latency"),Ke.update({streaming:{lowLatencyEnabled:!0}}))}function Se(){De.addEventListener("canplay",B),De.addEventListener("canplaythrough",U),De.addEventListener("play",G),De.addEventListener("waiting",H),De.addEventListener("playing",q),De.addEventListener("pause",Y),De.addEventListener("error",ee),De.addEventListener("seeking",K),De.addEventListener("seeked",V),De.addEventListener("timeupdate",W),De.addEventListener("progress",z),De.addEventListener("ratechange",X),De.addEventListener("loadedmetadata",Q),De.addEventListener("loadeddata",J),De.addEventListener("stalled",me),De.addEventListener("ended",$)}function be(){De.removeEventListener("canplay",B),De.removeEventListener("canplaythrough",U),De.removeEventListener("play",G),De.removeEventListener("waiting",H),De.removeEventListener("playing",q),De.removeEventListener("pause",Y),De.removeEventListener("error",ee),De.removeEventListener("seeking",K),De.removeEventListener("seeked",V),De.removeEventListener("timeupdate",W),De.removeEventListener("progress",z),De.removeEventListener("ratechange",X),De.removeEventListener("loadedmetadata",Q),De.removeEventListener("loadeddata",J),De.removeEventListener("stalled",me),De.removeEventListener("ended",$)}var Ae,Re,Ie,Ce,Ne,De,we,Oe,Me,Pe,Le,Fe,je,xe,ke,Be,Ue,Ge,He,qe,Ye,Ke,Ve=this.context,We=Object(o.default)(Ve).getInstance();return Ae={initialize:t,setConfig:P,getTimeToStreamEnd:r,getBufferLevel:ie,getTime:_,getNormalizedTime:v,getIsManifestUpdateInProgress:I,getPlaybackRate:T,getPlayedRanges:S,getEnded:b,getIsDynamic:A,getStreamController:R,computeAndSetLiveDelay:C,getLiveDelay:w,getCurrentLiveLatency:O,play:d,isPaused:h,pause:g,isSeeking:p,getStreamEndTime:u,seek:y,reset:M,updateCurrentTime:x,getAvailabilityStartTime:D},e(),Ae}n.r(t);var a=n("./src/streaming/constants/Constants.js"),i=n("./src/streaming/constants/MetricsConstants.js"),o=n("./src/core/EventBus.js"),s=n("./src/core/events/Events.js"),u=n("./src/core/FactoryMaker.js"),l=n("./src/core/Debug.js"),c=n("./src/streaming/MediaPlayerEvents.js"),f=500;r.__dashjs_factory_name="PlaybackController",t.default=u.default.getSingletonFactory(r)},"./src/streaming/controllers/ScheduleController.js":function(e,t,n){function r(e){function t(){H=Object(l.default)(Z).getInstance().getLogger(U),x(),G=e.streamInfo}function n(e){V=e,ee.on(s.default.BYTES_APPENDED_END_FRAGMENT,D,U),ee.on(s.default.URL_RESOLUTION_FAILED,w,U),ee.on(f.default.PLAYBACK_STARTED,O,U),ee.on(f.default.PLAYBACK_RATE_CHANGED,M,U),ee.on(f.default.PLAYBACK_TIME_UPDATED,C,U)}function r(){return se}function u(){return G.id}function d(e){q=e}function h(e){if(!ue.getIsBufferingCompleted()){g();var t=isNaN(e)?0:e;K=setTimeout(m,t)}}function g(){K&&(clearTimeout(K),K=null)}function p(){var e=G.id,t=ae.getMaxAllowedIndexFor(se,e);return!(!isNaN(z)&&z==t)&&(H.info("Top quality "+se+" index has changed from "+z+" to "+t),z=t,!0)}function m(){try{if(E())return void g();if(_()){var e=!1;$&&(e=ae.checkPlaybackQuality(se,G.id)),e||y()}else h(le.get().streaming.lowLatencyEnabled?le.get().streaming.scheduling.lowLatencyTimeout:le.get().streaming.scheduling.defaultTimeout)}catch(e){h(le.get().streaming.lowLatencyEnabled?le.get().streaming.scheduling.lowLatencyTimeout:le.get().streaming.scheduling.defaultTimeout)}}function y(){J||q.quality!==X||Q?(Q?(H.debug("Switch track for "+se+", representation id = "+q.id),Q=!1):H.debug("Quality has changed, get init request for representationid = "+q.id),ee.trigger(s.default.INIT_FRAGMENT_NEEDED,{representationId:q.id,sender:U},{streamId:G.id,mediaType:se}),$=!1,J=!1):(H.debug("Media segment needed for ".concat(se," and stream id ").concat(G.id)),ee.trigger(s.default.MEDIA_FRAGMENT_NEEDED,{},{streamId:G.id,mediaType:se}),$=!0)}function E(){try{return se===a.default.TEXT&&!oe.isTextEnabled()||ie.isPaused()&&(!ie.getStreamController().getInitialPlayback()||!ie.getStreamController().getAutoPlay())&&!le.get().streaming.scheduling.scheduleWhilePaused}catch(e){return!1}}function _(){try{return q&&(isNaN(X)||Q||p()||v())}catch(e){return!1}}function v(){if(!se||!q)return!0;var e=te.getCurrentBufferLevel(se);return e<T()}function T(){var e=NaN;return se&&q?(e=se===a.default.TEXT?S():se===a.default.AUDIO&&V?b():A(),e):e}function S(){try{if(oe.isTextEnabled()){if(isNaN(q.fragmentDuration)){var e=te.getCurrentSchedulingInfo(c.default.SCHEDULING_INFO);return e?e.duration:0}return q.fragmentDuration}return 0}catch(e){return 0}}function b(){try{var e=te.getCurrentBufferLevel(a.default.VIDEO);return isNaN(q.fragmentDuration)?e+1:Math.max(e+1,q.fragmentDuration)}catch(e){return 0}}function A(){try{var e=q.mediaInfo.streamInfo;if(ae.isPlayingAtTopQuality(e)){var t=e.manifestInfo.duration>=le.get().streaming.buffer.longFormContentDurationThreshold;return t?le.get().streaming.buffer.bufferTimeAtTopQualityLongForm:le.get().streaming.buffer.bufferTimeAtTopQuality}return ne.getStableBufferTime()}catch(e){return ne.getStableBufferTime()}}function R(e){Q=e}function I(){return Q}function C(){N(!0)}function N(e){if(ie&&re){var t=re.getRequests({state:i.default.FRAGMENT_MODEL_EXECUTED,time:ie.getTime(),threshold:0})[0];t&&ie.getTime()>=t.startTime&&((!W.mediaInfo||t.mediaInfo.type===W.mediaInfo.type&&t.mediaInfo.id!==W.mediaInfo.id)&&e&&ee.trigger(s.default.TRACK_CHANGE_RENDERED,{mediaType:se,oldMediaInfo:W.mediaInfo,newMediaInfo:t.mediaInfo,streamId:G.id}),t.quality===W.quality&&t.adaptationIndex===W.adaptationIndex||!e||(H.debug("Quality change rendered for streamId ".concat(G.id," and type ").concat(se)),ee.trigger(s.default.QUALITY_CHANGE_RENDERED,{mediaType:se,oldQuality:W.quality,newQuality:t.quality,streamId:G.id})),W={mediaInfo:t.mediaInfo,quality:t.quality,adaptationIndex:t.adaptationIndex})}}function D(e){H.debug("Appended bytes for ".concat(e.mediaType," and stream id ").concat(G.id)),(isNaN(e.index)||isNaN(X))&&(X=e.quality,H.info("["+se+"] lastInitializedRepresentationInfo changed to "+e.quality)),h(0)}function w(){re.abortRequests(),g()}function O(){le.get().streaming.scheduling.scheduleWhilePaused||h()}function M(e){te.updatePlayListTraceMetrics({playbackspeed:e.playbackRate.toString()})}function P(e){Y=e}function L(){return Y}function F(e){$=e}function j(e){J=e}function x(){$=!0,Y=0,X=NaN,W={mediaInfo:void 0,quality:NaN,adaptationIndex:NaN},z=NaN,Q=!1,J=!1}function k(){
ee.off(s.default.BYTES_APPENDED_END_FRAGMENT,D,U),ee.off(s.default.URL_RESOLUTION_FAILED,w,U),ee.off(f.default.PLAYBACK_STARTED,O,U),ee.off(f.default.PLAYBACK_RATE_CHANGED,M,U),ee.off(f.default.PLAYBACK_TIME_UPDATED,C,U),g(),N(!1),x(),G=null}function B(){return ie}e=e||{};var U,G,H,q,Y,K,V,W,z,X,Q,J,$,Z=this.context,ee=Object(o.default)(Z).getInstance(),te=e.dashMetrics,ne=e.mediaPlayerModel,re=e.fragmentModel,ae=e.abrController,ie=e.playbackController,oe=e.textController,se=e.type,ue=e.bufferController,le=e.settings;return U={initialize:n,getType:r,getStreamId:u,setCurrentRepresentation:d,setTimeToLoadDelay:P,getTimeToLoadDelay:L,setSwitchTrack:R,getSwitchStrack:I,startScheduleTimer:h,clearScheduleTimer:g,reset:k,getBufferTarget:T,getPlaybackController:B,setCheckPlaybackQuality:F,setInitSegmentRequired:j},t(),U}n.r(t);var a=n("./src/streaming/constants/Constants.js"),i=n("./src/streaming/models/FragmentModel.js"),o=n("./src/core/EventBus.js"),s=n("./src/core/events/Events.js"),u=n("./src/core/FactoryMaker.js"),l=n("./src/core/Debug.js"),c=n("./src/streaming/constants/MetricsConstants.js"),f=n("./src/streaming/MediaPlayerEvents.js");r.__dashjs_factory_name="ScheduleController",t.default=u.default.getClassFactory(r)},"./src/streaming/controllers/StreamController.js":function(e,t,n){function r(e){return s(e)||o(e)||i(e)||a()}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function o(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function s(e){if(Array.isArray(e))return u(e)}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function l(){function e(){Le=Object(E.default)(bt).getInstance().getLogger(Pe),qe=Object(S.default)(bt).getInstance(),He=Object(b.default)(bt).getInstance(),Qe=Object(_.default)(bt).getInstance(),Je=Object(v.default)(bt).getInstance(),De()}function t(e,t){Se(),it=e,at=t,Ze.initialize(),xe=Object(h.default)(bt).create(),xe.setConfig({manifestModel:Be,adapter:Ue,manifestLoader:ke,errHandler:$e,settings:_t}),xe.initialize(),Xe=Object(I.default)(bt).getInstance(),Xe.setConfig({manifestUpdater:xe,playbackController:ft,settings:_t}),Xe.start(),qe.setConfig({dashMetrics:Ge,baseURLController:Ye,errHandler:$e,settings:_t}),qe.initialize(),nt&&(At.trigger(p.default.PROTECTION_CREATED,{controller:nt}),nt.setMediaElement(ct.getElement()),at&&nt.setProtectionData(at)),n()}function n(){At.on(T.default.PLAYBACK_TIME_UPDATED,Y,Pe),At.on(T.default.PLAYBACK_SEEKING,M,Pe),At.on(T.default.PLAYBACK_ERROR,me,Pe),At.on(T.default.PLAYBACK_STARTED,K,Pe),At.on(T.default.PLAYBACK_PAUSED,V,Pe),At.on(T.default.PLAYBACK_ENDED,Z,Pe),At.on(T.default.METRIC_ADDED,Oe,Pe),At.on(T.default.MANIFEST_VALIDITY_CHANGED,Ie,Pe),At.on(T.default.BUFFER_LEVEL_UPDATED,H,Pe),At.on(T.default.QUALITY_CHANGE_REQUESTED,q,Pe),p.default.KEY_SESSION_UPDATED&&At.on(p.default.KEY_SESSION_UPDATED,o,Pe),At.on(p.default.MANIFEST_UPDATED,ce,Pe),At.on(p.default.STREAM_BUFFERING_COMPLETED,W,Pe),At.on(p.default.TIME_SYNCHRONIZATION_COMPLETED,i,Pe),At.on(p.default.CURRENT_TRACK_CHANGED,x,Pe)}function a(){At.off(T.default.PLAYBACK_TIME_UPDATED,Y,Pe),At.off(T.default.PLAYBACK_SEEKING,M,Pe),At.off(T.default.PLAYBACK_ERROR,me,Pe),At.off(T.default.PLAYBACK_STARTED,K,Pe),At.off(T.default.PLAYBACK_PAUSED,V,Pe),At.off(T.default.PLAYBACK_ENDED,Z,Pe),At.off(T.default.METRIC_ADDED,Oe,Pe),At.off(T.default.MANIFEST_VALIDITY_CHANGED,Ie,Pe),At.off(T.default.BUFFER_LEVEL_UPDATED,H,Pe),At.off(T.default.QUALITY_CHANGE_REQUESTED,q,Pe),p.default.KEY_SESSION_UPDATED&&At.off(p.default.KEY_SESSION_UPDATED,o,Pe),At.off(p.default.MANIFEST_UPDATED,ce,Pe),At.off(p.default.STREAM_BUFFERING_COMPLETED,W,Pe),At.off(p.default.TIME_SYNCHRONIZATION_COMPLETED,i,Pe),At.off(p.default.CURRENT_TRACK_CHANGED,x,Pe)}function i(){s()}function o(){vt=!0}function s(){try{var e=Ue.getStreamsInfo();if(!tt&&0===e.length)throw new Error("There are no streams");tt&&Ge.updateManifestUpdateInfo({currentTime:ft.getTime(),buffered:ct.getBufferRange(),presentationStartTime:e[0].start,clientTimeOffset:Ze.getClientTimeOffset()}),et.length>0&&ue(e);for(var t=[],n=0,r=e.length;n<r;n++){var a=e[n];t.push(u(a)),Ge.addManifestUpdateStreamInfo(a)}Promise.all(t).then(function(){tt||l(e),At.trigger(p.default.STREAMS_COMPOSED),z()}).catch(function(e){throw e})}catch(e){$e.error(new A.default(R.default.MANIFEST_ERROR_ID_NOSTREAMS_CODE,e.message+"nostreamscomposed",Be.getValue())),ut=!0,we()}}function u(e){var t=Te(e.id);return t?t.updateData(e):(t=Object(d.default)(bt).create({manifestModel:Be,mediaPlayerModel:dt,dashMetrics:Ge,manifestUpdater:xe,adapter:Ue,timelineConverter:Ze,capabilities:Fe,capabilitiesFilter:je,errHandler:$e,baseURLController:Ye,segmentBaseController:Ke,textController:rt,abrController:We,playbackController:ft,eventController:Xe,mediaController:ze,protectionController:nt,videoModel:ct,streamInfo:e,settings:_t}),et.push(t),t.initialize(),Promise.resolve())}function l(e){G();var t=Ge.getCurrentDVRInfo().range;if(t.end<t.start){Tt&&clearTimeout(Tt);var n=Math.min(1e3*(-1*(t.end-t.start)+D),2147483647);return Le.debug("Waiting for ".concat(n," ms before playback can start")),At.trigger(p.default.AST_IN_FUTURE,{delay:n}),void(Tt=setTimeout(function(){l(e)},n))}if(Ue.getIsDynamic()&&et.length){var r=e[0].manifestInfo,a=le(e,r);ft.computeAndSetLiveDelay(a,r)}var i=oe(),o=U(i),s=null!==o?o:et[0];At.trigger(p.default.INITIAL_STREAM_SWITCH,{startTime:i}),m(s,null,i),X()}function m(e,t,n){try{if(ot||!e||t===e&&e.getIsActive())return;ot=!0,At.trigger(p.default.PERIOD_SWITCH_STARTED,{fromStreamInfo:t?t.getStreamInfo():null,toStreamInfo:e.getStreamInfo()});var r=!1;tt=e,t&&(r=k(e,t),t.deactivate(r)),n=isNaN(n)?!r&&t?e.getStreamInfo().start:NaN:n,Le.info("Switch to stream ".concat(e.getId(),". Seektime is ").concat(n,", current playback time is ").concat(ft.getTime(),". Seamless period switch is set to ").concat(r)),yt=yt.filter(function(e){return e.getId()!==tt.getId()}),ft.initialize(Ee(),!!t),ct.getElement()&&w(n,r)}catch(e){ot=!1}}function w(e,t){function n(){if(lt&&"open"===lt.readyState){Le.debug("MediaSource is open!"),window.URL.revokeObjectURL(a),lt.removeEventListener("sourceopen",n),lt.removeEventListener("webkitsourceopen",n),ne();var r=Ge.getCurrentDVRInfo();He.setSeekable(r.range.start,r.range.end),O(e,t)}}function r(){lt.addEventListener("sourceopen",n,!1),lt.addEventListener("webkitsourceopen",n,!1),a=He.attachMediaSource(ct),Le.debug("MediaSource attached to element.  Waiting on open...")}var a;lt?t?O(e,t):(He.detachMediaSource(ct),r()):(lt=He.createMediaSource(),r())}function O(e,t){tt.activate(lt,t?mt:void 0,e).then(function(t){if(t){var n=Object.keys(t);n.length>0&&t[n[0]].getBuffer().changeType&&(Et=!0),mt=t}isNaN(e)||(At.trigger(p.default.SEEK_TARGET,{time:e},{streamId:tt.getId()}),ft.seek(e,!1,!0),tt.startScheduleControllers()),ot=!1,At.trigger(p.default.PERIOD_SWITCH_COMPLETED,{toStreamInfo:Ee()})})}function M(e){var t=ft.getTime(),n=e.seekTime,r=U(n);r&&r!==tt?r&&r!==tt&&(P(t,n,r),j(e,r)):(P(t,n),F(e)),pe(y.PlayList.SEEK_START_REASON)}function P(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];L()}function L(){yt&&yt.length>0&&(yt.forEach(function(e){e.deactivate(!0)}),yt=[])}function F(e){var t=tt.getProcessors();t.forEach(function(t){return t.prepareInnerPeriodPlaybackSeeking(e)}),ge(y.PlayListTrace.USER_REQUEST_STOP_REASON)}function j(e,t){var n=e&&!isNaN(e.seekTime)?e.seekTime:NaN,r=tt.getProcessors(),a=r.map(function(t){return t.prepareOuterPeriodPlaybackSeeking(e)});Promise.all(a).then(function(){m(t,tt,n)}).catch(function(e){$e.error(e)})}function x(e){e.newMediaInfo.streamInfo.id===tt.getId()&&(L(),tt.prepareTrackChange(e))}function k(e,t){try{return _t.get().streaming.buffer.reuseExistingSourceBuffers&&(t.isProtectionCompatible(e)||vt)&&(Et||t.isMediaCodecCompatible(e,t))}catch(e){return!1}}function B(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(lt&&!e.getPreloaded()){var n=k(e,t);n&&e.startPreloading(lt,mt).then(function(){yt.push(e)})}}function U(e){if(isNaN(e))return null;for(var t=et.length,n=0;n<t;n++){var r=et[n],a=parseFloat((r.getStartTime()+r.getDuration()).toFixed(5));if(e<a)return r}return null}function G(){try{var e=Ue.getIsDynamic(),t=Ue.getStreamsInfo(),n=t[0].manifestInfo,r=ft.getTime(),a=Ze.calcTimeShiftBufferWindow(et,e),i=$();if(void 0===a.start||void 0===a.end)return;i&&0!==i.length?i.forEach(function(e){Ge.addDVRInfo(e.getType(),r,n,a)}):Ge.addDVRInfo(c.default.VIDEO,r,n,a)}catch(e){}}function H(e){if(gt&&it){var t=dt.getInitialBufferLevel();(isNaN(t)||t<=ft.getBufferLevel()||Ue.getIsDynamic()&&t>ft.getLiveDelay())&&(gt=!1,pe(y.PlayList.INITIAL_PLAYOUT_START_REASON),ft.play())}e&&e.mediaType&&Ge.addBufferLevel(e.mediaType,new Date,1e3*e.bufferLevel)}function q(e){e.streamInfo.id===tt.getId()&&e.reason&&e.reason.forceReplace&&L();var t=Te(e.streamInfo.id);t.prepareQualityChange(e)}function Y(){if(fe()){var e=ct.getPlaybackQuality();e&&Ge.addDroppedFrames(e)}}function K(){Le.debug("[onPlaybackStarted]"),!gt&&ht&&pe(y.PlayList.RESUME_FROM_PAUSE_START_REASON),gt&&(gt=!1),ht=!1}function V(e){Le.debug("[onPlaybackPaused]"),e.ended||(ht=!0,ge(y.PlayListTrace.USER_REQUEST_STOP_REASON))}function W(e){Le.debug("Stream with id ".concat(e.streamInfo.id," finished buffering"));var t=e.streamInfo.isLast;lt&&t?(Le.info("[onStreamBufferingCompleted] calls signalEndOfStream of mediaSourceController."),He.signalEndOfStream(lt)):z()}function z(){if(tt&&tt.getHasFinishedBuffering())for(var e=te(tt),t=0;t<e.length;){var n=e[t],r=0===t?tt:e[t-1];!n.getPreloaded()&&r.getHasFinishedBuffering()&&lt&&B(n,r),t+=1}}function X(){pt||(pt=setInterval(function(){!ot&&ft.getTimeToStreamEnd()<=0&&!ft.isSeeking()&&At.trigger(p.default.PLAYBACK_ENDED,{isLast:Ee().isLast})},N))}function Q(){pt&&(clearInterval(pt),pt=null)}function J(e,t){for(var n=null,r=0,a=0,i=null,o=0;o<et.length;o++){if(n=et[o],a=n.getStartTime(),i=n.getDuration(),Number.isFinite(a)&&(r=a),n.getId()===t)return e-r;Number.isFinite(i)&&(r+=i)}return null}function $(){return tt?tt.getProcessors():[]}function Z(e){if(tt&&!tt.getIsEndedEventSignaled()){tt.setIsEndedEventSignaled(!0);var t=ee();t?(Le.debug("StreamController onEnded, found next stream with id ".concat(t.getStreamInfo().id,". Switching from ").concat(tt.getStreamInfo().id," to ").concat(t.getStreamInfo().id)),m(t,tt,NaN)):(Le.debug("StreamController no next stream found"),tt.setIsEndedEventSignaled(!1)),ge(t?y.PlayListTrace.END_OF_PERIOD_STOP_REASON:y.PlayListTrace.END_OF_CONTENT_STOP_REASON)}e&&e.isLast&&Q()}function ee(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=e||(tt||null);if(!t)return null;for(var n=t.getStreamInfo(),r=n.start,a=0,i=-1,o=NaN;a<et.length;){var s=et[a],u=s.getStreamInfo(),l=u.start-r;l>0&&(isNaN(o)||l<o)&&n.id!==u.id&&(o=l,i=a),a+=1}return i>=0?et[i]:null}function te(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{var t=e||(tt||null);if(t){var n=t.getStreamInfo();return et.filter(function(e){var t=e.getStreamInfo();return t.start>n.start&&n.id!==t.id})}}catch(e){return[]}}function ne(e){var t=e||Ee().manifestInfo.duration;He.setDuration(t)}function re(){return tt}function ae(){return gt}function ie(){return it}function oe(){var e;if(Ue.getIsDynamic()){var t=Ge.getCurrentDVRInfo(),n=t&&t.range?t.range.end:0;e=n-ft.getLiveDelay();var r=t?t.range:null;if(r){var a=se(!0);isNaN(a)||(Le.info("Start time from URI parameters: "+a),e=Math.max(Math.min(e,a),r.start))}}else{var i=Me(),o=i[0].getStreamInfo();e=o.start;var s=se(!1);isNaN(s)||(Le.info("Start time from URI parameters: "+s),e=Math.max(e,s))}return e}function se(e){var t=Ve.getURIFragmentData();if(!t||!t.t)return NaN;var n=Me()[0],r=n.getStreamInfo().start;t.t=t.t.split(",")[0];var a=-1!==t.t.indexOf("posix:")?"now"===t.t.substring(6)?Date.now()/1e3:parseInt(t.t.substring(6)):NaN,i=e&&!isNaN(a)?a-ft.getAvailabilityStartTime()/1e3:parseInt(t.t)+r;return i}function ue(e){et=et.filter(function(t){var n=e.filter(function(e){return e.id===t.getId()}).length>0,r=n||t.getId()===tt.getId();return r||(Le.debug("Removing stream ".concat(t.getId())),t.reset(!0)),r})}function le(e,t){try{var n=NaN;if(t&&!isNaN(t.maxFragmentDuration)&&isFinite(t.maxFragmentDuration))return t.maxFragmentDuration;if(e&&1===e.length){var a=e[0],i=[c.default.VIDEO,c.default.AUDIO,c.default.TEXT],o=i.reduce(function(e,t){var n=Ue.getMediaInfoForType(a,t);return n&&!1!==n.isFragmented&&e.push(n),e},[]).reduce(function(e,t){var n=Ue.getVoRepresentations(t);return n&&n.length>0&&n.forEach(function(t){t&&e.push(t)}),e},[]).reduce(function(e,t){var n=Ue.convertRepresentationToRepresentationInfo(t);return n&&n.fragmentDuration&&!isNaN(n.fragmentDuration)&&e.push(n.fragmentDuration),e},[]);n=Math.max.apply(Math,r(o))}return isFinite(n)?n:NaN}catch(e){return NaN}}function ce(e){if(e.error)ut=!0,we();else{Le.info("Manifest updated... updating data system wide.");var t=e.manifest;Ue.updatePeriods(t);var n=Ue.getUTCTimingSources();!Ue.getIsDynamic()||n&&0!==n.length||At.trigger(T.default.CONFORMANCE_VIOLATION,{level:C.default.LEVELS.WARNING,event:C.default.EVENTS.NO_UTC_TIMING_ELEMENT});var r=Ue.getIsDynamic()?n.concat(dt.getUTCTimingSources()):n,a=Je.isHTTPS(e.manifest.url);r.forEach(function(e){e.value.replace(/.*?:\/\//g,"")===dt.getDefaultUtcTimingSource().value.replace(/.*?:\/\//g,"")&&(e.value=e.value.replace(a?new RegExp(/^(http:)?\/\//i):new RegExp(/^(https:)?\/\//i),a?"https://":"http://"),Le.debug("Matching default timing source protocol to manifest protocol: ",e.value))}),je.filterUnsupportedFeatures(t).then(function(){Ye.initialize(t),qe.attemptSync(r,Ue.getIsDynamic())})}}function fe(){return!!tt&&tt.getHasVideoTrack()}function de(){return!!tt&&tt.getHasAudioTrack()}function he(e){tt&&(ft.initialize(Ee()),w(e,!1))}function ge(e,t){t=t||new Date,$().forEach(function(n){n.finalisePlayList(t,e)}),Ge.addPlayList()}function pe(e){Ge.createPlaylistMetrics(1e3*ft.getTime(),e)}function me(e){if(e.error){var t="";switch(e.error.code){case 1:t="MEDIA_ERR_ABORTED";break;case 2:t="MEDIA_ERR_NETWORK";break;case 3:t="MEDIA_ERR_DECODE",St.counts.mediaErrorDecode+=1;break;case 4:t="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:t="MEDIA_ERR_ENCRYPTED";break;default:t="UNKNOWN"}"MEDIA_ERR_DECODE"===t&&_t.get().errors.recoverAttempts.mediaErrorDecode>=St.counts.mediaErrorDecode?ye():(st=!0,e.error.message&&(t+=" ("+e.error.message+")"),e.error.msExtendedCode&&(t+=" (0x"+(e.error.msExtendedCode>>>0).toString(16).toUpperCase()+")"),Le.fatal("Video Element Error: "+t),e.error&&Le.fatal(e.error),$e.error(new A.default(e.error.code,t)),we())}}function ye(){Le.warn("A MEDIA_ERR_DECODE occured: Resetting the MediaSource");var e=ft.getTime();tt.deactivate(!1),Le.warn("MediaSource has been resetted. Resuming playback from time ".concat(e)),w(e,!1)}function Ee(){return tt?tt.getStreamInfo():null}function _e(){return ot}function ve(){return st||ut}function Te(e){for(var t=0,n=et.length;t<n;t++)if(et[t].getId()===e)return et[t];return null}function Se(){if(!(ke&&ke.hasOwnProperty("load")&&Ze&&Ze.hasOwnProperty("initialize")&&Ze.hasOwnProperty("reset")&&Ze.hasOwnProperty("getClientTimeOffset")&&Be&&$e&&Ge&&ft))throw new Error(c.default.MISSING_CONFIG_ERROR)}function be(){if(!xe||!xe.hasOwnProperty("setManifest"))throw new Error("initialize function has to be called previously")}function Ae(e){Se(),ke.load(e)}function Re(e){be(),xe.setManifest(e)}function Ie(e){isNaN(e.newDuration)||ne(e.newDuration)}function Ce(e){e&&(e.capabilities&&(Fe=e.capabilities),e.capabilitiesFilter&&(je=e.capabilitiesFilter),e.manifestLoader&&(ke=e.manifestLoader),e.manifestModel&&(Be=e.manifestModel),e.mediaPlayerModel&&(dt=e.mediaPlayerModel),e.protectionController&&(nt=e.protectionController),e.adapter&&(Ue=e.adapter),e.dashMetrics&&(Ge=e.dashMetrics),e.errHandler&&($e=e.errHandler),e.timelineConverter&&(Ze=e.timelineConverter),e.videoModel&&(ct=e.videoModel),e.playbackController&&(ft=e.playbackController),e.textController&&(rt=e.textController),e.abrController&&(We=e.abrController),e.mediaController&&(ze=e.mediaController),e.settings&&(_t=e.settings),e.baseURLController&&(Ye=e.baseURLController),e.uriFragmentModel&&(Ve=e.uriFragmentModel),e.segmentBaseController&&(Ke=e.segmentBaseController))}function Ne(e){at=e,nt&&nt.setProtectionData(at)}function De(){et=[],nt=null,ot=!1,tt=null,st=!1,ut=!1,gt=!0,ht=!1,it=!0,pt=null,vt=!1,Et=!1,yt=[],Tt=null,St={counts:{mediaErrorDecode:0}}}function we(){Se(),qe.reset(),ge(st||ut?y.PlayListTrace.FAILURE_STOP_REASON:y.PlayListTrace.USER_REQUEST_STOP_REASON);for(var e=0,t=et?et.length:0;e<t;e++){var n=et[e];n.reset(st)}a(),Ye.reset(),xe.reset(),Xe.reset(),Ge.clearAllCurrentMetrics(),Be.setValue(null),ke.reset(),Ze.reset(),Qe.reset(),lt&&(He.detachMediaSource(ct),lt=null),ct=null,nt&&(nt=null,at=null,Be.getValue()&&At.trigger(p.default.PROTECTION_DESTROYED,{data:Be.getValue().url})),Q(),At.trigger(p.default.STREAM_TEARDOWN_COMPLETE),De()}function Oe(e){if(e.metric===f.default.DVR_INFO){var t=de()?c.default.AUDIO:c.default.VIDEO;e.mediaType===t&&He.setSeekable(e.value.range.start,e.value.range.end)}}function Me(){return et}var Pe,Le,Fe,je,xe,ke,Be,Ue,Ge,He,qe,Ye,Ke,Ve,We,ze,Xe,Qe,Je,$e,Ze,et,tt,nt,rt,at,it,ot,st,ut,lt,ct,ft,dt,ht,gt,pt,mt,yt,Et,_t,vt,Tt,St,bt=this.context,At=Object(g.default)(bt).getInstance();return Pe={initialize:t,getActiveStreamInfo:Ee,addDVRMetric:G,hasVideoTrack:fe,hasAudioTrack:de,getStreamById:Te,getStreamForTime:U,getTimeRelativeToStreamId:J,load:Ae,loadWithManifest:Re,getActiveStreamProcessors:$,setConfig:Ce,setProtectionData:Ne,getIsStreamSwitchInProgress:_e,switchToVideoElement:he,getHasMediaOrInitialisationError:ve,getStreams:Me,getActiveStream:re,getInitialPlayback:ae,getAutoPlay:ie,reset:we},e(),Pe}n.r(t);var c=n("./src/streaming/constants/Constants.js"),f=n("./src/streaming/constants/MetricsConstants.js"),d=n("./src/streaming/Stream.js"),h=n("./src/streaming/ManifestUpdater.js"),g=n("./src/core/EventBus.js"),p=n("./src/core/events/Events.js"),m=n("./src/core/FactoryMaker.js"),y=n("./src/streaming/vo/metrics/PlayList.js"),E=n("./src/core/Debug.js"),_=n("./src/streaming/utils/InitCache.js"),v=n("./src/streaming/utils/URLUtils.js"),T=n("./src/streaming/MediaPlayerEvents.js"),S=n("./src/streaming/controllers/TimeSyncController.js"),b=n("./src/streaming/controllers/MediaSourceController.js"),A=n("./src/streaming/vo/DashJSError.js"),R=n("./src/core/errors/Errors.js"),I=n("./src/streaming/controllers/EventController.js"),C=n("./src/streaming/constants/ConformanceViolationConstants.js"),N=200,D=2;l.__dashjs_factory_name="StreamController",t.default=m.default.getSingletonFactory(l)},"./src/streaming/controllers/TimeSyncController.js":function(e,t,n){function r(){function e(){G=Object(c.default)(ne).getInstance().getLogger(U),re.on(s.default.ATTEMPT_BACKGROUND_SYNC,v,U)}function t(e){e&&(e.dashMetrics&&(V=e.dashMetrics),e.baseURLController&&(te=e.baseURLController),e.errHandler&&(ee=e.errHandler),e.settings&&(Y=e.settings))}function n(){W=[],z=[],X=null,Q=null,$=null,J=NaN,H=!1,q=!1,Z=Y.get().streaming.utcSynchronization.timeBetweenSyncAttempts}function r(){n(),K={"urn:mpeg:dash:utc:http-head:2014":P,"urn:mpeg:dash:utc:http-xsdate:2014":M.bind(null,C),"urn:mpeg:dash:utc:http-iso:2014":M.bind(null,N),"urn:mpeg:dash:utc:direct:2014":O,"urn:mpeg:dash:utc:http-head:2012":P,"urn:mpeg:dash:utc:http-xsdate:2012":M.bind(null,C),"urn:mpeg:dash:utc:http-iso:2012":M.bind(null,N),"urn:mpeg:dash:utc:direct:2012":O,"urn:mpeg:dash:utc:http-ntp:2014":w,"urn:mpeg:dash:utc:ntp:2014":w,"urn:mpeg:dash:utc:sntp:2014":w}}function l(e,t){z=e,H||(A(t)?(H=!0,S()):re.trigger(s.default.TIME_SYNCHRONIZATION_COMPLETED))}function v(){if(Y.get().streaming.utcSynchronization.enabled&&!H&&!q&&$&&$.value&&$.schemeIdUri&&!isNaN(J)&&!isNaN(Y.get().streaming.utcSynchronization.backgroundAttempts)&&!(Q&&(Date.now()-Q)/1e3<y)){W=[],q=!0;var e=isNaN(Y.get().streaming.utcSynchronization.backgroundAttempts)?p:Y.get().streaming.utcSynchronization.backgroundAttempts;T(e)}}function T(e){try{if(e<=0)return void x();var t=Date.now();K[$.schemeIdUri]($.value,function(n){var r=Date.now(),a=b(t,r,n);W.push(a),T(e-1)},function(){x()})}catch(e){x()}}function S(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=e||0;if(!z||0===z.length||t>=z.length)R();else{var n=z[t];if(n)if(K.hasOwnProperty(n.schemeIdUri)){var r=(new Date).getTime();K[n.schemeIdUri](n.value,function(e){var t=(new Date).getTime(),a=b(r,t,e);$=n,R(a)},function(){S(t+1)})}else S(t+1);else R()}}function b(e,t,n){var r=t-(t-e)/2;return n-r}function A(e){try{if(!e||!Y.get().streaming.utcSynchronization.enabled)return!1;var t=isNaN(Z)?m:Z;return!(X&&t&&!isNaN(t))||(Date.now()-X)/1e3>=t}catch(e){return!0}}function R(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,t=isNaN(e);t&&Y.get().streaming.utcSynchronization.useManifestDateHeaderTimeSource?L():F(t,e)}function I(e){var t,n,r=60,a=60,i=1e3,o=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/,s=o.exec(e);return t=Date.UTC(parseInt(s[1],10),parseInt(s[2],10)-1,parseInt(s[3],10),parseInt(s[4],10),parseInt(s[5],10),s[6]&&(parseInt(s[6],10)||0),s[7]&&parseFloat(s[7])*i||0),s[9]&&s[10]&&(n=parseInt(s[9],10)*a+parseInt(s[10],10),t+=("+"===s[8]?-1:1)*n*r*i),new Date(t).getTime()}function C(e){var t=Date.parse(e);return isNaN(t)&&(t=I(e)),t}function N(e){return Date.parse(e)}function D(e){return Date.parse(e)}function w(e,t,n){n()}function O(e,t,n){var r=C(e);isNaN(r)?n():t(r)}function M(e,t,n,r,a){var o,s,u=!1,l=new XMLHttpRequest,c=a?i.HTTPRequest.HEAD:i.HTTPRequest.GET,f=t.match(/\S+/g);if(t=f.shift(),o=function(){u||(u=!0,f.length?M(e,f.join(" "),n,r,a):r())},s=function(){var t,r;200===l.status&&(t=a?l.getResponseHeader("Date"):l.response,r=e(t),isNaN(r)||(n(r),u=!0))},ae.isRelative(t)){var h=te.resolve();h&&(t=ae.resolve(t,h.url))}l.open(c,t),l.timeout=d,l.onload=s,l.onloadend=o,l.send()}function P(e,t,n){M(D,e,t,n,!0)}function L(){var e=V.getLatestMPDRequestHeaderValueByID("Date"),t=null!==e?new Date(e).getTime():Number.NaN;if(isNaN(t))F(!0);else{var n=t-Date.now();F(!1,n)}}function F(e,t){if(isNaN(J)||isNaN(t)||e||j(t),!e&&!isNaN(t)){X=Date.now(),H=!1;var n=isNaN(J);J=t,n&&v(),G.debug("Completed UTC sync. Setting client - server offset to ".concat(t))}e&&($=null,H=!1,ee.error(new a.default(u.default.TIME_SYNC_FAILED_ERROR_CODE,u.default.TIME_SYNC_FAILED_ERROR_MESSAGE))),re.trigger(s.default.UPDATE_TIME_SYNC_OFFSET,{offset:t}),re.trigger(s.default.TIME_SYNCHRONIZATION_COMPLETED)}function j(e){try{var t,n=k(e),r=isNaN(Z)?m:Z,a=isNaN(Y.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor)?g:Y.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor,i=isNaN(Y.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts)?E:Y.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts,o=isNaN(Y.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts)?_:Y.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts;n?(t=Math.min(r*a,i),G.debug("Increasing timeBetweenSyncAttempts to ".concat(t))):(t=Math.max(r/a,o),G.debug("Decreasing timeBetweenSyncAttempts to ".concat(t))),Z=t}catch(e){}}function x(){if(W&&0!==W.length){var e=W.reduce(function(e,t){return e+t},0)/W.length;k(e)?G.debug("Completed background UTC sync. Offset is within allowed threshold and is not adjusted."):(G.debug("Completed background UTC sync. Setting client - server offset to ".concat(e)),J=e,re.trigger(s.default.UPDATE_TIME_SYNC_OFFSET,{offset:J})),q=!1,Q=Date.now()}}function k(e){try{if(isNaN(J))return!0;var t=Y.get().streaming.utcSynchronization.maximumAllowedDrift&&!isNaN(Y.get().streaming.utcSynchronization.maximumAllowedDrift)?Y.get().streaming.utcSynchronization.maximumAllowedDrift:h,n=J-t,r=J+t;return e>=n&&e<=r}catch(e){return!0}}function B(){n(),re.off(s.default.ATTEMPT_BACKGROUND_SYNC,v,U)}var U,G,H,q,Y,K,V,W,z,X,Q,J,$,Z,ee,te,ne=this.context,re=Object(o.default)(ne).getInstance(),ae=Object(f.default)(ne).getInstance();return U={initialize:r,attemptSync:l,setConfig:t,reset:B},e(),U}n.r(t);var a=n("./src/streaming/vo/DashJSError.js"),i=n("./src/streaming/vo/metrics/HTTPRequest.js"),o=n("./src/core/EventBus.js"),s=n("./src/core/events/Events.js"),u=n("./src/core/errors/Errors.js"),l=n("./src/core/FactoryMaker.js"),c=n("./src/core/Debug.js"),f=n("./src/streaming/utils/URLUtils.js"),d=5e3,h=100,g=2,p=2,m=30,y=30,E=600,_=2;r.__dashjs_factory_name="TimeSyncController";var v=l.default.getSingletonFactory(r);v.HTTP_TIMEOUT_MS=d,l.default.updateSingletonFactory(r.__dashjs_factory_name,v),t.default=v},"./src/streaming/controllers/XlinkController.js":function(e,t,n){function r(e){function t(){w.on(o.default.XLINK_ELEMENT_LOADED,m,b),N=Object(a.default)(D).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,settings:e.settings})}function n(e){e&&(A=e)}function r(e){e&&(R=e)}function s(e){var t;C=new u.default({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:A}),I=e,I.Period_asArray?(t=E(I.Period_asArray,I,c.default.PERIOD,f),p(t,c.default.PERIOD,f)):w.trigger(o.default.XLINK_READY,{manifest:I})}function g(){w.off(o.default.XLINK_ELEMENT_LOADED,m,b),N&&(N.reset(),N=null)}function p(e,t,n){var r,a,i={};i.elements=e,i.type=t,i.resolveType=n,0===i.elements.length&&y(i);for(var o=0;o<i.elements.length;o++)r=i.elements[o],a=O.isHTTPURL(r.url)?r.url:r.originalContent.BaseURL+r.url,N.load(a,r,i)}function m(e){var t,n,r="<response>",a="</response>",i="";if(t=e.element,n=e.resolveObject,t.resolvedContent){var o=0;0===t.resolvedContent.indexOf("<?xml")&&(o=t.resolvedContent.indexOf("?>")+2),i=t.resolvedContent.substr(0,o)+r+t.resolvedContent.substr(o)+a,t.resolvedContent=C.xml_str2json(i)}T(n)&&y(n)}function y(e){var t,n,r=[];if(_(e),e.resolveType===d&&w.trigger(o.default.XLINK_READY,{manifest:I}),e.resolveType===f)switch(e.type){case c.default.PERIOD:for(t=0;t<I[c.default.PERIOD+"_asArray"].length;t++)n=I[c.default.PERIOD+"_asArray"][t],n.hasOwnProperty(c.default.ADAPTATION_SET+"_asArray")&&(r=r.concat(E(n[c.default.ADAPTATION_SET+"_asArray"],n,c.default.ADAPTATION_SET,f))),n.hasOwnProperty(c.default.EVENT_STREAM+"_asArray")&&(r=r.concat(E(n[c.default.EVENT_STREAM+"_asArray"],n,c.default.EVENT_STREAM,f)));p(r,c.default.ADAPTATION_SET,f);break;case c.default.ADAPTATION_SET:w.trigger(o.default.XLINK_READY,{manifest:I})}}function E(e,t,n,r){var a,i,o,s=[];for(i=e.length-1;i>=0;i--)a=e[i],a.hasOwnProperty("xlink:href")&&a["xlink:href"]===h&&e.splice(i,1);for(i=0;i<e.length;i++)a=e[i],a.hasOwnProperty("xlink:href")&&a.hasOwnProperty("xlink:actuate")&&a["xlink:actuate"]===r&&(o=v(a["xlink:href"],t,n,i,r,a),s.push(o));return s}function _(e){var t,n,r,a,i,o,s=[];for(a=e.elements.length-1;a>=0;a--){if(t=e.elements[a],n=t.type+"_asArray",!t.resolvedContent||S())delete t.originalContent["xlink:actuate"],delete t.originalContent["xlink:href"],s.push(t.originalContent);else if(t.resolvedContent)for(i=0;i<t.resolvedContent[n].length;i++)r=t.resolvedContent[n][i],s.push(r);for(t.parentElement[n].splice(t.index,1),o=0;o<s.length;o++)t.parentElement[n].splice(t.index+o,0,s[o]);s=[]}e.elements.length>0&&R.run(I)}function v(e,t,n,r,a,i){return{url:e,parentElement:t,type:n,index:r,resolveType:a,originalContent:i,resolvedContent:null,resolved:!1}}function T(e){var t,n;for(t=0;t<e.elements.length;t++)if(n=e.elements[t],!1===n.resolved)return!1;return!0}function S(){return!1}e=e||{};var b,A,R,I,C,N,D=this.context,w=Object(i.default)(D).getInstance(),O=Object(l.default)(D).getInstance();return b={resolveManifestOnLoad:s,setMatchers:n,setIron:r,reset:g},t(),b}n.r(t);var a=n("./src/streaming/XlinkLoader.js"),i=n("./src/core/EventBus.js"),o=n("./src/core/events/Events.js"),s=n("./src/core/FactoryMaker.js"),u=n("./externals/xml2json.js"),l=n("./src/streaming/utils/URLUtils.js"),c=n("./src/dash/constants/DashConstants.js"),f="onLoad",d="onActuate",h="urn:mpeg:dash:resolve-to-zero:2013";r.__dashjs_factory_name="XlinkController",t.default=s.default.getClassFactory(r)},"./src/streaming/metrics/MetricsReporting.js":function(e,t,n){function r(){function e(e){return i=Object(a.default)(l).getInstance({eventBus:e.eventBus,dashMetrics:e.dashMetrics,metricsConstants:e.metricsConstants,events:e.events}),i.initialise(),Object(o.default)(l).create(e)}function t(){return Object(u.default)(l).getInstance()}function n(){return Object(s.default)(l).getInstance()}var r,i,l=this.context;return r={createMetricsReporting:e,getReportingFactory:t,getMetricsHandlerFactory:n},r}n.r(t);var a=n("./src/streaming/metrics/utils/DVBErrorsTranslator.js"),i=n("./src/streaming/metrics/MetricsReportingEvents.js"),o=n("./src/streaming/metrics/controllers/MetricsCollectionController.js"),s=n("./src/streaming/metrics/metrics/MetricsHandlerFactory.js"),u=n("./src/streaming/metrics/reporting/ReportingFactory.js");r.__dashjs_factory_name="MetricsReporting";var l=dashjs.FactoryMaker.getClassFactory(r);l.events=i.default,dashjs.FactoryMaker.updateClassFactory(r.__dashjs_factory_name,l),t.default=l},"./src/streaming/metrics/MetricsReportingEvents.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function s(e){var t=c();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}n.r(t);var d=n("./src/core/events/EventsBase.js"),h=function(e){function t(){var e;return a(this,t),e=n.call(this),e.METRICS_INITIALISATION_COMPLETE="internal_metricsReportingInitialized",e.BECAME_REPORTING_PLAYER="internal_becameReportingPlayer",e.CMCD_DATA_GENERATED="cmcdDataGenerated",e}i(t,e);var n=s(t);return t}(d.default),g=new h;t.default=g},"./src/streaming/metrics/controllers/MetricsCollectionController.js":function(e,t,n){function r(e){function t(t){if(!t.error){var n=Object.keys(l),r=Object(i.default)(c).getInstance({adapter:e.adapter,constants:e.constants}).getMetrics(t.manifest);r.forEach(function(t){var r=JSON.stringify(t);if(l.hasOwnProperty(r))n.splice(r,1);else try{var i=Object(a.default)(c).create(e);i.initialize(t),l[r]=i}catch(e){}}),n.forEach(function(e){l[e].reset(),delete l[e]}),
f.trigger(o.default.METRICS_INITIALISATION_COMPLETE)}}function n(){Object.keys(l).forEach(function(e){l[e].reset()}),l={}}function r(){f.on(d.MANIFEST_UPDATED,t,u),f.on(d.STREAM_TEARDOWN_COMPLETE,n,u)}function s(){f.off(d.MANIFEST_UPDATED,t,u),f.off(d.STREAM_TEARDOWN_COMPLETE,n,u)}var u;e=e||{};var l={},c=this.context,f=e.eventBus,d=e.events;return u={reset:s},r(),u}n.r(t);var a=n("./src/streaming/metrics/controllers/MetricsController.js"),i=n("./src/streaming/metrics/utils/ManifestParsing.js"),o=n("./src/streaming/metrics/MetricsReportingEvents.js");r.__dashjs_factory_name="MetricsCollectionController",t.default=dashjs.FactoryMaker.getClassFactory(r)},"./src/streaming/metrics/controllers/MetricsController.js":function(e,t,n){function r(e){function t(t){try{u=Object(a.default)(c).create({mediaElement:e.mediaElement}),u.initialize(t.Range),s=Object(i.default)(c).create({debug:e.debug,metricsConstants:e.metricsConstants}),s.initialize(t.Reporting,u),r=Object(o.default)(c).create({debug:e.debug,eventBus:e.eventBus,metricsConstants:e.metricsConstants,events:e.events}),r.initialize(t.metrics,s)}catch(e){throw n(),e}}function n(){r&&r.reset(),s&&s.reset(),u&&u.reset()}var r,s,u,l;e=e||{};var c=this.context;return l={initialize:t,reset:n},l}n.r(t);var a=n("./src/streaming/metrics/controllers/RangeController.js"),i=n("./src/streaming/metrics/controllers/ReportingController.js"),o=n("./src/streaming/metrics/controllers/MetricsHandlersController.js");r.__dashjs_factory_name="MetricsController",t.default=dashjs.FactoryMaker.getClassFactory(r)},"./src/streaming/metrics/controllers/MetricsHandlersController.js":function(e,t,n){function r(e){function t(e){o.forEach(function(t){t.handleNewMetric(e.metric,e.value,e.mediaType)})}function n(e,n){e.split(",").forEach(function(e,t,r){var a;if(-1!==e.indexOf("(")&&-1===e.indexOf(")")){var i=r[t+1];i&&-1===i.indexOf("(")&&-1!==i.indexOf(")")&&(e+=","+i,delete r[t+1])}a=c.create(e,n),a&&o.push(a)}),u.on(l.METRIC_ADDED,t,i),u.on(l.METRIC_UPDATED,t,i)}function r(){u.off(l.METRIC_ADDED,t,i),u.off(l.METRIC_UPDATED,t,i),o.forEach(function(e){return e.reset()}),o=[]}e=e||{};var i,o=[],s=this.context,u=e.eventBus,l=e.events,c=Object(a.default)(s).getInstance({debug:e.debug,eventBus:e.eventBus,metricsConstants:e.metricsConstants});return i={initialize:n,reset:r},i}n.r(t);var a=n("./src/streaming/metrics/metrics/MetricsHandlerFactory.js");r.__dashjs_factory_name="MetricsHandlersController",t.default=dashjs.FactoryMaker.getClassFactory(r)},"./src/streaming/metrics/controllers/RangeController.js":function(e,t,n){function r(e){function t(e){e&&e.length&&(e.forEach(function(e){var t=e.starttime,n=t+e.duration;s.add(t,n)}),u=!!e[0]._useWallClockTime)}function n(){s.clear()}function r(){s=Object(a.default)(l).create()}function i(){var e,t=s.length;if(!t)return!0;e=u?(new Date).getTime()/1e3:c.currentTime;for(var n=0;n<t;n+=1){var r=s.start(n),a=s.end(n);if(r<=e&&e<a)return!0}return!1}e=e||{};var o,s,u=!1,l=this.context,c=e.mediaElement;return o={initialize:t,reset:n,isEnabled:i},r(),o}n.r(t);var a=n("./src/streaming/utils/CustomTimeRanges.js");r.__dashjs_factory_name="RangeController",t.default=dashjs.FactoryMaker.getClassFactory(r)},"./src/streaming/metrics/controllers/ReportingController.js":function(e,t,n){function r(e){function t(e,t){e.some(function(e){var n=s.create(e,t);if(n)return o.push(n),!0})}function n(){o.forEach(function(e){return e.reset()}),o=[]}function r(e,t){o.forEach(function(n){return n.report(e,t)})}var i,o=[],s=Object(a.default)(this.context).getInstance(e);return i={initialize:t,reset:n,report:r},i}n.r(t);var a=n("./src/streaming/metrics/reporting/ReportingFactory.js");r.__dashjs_factory_name="ReportingController",t.default=dashjs.FactoryMaker.getClassFactory(r)},"./src/streaming/metrics/metrics/MetricsHandlerFactory.js":function(e,t,n){function r(e){function t(t,n){var r,a=t.match(c);if(a){try{r=d[a[1]](f).create({eventBus:e.eventBus,metricsConstants:e.metricsConstants}),r.initialize(a[1],n,a[3],a[5])}catch(e){r=null,l.error("MetricsHandlerFactory: Could not create handler for type ".concat(a[1]," with args ").concat(a[3],", ").concat(a[5]," (").concat(e.message,")"))}return r}}function n(e,t){d[e]=t}function r(e){delete d[e]}var u;e=e||{};var l=e.debug?e.debug.getLogger(u):{},c=/([a-zA-Z]*)(\(([0-9]*)(\,\s*([a-zA-Z]*))?\))?/,f=this.context,d={BufferLevel:a.default,DVBErrors:i.default,HttpList:o.default,PlayList:s.default,RepSwitchList:s.default,TcpList:s.default};return u={create:t,register:n,unregister:r},u}n.r(t);var a=n("./src/streaming/metrics/metrics/handlers/BufferLevelHandler.js"),i=n("./src/streaming/metrics/metrics/handlers/DVBErrorsHandler.js"),o=n("./src/streaming/metrics/metrics/handlers/HttpListHandler.js"),s=n("./src/streaming/metrics/metrics/handlers/GenericMetricHandler.js");r.__dashjs_factory_name="MetricsHandlerFactory",t.default=dashjs.FactoryMaker.getSingletonFactory(r)},"./src/streaming/metrics/metrics/handlers/BufferLevelHandler.js":function(e,t,n){function r(e){function t(){try{return Object.keys(p).map(function(e){return p[e]}).reduce(function(e,t){return e.level<t.level?e:t})}catch(e){return}}function n(){var e=t();e&&d!==e.t&&(d=e.t,u.report(c,e))}function r(e,t,r){t&&(l=g.validateN(r),u=t,c=g.reconstructFullMetricName(e,r),f=setInterval(n,l))}function i(){clearInterval(f),f=null,l=0,u=null,d=null}function o(e,t,n){e===m.BUFFER_LEVEL&&(p[n]=t)}var s,u,l,c,f,d;e=e||{};var h=this.context,g=Object(a.default)(h).getInstance(),p=[],m=e.metricsConstants;return s={initialize:r,reset:i,handleNewMetric:o},s}n.r(t);var a=n("./src/streaming/metrics/utils/HandlerHelpers.js");r.__dashjs_factory_name="BufferLevelHandler",t.default=dashjs.FactoryMaker.getClassFactory(r)},"./src/streaming/metrics/metrics/handlers/DVBErrorsHandler.js":function(e,t,n){function r(e){function t(){u.off(a.default.METRICS_INITIALISATION_COMPLETE,t,this),u.trigger(a.default.BECAME_REPORTING_PLAYER)}function n(e,n){n&&(s=n,u.on(a.default.METRICS_INITIALISATION_COMPLETE,t,this))}function r(){s=null}function i(e,t){e===l.DVB_ERRORS&&s&&s.report(e,t)}var o,s;e=e||{};var u=e.eventBus,l=e.metricsConstants;return o={initialize:n,reset:r,handleNewMetric:i},o}n.r(t);var a=n("./src/streaming/metrics/MetricsReportingEvents.js");t.default=dashjs.FactoryMaker.getClassFactory(r)},"./src/streaming/metrics/metrics/handlers/GenericMetricHandler.js":function(e,t,n){function r(){function e(e,t){a=e,i=t}function t(){i=null,a=void 0}function n(e,t){e===a&&i&&i.report(a,t)}var r,a,i;return r={initialize:e,reset:t,handleNewMetric:n},r}n.r(t),r.__dashjs_factory_name="GenericMetricHandler",t.default=dashjs.FactoryMaker.getClassFactory(r)},"./src/streaming/metrics/metrics/handlers/HttpListHandler.js":function(e,t,n){function r(e){function t(){var e=d;e.length&&s&&s.report(c,e),d=[]}function n(e,n,r,a){n&&(u=h.validateN(r),s=n,a&&a.length&&(l=a),c=h.reconstructFullMetricName(e,r,a),f=setInterval(t,u))}function r(){clearInterval(f),f=null,u=null,l=null,d=[],s=null}function i(e,t){e===g.HTTP_REQUEST&&(l&&l!==t.type||d.push(t))}var o,s,u,l,c,f;e=e||{};var d=[],h=Object(a.default)(this.context).getInstance(),g=e.metricsConstants;return o={initialize:n,reset:r,handleNewMetric:i},o}n.r(t);var a=n("./src/streaming/metrics/utils/HandlerHelpers.js");r.__dashjs_factory_name="HttpListHandler",t.default=dashjs.FactoryMaker.getClassFactory(r)},"./src/streaming/metrics/reporting/ReportingFactory.js":function(e,t,n){function r(e){function t(e,t){var n;try{n=o[e.schemeIdUri](s).create({metricsConstants:l}),n.initialize(e,t)}catch(t){n=null,u.error("ReportingFactory: could not create Reporting with schemeIdUri ".concat(e.schemeIdUri," (").concat(t.message,")"))}return n}function n(e,t){o[e]=t}function r(e){delete o[e]}e=e||{};var i,o={"urn:dvb:dash:reporting:2014":a.default},s=this.context,u=e.debug?e.debug.getLogger(i):{},l=e.metricsConstants;return i={create:t,register:n,unregister:r},i}n.r(t);var a=n("./src/streaming/metrics/reporting/reporters/DVBReporting.js");r.__dashjs_factory_name="ReportingFactory",t.default=dashjs.FactoryMaker.getSingletonFactory(r)},"./src/streaming/metrics/reporting/reporters/DVBReporting.js":function(e,t,n){function r(e){function t(){c=Object(a.default)(m).getInstance(),f=Object(i.default)(m).getInstance(),s()}function n(e,t,n){var r=new XMLHttpRequest,a=function(){var e=y.indexOf(r);-1!==e&&(y.splice(e,1),r.status>=200&&r.status<300?t&&t():n&&n())};y.push(r);try{r.open("GET",e),r.onloadend=a,r.onerror=a,r.send()}catch(e){r.onerror()}}function r(e,t){Array.isArray(t)||(t=[t]),h&&p.isEnabled()&&t.forEach(function(t){var r=c.serialise(t);e!==E.DVB_ERRORS&&(r="metricname=".concat(e,"&").concat(r)),r="".concat(g,"?").concat(r),n(r,null,function(){h=!1})})}function o(e,t){var n;if(p=t,g=e.dvb_reportingUrl,!g)throw new Error("required parameter missing (dvb:reportingUrl)");d||(n=e.dvb_probability,n&&(1e3===n||n/1e3>=f.random())&&(h=!0),d=!0)}function s(){d=!1,h=!1,g=null,p=null}function u(){s()}var l;e=e||{};var c,f,d,h,g,p,m=this.context,y=[],E=e.metricsConstants;return l={report:r,initialize:o,reset:u},t(),l}n.r(t);var a=n("./src/streaming/metrics/utils/MetricSerialiser.js"),i=n("./src/streaming/metrics/utils/RNG.js");r.__dashjs_factory_name="DVBReporting",t.default=dashjs.FactoryMaker.getClassFactory(r)},"./src/streaming/metrics/utils/DVBErrorsTranslator.js":function(e,t,n){function r(e){function t(e){var t=new a.default;if(h){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.mpdurl||(t.mpdurl=h.originalUrl||h.url),t.terror||(t.terror=new Date),p.addDVBErrors(t)}}function n(e){e.error||(h=e.manifest)}function r(e){t({errorcode:a.default.BASE_URL_CHANGED,servicelocation:e.entry})}function o(){t({errorcode:a.default.BECAME_REPORTER})}function s(e){(0===e.responsecode||null==e.responsecode||e.responsecode>=400||e.responsecode<100||e.responsecode>=600)&&t({errorcode:e.responsecode||a.default.CONNECTION_ERROR,url:e.url,terror:e.tresponse,servicelocation:e._serviceLocation})}function u(e){switch(e.metric){case m.HTTP_REQUEST:s(e.value)}}function l(e){var n,r=e.error?e.error.code:0;switch(r){case MediaError.MEDIA_ERR_NETWORK:n=a.default.CONNECTION_ERROR;break;case MediaError.MEDIA_ERR_DECODE:n=a.default.CORRUPT_MEDIA_OTHER;break;default:return}t({errorcode:n})}function c(){g.on(y.MANIFEST_UPDATED,n,d),g.on(y.SERVICE_LOCATION_BLACKLIST_CHANGED,r,d),g.on(y.METRIC_ADDED,u,d),g.on(y.METRIC_UPDATED,u,d),g.on(y.PLAYBACK_ERROR,l,d),g.on(i.default.BECAME_REPORTING_PLAYER,o,d)}function f(){g.off(y.MANIFEST_UPDATED,n,d),g.off(y.SERVICE_LOCATION_BLACKLIST_CHANGED,r,d),g.off(y.METRIC_ADDED,u,d),g.off(y.METRIC_UPDATED,u,d),g.off(y.PLAYBACK_ERROR,l,d),g.off(i.default.BECAME_REPORTING_PLAYER,o,d)}var d,h;e=e||{};var g=e.eventBus,p=e.dashMetrics,m=e.metricsConstants,y=e.events;return d={initialise:c,reset:f},d}n.r(t);var a=n("./src/streaming/metrics/vo/DVBErrors.js"),i=n("./src/streaming/metrics/MetricsReportingEvents.js");r.__dashjs_factory_name="DVBErrorsTranslator",t.default=dashjs.FactoryMaker.getSingletonFactory(r)},"./src/streaming/metrics/utils/HandlerHelpers.js":function(e,t,n){function r(){return{reconstructFullMetricName:function(e,t,n){var r=e;return t&&(r+="("+t,n&&n.length&&(r+=","+n),r+=")"),r},validateN:function(e){if(!e)throw new Error("missing n");if(isNaN(e))throw new Error("n is NaN");if(e<0)throw new Error("n must be positive");return e}}}n.r(t),r.__dashjs_factory_name="HandlerHelpers",t.default=dashjs.FactoryMaker.getSingletonFactory(r)},"./src/streaming/metrics/utils/ManifestParsing.js":function(e,t,n){function r(e){function t(e,t,n){var r,a,i=0;return t?i=s.getAvailabilityStartTime(e)/1e3:(r=s.getRegularPeriods(e),r.length&&(i=r[0].start)),a=i,n&&n.hasOwnProperty(u.START_TIME)&&(a+=n.starttime),a}function n(e){var n=[];return e&&e.Metrics_asArray&&e.Metrics_asArray.forEach(function(r){var l=new a.default,c=s.getIsDynamic(e);r.hasOwnProperty("metrics")&&(l.metrics=r.metrics,r.Range_asArray&&r.Range_asArray.forEach(function(n){var r=new i.default;r.starttime=t(e,c,n),n.hasOwnProperty("duration")?r.duration=n.duration:r.duration=s.getDuration(e),r._useWallClockTime=c,l.Range.push(r)}),r.Reporting_asArray&&(r.Reporting_asArray.forEach(function(e){var t=new o.default;e.hasOwnProperty(u.SCHEME_ID_URI)&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty("value")&&(t.value=e.value),e.hasOwnProperty(u.DVB_REPORTING_URL)&&(t.dvb_reportingUrl=e[u.DVB_REPORTING_URL]),e.hasOwnProperty(u.DVB_PROBABILITY)&&(t.dvb_probability=e[u.DVB_PROBABILITY]),l.Reporting.push(t))}),n.push(l)))}),n}var r;e=e||{};var s=e.adapter,u=e.constants;return r={getMetrics:n},r}n.r(t);var a=n("./src/streaming/metrics/vo/Metrics.js"),i=n("./src/streaming/metrics/vo/Range.js"),o=n("./src/streaming/metrics/vo/Reporting.js");r.__dashjs_factory_name="ManifestParsing",t.default=dashjs.FactoryMaker.getSingletonFactory(r)},"./src/streaming/metrics/utils/MetricSerialiser.js":function(e,t,n){function r(){function e(t){var n,r,a=[],i=[];for(n in t)if(t.hasOwnProperty(n)&&0!==n.indexOf("_")){if(r=t[n],null==r&&(r=""),Array.isArray(r)){if(!r.length)continue;i=[],r.forEach(function(t){var n="Object"!==Object.prototype.toString.call(t).slice(8,-1);i.push(n?t:e(t))}),r=i.map(encodeURIComponent).join(",")}else"string"==typeof r?r=encodeURIComponent(r):r instanceof Date?r=r.toISOString():"number"==typeof r&&(r=Math.round(r));a.push(n+"="+r)}return a.join("&")}return{serialise:e}}n.r(t),r.__dashjs_factory_name="MetricSerialiser",t.default=dashjs.FactoryMaker.getSingletonFactory(r)},"./src/streaming/metrics/utils/RNG.js":function(e,t,n){function r(){function e(){i&&(n||(n=new o(u)),i.getRandomValues(n),r=0)}function t(t,a){var o;return t||(t=0),a||(a=1),i?(r===n.length&&e(),o=n[r]/s,r+=1):o=Math.random(),o*(a-t)+t}var n,r,a,i=window.crypto||window.msCrypto,o=Uint32Array,s=Math.pow(2,8*o.BYTES_PER_ELEMENT)-1,u=10;return a={random:t},e(),a}n.r(t),r.__dashjs_factory_name="RNG",t.default=dashjs.FactoryMaker.getSingletonFactory(r)},"./src/streaming/metrics/vo/DVBErrors.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.mpdurl=null,this.errorcode=null,this.terror=null,this.url=null,this.ipaddress=null,this.servicelocation=null};a.SSL_CONNECTION_FAILED_PREFIX="SSL",a.DNS_RESOLUTION_FAILED="C00",a.HOST_UNREACHABLE="C01",a.CONNECTION_REFUSED="C02",a.CONNECTION_ERROR="C03",a.CORRUPT_MEDIA_ISOBMFF="M00",a.CORRUPT_MEDIA_OTHER="M01",a.BASE_URL_CHANGED="F00",a.BECAME_REPORTER="S00",t.default=a},"./src/streaming/metrics/vo/Metrics.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.metrics="",this.Range=[],this.Reporting=[]};t.default=a},"./src/streaming/metrics/vo/Range.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.starttime=0,this.duration=1/0,this._useWallClockTime=!1};t.default=a},"./src/streaming/metrics/vo/Reporting.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=1e3,i=function e(){r(this,e),this.schemeIdUri="",this.value="",this.dvb_reportingUrl="",this.dvb_probability=a};t.default=i},"./src/streaming/models/BaseURLTreeModel.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(){function e(){f()}function t(e){e.adapter&&(p=e.adapter)}function n(){if(!p||!p.hasOwnProperty("getBaseURLsFromElement")||!p.hasOwnProperty("getRepresentationSortFunction"))throw new Error("setConfig function has to be called previously")}function r(e,t,n){var r=p.getBaseURLsFromElement(n);e[t]?y.areEqual(r,e[t].data.baseUrls)||(e[t].data.baseUrls=r,e[t].data.selectedIdx=s):e[t]=new u(r)}function a(e){n();var t=p.getBaseURLsFromElement(e);y.areEqual(t,g.data.baseUrls)||(g.data.baseUrls=t,g.data.selectedIdx=s),e&&e.Period_asArray&&e.Period_asArray.forEach(function(e,t){r(g.children,t,e),e.AdaptationSet_asArray&&e.AdaptationSet_asArray.forEach(function(e,n){r(g.children[t].children,n,e),e.Representation_asArray&&e.Representation_asArray.sort(p.getRepresentationSortFunction()).forEach(function(e,a){r(g.children[t].children[n].children,a,e)})})})}function o(e,t){var n=t||g;e(n.data),n.children&&n.children.forEach(function(t){return o(e,t)})}function l(e){o(function(t){isNaN(t.selectedIdx)||e===t.baseUrls[t.selectedIdx].serviceLocation&&(t.selectedIdx=s)})}function c(e){a(e)}function f(){g=new u}function d(e){var t=g,n=[t.data];return e&&e.forEach(function(e){t=t.children[e],t&&n.push(t.data)}),n.filter(function(e){return e.baseUrls.length})}var h,g,p,m=this.context,y=Object(i.default)(m).getInstance();return h={reset:f,update:c,getForPath:d,invalidateSelectedIndexes:l,setConfig:t},e(),h}n.r(t);var i=n("./src/streaming/utils/ObjectUtils.js"),o=n("./src/core/FactoryMaker.js"),s=NaN,u=function e(t,n){r(this,e),this.data={baseUrls:t||null,selectedIdx:n||s},this.children=[]};a.__dashjs_factory_name="BaseURLTreeModel",t.default=o.default.getClassFactory(a)},"./src/streaming/models/CmcdModel.js":function(e,t,n){function r(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=a(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}}function a(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(){function e(){V=Object(g.default)(ne).getInstance(),a()}function t(){re.on(u.default.PLAYBACK_RATE_CHANGED,k,W),re.on(u.default.MANIFEST_LOADED,B,W),re.on(u.default.BUFFER_LEVEL_STATE_CHANGED,U,W),re.on(u.default.PLAYBACK_SEEKED,G,W),re.on(u.default.PERIOD_SWITCH_COMPLETED,i,W)}function n(e){e&&(e.abrController&&(X=e.abrController),e.dashMetrics&&(Q=e.dashMetrics),e.playbackController&&(J=e.playbackController))}function a(){z={pr:1,nor:null,st:null,sf:null,sid:"".concat(p.default.generateUuid()),cid:null},ee={},Z={},te={},o()}function i(){o()}function o(){if(J){var e=J.getStreamController();if(e&&"function"==typeof e.getActiveStream){var t=e.getActiveStream();t&&($=t.getProcessors())}}}function c(e){try{if(ae.get().streaming.cmcd&&ae.get().streaming.cmcd.enabled){var t=A(e),n=H(t);return re.trigger(l.default.CMCD_DATA_GENERATED,{url:e.url,mediaType:e.mediaType,cmcdData:t,cmcdString:n}),{key:m,value:n}}return null}catch(e){return null}}function S(e,t){var n,a={},i=r(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;e[o]&&(a[o]=e[o])}}catch(e){i.e(e)}finally{i.f()}return a}function b(e){try{if(ae.get().streaming.cmcd&&ae.get().streaming.cmcd.enabled){var t=A(e),n=S(t,["br","d","ot","tb"]),r=S(t,["bl","dl","mtp","nor","nrr","su"]),a=S(t,["bs","rtp"]),i=S(t,["cid","pr","sf","sid","st","v"]),o={"CMCD-Object":H(n),"CMCD-Request":H(r),"CMCD-Status":H(a),"CMCD-Session":H(i)};return re.trigger(l.default.CMCD_DATA_GENERATED,{url:e.url,mediaType:e.mediaType,cmcdData:t,headers:o}),o}return null}catch(e){return null}}function A(e){try{var t=null;return e.type===h.HTTPRequest.MPD_TYPE?I(e):e.type===h.HTTPRequest.MEDIA_SEGMENT_TYPE?(N(e.mediaType),C(e)):e.type===h.HTTPRequest.INIT_SEGMENT_TYPE?D(e):e.type===h.HTTPRequest.OTHER_TYPE||e.type===h.HTTPRequest.XLINK_EXPANSION_TYPE?w(e):e.type===h.HTTPRequest.LICENSE?R(e):t}catch(e){return null}}function R(e){var t=O(e);return t.ot=E.ENCRYPTION_KEY,t}function I(){var e=O();return e.ot=E.MANIFEST,e}function C(e){var t,n=O(),r=M(e),a=L(e),i=F(e.mediaType),o=j(e.mediaType),s=x(e.mediaType),u=P(e.mediaType),l=z.pr,c=q(e.mediaType);e.mediaType===d.default.VIDEO&&(t=E.VIDEO),e.mediaType===d.default.AUDIO&&(t=E.AUDIO),e.mediaType===d.default.TEXT&&(t="application/mp4"===e.mediaInfo.mimeType?E.ISOBMFF_TEXT_TRACK:E.CAPTION);var f=ae.get().streaming.cmcd.rtp;return f||(f=Y(e)),n.rtp=f,c&&(e.url!==c.url?n.nor=encodeURIComponent(p.default.getRelativeUrl(e.url,c.url)):c.range&&(n.nrr=c.range)),r&&(n.br=r),t&&(n.ot=t),isNaN(a)||(n.d=a),isNaN(i)||(n.mtp=i),isNaN(o)||(n.dl=o),isNaN(s)||(n.bl=s),isNaN(u)||(n.tb=u),isNaN(l)||1===l||(n.pr=l),ee[e.mediaType]&&(n.bs=!0,ee[e.mediaType]=!1),!Z[e.mediaType]&&te[e.mediaType]||(n.su=!0,Z[e.mediaType]=!1,te[e.mediaType]=!0),n}function N(e){te.hasOwnProperty(e)||(te[e]=!1),Z.hasOwnProperty(e)||(Z[e]=!1),ee.hasOwnProperty(e)||(ee[e]=!1)}function D(){var e=O();return e.ot=E.INIT,e.su=!0,e}function w(){var e=O();return e.ot=E.OTHER,e}function O(){var e={},t=ae.get().streaming.cmcd.cid?ae.get().streaming.cmcd.cid:z.cid;return e.v=y,e.sid=ae.get().streaming.cmcd.sid?ae.get().streaming.cmcd.sid:z.sid,e.sid="".concat(e.sid),t&&(e.cid="".concat(t)),isNaN(z.pr)||1===z.pr||null===z.pr||(e.pr=z.pr),z.st&&(e.st=z.st),z.sf&&(e.sf=z.sf),e}function M(e){try{var t=e.quality,n=e.mediaInfo.bitrateList;return parseInt(n[t].bandwidth/1e3)}catch(e){return null}}function P(e){try{var t=X.getTopBitrateInfoFor(e);return Math.round(t.bitrate/1e3)}catch(e){return null}}function L(e){try{return isNaN(e.duration)?null:Math.round(1e3*e.duration)}catch(e){return null}}function F(e){try{return 100*parseInt(X.getThroughputHistory().getSafeAverageThroughput(e)/100)}catch(e){return null}}function j(e){try{var t=z.pr,n=Q.getCurrentBufferLevel(e);return isNaN(t)||isNaN(n)?null:100*parseInt(n/t*10)}catch(e){return null}}function x(e){try{var t=Q.getCurrentBufferLevel(e);return isNaN(t)?null:100*parseInt(10*t)}catch(e){return null}}function k(e){try{z.pr=e.playbackRate}catch(e){}}function B(e){try{var t=V.getIsDynamic(e.data),n=t?v.LIVE:v.VOD,r=e.protocol&&"MSS"===e.protocol?_.MSS:_.DASH;z.st="".concat(n),z.sf="".concat(r)}catch(e){}}function U(e){try{e.state&&e.mediaType&&e.state===u.default.BUFFER_EMPTY&&(ee[e.mediaType]||(ee[e.mediaType]=!0),Z[e.mediaType]||(Z[e.mediaType]=!0))}catch(e){}}function G(){for(var e in ee)ee.hasOwnProperty(e)&&(ee[e]=!0);for(var t in Z)Z.hasOwnProperty(t)&&(Z[t]=!0)}function H(e){try{if(!e)return null;var t=Object.keys(e).sort(function(e,t){return e.localeCompare(t)}),n=t.length,r=t.reduce(function(t,r,a){if("v"===r&&1===e[r])return t;if("string"==typeof e[r]&&"ot"!==r&&"sf"!==r&&"st"!==r){var i=e[r].replace(/"/g,'"');t+="".concat(r,'="').concat(i,'"')}else t+="".concat(r,"=").concat(e[r]);return a<n-1&&(t+=","),t},"");return r=r.replace(/=true/g,""),r=r.replace(/,\s*$/,""),r}catch(e){return null}}function q(e){if($&&0!==$.length){var t,n=r($);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a.getType()===e)return a.probeNextRequest()}}catch(e){n.e(e)}finally{n.f()}}}function Y(e){var t=J.getPlaybackRate();t||(t=1);var n=e.quality,r=e.mediaType,a=e.mediaInfo,i=e.duration,o=x(r);0===o&&(o=500);var s=a.bitrateList[n].bandwidth,u=s*i/1e3,l=o/t/1e3,c=u/l,f=ae.get().streaming.cmcd.rtpSafetyFactor&&!isNaN(ae.get().streaming.cmcd.rtpSafetyFactor)?ae.get().streaming.cmcd.rtpSafetyFactor:T,d=c*f,h=100*(parseInt(d/100)+1);return h}function K(){re.off(u.default.PLAYBACK_RATE_CHANGED,k,this),re.off(u.default.MANIFEST_LOADED,B,this),re.off(u.default.BUFFER_LEVEL_STATE_CHANGED,U,W),re.off(u.default.PLAYBACK_SEEKED,G,W),a()}var V,W,z,X,Q,J,$,Z,ee,te,ne=this.context,re=Object(s.default)(ne).getInstance(),ae=Object(f.default)(ne).getInstance();return W={getQueryParameter:c,getHeaderParameters:b,setConfig:n,reset:K,initialize:t},e(),W}n.r(t);var s=n("./src/core/EventBus.js"),u=n("./src/streaming/MediaPlayerEvents.js"),l=n("./src/streaming/metrics/MetricsReportingEvents.js"),c=n("./src/core/FactoryMaker.js"),f=n("./src/core/Settings.js"),d=n("./src/streaming/constants/Constants.js"),h=n("./src/streaming/vo/metrics/HTTPRequest.js"),g=n("./src/dash/models/DashManifestModel.js"),p=n("./src/core/Utils.js"),m="CMCD",y=1,E={MANIFEST:"m",AUDIO:"a",VIDEO:"v",INIT:"i",CAPTION:"c",ISOBMFF_TEXT_TRACK:"tt",ENCRYPTION_KEY:"k",OTHER:"o"},_={DASH:"d",MSS:"s"},v={VOD:"v",LIVE:"l"},T=5;o.__dashjs_factory_name="CmcdModel",t.default=c.default.getSingletonFactory(o)},"./src/streaming/models/FragmentModel.js":function(e,t,n){function r(e){function t(){w=x.getLogger(D),I(),P.on(L.LOADING_COMPLETED,b,D),P.on(L.LOADING_DATA_PROGRESS,A,D),P.on(L.LOADING_ABANDONED,R,D)}function n(){return k.id}function r(){return B}function a(e){var t=function(e,t){return e.action===i.default.ACTION_COMPLETE&&e.action===t.action},n=function(e,t){return!isNaN(e.index)&&e.startTime===t.startTime&&e.adaptationIndex===t.adaptationIndex&&e.type===t.type},r=function(e,t){return isNaN(e.index)&&isNaN(t.index)&&e.quality===t.quality},a=function(a){var i=!1;return a.some(function(a){if(n(e,a)||r(e,a)||t(e,a))return i=!0,i}),i};return!!e&&a(O)}function u(e){var t,n=!1,r=0;if(n=a(e),!n)for(r=0;r<M.length;r++)t=M[r],e.url===t.url&&e.startTime===t.startTime&&(n=!0);return n}function c(e){var t=e?e.state instanceof Array?e.state:[e.state]:[],n=[];return t.forEach(function(t){var r=T(t);n=n.concat(v(r,e))}),n}function f(e){return isNaN(e.duration)?.25:Math.min(e.duration/8,.5)}function d(e){O=O.filter(function(t){var n=f(t);return isNaN(t.startTime)||void 0!==e&&t.startTime>=e-n})}function h(e){O=O.filter(function(t){return isNaN(t.startTime)||void 0!==e&&t.startTime<e})}function g(e,t){t<=e+.5||(O=O.filter(function(n){var r=f(n);return isNaN(n.startTime)||n.startTime>=t-r||isNaN(n.duration)||n.startTime+n.duration<=e+r}))}function p(e,t){if(e&&0!==e.length){for(var n=0,r=0,a=e.length;r<a;r++)g(n,e.start(r)),n=e.end(r);t>0&&g(n,t)}else d()}function m(){w.debug("abort requests"),j.abort(),M=[]}function y(e){switch(e.action){case i.default.ACTION_DOWNLOAD:S(e,o),M.push(e),E(e);break;default:w.warn("Unknown request action.")}}function E(e){P.trigger(L.FRAGMENT_LOADING_STARTED,{request:e},{streamId:k.id,mediaType:B}),j.load(e)}function _(e,t,n){for(var r=e.length-1,a=r;a>=0;a--){var i=e[a],o=i.startTime,s=o+i.duration;if(n=isNaN(n)?f(i):n,!isNaN(o)&&!isNaN(s)&&t+n>=o&&t-n<s||isNaN(o)&&isNaN(t))return i}return null}function v(e,t){return t.hasOwnProperty("time")?[_(e,t.time,t.threshold)]:e.filter(function(e){for(var n in t)if("state"!==n&&t.hasOwnProperty(n)&&e[n]!=t[n])return!1;return!0})}function T(e){var t;switch(e){case o:t=M;break;case s:t=O;break;default:t=[]}return t}function S(e,t){F.addSchedulingInfo(e,t),F.addRequestsQueue(e.mediaType,M,O)}function b(e){e.sender===j&&(M.splice(M.indexOf(e.request),1),e.response&&!e.error&&O.push(e.request),S(e.request,e.error?l:s),P.trigger(L.FRAGMENT_LOADING_COMPLETED,{request:e.request,response:e.response,error:e.error,sender:this},{streamId:k.id,mediaType:B}))}function A(e){e.sender===j&&P.trigger(L.FRAGMENT_LOADING_PROGRESS,{request:e.request,response:e.response,error:e.error,sender:this},{streamId:k.id,mediaType:B})}function R(e){e.sender===j&&P.trigger(L.FRAGMENT_LOADING_ABANDONED,{request:e.request},{streamId:k.id,mediaType:B})}function I(){O=[],M=[]}function C(){P.off(L.LOADING_COMPLETED,b,this),P.off(L.LOADING_DATA_PROGRESS,A,this),P.off(L.LOADING_ABANDONED,R,this),j&&j.reset(),I()}function N(e){O.push(e)}e=e||{};var D,w,O,M,P=e.eventBus,L=e.events,F=e.dashMetrics,j=e.fragmentLoader,x=e.debug,k=e.streamInfo,B=e.type;return D={getStreamId:n,getType:r,getRequests:c,isFragmentLoaded:a,isFragmentLoadedOrPending:u,removeExecutedRequestsBeforeTime:d,removeExecutedRequestsAfterTime:h,syncExecutedRequestsWithBufferedRange:p,abortRequests:m,executeRequest:y,reset:C,resetInitialSettings:I,addExecutedRequest:N},t(),D}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/vo/FragmentRequest.js"),o="loading",s="executed",u="canceled",l="failed";r.__dashjs_factory_name="FragmentModel";var c=a.default.getClassFactory(r);c.FRAGMENT_MODEL_LOADING=o,c.FRAGMENT_MODEL_EXECUTED=s,c.FRAGMENT_MODEL_CANCELED=u,c.FRAGMENT_MODEL_FAILED=l,a.default.updateClassFactory(r.__dashjs_factory_name,c),t.default=c},"./src/streaming/models/LowLatencyThroughputModel.js":function(e,t,n){function r(){function e(){u=Object(a.default)(g).getInstance().getLogger(s)}function t(e){for(var t={},n=0,r=0,a=0,i=0,o=e.length,s=0;s<o;++s)n+=e[s].chunkDownloadTimeRelativeMS,r+=e[s].bufferLevel,a+=e[s].chunkDownloadTimeRelativeMS*e[s].bufferLevel,i+=e[s].chunkDownloadTimeRelativeMS*e[s].chunkDownloadTimeRelativeMS;return t.m=(a-n*r/o)/(i-n*n/o),t.b=r/o-t.m*n/o,function(e){return t.m*e+t.b}}function n(e){var t,n=!0,r=e.reduce(function(e,t){return e+t.bufferLevelAtSegmentEnd},0)/e.length;return e.forEach(function(e){Math.abs(e.bufferLevelAtSegmentEnd/e.bufferLevelAtSegmentStart)<.95&&(n=!1),e.bufferLevelAtSegmentEnd/r<.8&&(n=!1),t?t>e.bitrate&&(n=!1):t=e.bitrate}),n}function r(e){var t=p[e.mediaType].slice(-1).pop(),r=p[e.mediaType].slice(-3),a=t.chunkMeasurements.slice(-1).pop().chunkDownloadTimeRelativeMS;t.bufferLevelAtSegmentStart=t.getEstimatedBufferLevel(a/2),t.bufferLevelAtSegmentEnd=t.getEstimatedBufferLevel(a);var i=n(r),o=i?f:c;if(t.isBufferStable&&t.segDurationMS*d<t.fetchDownloadDurationMS)return t.fetchDownloadDurationMS;if(!i||t.segDurationMS<t.fetchDownloadDurationMS)return t.fetchDownloadDurationMS*c;if(t.adjustedAvailabilityStartTimeMS<=t.requestTimeMS+t.throughputCapacityDelayMS-t.segDurationMS)return t.fetchDownloadDurationMS*c;for(var s=t.requestTimeMS+t.throughputCapacityDelayMS-t.adjustedAvailabilityStartTimeMS,l=0,h=0,g=0,m=0;m<t.chunkMeasurements.length;m++){var y=t.chunkMeasurements[m];if(s<h+y.chunkDownloadDurationMS)break;h+=y.chunkDownloadDurationMS,l+=y.chunkBytes,g++}if(s<0&&u.warn("request time was before adjusted availibitly start time"),l&&h&&g>.2*t.chunkMeasurements.length){var E=l/h,_=t.segmentBytes/E;return t.fetchDownloadDurationMS<_?t.fetchDownloadDurationMS*o:_*o}var v=t.bitrate;return t.bitrateList.some(function(e){if(e.bandwidth>t.bitrate)return v=e.bandwidth,!0}),v===t.bitrate?t.fetchDownloadDurationMS*o:o*t.segmentBytes*8*1e3/v}function i(e,t){var r=p[e.mediaType]&&p[e.mediaType].slice(-3);return!r||r.length<3?0:n(r)?t/4>h?h:t/4:0}function o(e,n,r,a,i){e&&e.mediaType&&!p[e.mediaType]&&(p[e.mediaType]=[]);var o=e.mediaInfo.bitrateList.find(function(t){return t.id===e.representationId});p[e.mediaType].push({index:e.index,repId:e.representationId,mediaType:e.mediaType,requestTimeMS:a,adjustedAvailabilityStartTimeMS:e.availabilityStartTime.getTime(),segDurationMS:1e3*e.duration,chunksDurationMS:r.reduce(function(e,t){return e+t.chunkDownloadDurationMS},0),segmentBytes:r.reduce(function(e,t){return e+t.chunkBytes},0),bitrate:o&&o.bandwidth,bitrateList:e.mediaInfo.bitrateList,chunkMeasurements:r,fetchDownloadDurationMS:n,throughputCapacityDelayMS:i,getEstimatedBufferLevel:t(r.slice(1))}),p[e.mediaType].length>l&&p[e.mediaType].shift()}var s,u,l=10,c=.8,f=.6,d=1.05,h=250,g=this.context,p={};return s={setup:e,addMeasurement:o,getThroughputCapacityDelayMS:i,getEstimatedDownloadDurationMS:r},e(),s}n.r(t);var a=n("./src/core/Debug.js"),i=n("./src/core/FactoryMaker.js");r.__dashjs_factory_name="LowLatencyThroughputModel",t.default=i.default.getSingletonFactory(r)},"./src/streaming/models/ManifestModel.js":function(e,t,n){function r(){function e(){return r}function t(e){r=e,e&&s.trigger(i.default.MANIFEST_LOADED,{data:e})}var n,r,o=this.context,s=Object(a.default)(o).getInstance();return n={getValue:e,setValue:t},n}n.r(t);var a=n("./src/core/EventBus.js"),i=n("./src/core/events/Events.js"),o=n("./src/core/FactoryMaker.js");r.__dashjs_factory_name="ManifestModel",
t.default=o.default.getSingletonFactory(r)},"./src/streaming/models/MediaPlayerModel.js":function(e,t,n){function r(){function e(){L=[],F={default:y},j=[]}function t(e){var t;for(t=0;t<j.length;t++)if(j[t].rulename===e)return t;return-1}function n(){return j}function r(e,n,r){if("string"!=typeof e||e!==s.default.ABANDON_FRAGMENT_RULES&&e!==s.default.QUALITY_SWITCH_RULES||"string"!=typeof n)throw o.default.BAD_ARGUMENT_ERROR;var a=t(n);-1===a?j.push({type:e,rulename:n,rule:r}):(j[a].type=e,j[a].rule=r)}function i(e){if(e){var n=t(e);-1!==n&&j.splice(n,1)}else j=[]}function E(){var e=k.get().streaming.buffer.initialBufferLevel;return isNaN(e)||e<0?0:Math.min(_(),e)}function _(){if(k.get().streaming.lowLatencyEnabled)return S();var e=k.get().streaming.buffer.stableBufferTime;return e>0?e:k.get().streaming.buffer.fastSwitchEnabled?f:c}function v(e){var t=isNaN(k.get().streaming.retryAttempts.lowLatencyMultiplyFactor)?g:k.get().streaming.retryAttempts.lowLatencyMultiplyFactor;return k.get().streaming.lowLatencyEnabled?k.get().streaming.retryAttempts[e]*t:k.get().streaming.retryAttempts[e]}function T(e){var t=isNaN(k.get().streaming.retryIntervals.lowLatencyReductionFactor)?h:k.get().streaming.retryIntervals.lowLatencyReductionFactor;return k.get().streaming.lowLatencyEnabled?k.get().streaming.retryIntervals[e]/t:k.get().streaming.retryIntervals[e]}function S(){return k.get().streaming.lowLatencyEnabled?k.get().streaming.delay.liveDelay||d:k.get().streaming.delay.liveDelay}function b(){try{var e=k.get().streaming.liveCatchup.latencyThreshold,t=S();if(null!==e&&!isNaN(e))return Math.max(e,t);var n=k.get().streaming.liveCatchup.minDrift,r=!isNaN(t)&&t?isNaN(n)?S():k.get().streaming.liveCatchup.minDrift+S():NaN;return r&&!isNaN(r)?Math.max(r*p,m):NaN}catch(e){return NaN}}function A(e,t){I(e,t);var n=new a.default;n.schemeIdUri=e,n.value=t,L.push(n)}function R(){return L}function I(e,t){Object(l.checkParameterType)(e,"string"),Object(l.checkParameterType)(t,"string"),L.forEach(function(n,r){n.schemeIdUri===e&&n.value===t&&L.splice(r,1)})}function C(){L=[]}function N(){var e=k.get().streaming.utcSynchronization.defaultTimingSource;A(e.scheme,e.value)}function D(e,t){e?F[e]=!!t:Object.keys(F).forEach(function(e){D(e,t)})}function w(e){var t=F[e];return void 0===t?F.default:t}function O(){return k.get().streaming.utcSynchronization.defaultTimingSource}function M(){}var P,L,F,j,x=this.context,k=Object(u.default)(x).getInstance();return P={getABRCustomRules:n,addABRCustomRule:r,removeABRCustomRule:i,getStableBufferTime:_,getInitialBufferLevel:E,getRetryAttemptsForType:v,getRetryIntervalsForType:T,getLiveDelay:S,getLiveCatchupLatencyThreshold:b,addUTCTimingSource:A,removeUTCTimingSource:I,getUTCTimingSources:R,clearDefaultUTCTimingSources:C,restoreDefaultUTCTimingSources:N,setXHRWithCredentialsForType:D,getXHRWithCredentialsForType:w,getDefaultUtcTimingSource:O,reset:M},e(),P}n.r(t);var a=n("./src/dash/vo/UTCTiming.js"),i=n("./src/core/FactoryMaker.js"),o=n("./src/streaming/constants/Constants.js"),s=n("./src/streaming/rules/abr/ABRRulesCollection.js"),u=n("./src/core/Settings.js"),l=n("./src/streaming/utils/SupervisorTools.js"),c=12,f=20,d=3,h=10,g=5,p=4,m=5,y=!1;r.__dashjs_factory_name="MediaPlayerModel",t.default=i.default.getSingletonFactory(r)},"./src/streaming/models/MetricsModel.js":function(e,t,n){function r(e){function t(){G={}}function n(){Y.trigger(y.default.METRICS_CHANGED)}function r(e){Y.trigger(y.default.METRIC_CHANGED,{mediaType:e}),n()}function E(e,t,n){Y.trigger(y.default.METRIC_UPDATED,{mediaType:e,metric:t,value:n}),r(e)}function _(e,t,n){Y.trigger(y.default.METRIC_ADDED,{mediaType:e,metric:t,value:n}),r(e)}function v(e){delete G[e],r(e)}function T(){G={},n()}function S(e,t){var n=null;return e?(G.hasOwnProperty(e)?n=G[e]:t||(n=new o.default,G[e]=n),n):n}function b(e,t,n){var r=S(e);null!==r&&(r[t].push(n),r[t].length>H.get().streaming.metrics.maxListDepth&&r[t].shift())}function A(e,t,n,r,a){var i=new s.HTTPRequestTrace;return i.s=t,i.d=n,i.b=r,i.t=a,e.trace.push(i),e.interval||(e.interval=0),e.interval+=n,i}function R(e,t,n,r,a,o,u,l,c,f,d,h,g,p,m){var y=new s.HTTPRequest;o&&o!==r&&(R(e,null,n,r,a,null,null,l,c,null,null,null,g,null,null),y.actualurl=o),y.tcpid=t,y.type=n,y.url=r,y.range=l,y.trequest=c,y.tresponse=f,y.responsecode=h,y._tfinish=d,y._stream=e,y._mediaduration=g,y._quality=a,y._responseHeaders=p,y._serviceLocation=u,m?m.forEach(function(e){A(y,e.s,e.d,e.b,e.t)}):(delete y.interval,delete y.trace),C(e,i.default.HTTP_REQUEST,y)}function I(e,t,n,r,a){var o=new u.default;o.t=t,o.mt=n,o.to=r,a?o.lto=a:delete o.lto,C(e,i.default.TRACK_SWITCH,o)}function C(e,t,n){b(e,t,n),_(e,t,n)}function N(e,t,n){var r=new l.default;r.t=t,r.level=n,C(e,i.default.BUFFER_LEVEL,r)}function D(e,t,n){var r=new c.default;r.target=n,r.state=t,C(e,i.default.BUFFER_STATE,r)}function w(e,t,n,r){var a=new f.default;a.time=t,a.range=r,a.manifestInfo=n,C(e,i.default.DVR_INFO,a)}function O(e,t){var n=new d.default,r=S(e).DroppedFrames;t&&(n.time=t.creationTime,n.droppedFrames=t.droppedVideoFrames,r.length>0&&r[r.length-1]==n||C(e,i.default.DROPPED_FRAMES,n))}function M(e,t,n,r,a,o,s,u,l){var c=new g.default;c.mediaType=e,c.t=t,c.type=n,c.startTime=r,c.availabilityStartTime=a,c.duration=o,c.quality=s,c.range=u,c.state=l,C(e,i.default.SCHEDULING_INFO,c)}function P(e,t,n){var r=new m.default;r.loadingRequests=t,r.executedRequests=n,S(e).RequestsQueue=r,_(e,i.default.REQUESTS_QUEUE,r)}function L(e,t,n,r,o,s,u,l,c,f){var d=new h.ManifestUpdate;d.mediaType=e,d.type=t,d.requestTime=n,d.fetchTime=r,d.availabilityStartTime=o,d.presentationStartTime=s,d.clientTimeOffset=u,d.currentTime=l,d.buffered=c,d.latency=f,b(a.default.STREAM,i.default.MANIFEST_UPDATE,d),_(e,i.default.MANIFEST_UPDATE,d)}function F(e,t){if(e){for(var n in t)e[n]=t[n];E(e.mediaType,i.default.MANIFEST_UPDATE,e)}}function j(e,t,n,r,a){if(e){var o=new h.ManifestUpdateStreamInfo;o.id=t,o.index=n,o.start=r,o.duration=a,e.streamInfo.push(o),E(e.mediaType,i.default.MANIFEST_UPDATE_STREAM_INFO,e)}}function x(e,t,n,r,a,o,s,u){if(e&&e.representationInfo){var l=new h.ManifestUpdateRepresentationInfo;l.id=t,l.index=n,l.streamIndex=r,l.mediaType=a,l.startNumber=s,l.fragmentInfoType=u,l.presentationTimeOffset=o,e.representationInfo.push(l),E(e.mediaType,i.default.MANIFEST_UPDATE_TRACK_INFO,e)}}function k(e){e.trace&&Array.isArray(e.trace)?e.trace.forEach(function(e){e.hasOwnProperty("subreplevel")&&!e.subreplevel&&delete e.subreplevel}):delete e.trace,C(a.default.STREAM,i.default.PLAY_LIST,e)}function B(e){C(a.default.STREAM,i.default.DVB_ERRORS,e)}e=e||{};var U,G,H=e.settings,q=this.context,Y=Object(p.default)(q).getInstance();return U={clearCurrentMetricsForType:v,clearAllCurrentMetrics:T,getMetricsFor:S,addHttpRequest:R,addRepresentationSwitch:I,addBufferLevel:N,addBufferState:D,addDVRInfo:w,addDroppedFrames:O,addSchedulingInfo:M,addRequestsQueue:P,addManifestUpdate:L,updateManifestUpdateInfo:F,addManifestUpdateStreamInfo:j,addManifestUpdateRepresentationInfo:x,addPlayList:k,addDVBErrors:B},t(),U}n.r(t);var a=n("./src/streaming/constants/Constants.js"),i=n("./src/streaming/constants/MetricsConstants.js"),o=n("./src/streaming/vo/MetricsList.js"),s=n("./src/streaming/vo/metrics/HTTPRequest.js"),u=n("./src/streaming/vo/metrics/RepresentationSwitch.js"),l=n("./src/streaming/vo/metrics/BufferLevel.js"),c=n("./src/streaming/vo/metrics/BufferState.js"),f=n("./src/streaming/vo/metrics/DVRInfo.js"),d=n("./src/streaming/vo/metrics/DroppedFrames.js"),h=n("./src/streaming/vo/metrics/ManifestUpdate.js"),g=n("./src/streaming/vo/metrics/SchedulingInfo.js"),p=n("./src/core/EventBus.js"),m=n("./src/streaming/vo/metrics/RequestsQueue.js"),y=n("./src/core/events/Events.js"),E=n("./src/core/FactoryMaker.js");r.__dashjs_factory_name="MetricsModel",t.default=E.default.getSingletonFactory(r)},"./src/streaming/models/URIFragmentModel.js":function(e,t,n){function r(){function e(e){if(r=new a.default,!e)return null;var t=e.indexOf("#");if(-1!==t)for(var n=e.substr(t+1).split("&"),i=0,o=n.length;i<o;++i){var s=n[i],u=s.indexOf("=");if(-1!==u){var l=s.substring(0,u);r.hasOwnProperty(l)&&(r[l]=s.substr(u+1))}}}function t(){return r}var n,r;return n={initialize:e,getURIFragmentData:t},n}n.r(t);var a=n("./src/streaming/vo/URIFragmentData.js"),i=n("./src/core/FactoryMaker.js");r.__dashjs_factory_name="URIFragmentModel",t.default=i.default.getSingletonFactory(r)},"./src/streaming/models/VideoModel.js":function(e,t,n){function r(){function e(){J=Object(s.default)(te).getInstance().getLogger(Q)}function t(){ne.on(o.default.PLAYBACK_PLAYING,b,this)}function n(){ne.off(o.default.PLAYBACK_PLAYING,b,this)}function r(){$&&($.playbackRate=1,$.removeEventListener("canplay",r))}function a(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];$&&(!t&&$.readyState<=2&&e>0?$.addEventListener("canplay",r):$.playbackRate=e)}function c(e,t){z(u.default.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,function(){if($){if($.currentTime===e)return;try{e=t?f(e):e,$.currentTime=e}catch(t){0===$.readyState&&t.code===t.INVALID_STATE_ERR&&setTimeout(function(){$.currentTime=e},400)}}})}function f(e){var t=j(),n=e,r=9999999999;if(t)for(var a=0;a<t.length;a++){var i=t.start(a),o=t.end(a),s=Math.abs(i-e),u=Math.abs(o-e);if(e>=i&&e<=o)return e;s<r&&(r=s,n=i),u<r&&(r=u,n=o)}return n}function d(){return $}function h(e){if(!(null==e||e&&/^(VIDEO|AUDIO)$/i.test(e.nodeName)))throw ee;$=e,$&&($.preload="auto")}function g(e){$&&(e?$.src=e:($.removeAttribute("src"),$.load()))}function p(){return $?$.src:null}function m(){return Z}function y(e){Z=e,Z.style.position="absolute",Z.style.display="flex",Z.style.overflow="hidden",Z.style.pointerEvents="none",Z.style.top=0,Z.style.left=0}function E(e,t){S(e,t)}function _(){return re.length>0}function v(e){null!==e&&$&&!$.seeking&&-1===re.indexOf(e)&&re.push(e)}function T(e){var t=re.indexOf(e);null!==e&&-1!==t&&re.splice(t,1)}function S(e,t){t?v(e):T(e)}function b(){if($&&_()&&0===$.playbackRate){var e=document.createEvent("Event");e.initEvent("waiting",!0,!1),$.dispatchEvent(e)}}function A(){if(!$)return null;var e="webkitDroppedFrameCount"in $&&"webkitDecodedFrameCount"in $,t="getVideoPlaybackQuality"in $,n=null;return t?n=$.getVideoPlaybackQuality():e&&(n={droppedVideoFrames:$.webkitDroppedFrameCount,totalVideoFrames:$.webkitDroppedFrameCount+$.webkitDecodedFrameCount,creationTime:new Date}),n}function R(){if($){$.autoplay=!0;var e=$.play();e&&e.catch&&"undefined"!=typeof Promise&&e.catch(function(e){"NotAllowedError"===e.name&&ne.trigger(o.default.PLAYBACK_NOT_ALLOWED),J.warn("Caught pending play exception - continuing (".concat(e,")"))})}}function I(){return $?$.paused:null}function C(){$&&($.pause(),$.autoplay=!1)}function N(){return $?$.seeking:null}function D(){return $?$.currentTime:null}function w(){return $?$.playbackRate:null}function O(){return $?$.played:null}function M(){return $?$.ended:null}function P(e,t){$&&$.addEventListener(e,t)}function L(e,t){$&&$.removeEventListener(e,t)}function F(){return $?$.readyState:NaN}function j(){return $?$.buffered:null}function x(){return $?$.clientWidth:NaN}function k(){return $?$.clientHeight:NaN}function B(){return $?$.videoWidth:NaN}function U(){return $?$.videoHeight:NaN}function G(){var e=$.parentNode.host||$.parentNode;return e?$.getBoundingClientRect().top-e.getBoundingClientRect().top:NaN}function H(){var e=$.parentNode.host||$.parentNode;return e?$.getBoundingClientRect().left-e.getBoundingClientRect().left:NaN}function q(){return $?$.textTracks:[]}function Y(e,t,n,r,a){if($)for(var i=0;i<$.textTracks.length;i++)if($.textTracks[i].kind===e&&(!t||$.textTracks[i].label==t)&&$.textTracks[i].language===n&&$.textTracks[i].isTTML===r&&$.textTracks[i].isEmbedded===a)return $.textTracks[i];return null}function K(e,t,n,r,a){if(!$)return null;var i=Y(e,t,n,r,a);return i||(i=$.addTextTrack(e,t,n),i.isEmbedded=a,i.isTTML=r),i}function V(e){$&&($.appendChild(e),void 0!==e.isTTML&&($.textTracks[$.textTracks.length-1].isTTML=e.isTTML,$.textTracks[$.textTracks.length-1].isEmbedded=e.isEmbedded))}function W(e){$&&$.removeChild(e)}function z(e,t){if(e===u.default.VIDEO_ELEMENT_READY_STATES.HAVE_NOTHING||F()>=e)t();else{var n=l.get(e);X(n,t)}}function X(e,t){var n=function n(){L(e,n),t(e)};P(e,n)}var Q,J,$,Z,ee="element is not video or audio DOM type!",te=this.context,ne=Object(i.default)(te).getInstance(),re=[];return Q={initialize:t,setCurrentTime:c,play:R,isPaused:I,pause:C,isStalled:_,isSeeking:N,getTime:D,getPlaybackRate:w,setPlaybackRate:a,getPlayedRanges:O,getEnded:M,setStallState:E,getElement:d,setElement:h,setSource:g,getSource:p,getTTMLRenderingDiv:m,setTTMLRenderingDiv:y,getPlaybackQuality:A,addEventListener:P,removeEventListener:L,getReadyState:F,getBufferRange:j,getClientWidth:x,getClientHeight:k,getTextTracks:q,getTextTrack:Y,addTextTrack:K,appendChild:V,removeChild:W,getVideoWidth:B,getVideoHeight:U,getVideoRelativeOffsetTop:G,getVideoRelativeOffsetLeft:H,reset:n},e(),Q}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/core/EventBus.js"),o=n("./src/core/events/Events.js"),s=n("./src/core/Debug.js"),u=n("./src/streaming/constants/Constants.js"),l=new Map([[u.default.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,"loadedmetadata"],[u.default.VIDEO_ELEMENT_READY_STATES.HAVE_CURRENT_DATA,"loadeddata"],[u.default.VIDEO_ELEMENT_READY_STATES.HAVE_FUTURE_DATA,"canplay"],[u.default.VIDEO_ELEMENT_READY_STATES.HAVE_ENOUGH_DATA,"canplaythrough"]]);r.__dashjs_factory_name="VideoModel",t.default=a.default.getSingletonFactory(r)},"./src/streaming/net/FetchLoader.js":function(e,t,n){function r(e,t){return o(e)||i(e,t)||u(e,t)||a()}function a(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}}function o(e){if(Array.isArray(e))return e}function s(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=u(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function u(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e){function t(e){f=e.dashMetrics}function n(e){var t,n=new Date,o=e.request,c=new Headers;if(o.range&&c.append("Range","bytes="+o.range),e.headers)for(var d in e.headers){var g=e.headers[d];g&&c.append(d,g)}o.requestStartDate||(o.requestStartDate=n),p&&p.modifyRequestHeader({setRequestHeader:function(e,t){c.append(e,t)}}),"function"==typeof window.AbortController&&(t=new AbortController,e.abortController=t,t.signal.onabort=e.onabort);var _={method:e.method,headers:c,credentials:e.withCredentials?"include":void 0,signal:t?t.signal:void 0},v=E.get().streaming.abr.fetchThroughputCalculationMode,T=Date.now(),S=0;new Promise(function(e){if(v===h.default.ABR_FETCH_THROUGHPUT_CALCULATION_AAST&&m&&(S=m.getThroughputCapacityDelayMS(o,1e3*f.getCurrentBufferLevel(o.mediaType)),S))return setTimeout(e,S);e()}).then(function(){var t=Date.now();fetch(e.url,_).then(function(n){e.response||(e.response={}),e.response.status=n.status,e.response.statusText=n.statusText,e.response.responseURL=n.url,n.ok||e.onerror();var c,d="",g=s(n.headers.keys());try{for(g.s();!(c=g.n()).done;){var p=c.value;d+=p+": "+n.headers.get(p)+"\r\n"}}catch(e){g.e(e)}finally{g.f()}if(e.response.responseHeaders=d,!n.body)return n.arrayBuffer().then(function(t){e.response.response=t;var n={loaded:t.byteLength,total:t.byteLength,stream:!1};e.progress(n),e.onload(),e.onend()});var E=parseInt(n.headers.get("Content-Length"),10),_=0,b=!1,A=new Uint8Array,R=0;if(v===h.default.ABR_FETCH_THROUGHPUT_CALCULATION_AAST&&m){var I=function(n){var r=n.getReader(),a=[];r.read().then(function n(i){var s=i.value,u=i.done;if(N=Date.now(),s&&s.length){var l=N-C,c=s.length;a.push({chunkDownloadTimeRelativeMS:N-t,chunkDownloadDurationMS:l,chunkBytes:c,kbps:Math.round(8*c/(l/1e3)),bufferLevel:f.getCurrentBufferLevel(o.mediaType)})}if(u){var h=N-t,g=a.reduce(function(e,t){return e+t.chunkBytes},0);return m.addMeasurement(o,h,a,T,S,d),void e.progress({loaded:g,total:g,lengthComputable:!0,time:m.getEstimatedDownloadDurationMS(o),stream:!0})}return C=Date.now(),r.read().then(n)})},C=t,N=0,D=n.body.tee(),w=r(D,2),O=w[0],M=w[1];I(O),e.reader=M.getReader()}else e.reader=n.body.getReader();var P=[],L=[],F=[],j=!0,x=function t(n){var r=n.value,o=n.done;if(o){if(A){if(v!==h.default.ABR_FETCH_THROUGHPUT_CALCULATION_AAST){var s=null;v===h.default.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING&&(s=l(L,F)),e.progress({loaded:_,total:isNaN(E)?_:E,lengthComputable:!0,time:u(P,_),throughput:s,stream:!0})}e.response.response=A.buffer}return e.onload(),void e.onend()}if(r&&r.length>0){if(A=i(A,r),_+=r.length,P.push({ts:Date.now(),bytes:r.length}),v===h.default.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING&&j){var c=y.findLastTopIsoBoxCompleted(["moof"],A,R);c.found&&(j=!1,L.push({ts:performance.now(),bytes:r.length}))}var f=y.findLastTopIsoBoxCompleted(["moov","mdat"],A,R);if(f.found){var d,g=f.lastCompletedOffset+f.size;v!==h.default.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING||j||(j=!0,F.push({ts:performance.now(),bytes:A.length})),g===A.length?(d=A,A=new Uint8Array):(d=new Uint8Array(A.subarray(0,g)),A=A.subarray(g)),e.progress({data:d.buffer,lengthComputable:!1,noTrace:!0}),R=0}else R=f.lastCompletedOffset,b||(e.progress({lengthComputable:!1,noTrace:!0}),b=!0)}a(e,t)};a(e,x)}).catch(function(t){e.onerror&&e.onerror(t)})})}function a(e,t){e.reader.read().then(t).catch(function(t){e.onerror&&200===e.response.status&&e.onerror(t)})}function i(e,t){if(0===e.length)return t;var n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function o(e){if(e.abortController)e.abortController.abort();else if(e.reader)try{e.reader.cancel(),e.onabort()}catch(e){}}function u(e,t){try{if(e=e.filter(function(n){return n.bytes>t/4/e.length}),e.length>1){var n=0,r=(e[e.length-1].ts-e[0].ts)/e.length;return e.forEach(function(t,a){var i=e[a+1];if(i){var o=i.ts-t.ts;n+=o<r?o:0}}),n}return null}catch(e){return null}}function l(e,t){try{var n,r;n=e.filter(function(t,n){return n<e.length-1}),r=t.filter(function(e,n){return n<t.length-1});var a=[];if(n.length>1){for(var i=0,o=0,s=0;s<n.length;s++)if(n[s]&&r[s]){var u=r[s].ts-n[s].ts;if(u>1)a.push(8*r[s].bytes/u);else{0===o&&(o=n[s].ts);var l=r[s].ts-o;l>1?(a.push(8*i/l),i=0,o=0):i+=r[s].bytes}}if(a.length>0){var c=a.reduce(function(e,t){return e+t},0);return c/a.length}}return null}catch(e){return null}}e=e||{};var c,f,g=this.context,p=e.requestModifier,m=e.lowLatencyThroughputModel,y=e.boxParser,E=Object(d.default)(g).getInstance();return c={load:n,abort:o,calculateDownloadedTime:u,setup:t},c}n.r(t);var f=n("./src/core/FactoryMaker.js"),d=n("./src/core/Settings.js"),h=n("./src/streaming/constants/Constants.js");c.__dashjs_factory_name="FetchLoader";var g=f.default.getClassFactory(c);t.default=g},"./src/streaming/net/HTTPLoader.js":function(e,t,n){function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){function t(){var e;I=Object(d.default)(C).getInstance().getLogger(_),v=[],T=[],S=[],A=Object(c.default)(C).getInstance(),R=Object(y.default)(C).getInstance(),e={},r(e,s.HTTPRequest.MPD_TYPE,P.DOWNLOAD_ERROR_ID_MANIFEST_CODE),r(e,s.HTTPRequest.XLINK_EXPANSION_TYPE,P.DOWNLOAD_ERROR_ID_XLINK_CODE),r(e,s.HTTPRequest.INIT_SEGMENT_TYPE,P.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE),r(e,s.HTTPRequest.MEDIA_SEGMENT_TYPE,P.DOWNLOAD_ERROR_ID_CONTENT_CODE),r(e,s.HTTPRequest.INDEX_SEGMENT_TYPE,P.DOWNLOAD_ERROR_ID_CONTENT_CODE),r(e,s.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE,P.DOWNLOAD_ERROR_ID_CONTENT_CODE),r(e,s.HTTPRequest.OTHER_TYPE,P.DOWNLOAD_ERROR_ID_CONTENT_CODE),b=e}function n(e,t){var r,u=e.request,c=[],d=!0,h=!0,p=new Date,y=p,E=0;if(!O||!D||!N)throw new Error("config object is not correct or missing");var _,P=function(e){if(h=!1,u.requestStartDate=p,u.requestEndDate=new Date,u.firstByteDate=u.firstByteDate||p,!u.checkExistenceOnly){var t=r.response?r.response.responseURL:null,n=r.response?r.response.status:null,a=r.response&&r.response.getAllResponseHeaders?r.response.getAllResponseHeaders():r.response?r.response.responseHeaders:[];D.addHttpRequest(u,t,n,a,e?c:null),u.type===s.HTTPRequest.MPD_TYPE&&D.addManifestUpdate(u)}},x=function(){if(-1!==v.indexOf(r)&&(v.splice(v.indexOf(r),1),h))if(P(!1),t>0){try{if(j.get().streaming.utcSynchronization.enableBackgroundSyncAfterSegmentDownloadError&&u.type===s.HTTPRequest.MEDIA_SEGMENT_TYPE){var a=w.getRetryAttemptsForType(s.HTTPRequest.MEDIA_SEGMENT_TYPE);a===t&&F.trigger(g.default.ATTEMPT_BACKGROUND_SYNC)}}catch(e){}t--;var i={config:e};S.push(i),i.timeout=setTimeout(function(){-1!==S.indexOf(i)&&(S.splice(S.indexOf(i),1),n(e,t))},w.getRetryIntervalsForType(u.type))}else{if(u.type===s.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE)return;N.error(new l.default(b[u.type],u.url+" is not available",{request:u,response:r.response})),e.error&&e.error(u,"error",r.response.statusText),e.complete&&e.complete(u,r.response.statusText)}},k=function(t){var n=new Date;d&&(d=!1,(!t.lengthComputable||t.lengthComputable&&t.total!==t.loaded)&&(u.firstByteDate=n)),t.lengthComputable&&(u.bytesLoaded=t.loaded,u.bytesTotal=t.total),t.noTrace||(c.push({s:y,d:t.time?t.time:n.getTime()-y.getTime(),b:[t.loaded?t.loaded-E:0],t:t.throughput}),y=n,E=t.loaded),e.progress&&t&&e.progress(t)},B=function(){r.response.status>=200&&r.response.status<=299&&(P(!0),e.success&&e.success(r.response.response,r.response.statusText,r.response.responseURL),e.complete&&e.complete(u,r.response.statusText))},U=function(){e.abort&&e.abort(u)},G=function(e){var t;if(e.lengthComputable){var n=e.loaded/e.total*100;t="Request timeout: loaded: "+e.loaded+", out of: "+e.total+" : "+n.toFixed(3)+"% Completed"}else t="Request timeout: non-computable download size";I.warn(t)};j.get().streaming.lowLatencyEnabled&&window.fetch&&"arraybuffer"===u.responseType&&u.type===s.HTTPRequest.MEDIA_SEGMENT_TYPE?(_=Object(o.default)(C).create({requestModifier:O,lowLatencyThroughputModel:R,boxParser:M}),_.setup({dashMetrics:D})):_=Object(i.default)(C).create({requestModifier:O});var H=null,q=O.modifyRequestURL(u.url);if(j.get().streaming.cmcd&&j.get().streaming.cmcd.enabled){var Y=j.get().streaming.cmcd.mode;if(Y===m.default.CMCD_MODE_QUERY){var K=a(u);q=f.default.addAditionalQueryParameterToUrl(q,K)}else Y===m.default.CMCD_MODE_HEADER&&(H=A.getHeaderParameters(u))}u.url=q;var V=u.checkExistenceOnly?s.HTTPRequest.HEAD:s.HTTPRequest.GET,W=w.getXHRWithCredentialsForType(u.type);r={url:q,method:V,withCredentials:W,request:u,onload:B,onend:x,onerror:x,progress:k,onabort:U,ontimeout:G,loader:_,timeout:L,headers:H};var z=(new Date).getTime();if(isNaN(u.delayLoadingTime)||z>=u.delayLoadingTime)v.push(r),_.load(r);else{var X={httpRequest:r};T.push(X),X.delayTimeout=setTimeout(function(){if(-1!==T.indexOf(X)){T.splice(T.indexOf(X),1);try{p=new Date,y=p,v.push(X.httpRequest),_.load(X.httpRequest)}catch(e){X.httpRequest.onerror()}}},u.delayLoadingTime-z)}}function a(e){try{var t=[],n=A.getQueryParameter(e);return n&&t.push(n),t}catch(e){return[]}}function u(e){e.request?n(e,w.getRetryAttemptsForType(e.request.type)):e.error&&e.error(e.request,"error")}function E(){S.forEach(function(e){clearTimeout(e.timeout),e.config.request&&e.config.abort&&e.config.abort(e.config.request)}),S=[],T.forEach(function(e){return clearTimeout(e.delayTimeout)}),T=[],v.forEach(function(e){e.request.type!==s.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE&&(e.onloadend=e.onerror=e.onprogress=void 0,e.loader.abort(e))}),v=[]}e=e||{};var _,v,T,S,b,A,R,I,C=this.context,N=e.errHandler,D=e.dashMetrics,w=e.mediaPlayerModel,O=e.requestModifier,M=e.boxParser,P=e.errors,L=e.requestTimeout||0,F=Object(h.default)(C).getInstance(),j=Object(p.default)(C).getInstance();return _={load:u,abort:E},t(),_}n.r(t);var i=n("./src/streaming/net/XHRLoader.js"),o=n("./src/streaming/net/FetchLoader.js"),s=n("./src/streaming/vo/metrics/HTTPRequest.js"),u=n("./src/core/FactoryMaker.js"),l=n("./src/streaming/vo/DashJSError.js"),c=n("./src/streaming/models/CmcdModel.js"),f=n("./src/core/Utils.js"),d=n("./src/core/Debug.js"),h=n("./src/core/EventBus.js"),g=n("./src/core/events/Events.js"),p=n("./src/core/Settings.js"),m=n("./src/streaming/constants/Constants.js"),y=n("./src/streaming/models/LowLatencyThroughputModel.js");a.__dashjs_factory_name="HTTPLoader";var E=u.default.getClassFactory(a);t.default=E},"./src/streaming/net/SchemeLoaderFactory.js":function(e,t,n){function r(){function e(e,t){u[e]=t}function t(e){u[e]&&delete u[e]}function n(){u={}}function r(e){for(var t in u)if(u.hasOwnProperty(t)&&e.startsWith(t))return u[t];return i.default}function a(){n()}function o(){a()}var s,u;return o(),s={getLoader:r,registerLoader:e,unregisterLoader:t,unregisterAllLoader:n,reset:a},s}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/net/HTTPLoader.js");r.__dashjs_factory_name="SchemeLoaderFactory";var o=a.default.getSingletonFactory(r);t.default=o},"./src/streaming/net/URLLoader.js":function(e,t,n){function r(e){function t(t){if(!o){var n=a.getLoader(t&&t.request?t.request.url:null);o=n(s).create({errHandler:e.errHandler,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,dashMetrics:e.dashMetrics,boxParser:e.boxParser?e.boxParser:null,constants:e.constants?e.constants:null,dashConstants:e.dashConstants?e.dashConstants:null,urlUtils:e.urlUtils?e.urlUtils:null,requestTimeout:isNaN(e.requestTimeout)?0:e.requestTimeout,errors:e.errors})}o.load(t)}function n(){o&&o.abort()}e=e||{};var r,a,o,s=this.context;return a=Object(i.default)(s).getInstance(),r={load:t,abort:n},r}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/net/SchemeLoaderFactory.js");r.__dashjs_factory_name="URLLoader";var o=a.default.getClassFactory(r);t.default=o},"./src/streaming/net/XHRLoader.js":function(e,t,n){function r(e){function t(e){var t=new Date,n=e.request,r=new XMLHttpRequest;if(r.open(e.method,e.url,!0),n.responseType&&(r.responseType=n.responseType),n.range&&r.setRequestHeader("Range","bytes="+n.range),n.requestStartDate||(n.requestStartDate=t),a&&(r=a.modifyRequestHeader(r)),e.headers)for(var i in e.headers){var o=e.headers[i];o&&r.setRequestHeader(i,o)}r.withCredentials=e.withCredentials,r.onload=e.onload,r.onloadend=e.onend,r.onerror=e.onerror,r.onprogress=e.progress,r.onabort=e.onabort,r.ontimeout=e.ontimeout,r.timeout=e.timeout,r.send(),e.response=r}function n(e){var t=e.response;t.onloadend=t.onerror=t.onprogress=void 0,t.abort()}e=e||{};var r,a=e.requestModifier;return r={load:t,abort:n},r}n.r(t);var a=n("./src/core/FactoryMaker.js");r.__dashjs_factory_name="XHRLoader";var i=a.default.getClassFactory(r);t.default=i},"./src/streaming/protection/CommonEncryption.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}n.r(t);var o={attributes:["Laurl","laurl"],prefixes:["clearkey","dashif"]},s=function(){function e(){r(this,e)}return i(e,null,[{key:"findCencContentProtection",value:function(e){for(var t=null,n=0;n<e.length;++n){var r=e[n];"urn:mpeg:dash:mp4protection:2011"!==r.schemeIdUri.toLowerCase()||"cenc"!==r.value.toLowerCase()&&"cbcs"!==r.value.toLowerCase()||(t=r)}return t}},{key:"getPSSHData",value:function(e){var t=8,n=new DataView(e),r=n.getUint8(t);return t+=20,r>0&&(t+=4+16*n.getUint32(t)),t+=4,e.slice(t)}},{key:"getPSSHForKeySystem",value:function(t,n){var r=e.parsePSSHList(n);return t&&r.hasOwnProperty(t.uuid.toLowerCase())?r[t.uuid.toLowerCase()]:null}},{key:"parseInitDataFromContentProtection",value:function(e,t){return"pssh"in e?(e.pssh.__text=e.pssh.__text.replace(/\r?\n|\r/g,"").replace(/\s+/g,""),t.decodeArray(e.pssh.__text).buffer):null}},{key:"parsePSSHList",value:function(e){if(null==e)return[];for(var t=new DataView(e.buffer||e),n=!1,r={},a=0;!n;){var i=void 0,o=void 0,s=void 0,u=void 0,l=a;if(a>=t.buffer.byteLength)break;if(i=t.getUint32(a),o=a+i,a+=4,1886614376===t.getUint32(a))if(a+=4,s=t.getUint8(a),0===s||1===s){a++,a+=3,u="";var c=void 0,f=void 0;for(c=0;c<4;c++)f=t.getUint8(a+c).toString(16),u+=1===f.length?"0"+f:f;for(a+=4,u+="-",c=0;c<2;c++)f=t.getUint8(a+c).toString(16),u+=1===f.length?"0"+f:f;for(a+=2,u+="-",c=0;c<2;c++)f=t.getUint8(a+c).toString(16),u+=1===f.length?"0"+f:f;for(a+=2,u+="-",c=0;c<2;c++)f=t.getUint8(a+c).toString(16),u+=1===f.length?"0"+f:f;for(a+=2,u+="-",c=0;c<6;c++)f=t.getUint8(a+c).toString(16),u+=1===f.length?"0"+f:f;a+=6,u=u.toLowerCase(),a+=4,r[u]=t.buffer.slice(l,o),a=o}else a=o;else a=o}return r}},{key:"getLicenseServerUrlFromMediaInfo",value:function(e,t){try{if(!e||0===e.length)return null;for(var n=0,r=null;n<e.length&&!r;){var a=e[n];if(a&&a.contentProtection&&a.contentProtection.length>0){var i=a.contentProtection.filter(function(e){return e.schemeIdUri&&e.schemeIdUri===t});if(i&&i.length>0)for(var s=0;s<i.length&&!r;){for(var u=i[s],l=0;l<o.attributes.length&&!r;){for(var c=0,f=o.attributes[l];c<o.prefixes.length&&!r;){var d=o.prefixes[c];u[f]&&u[f].__prefix&&u[f].__prefix===d&&u[f].__text&&(r=u[f].__text),c+=1}l+=1}s+=1}}n+=1}return r}catch(e){return null}}}]),e}();t.default=s},"./src/streaming/protection/Protection.js":function(e,t,n){function r(){function e(e){var n=null,r=Object(i.default)(o).getInstance();r.setConfig({debug:e.debug,BASE64:e.BASE64}),r.initialize();var s=t(e);return!n&&s&&(n=Object(a.default)(o).create({protectionModel:s,protectionKeyController:r,eventBus:e.eventBus,debug:e.debug,events:e.events,BASE64:e.BASE64,constants:e.constants,cmcdModel:e.cmcdModel,settings:e.settings}),e.capabilities.setEncryptedMediaSupported(!0)),n}function t(e){var t=e.debug,a=t.getLogger(r),i=e.eventBus,s=e.errHandler,h=e.videoModel?e.videoModel.getElement():null;return h&&void 0===h.onencrypted||h&&void 0===h.mediaKeys?n(h,d)?(a.info("EME detected on this user agent! (ProtectionModel_3Feb2014)"),Object(l.default)(o).create({debug:t,eventBus:i,events:e.events,api:n(h,d)})):n(h,f)?(a.info("EME detected on this user agent! (ProtectionModel_01b)"),Object(c.default)(o).create({debug:t,eventBus:i,errHandler:s,events:e.events,api:n(h,f)})):(a.warn("No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!"),null):(a.info("EME detected on this user agent! (ProtectionModel_21Jan2015)"),Object(u.default)(o).create({debug:t,eventBus:i,events:e.events}))}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];if("function"==typeof e[r[Object.keys(r)[0]]])return r}return null}var r,o=this.context;return r={createProtectionSystem:e},r}n.r(t)
;var a=n("./src/streaming/protection/controllers/ProtectionController.js"),i=n("./src/streaming/protection/controllers/ProtectionKeyController.js"),o=n("./src/streaming/protection/ProtectionEvents.js"),s=n("./src/streaming/protection/errors/ProtectionErrors.js"),u=n("./src/streaming/protection/models/ProtectionModel_21Jan2015.js"),l=n("./src/streaming/protection/models/ProtectionModel_3Feb2014.js"),c=n("./src/streaming/protection/models/ProtectionModel_01b.js"),f=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],d=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}];r.__dashjs_factory_name="Protection";var h=dashjs.FactoryMaker.getClassFactory(r);h.events=o.default,h.errors=s.default,dashjs.FactoryMaker.updateClassFactory(r.__dashjs_factory_name,h),t.default=h},"./src/streaming/protection/ProtectionEvents.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function s(e){var t=c();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}n.r(t);var d=n("./src/core/events/EventsBase.js"),h=function(e){function t(){var e;return a(this,t),e=n.call(this),e.INTERNAL_KEY_MESSAGE="internalKeyMessage",e.INTERNAL_KEY_STATUS_CHANGED="internalkeyStatusChanged",e.KEY_ADDED="public_keyAdded",e.KEY_ERROR="public_keyError",e.KEY_MESSAGE="public_keyMessage",e.KEY_SESSION_CLOSED="public_keySessionClosed",e.KEY_SESSION_CREATED="public_keySessionCreated",e.KEY_SESSION_REMOVED="public_keySessionRemoved",e.KEY_STATUSES_CHANGED="public_keyStatusesChanged",e.KEY_SYSTEM_ACCESS_COMPLETE="public_keySystemAccessComplete",e.KEY_SYSTEM_SELECTED="public_keySystemSelected",e.LICENSE_REQUEST_COMPLETE="public_licenseRequestComplete",e.LICENSE_REQUEST_SENDING="public_licenseRequestSending",e.NEED_KEY="needkey",e.PROTECTION_CREATED="public_protectioncreated",e.PROTECTION_DESTROYED="public_protectiondestroyed",e.SERVER_CERTIFICATE_UPDATED="serverCertificateUpdated",e.TEARDOWN_COMPLETE="protectionTeardownComplete",e.VIDEO_ELEMENT_SELECTED="videoElementSelected",e.KEY_SESSION_UPDATED="public_keySessionUpdated",e}i(t,e);var n=s(t);return t}(d.default),g=new h;t.default=g},"./src/streaming/protection/controllers/ProtectionController.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e){function t(){ne=me.getLogger(te),re=[],ae=[],oe="temporary",se="",ce=[],fe=[],ge.on(pe.INTERNAL_KEY_MESSAGE,H,te),ge.on(pe.INTERNAL_KEY_STATUS_CHANGED,G,te)}function n(){if(!(ge&&ge.hasOwnProperty("on")&&de&&de.hasOwnProperty("getSupportedKeySystemsFromContentProtection")))throw new Error("Missing config parameter(s)")}function a(e){if(!e)throw new Error("mediaInfo can not be null or undefined");n(),ae.push(e);var t=de.getSupportedKeySystemsFromContentProtection(e.contentProtection,ie,oe);t=t.sort(function(e,n){var r=ie&&ie[e.ks.systemString]&&ie[e.ks.systemString].priority>=0?ie[e.ks.systemString].priority:t.length,a=ie&&ie[n.ks.systemString]&&ie[n.ks.systemString].priority>=0?ie[n.ks.systemString].priority:t.length;return r-a}),t&&t.length>0&&p(t,!0)}function p(e,t){le?re.push(e):ue?ue&&S(e):T(e,t)}function T(e,t){le=!0;var n,r=[];re.push(e);for(var a=0;a<e.length;a++){var i=U(e[a]);r.push({ks:e[a].ks,configs:[i]})}he.requestKeySystemAccess(r).then(function(e){return n=e.data,ne.info("DRM: KeySystem Access Granted ("+n.keySystem.systemString+")!  Selecting key system..."),he.selectKeySystem(n)}).then(function(e){if(ue=e,le=!1,he){ge.trigger(pe.KEY_SYSTEM_SELECTED,{data:n});var t,r=I(ue);r&&r.serverCertificate&&r.serverCertificate.length>0&&he.setServerCertificate(ye.decodeArray(r.serverCertificate).buffer);for(var a=0;a<re.length;a++)for(t=0;t<re[a].length;t++)if(ue===re[a][t].ks){var i=re[a][t];b(i);break}}}).catch(function(e){ue=null,le=!1,t||ge.trigger(pe.KEY_SYSTEM_SELECTED,{data:null,error:new l.default(u.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,u.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+"Error selecting key system! -- "+e.error)})})}function S(e){var t=e.findIndex(function(e){return e.ks===ue}),n=e[t];-1!==t&&n.initData&&b(n)}function b(e){if(de.isClearKey(ue)&&e.protData&&e.protData.hasOwnProperty("clearkeys")){var t={kids:Object.keys(e.protData.clearkeys)};e.initData=(new TextEncoder).encode(JSON.stringify(t))}e.sessionId?A(e):null!==e.initData&&R(e)}function A(e){n(),he.loadKeySession(e)}function R(e){var t=i.default.getPSSHForKeySystem(ue,e?e.initData:null);if(t){if(D(e.keyId))return;if(w(t))return;try{e.initData=t,he.createKeySession(e)}catch(e){ge.trigger(pe.KEY_SESSION_CREATED,{data:null,error:new l.default(u.default.KEY_SESSION_CREATED_ERROR_CODE,u.default.KEY_SESSION_CREATED_ERROR_MESSAGE+e.message)})}}else e&&e.initData?he.createKeySession(e):ge.trigger(pe.KEY_SESSION_CREATED,{data:null,error:new l.default(u.default.KEY_SESSION_CREATED_ERROR_CODE,u.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Selected key system is "+(ue?ue.systemString:null)+".  needkey/encrypted event contains no initData corresponding to that key system!")})}function I(e){if(e){var t=e.systemString;if(ie)return t in ie?ie[t]:null}return null}function C(){ae=[]}function N(e){return n(),de.getSupportedKeySystemsFromContentProtection(e,ie,oe)}function D(e){if(!e)return!1;try{for(var t=he.getSessions(),n=0;n<t.length;n++)if(t[n].getKeyId()===e)return!0;return!1}catch(e){return!1}}function w(e){if(!e)return!1;try{for(var t=he.getAllInitData(),n=0;n<t.length;n++)if(de.initDataEquals(e,t[n]))return ne.debug("DRM: Ignoring initData because we have already seen it!"),!0;return!1}catch(e){return!1}}function O(e){n(),he.removeKeySession(e)}function M(e){n(),he.closeKeySession(e)}function P(e){n(),he.setServerCertificate(e)}function L(e){n(),e?(he.setMediaElement(e),ge.on(pe.NEED_KEY,Q,te)):null===e&&(he.setMediaElement(e),ge.off(pe.NEED_KEY,Q,te))}function F(e){oe=e}function j(e){se=e}function x(e){ie=e,de.setProtectionData(e)}function k(){he&&he.stop()}function B(){ge.off(pe.INTERNAL_KEY_MESSAGE,H,te),ge.off(pe.INTERNAL_KEY_STATUS_CHANGED,G,te),n(),ce=[],fe=[],L(null),ue=null,le=!1,he&&(he.reset(),he=null),_e.forEach(function(e){return clearTimeout(e)}),_e=[],ae=[],re=[]}function U(e){var t=e.protData,n=[],r=[],a=t&&t.audioRobustness&&t.audioRobustness.length>0?t.audioRobustness:se,i=t&&t.videoRobustness&&t.videoRobustness.length>0?t.videoRobustness:se,u=e.sessionType,l=t&&t.distinctiveIdentifier?t.distinctiveIdentifier:"optional",c=t&&t.persistentState?t.persistentState:"temporary"===u?"optional":"required";return ae.forEach(function(e){e.type===Ee.AUDIO?n.push(new o.default(e.codec,a)):e.type===Ee.VIDEO&&r.push(new o.default(e.codec,i))}),new s.default(n,r,l,c,[u])}function G(e){e.error?ge.trigger(pe.KEY_STATUSES_CHANGED,{data:null,error:e.error}):ne.debug("DRM: key status = "+e.status)}function H(e){ne.debug("DRM: onKeyMessage");var t=e.data;ge.trigger(pe.KEY_MESSAGE,{data:t});var n=t.messageType?t.messageType:"license-request",r=t.message,a=t.sessionToken,i=I(ue),o=de.getLicenseServerModelInstance(ue,i,n),s={sessionToken:a,messageType:n};if(r&&0!==r.byteLength){if(!o)return ne.debug("DRM: License server request not required for this message (type = "+e.data.messageType+").  Session ID = "+a.getSessionId()),void q(s);if(de.isClearKey(ue)){var c=de.processClearKeyLicenseRequest(ue,i,r);if(c)return ne.debug("DRM: ClearKey license request handled by application!"),q(s),void he.updateKeySession(a,c)}Y(t,o,i)}else q(s,new l.default(u.default.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE,u.default.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE))}function q(e,t){ge.trigger(pe.LICENSE_REQUEST_COMPLETE,{data:e,error:t})}function Y(e,t,n){var r=e.sessionToken,a=e.messageType?e.messageType:"license-request",i={sessionToken:r,messageType:a},o=ue?ue.systemString:null,s=V(n,a,r,e,t);if(s){var g={},p=!1;n&&W(g,n.httpRequestHeaders);var m=e.message,y=ue.getRequestHeadersFromMessage(m);W(g,y),Object.keys(g).forEach(function(e){"authorization"===e.toLowerCase()&&(p=!0)}),n&&"boolean"==typeof n.withCredentials&&(p=n.withCredentials);var _=function(e){if(he)if(e.status>=200&&e.status<=299){var n=h.default.parseHttpHeaders(e.getAllResponseHeaders?e.getAllResponseHeaders():null),s=new f.default(e.responseURL,n,e.response);X(fe,s).then(function(){var n=t.getLicenseMessage(s.data,o,a);null!==n?(q(i),he.updateKeySession(r,n)):z(e,i,o,a,t)})}else z(e,i,o,a,t)},T=function(e){q(i,new l.default(u.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,u.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+o+' update, XHR aborted. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},S=function(e){q(i,new l.default(u.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,u.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+o+' update, XHR error. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},b=ue.getLicenseRequestFromMessage(m),A=t.getHTTPMethod(a),R=t.getResponseType(o,a),I=n&&!isNaN(n.httpTimeout)?n.httpTimeout:v,C=r.getSessionId()||null,N=new c.default(s,A,R,g,p,a,C,b),D=isNaN(Te.get().streaming.retryAttempts[d.HTTPRequest.LICENSE])?E:Te.get().streaming.retryAttempts[d.HTTPRequest.LICENSE];X(ce,N).then(function(){K(N,D,I,_,T,S)})}else q(i,new l.default(u.default.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE,u.default.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE))}function K(e,t,n,r,a,i){var o=new XMLHttpRequest;if(Te.get().streaming.cmcd&&Te.get().streaming.cmcd.enabled){var s=Te.get().streaming.cmcd.mode;if(s===g.default.CMCD_MODE_QUERY){var u=ve.getQueryParameter({url:e.url,type:d.HTTPRequest.LICENSE});u&&(e.url=h.default.addAditionalQueryParameterToUrl(e.url,[u]))}}for(var l in o.open(e.method,e.url,!0),o.responseType=e.responseType,o.withCredentials=e.withCredentials,n>0&&(o.timeout=n),e.headers)o.setRequestHeader(l,e.headers[l]);if(Te.get().streaming.cmcd&&Te.get().streaming.cmcd.enabled){var c=Te.get().streaming.cmcd.mode;if(c===g.default.CMCD_MODE_HEADER){var f=ve.getHeaderParameters({url:e.url,type:d.HTTPRequest.LICENSE});if(f)for(var p in f){var m=f[p];m&&o.setRequestHeader(p,m)}}}var y=function(){t--;var o=isNaN(Te.get().streaming.retryIntervals[d.HTTPRequest.LICENSE])?_:Te.get().streaming.retryIntervals[d.HTTPRequest.LICENSE];setTimeout(function(){K(e,t,n,r,a,i)},o)};o.onload=function(){this.status>=200&&this.status<=299||t<=0?r(this):(ne.warn("License request failed ("+this.status+"). Retrying it... Pending retries: "+t),y())},o.ontimeout=o.onerror=function(){t<=0?i(this):(ne.warn("License request network request failed . Retrying it... Pending retries: "+t),y())},o.onabort=function(){a(this)},ge.trigger(pe.LICENSE_REQUEST_SENDING,{url:e.url,headers:e.headers,payload:e.data,sessionId:e.sessionId}),o.send(e.data)}function V(e,t,n,a,o){var s=null,u=a.message;if(e&&e.serverURL){var l=e.serverURL;"string"==typeof l&&""!==l?s=l:"object"===r(l)&&l.hasOwnProperty(t)&&(s=l[t])}else if(e&&e.laURL&&""!==e.laURL)s=e.laURL;else if(s=i.default.getLicenseServerUrlFromMediaInfo(ae,ue.schemeIdURI),!s&&!de.isClearKey(ue)){var c=i.default.getPSSHData(n.initData);s=ue.getLicenseServerURLFromInitData(c),s||(s=a.laURL)}return s=o.getServerURLFromMessage(s,u,t),s}function W(e,t){if(t)for(var n in t)e[n]=t[n]}function z(e,t,n,r,a){var i=e.response?a.getErrorResponse(e.response,n,r):"NONE";q(t,new l.default(u.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,u.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+n+' update, XHR complete. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState+".  Response is "+i))}function X(e,t){return e?e.reduce(function(e,n){return e.then(function(){return n(t)})},Promise.resolve()):Promise.resolve()}function Q(e,t){if(!Te.get().streaming.protection.ignoreEmeEncryptedEvent){if(ne.debug("DRM: onNeedKey"),"cenc"!==e.key.initDataType)return void ne.warn("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+e.key.initDataType);if(0===ae.length&&(ne.warn("DRM: onNeedKey called before initializeForMedia, wait until initialized"),t=void 0===t?1:t+1,t<m))return void _e.push(setTimeout(function(){Q(e,t)},y));var n=e.key.initData;if(ArrayBuffer.isView(n)&&(n=n.buffer),ue){var r=i.default.getPSSHForKeySystem(ue,n);if(r&&w(r))return}ne.debug("DRM: initData:",String.fromCharCode.apply(null,new Uint8Array(n)));var a=de.getSupportedKeySystemsFromSegmentPssh(n,ie,oe);if(0===a.length)return void ne.debug("DRM: Received needkey event with initData, but we don't support any of the key systems!");p(a,!1)}}function J(){return de?de.getKeySystems():[]}function $(e){de&&de.setKeySystems(e)}function Z(e){ce=e}function ee(e){fe=e}e=e||{};var te,ne,re,ae,ie,oe,se,ue,le,ce,fe,de=e.protectionKeyController,he=e.protectionModel,ge=e.eventBus,pe=e.events,me=e.debug,ye=e.BASE64,Ee=e.constants,_e=[],ve=e.cmcdModel,Te=e.settings;return te={initializeForMedia:a,clearMediaInfoArray:C,createKeySession:R,loadKeySession:A,removeKeySession:O,closeKeySession:M,setServerCertificate:P,setMediaElement:L,setSessionType:F,setRobustnessLevel:j,setProtectionData:x,getSupportedKeySystemsFromContentProtection:N,getKeySystems:J,setKeySystems:$,setLicenseRequestFilters:Z,setLicenseResponseFilters:ee,stop:k,reset:B},t(),te}n.r(t);var i=n("./src/streaming/protection/CommonEncryption.js"),o=n("./src/streaming/protection/vo/MediaCapability.js"),s=n("./src/streaming/protection/vo/KeySystemConfiguration.js"),u=n("./src/streaming/protection/errors/ProtectionErrors.js"),l=n("./src/streaming/vo/DashJSError.js"),c=n("./src/streaming/protection/vo/LicenseRequest.js"),f=n("./src/streaming/protection/vo/LicenseResponse.js"),d=n("./src/streaming/vo/metrics/HTTPRequest.js"),h=n("./src/core/Utils.js"),g=n("./src/streaming/constants/Constants.js"),p=n("./src/core/FactoryMaker.js"),m=5,y=500,E=3,_=1e3,v=8e3;a.__dashjs_factory_name="ProtectionController",t.default=p.default.getClassFactory(a)},"./src/streaming/protection/controllers/ProtectionKeyController.js":function(e,t,n){function r(){function e(e){e&&(e.debug&&(I=e.debug,C=I.getLogger(R)),e.BASE64&&(D=e.BASE64))}function t(){var e;N=[],e=Object(u.default)(M).getInstance({BASE64:D}),N.push(e),e=Object(s.default)(M).getInstance({BASE64:D}),N.push(e),e=Object(i.default)(M).getInstance({BASE64:D}),N.push(e),w=e,e=Object(o.default)(M).getInstance({BASE64:D,debug:I}),N.push(e),O=e}function n(){return N}function r(e){N=e}function g(e){for(var t=0;t<N.length;t++)if(N[t].systemString===e)return N[t];return null}function p(e){return e===w||e===O}function m(e,t){if(e.byteLength===t.byteLength){for(var n=new Uint8Array(e),r=new Uint8Array(t),a=0;a<n.length;a++)if(n[a]!==r[a])return!1;return!0}return!1}function y(e,t,n){var r,i,o,s,u=[];if(e){var l=a.default.findCencContentProtection(e);for(o=0;o<N.length;++o){i=N[o];var c=S(i.systemString,t);for(s=0;s<e.length;++s)if(r=e[s],r.schemeIdUri.toLowerCase()===i.schemeIdURI){var f=i.getInitData(r,l);u.push({ks:N[o],keyId:r.keyId,initData:f,protData:c,cdmData:i.getCDMData(c?c.cdmData:null),sessionId:b(c,r),sessionType:A(c,n)})}}}return u}function E(e,t,n){for(var r,i,o=[],s=a.default.parsePSSHList(e),u=0;u<N.length;++u){r=N[u],i=r.systemString;var l=S(i,t);r.uuid in s&&o.push({ks:r,initData:s[r.uuid],protData:l,cdmData:r.getCDMData(l?l.cdmData:null),sessionId:b(l),sessionType:A(l,n)})}return o}function _(e,t,n){if("license-release"===n||"individualization-request"===n)return null;var r=null;return t&&t.hasOwnProperty("drmtoday")?r=Object(l.default)(M).getInstance({BASE64:D}):e.systemString===h.default.WIDEVINE_KEYSTEM_STRING?r=Object(f.default)(M).getInstance():e.systemString===h.default.PLAYREADY_KEYSTEM_STRING?r=Object(c.default)(M).getInstance():e.systemString===h.default.CLEARKEY_KEYSTEM_STRING&&(r=Object(d.default)(M).getInstance()),r}function v(e,t,n){try{return e.getClearKeysFromProtectionData(t,n)}catch(e){return C.error("Failed to retrieve clearkeys from ProtectionData"),null}}function T(e){for(var t=function(t){var n=null;return e&&(n=t in e?e[t]:null),n},n=0;n<N.length;n++){var r=N[n];r.hasOwnProperty("init")&&r.init(t(r.systemString))}}function S(e,t){return t&&e in t?t[e]:null}function b(e,t){return e&&e.sessionId?e.sessionId:t&&t.sessionId?t.sessionId:null}function A(e,t){return e&&e.sessionType?e.sessionType:t}var R,I,C,N,D,w,O,M=this.context;return R={initialize:t,setProtectionData:T,isClearKey:p,initDataEquals:m,getKeySystems:n,setKeySystems:r,getKeySystemBySystemString:g,getSupportedKeySystemsFromContentProtection:y,getSupportedKeySystemsFromSegmentPssh:E,getLicenseServerModelInstance:_,processClearKeyLicenseRequest:v,setConfig:e},R}n.r(t);var a=n("./src/streaming/protection/CommonEncryption.js"),i=n("./src/streaming/protection/drm/KeySystemClearKey.js"),o=n("./src/streaming/protection/drm/KeySystemW3CClearKey.js"),s=n("./src/streaming/protection/drm/KeySystemWidevine.js"),u=n("./src/streaming/protection/drm/KeySystemPlayReady.js"),l=n("./src/streaming/protection/servers/DRMToday.js"),c=n("./src/streaming/protection/servers/PlayReady.js"),f=n("./src/streaming/protection/servers/Widevine.js"),d=n("./src/streaming/protection/servers/ClearKey.js"),h=n("./src/streaming/constants/ProtectionConstants.js");r.__dashjs_factory_name="ProtectionKeyController",t.default=dashjs.FactoryMaker.getSingletonFactory(r)},"./src/streaming/protection/drm/KeySystemClearKey.js":function(e,t,n){function r(e){function t(e,t){var n=null;if(e){for(var r=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),o=[],s=0;s<r.kids.length;s++){var u=r.kids[s],l=e.clearkeys&&e.clearkeys.hasOwnProperty(u)?e.clearkeys[u]:null;if(!l)throw new Error("DRM: ClearKey keyID ("+u+") is not known!");o.push(new a.default(u,l))}n=new i.default(o)}return n}function n(e,t){try{var n=o.default.parseInitDataFromContentProtection(e,p);if(!n&&t){var a=r(t["cenc:default_KID"]),i={kids:[a]};n=(new TextEncoder).encode(JSON.stringify(i))}return n}catch(e){return null}}function r(e){try{var t=e.replace(/-/g,"");return t=btoa(t.match(/\w{2}/g).map(function(e){return String.fromCharCode(parseInt(e,16))}).join("")),t.replace(/=/g,"")}catch(e){return null}}function s(){return{"Content-Type":"application/json"}}function f(e){return JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e)))}function d(){return null}function h(){return null}var g;e=e||{};var p=e.BASE64;return g={uuid:u,schemeIdURI:c,systemString:l,getInitData:n,getRequestHeadersFromMessage:s,getLicenseRequestFromMessage:f,getLicenseServerURLFromInitData:d,getCDMData:h,getClearKeysFromProtectionData:t},g}n.r(t);var a=n("./src/streaming/protection/vo/KeyPair.js"),i=n("./src/streaming/protection/vo/ClearKeyKeySet.js"),o=n("./src/streaming/protection/CommonEncryption.js"),s=n("./src/streaming/constants/ProtectionConstants.js"),u="e2719d58-a985-b3c9-781a-b030af78d30e",l=s.default.CLEARKEY_KEYSTEM_STRING,c="urn:uuid:"+u;r.__dashjs_factory_name="KeySystemClearKey",t.default=dashjs.FactoryMaker.getSingletonFactory(r)},"./src/streaming/protection/drm/KeySystemPlayReady.js":function(e,t,n){function r(e){function t(){if(!p||!p.hasOwnProperty("decodeArray")||!p.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}function n(e){var t,n,r={},a=new DOMParser,i="utf-16"===g?new Uint16Array(e):new Uint8Array(e);t=String.fromCharCode.apply(null,i),n=a.parseFromString(t,"application/xml");for(var o=n.getElementsByTagName("name"),s=n.getElementsByTagName("value"),u=0;u<o.length;u++)r[o[u].childNodes[0].nodeValue]=s[u].childNodes[0].nodeValue;return r.hasOwnProperty("Content")&&(r["Content-Type"]=r.Content,delete r.Content),r.hasOwnProperty("Content-Type")||(r["Content-Type"]="text/xml; charset=utf-8"),r}function r(e){var n=null,r=new DOMParser,a="utf-16"===g?new Uint16Array(e):new Uint8Array(e);t();var i=String.fromCharCode.apply(null,a),o=r.parseFromString(i,"application/xml");if(!o.getElementsByTagName("PlayReadyKeyMessage")[0])return e;var s=o.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;return s&&(n=p.decode(s)),n}function i(e){if(e)for(var t=new DataView(e),n=t.getUint16(4,!0),r=6,a=new DOMParser,i=0;i<n;i++){var o=t.getUint16(r,!0);r+=2;var s=t.getUint16(r,!0);if(r+=2,1===o){var u=e.slice(r,r+s),l=String.fromCharCode.apply(null,new Uint16Array(u)),c=a.parseFromString(l,"application/xml");if(c.getElementsByTagName("LA_URL")[0]){var f=c.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(f)return f}if(c.getElementsByTagName("LUI_URL")[0]){var d=c.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(d)return d}}else r+=s}return null}function c(e){var n,r,i,o,s,u=new Uint8Array([112,115,115,104,0,0,0,0]),l=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),c=0,f=null;if(t(),!e)return null;if("pssh"in e)return a.default.parseInitDataFromContentProtection(e,p);if("pro"in e)f=p.decodeArray(e.pro.__text);else{if(!("prheader"in e))return null;f=p.decodeArray(e.prheader.__text)}return n=f.length,r=4+u.length+l.length+4+n,i=new ArrayBuffer(r),o=new Uint8Array(i),s=new DataView(i),s.setUint32(c,r),c+=4,o.set(u,c),c+=u.length,o.set(l,c),c+=l.length,s.setUint32(c,n),c+=4,o.set(f,c),c+=n,o.buffer}function f(e){if("utf-8"!==e&&"utf-16"!==e)throw new Error('Specified message format is not one of "utf-8" or "utf-16"');g=e}function d(e){var n,r,a,i;if(t(),!e)return null;for(n=[],i=0;i<e.length;++i)n.push(e.charCodeAt(i)),n.push(0);for(n=String.fromCharCode.apply(null,n),n=p.encode(n),r=l.replace("%CUSTOMDATA%",n),a=[],i=0;i<r.length;++i)a.push(r.charCodeAt(i)),a.push(0);return new Uint8Array(a).buffer}var h;e=e||{};var g="utf-16",p=e.BASE64;return h={uuid:o,schemeIdURI:u,systemString:s,getInitData:c,getRequestHeadersFromMessage:n,getLicenseRequestFromMessage:r,getLicenseServerURLFromInitData:i,getCDMData:d,setPlayReadyMessageFormat:f},h}n.r(t);var a=n("./src/streaming/protection/CommonEncryption.js"),i=n("./src/streaming/constants/ProtectionConstants.js"),o="9a04f079-9840-4286-ab92-e65be0885f95",s=i.default.PLAYREADY_KEYSTEM_STRING,u="urn:uuid:"+o,l='<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="false"><CustomData encoding="base64encoded">%CUSTOMDATA%</CustomData></LicenseAcquisition></PlayReadyCDMData>';r.__dashjs_factory_name="KeySystemPlayReady",t.default=dashjs.FactoryMaker.getSingletonFactory(r)},"./src/streaming/protection/drm/KeySystemW3CClearKey.js":function(e,t,n){function r(e){function t(e,t){var n=null;if(e){for(var r=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),o=[],s=0;s<r.kids.length;s++){var u=r.kids[s],l=e.clearkeys&&e.clearkeys.hasOwnProperty(u)?e.clearkeys[u]:null;if(!l)throw new Error("DRM: ClearKey keyID ("+u+") is not known!");o.push(new a.default(u,l))}n=new i.default(o),p.warn("ClearKey schemeIdURI is using W3C Common PSSH systemID (1077efec-c0b2-4d02-ace3-3c1e52e2fb4b) in Content Protection. See DASH-IF IOP v4.1 section 7.6.2.4")}return n}function n(e){return o.default.parseInitDataFromContentProtection(e,g)}function r(){return null}function s(e){return new Uint8Array(e)}function f(){return null}function d(){return null}var h,g=e.BASE64,p=e.debug.getLogger(h);return h={uuid:u,schemeIdURI:c,systemString:l,getInitData:n,getRequestHeadersFromMessage:r,getLicenseRequestFromMessage:s,getLicenseServerURLFromInitData:f,getCDMData:d,getClearKeysFromProtectionData:t},h}n.r(t);var a=n("./src/streaming/protection/vo/KeyPair.js"),i=n("./src/streaming/protection/vo/ClearKeyKeySet.js"),o=n("./src/streaming/protection/CommonEncryption.js"),s=n("./src/streaming/constants/ProtectionConstants.js"),u="1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",l=s.default.CLEARKEY_KEYSTEM_STRING,c="urn:uuid:"+u;r.__dashjs_factory_name="KeySystemW3CClearKey",t.default=dashjs.FactoryMaker.getSingletonFactory(r)},"./src/streaming/protection/drm/KeySystemWidevine.js":function(e,t,n){function r(e){function t(e){return a.default.parseInitDataFromContentProtection(e,f)}function n(){return null}function r(e){return new Uint8Array(e)}function i(){return null}function l(){return null}var c;e=e||{};var f=e.BASE64;return c={uuid:o,schemeIdURI:u,systemString:s,getInitData:t,getRequestHeadersFromMessage:n,getLicenseRequestFromMessage:r,getLicenseServerURLFromInitData:i,getCDMData:l},c}n.r(t);var a=n("./src/streaming/protection/CommonEncryption.js"),i=n("./src/streaming/constants/ProtectionConstants.js"),o="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",s=i.default.WIDEVINE_KEYSTEM_STRING,u="urn:uuid:"+o;r.__dashjs_factory_name="KeySystemWidevine",t.default=dashjs.FactoryMaker.getSingletonFactory(r)},"./src/streaming/protection/errors/ProtectionErrors.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function s(e){var t=c();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}n.r(t);var d=n("./src/core/errors/ErrorsBase.js"),h=function(e){function t(){var e;return a(this,t),e=n.call(this),e.MEDIA_KEYERR_CODE=100,e.MEDIA_KEYERR_UNKNOWN_CODE=101,e.MEDIA_KEYERR_CLIENT_CODE=102,e.MEDIA_KEYERR_SERVICE_CODE=103,e.MEDIA_KEYERR_OUTPUT_CODE=104,e.MEDIA_KEYERR_HARDWARECHANGE_CODE=105,e.MEDIA_KEYERR_DOMAIN_CODE=106,e.MEDIA_KEY_MESSAGE_ERROR_CODE=107,e.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE=108,e.SERVER_CERTIFICATE_UPDATED_ERROR_CODE=109,e.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE=110,e.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE=111,e.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE=112,e.KEY_SESSION_CREATED_ERROR_CODE=113,e.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE=114,e.MEDIA_KEYERR_UNKNOWN_MESSAGE="An unspecified error occurred. This value is used for errors that don't match any of the other codes.",e.MEDIA_KEYERR_CLIENT_MESSAGE="The Key System could not be installed or updated.",e.MEDIA_KEYERR_SERVICE_MESSAGE="The message passed into update indicated an error from the license service.",e.MEDIA_KEYERR_OUTPUT_MESSAGE="There is no available output device with the required characteristics for the content protection system.",e.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE="A hardware configuration change caused a content protection error.",e.MEDIA_KEYERR_DOMAIN_MESSAGE="An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain.",e.MEDIA_KEY_MESSAGE_ERROR_MESSAGE="Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!",e.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE="DRM: Empty key message from CDM",e.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE="Error updating server certificate -- ",e.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE="DRM: KeyStatusChange error! -- License has expired",e.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE="DRM: No license server URL specified!",e.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE="DRM: KeySystem Access Denied! -- ",e.KEY_SESSION_CREATED_ERROR_MESSAGE="DRM: unable to create session! --",e.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE="DRM: licenser error! --",e}i(t,e);var n=s(t);return t}(d.default),g=new h;t.default=g},"./src/streaming/protection/models/ProtectionModel_01b.js":function(e,t,n){function r(e){function t(){R=j.getLogger(A),I=null,C=null,D=[],w=[],N=Object(a.default)(P).getInstance(),M=T()}function n(){I&&b();for(var e=0;e<w.length;e++)y(w[e]);L.trigger(F.TEARDOWN_COMPLETE)}function r(){for(var e=[],t=0;t<D.length;t++)e.push(D[t].initData);for(var n=0;n<w.length;n++)e.push(w[n].initData);return e}function f(){return w.concat(D)}function d(e){return new Promise(function(t,n){var r=I;r||(r=document.createElement("video"));for(var a=!1,i=0;i<e.length;i++)for(var o=e[i].ks.systemString,s=e[i].configs,c=null,f=null,d=0;d<s.length;d++){var h=s[d].videoCapabilities;if(h&&0!==h.length){f=[];for(var g=0;g<h.length;g++)""!==r.canPlayType(h[g].contentType,o)&&f.push(h[g])}if(!(!f||c&&0===c.length||f&&0===f.length)){a=!0;var p=new u.default(c,f),m=N.getKeySystemBySystemString(o),y=new l.default(m,p);L.trigger(F.KEY_SYSTEM_ACCESS_COMPLETE,{data:y}),t({data:y});break}}if(!a){var E="Key system access denied! -- No valid audio/video content configurations detected!";L.trigger(F.KEY_SYSTEM_ACCESS_COMPLETE,{error:E}),n({error:E})}})}function h(e){return C=e.keySystem,Promise.resolve(C)}function g(e){if(I!==e){if(I){b();for(var t=0;t<w.length;t++)y(w[t]);w=[]}I=e,I&&(I.addEventListener(x.keyerror,M),I.addEventListener(x.needkey,M),I.addEventListener(x.keymessage,M),I.addEventListener(x.keyadded,M),L.trigger(F.VIDEO_ELEMENT_SELECTED))}}function p(e){if(!C)throw new Error("Can not create sessions until you have selected a key system");if(O||0===w.length){var t={sessionId:null,keyId:e.keyId,initData:e.initData,getKeyId:function(){return this.keyId},getSessionId:function(){return this.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};return D.push(t),I[x.generateKeyRequest](C.systemString,new Uint8Array(e.initData)),t}throw new Error("Multiple sessions not allowed!")}function m(e,t){
var n=e.sessionId;if(N.isClearKey(C))for(var r=0;r<t.keyPairs.length;r++)I[x.addKey](C.systemString,t.keyPairs[r].key,t.keyPairs[r].keyID,n);else I[x.addKey](C.systemString,new Uint8Array(t),new Uint8Array(e.initData),n);L.trigger(F.KEY_SESSION_UPDATED)}function y(e){try{I[x.cancelKeyRequest](C.systemString,e.sessionId)}catch(t){L.trigger(F.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.sessionId+") "+t.message})}}function E(){}function _(){}function v(){}function T(){return{handleEvent:function(e){var t=null;switch(e.type){case x.needkey:var n=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;L.trigger(F.NEED_KEY,{key:new i.default(n,"cenc")});break;case x.keyerror:if(t=S(w,e.sessionId),t||(t=S(D,e.sessionId)),t){var r=c.default.MEDIA_KEYERR_CODE,a="";switch(e.errorCode.code){case 1:r=c.default.MEDIA_KEYERR_UNKNOWN_CODE,a+="MEDIA_KEYERR_UNKNOWN - "+c.default.MEDIA_KEYERR_UNKNOWN_MESSAGE;break;case 2:r=c.default.MEDIA_KEYERR_CLIENT_CODE,a+="MEDIA_KEYERR_CLIENT - "+c.default.MEDIA_KEYERR_CLIENT_MESSAGE;break;case 3:r=c.default.MEDIA_KEYERR_SERVICE_CODE,a+="MEDIA_KEYERR_SERVICE - "+c.default.MEDIA_KEYERR_SERVICE_MESSAGE;break;case 4:r=c.default.MEDIA_KEYERR_OUTPUT_CODE,a+="MEDIA_KEYERR_OUTPUT - "+c.default.MEDIA_KEYERR_OUTPUT_MESSAGE;break;case 5:r=c.default.MEDIA_KEYERR_HARDWARECHANGE_CODE,a+="MEDIA_KEYERR_HARDWARECHANGE - "+c.default.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE;break;case 6:r=c.default.MEDIA_KEYERR_DOMAIN_CODE,a+="MEDIA_KEYERR_DOMAIN - "+c.default.MEDIA_KEYERR_DOMAIN_MESSAGE}a+="  System Code = "+e.systemCode,L.trigger(F.KEY_ERROR,{error:new o.default(r,a,t)})}else R.error("No session token found for key error");break;case x.keyadded:t=S(w,e.sessionId),t||(t=S(D,e.sessionId)),t?(R.debug("DRM: Key added."),L.trigger(F.KEY_ADDED,{data:t})):R.debug("No session token found for key added");break;case x.keymessage:if(O=null!==e.sessionId&&void 0!==e.sessionId,O?(t=S(w,e.sessionId),!t&&D.length>0&&(t=D.shift(),w.push(t),t.sessionId=e.sessionId,L.trigger(F.KEY_SESSION_CREATED,{data:t}))):D.length>0&&(t=D.shift(),w.push(t),0!==D.length&&k.error(new o.default(c.default.MEDIA_KEY_MESSAGE_ERROR_CODE,c.default.MEDIA_KEY_MESSAGE_ERROR_MESSAGE))),t){var u=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;t.keyMessage=u,L.trigger(F.INTERNAL_KEY_MESSAGE,{data:new s.default(t,u,e.defaultURL)})}else R.warn("No session token found for key message")}}}}function S(e,t){if(t&&e){for(var n=e.length,r=0;r<n;r++)if(e[r].sessionId==t)return e[r];return null}return null}function b(){I.removeEventListener(x.keyerror,M),I.removeEventListener(x.needkey,M),I.removeEventListener(x.keymessage,M),I.removeEventListener(x.keyadded,M)}e=e||{};var A,R,I,C,N,D,w,O,M,P=this.context,L=e.eventBus,F=e.events,j=e.debug,x=e.api,k=e.errHandler;return A={getAllInitData:r,getSessions:f,requestKeySystemAccess:d,selectKeySystem:h,setMediaElement:g,createKeySession:p,updateKeySession:m,closeKeySession:y,setServerCertificate:E,loadKeySession:_,removeKeySession:v,stop:n,reset:n},t(),A}n.r(t);var a=n("./src/streaming/protection/controllers/ProtectionKeyController.js"),i=n("./src/streaming/protection/vo/NeedKey.js"),o=n("./src/streaming/vo/DashJSError.js"),s=n("./src/streaming/protection/vo/KeyMessage.js"),u=n("./src/streaming/protection/vo/KeySystemConfiguration.js"),l=n("./src/streaming/protection/vo/KeySystemAccess.js"),c=n("./src/streaming/protection/errors/ProtectionErrors.js");r.__dashjs_factory_name="ProtectionModel_01b",t.default=dashjs.FactoryMaker.getClassFactory(r)},"./src/streaming/protection/models/ProtectionModel_21Jan2015.js":function(e,t,n){function r(e){function t(){D=B.getLogger(N),w=null,O=null,M=null,P=[],F=Object(a.default)(j).getInstance(),L=A()}function n(){var e,t=P.length;0!==t?function(){for(var n=function(e){R(e),0===P.length&&(O?(O.removeEventListener("encrypted",L),O.setMediaKeys(null).then(function(){x.trigger(k.TEARDOWN_COMPLETE)})):x.trigger(k.TEARDOWN_COMPLETE))},r=0;r<t;r++)e=P[r],function(t){e.session.closed.then(function(){n(t)}),b(e).catch(function(){n(t)})}(e)}():x.trigger(k.TEARDOWN_COMPLETE)}function r(){for(var e,t=0;t<P.length;t++)e=P[t],e.getUsable()||b(e).catch(function(){R(e)})}function f(){for(var e=[],t=0;t<P.length;t++)P[t].initData&&e.push(P[t].initData);return e}function d(){return P}function h(e){return new Promise(function(t,n){g(e,0,t,n)})}function g(e,t,n,r){if(void 0===navigator.requestMediaKeySystemAccess||"function"!=typeof navigator.requestMediaKeySystemAccess){var a="Insecure origins are not allowed";return x.trigger(k.KEY_SYSTEM_ACCESS_COMPLETE,{error:a}),void r({error:a})}var i=e[t].ks,o=e[t].configs,s=i.systemString;s===c.default.PLAYREADY_KEYSTEM_STRING&&"required"===o[0].persistentState&&(s+=".recommendation"),navigator.requestMediaKeySystemAccess(s,o).then(function(e){var t="function"==typeof e.getConfiguration?e.getConfiguration():null,r=new l.default(i,t);r.mksa=e,x.trigger(k.KEY_SYSTEM_ACCESS_COMPLETE,{data:r}),n({data:r})}).catch(function(a){if(t+1<e.length)g(e,t+1,n,r);else{var i="Key system access denied! ";x.trigger(k.KEY_SYSTEM_ACCESS_COMPLETE,{error:i+a.message}),r({error:i+a.message})}})}function p(e){return new Promise(function(t,n){e.mksa.createMediaKeys().then(function(t){return w=e.keySystem,M=t,O?O.setMediaKeys(M):Promise.resolve()}).then(function(){t(w)}).catch(function(){n({error:"Error selecting keys system ("+e.keySystem.systemString+")! Could not create MediaKeys -- TODO"})})})}function m(e){O!==e&&(O&&(O.removeEventListener("encrypted",L),O.setMediaKeys&&O.setMediaKeys(null)),O=e,O&&(O.addEventListener("encrypted",L),O.setMediaKeys&&M&&O.setMediaKeys(M)))}function y(e){if(!w||!M)throw new Error("Can not set server certificate until you have selected a key system");M.setServerCertificate(e).then(function(){D.info("DRM: License server certificate successfully updated."),x.trigger(k.SERVER_CERTIFICATE_UPDATED)}).catch(function(e){x.trigger(k.SERVER_CERTIFICATE_UPDATED,{error:new s.default(o.default.SERVER_CERTIFICATE_UPDATED_ERROR_CODE,o.default.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE+e.name)})})}function E(e){if(!w||!M)throw new Error("Can not create sessions until you have selected a key system");var t=M.createSession(e.sessionType),n=C(t,e),r=w.systemString===c.default.CLEARKEY_KEYSTEM_STRING&&(e.initData||e.protData&&e.protData.clearkeys)?c.default.INITIALIZATION_DATA_TYPE_KEYIDS:c.default.INITIALIZATION_DATA_TYPE_CENC;t.generateRequest(r,e.initData).then(function(){D.debug("DRM: Session created.  SessionID = "+n.getSessionId()),x.trigger(k.KEY_SESSION_CREATED,{data:n})}).catch(function(e){R(n),x.trigger(k.KEY_SESSION_CREATED,{data:null,error:new s.default(o.default.KEY_SESSION_CREATED_ERROR_CODE,o.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Error generating key request -- "+e.name)})})}function _(e,t){var n=e.session;F.isClearKey(w)&&(t=t.toJWK()),n.update(t).then(function(){x.trigger(k.KEY_SESSION_UPDATED)}).catch(function(t){x.trigger(k.KEY_ERROR,{error:new s.default(o.default.MEDIA_KEYERR_CODE,"Error sending update() message! "+t.name,e)})})}function v(e){if(!w||!M)throw new Error("Can not load sessions until you have selected a key system");for(var t=e.sessionId,n=0;n<P.length;n++)if(t===P[n].sessionId)return void D.warn("DRM: Ignoring session ID because we have already seen it!");var r=M.createSession(e.sessionType),a=C(r,e);r.load(t).then(function(e){e?(D.debug("DRM: Session loaded.  SessionID = "+a.getSessionId()),x.trigger(k.KEY_SESSION_CREATED,{data:a})):(R(a),x.trigger(k.KEY_SESSION_CREATED,{data:null,error:new s.default(o.default.KEY_SESSION_CREATED_ERROR_CODE,o.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session! Invalid Session ID ("+t+")")}))}).catch(function(e){R(a),x.trigger(k.KEY_SESSION_CREATED,{data:null,error:new s.default(o.default.KEY_SESSION_CREATED_ERROR_CODE,o.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session ("+t+")! "+e.name)})})}function T(e){var t=e.session;t.remove().then(function(){D.debug("DRM: Session removed.  SessionID = "+e.getSessionId()),x.trigger(k.KEY_SESSION_REMOVED,{data:e.getSessionId()})},function(t){x.trigger(k.KEY_SESSION_REMOVED,{data:null,error:"Error removing session ("+e.getSessionId()+"). "+t.name})})}function S(e){b(e).catch(function(t){R(e),x.trigger(k.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.getSessionId()+") "+t.name})})}function b(e){var t=e.session;return t.removeEventListener("keystatuseschange",e),t.removeEventListener("message",e),t.close()}function A(){return{handleEvent:function(e){switch(e.type){case"encrypted":if(e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;x.trigger(k.NEED_KEY,{key:new i.default(t,e.initDataType)})}}}}}function R(e){for(var t=0;t<P.length;t++)if(P[t]===e){P.splice(t,1);break}}function I(e){var t,n;return e&&e.length>0&&(e[0]&&("string"==typeof e[0]?t=e[0]:n=e[0]),e[1]&&("string"==typeof e[1]?t=e[1]:n=e[1])),{status:t,keyId:n}}function C(e,t){var n={session:e,keyId:t.keyId,initData:t.initData,sessionId:t.sessionId,sessionType:t.sessionType,handleEvent:function(e){switch(e.type){case"keystatuseschange":x.trigger(k.KEY_STATUSES_CHANGED,{data:this}),e.target.keyStatuses.forEach(function(){var e=I(arguments);switch(e.status){case"expired":x.trigger(k.INTERNAL_KEY_STATUS_CHANGED,{error:new s.default(o.default.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE,o.default.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE)});break;default:x.trigger(k.INTERNAL_KEY_STATUS_CHANGED,e)}});break;case"message":var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;x.trigger(k.INTERNAL_KEY_MESSAGE,{data:new u.default(this,t,void 0,e.messageType)})}},getKeyId:function(){return this.keyId},getSessionId:function(){return e.sessionId},getSessionType:function(){return this.sessionType},getExpirationTime:function(){return e.expiration},getKeyStatuses:function(){return e.keyStatuses},getUsable:function(){var t=!1;return e.keyStatuses.forEach(function(){var e=I(arguments);"usable"===e.status&&(t=!0)}),t}};return e.addEventListener("keystatuseschange",n),e.addEventListener("message",n),e.closed.then(function(){R(n),D.debug("DRM: Session closed.  SessionID = "+n.getSessionId()),x.trigger(k.KEY_SESSION_CLOSED,{data:n.getSessionId()})}),P.push(n),n}e=e||{};var N,D,w,O,M,P,L,F,j=this.context,x=e.eventBus,k=e.events,B=e.debug;return N={getAllInitData:f,getSessions:d,requestKeySystemAccess:h,selectKeySystem:p,setMediaElement:m,setServerCertificate:y,createKeySession:E,updateKeySession:_,loadKeySession:v,removeKeySession:T,closeKeySession:S,stop:r,reset:n},t(),N}n.r(t);var a=n("./src/streaming/protection/controllers/ProtectionKeyController.js"),i=n("./src/streaming/protection/vo/NeedKey.js"),o=n("./src/streaming/protection/errors/ProtectionErrors.js"),s=n("./src/streaming/vo/DashJSError.js"),u=n("./src/streaming/protection/vo/KeyMessage.js"),l=n("./src/streaming/protection/vo/KeySystemAccess.js"),c=n("./src/streaming/constants/ProtectionConstants.js");r.__dashjs_factory_name="ProtectionModel_21Jan2015",t.default=dashjs.FactoryMaker.getClassFactory(r)},"./src/streaming/protection/models/ProtectionModel_3Feb2014.js":function(e,t,n){function r(e){function t(){R=j.getLogger(A),I=null,C=null,N=null,D=null,w=[],M=Object(a.default)(P).getInstance(),O=T()}function n(){try{for(var e=0;e<w.length;e++)y(w[e]);I&&I.removeEventListener(x.needkey,O),L.trigger(F.TEARDOWN_COMPLETE)}catch(e){L.trigger(F.TEARDOWN_COMPLETE,{error:"Error tearing down key sessions and MediaKeys! -- "+e.message})}}function r(){for(var e=[],t=0;t<w.length;t++)e.push(w[t].initData);return e}function f(){return w}function d(e){return new Promise(function(t,n){for(var r=!1,a=0;a<e.length;a++)for(var i=e[a].ks.systemString,o=e[a].configs,s=null,u=null,f=0;f<o.length;f++){var d=o[f].audioCapabilities,h=o[f].videoCapabilities;if(d&&0!==d.length){s=[];for(var g=0;g<d.length;g++)window[x.MediaKeys].isTypeSupported(i,d[g].contentType)&&s.push(d[g])}if(h&&0!==h.length){u=[];for(var p=0;p<h.length;p++)window[x.MediaKeys].isTypeSupported(i,h[p].contentType)&&u.push(h[p])}if(!(!s&&!u||s&&0===s.length||u&&0===u.length)){r=!0;var m=new l.default(s,u),y=M.getKeySystemBySystemString(i),E=new c.default(y,m);L.trigger(F.KEY_SYSTEM_ACCESS_COMPLETE,{data:E}),t({data:E});break}}if(!r){var _="Key system access denied! -- No valid audio/video content configurations detected!";L.trigger(F.KEY_SYSTEM_ACCESS_COMPLETE,{error:_}),n({error:_})}})}function h(e){return new Promise(function(t,n){try{N=e.mediaKeys=new window[x.MediaKeys](e.keySystem.systemString),C=e.keySystem,D=e,I&&S(),t(C)}catch(e){n({error:"Error selecting keys system ("+C.systemString+")! Could not create MediaKeys -- TODO"})}})}function g(e){I!==e&&(I&&I.removeEventListener(x.needkey,O),I=e,I&&(I.addEventListener(x.needkey,O),N&&S()))}function p(e){if(!C||!N||!D)throw new Error("Can not create sessions until you have selected a key system");var t=null;if(D.ksConfiguration.videoCapabilities&&D.ksConfiguration.videoCapabilities.length>0&&(t=D.ksConfiguration.videoCapabilities[0]),null===t&&D.ksConfiguration.audioCapabilities&&D.ksConfiguration.audioCapabilities.length>0&&(t=D.ksConfiguration.audioCapabilities[0]),null===t)throw new Error("Can not create sessions for unknown content types.");var n=t.contentType,r=N.createSession(n,new Uint8Array(e.initData),e.cdmData?new Uint8Array(e.cdmData):null),a=b(r,e);r.addEventListener(x.error,a),r.addEventListener(x.message,a),r.addEventListener(x.ready,a),r.addEventListener(x.close,a),w.push(a),R.debug("DRM: Session created.  SessionID = "+a.getSessionId()),L.trigger(F.KEY_SESSION_CREATED,{data:a})}function m(e,t){var n=e.session;M.isClearKey(C)?n.update(new Uint8Array(t.toJWK())):n.update(new Uint8Array(t)),L.trigger(F.KEY_SESSION_UPDATED)}function y(e){var t=e.session;t.removeEventListener(x.error,e),t.removeEventListener(x.message,e),t.removeEventListener(x.ready,e),t.removeEventListener(x.close,e);for(var n=0;n<w.length;n++)if(w[n]===e){w.splice(n,1);break}t[x.release]()}function E(){}function _(){}function v(){}function T(){return{handleEvent:function(e){switch(e.type){case x.needkey:if(e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;L.trigger(F.NEED_KEY,{key:new i.default(t,"cenc")})}}}}}function S(){var e=null,t=function(){I.removeEventListener("loadedmetadata",e),I[x.setMediaKeys](N),L.trigger(F.VIDEO_ELEMENT_SELECTED)};I.readyState>=1?t():(e=t.bind(this),I.addEventListener("loadedmetadata",e))}function b(e,t){return{session:e,keyId:t.keyId,initData:t.initData,getKeyId:function(){return this.keyId},getSessionId:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"},handleEvent:function(e){switch(e.type){case x.error:var t="KeyError";L.trigger(F.KEY_ERROR,{error:new o.default(s.default.MEDIA_KEYERR_CODE,t,this)});break;case x.message:var n=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;L.trigger(F.INTERNAL_KEY_MESSAGE,{data:new u.default(this,n,e.destinationURL)});break;case x.ready:R.debug("DRM: Key added."),L.trigger(F.KEY_ADDED);break;case x.close:R.debug("DRM: Session closed.  SessionID = "+this.getSessionId()),L.trigger(F.KEY_SESSION_CLOSED,{data:this.getSessionId()})}}}}e=e||{};var A,R,I,C,N,D,w,O,M,P=this.context,L=e.eventBus,F=e.events,j=e.debug,x=e.api;return A={getAllInitData:r,getSessions:f,requestKeySystemAccess:d,selectKeySystem:h,setMediaElement:g,createKeySession:p,updateKeySession:m,closeKeySession:y,setServerCertificate:E,loadKeySession:_,removeKeySession:v,stop:n,reset:n},t(),A}n.r(t);var a=n("./src/streaming/protection/controllers/ProtectionKeyController.js"),i=n("./src/streaming/protection/vo/NeedKey.js"),o=n("./src/streaming/vo/DashJSError.js"),s=n("./src/streaming/protection/errors/ProtectionErrors.js"),u=n("./src/streaming/protection/vo/KeyMessage.js"),l=n("./src/streaming/protection/vo/KeySystemConfiguration.js"),c=n("./src/streaming/protection/vo/KeySystemAccess.js");r.__dashjs_factory_name="ProtectionModel_3Feb2014",t.default=dashjs.FactoryMaker.getClassFactory(r)},"./src/streaming/protection/servers/ClearKey.js":function(e,t,n){function r(){function e(e){return e}function t(){return"POST"}function n(){return"json"}function r(e){if(!e.hasOwnProperty("keys"))return null;for(var t=[],n=0;n<e.keys.length;n++){var r=e.keys[n],o=r.kid.replace(/=/g,""),s=r.k.replace(/=/g,"");t.push(new a.default(o,s))}return new i.default(t)}function o(e){return String.fromCharCode.apply(null,new Uint8Array(e))}var s;return s={getServerURLFromMessage:e,getHTTPMethod:t,getResponseType:n,getLicenseMessage:r,getErrorResponse:o},s}n.r(t);var a=n("./src/streaming/protection/vo/KeyPair.js"),i=n("./src/streaming/protection/vo/ClearKeyKeySet.js");r.__dashjs_factory_name="ClearKey",t.default=dashjs.FactoryMaker.getSingletonFactory(r)},"./src/streaming/protection/servers/DRMToday.js":function(e,t,n){function r(e){function t(){if(!l||!l.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}function n(e){return e}function r(){return"POST"}function i(e){return c[e].responseType}function o(e,n){return t(),c[n].getLicenseMessage(e)}function s(e,t){return c[t].getErrorResponse(e)}e=e||{};var u,l=e.BASE64,c={};return c[a.default.WIDEVINE_KEYSTEM_STRING]={responseType:"json",getLicenseMessage:function(e){return l.decodeArray(e.license)},getErrorResponse:function(e){return e}},c[a.default.PLAYREADY_KEYSTEM_STRING]={responseType:"arraybuffer",getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}},u={getServerURLFromMessage:n,getHTTPMethod:r,getResponseType:i,getLicenseMessage:o,getErrorResponse:s},u}n.r(t);var a=n("./src/streaming/constants/ProtectionConstants.js");r.__dashjs_factory_name="DRMToday",t.default=dashjs.FactoryMaker.getSingletonFactory(r)},"./src/streaming/protection/servers/PlayReady.js":function(e,t,n){function r(){function e(e){var t=String.fromCharCode.apply(null,new Uint8Array(e)),n=decodeURIComponent(escape(t));return n}function t(t){if(window.DOMParser){var n=e(t),r=new window.DOMParser,a=r.parseFromString(n,"text/xml"),i=a?a.getElementsByTagNameNS(l,"Envelope")[0]:null,o=i?i.getElementsByTagNameNS(l,"Body")[0]:null,s=o?o.getElementsByTagNameNS(l,"Fault")[0]:null;if(s)return null}return t}function n(t){var n="",r="",a="",i=-1,o=-1;if(window.DOMParser){var s=e(t),u=new window.DOMParser,c=u.parseFromString(s,"text/xml"),f=c?c.getElementsByTagNameNS(l,"Envelope")[0]:null,d=f?f.getElementsByTagNameNS(l,"Body")[0]:null,h=d?d.getElementsByTagNameNS(l,"Fault")[0]:null,g=h?h.getElementsByTagName("detail")[0]:null,p=g?g.getElementsByTagName("Exception")[0]:null,m=null;if(null===h)return s;m=h.getElementsByTagName("faultstring")[0].firstChild,n=m?m.nodeValue:null,null!==p&&(m=p.getElementsByTagName("StatusCode")[0],r=m?m.firstChild.nodeValue:null,m=p.getElementsByTagName("Message")[0],a=m?m.firstChild.nodeValue:null,i=a?a.lastIndexOf("[")+1:-1,o=a?a.indexOf("]"):-1,a=a?a.substring(i,o):"")}var y="code: ".concat(r,", name: ").concat(n);return a&&(y+=", message: ".concat(a)),y}function r(e){return e}function a(){return"POST"}function i(){return"arraybuffer"}function o(e){return t.call(this,e)}function s(e){return n.call(this,e)}var u,l="http://schemas.xmlsoap.org/soap/envelope/";return u={getServerURLFromMessage:r,getHTTPMethod:a,getResponseType:i,getLicenseMessage:o,getErrorResponse:s},u}n.r(t),r.__dashjs_factory_name="PlayReady",t.default=dashjs.FactoryMaker.getSingletonFactory(r)},"./src/streaming/protection/servers/Widevine.js":function(e,t,n){function r(){function e(e){return e}function t(){return"POST"}function n(){return"arraybuffer"}function r(e){return e}function a(e){return String.fromCharCode.apply(null,new Uint8Array(e))}var i;return i={getServerURLFromMessage:e,getHTTPMethod:t,getResponseType:n,getLicenseMessage:r,getErrorResponse:a},i}n.r(t),r.__dashjs_factory_name="Widevine",t.default=dashjs.FactoryMaker.getSingletonFactory(r)},"./src/streaming/protection/vo/ClearKeyKeySet.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}n.r(t);var o=function(){function e(t,n){if(r(this,e),n&&"persistent"!==n&&"temporary"!==n)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=t,this.type=n}return i(e,[{key:"toJWK",value:function(){var e,t=this.keyPairs.length,n={keys:[]};for(e=0;e<t;e++){var r={kty:"oct",alg:"A128KW",kid:this.keyPairs[e].keyID,k:this.keyPairs[e].key};n.keys.push(r)}this.type&&(n.type=this.type);var a=JSON.stringify(n),i=a.length,o=new ArrayBuffer(i),s=new Uint8Array(o);for(e=0;e<i;e++)s[e]=a.charCodeAt(e);return o}}]),e}();t.default=o},"./src/streaming/protection/vo/KeyMessage.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(t,n,a,i){r(this,e),this.sessionToken=t,this.message=n,this.defaultURL=a,this.messageType=i||"license-request"};t.default=a},"./src/streaming/protection/vo/KeyPair.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(t,n){r(this,e),this.keyID=t,this.key=n};t.default=a},"./src/streaming/protection/vo/KeySystemAccess.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(t,n){r(this,e),this.keySystem=t,this.ksConfiguration=n};t.default=a},"./src/streaming/protection/vo/KeySystemConfiguration.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(t,n,a,i,o){r(this,e),this.initDataTypes=["cenc"],t&&t.length&&(this.audioCapabilities=t),n&&n.length&&(this.videoCapabilities=n),this.distinctiveIdentifier=a,this.persistentState=i,this.sessionTypes=o};t.default=a},"./src/streaming/protection/vo/LicenseRequest.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(t,n,a,i,o,s,u,l){r(this,e),this.url=t,this.method=n,this.responseType=a,this.headers=i,this.withCredentials=o,this.messageType=s,this.sessionId=u,this.data=l};t.default=a},"./src/streaming/protection/vo/LicenseResponse.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(t,n,a){r(this,e),this.url=t,this.headers=n,this.data=a};t.default=a},"./src/streaming/protection/vo/MediaCapability.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(t,n){r(this,e),this.contentType=t,this.robustness=n};t.default=a},"./src/streaming/protection/vo/NeedKey.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(t,n){r(this,e),this.initData=t,this.initDataType=n};t.default=a},"./src/streaming/rules/DroppedFramesHistory.js":function(e,t,n){function r(){function e(e,t,n){if(t){a[e]||(a[e]=[],i[e]=0,o[e]=0);var r=n&&n.droppedVideoFrames?n.droppedVideoFrames:0,s=n&&n.totalVideoFrames?n.totalVideoFrames:0,u=r-i;i[e]=r;var l=s-o;o[e]=s;var c=a[e];isNaN(t)||(c[t]?(c[t].droppedVideoFrames+=u,c[t].totalVideoFrames+=l):c[t]={droppedVideoFrames:u,totalVideoFrames:l})}}function t(e){return a[e]}function n(e){try{delete a[e],delete i[e],delete o[e]}catch(e){}}function r(){a={},i={},o={}}var a={},i={},o={};return{push:e,getFrameHistory:t,clearForStream:n,reset:r}}n.r(t);var a=n("./src/core/FactoryMaker.js");r.__dashjs_factory_name="DroppedFramesHistory";var i=a.default.getClassFactory(r);t.default=i},"./src/streaming/rules/RulesContext.js":function(e,t,n){function r(e){function t(){var e=r();return e?e.type:null}function n(){var e=r();return e?e.streamInfo:null}function r(){return b?b.mediaInfo:null}function a(){return b}function i(){return S}function o(){return p}function s(){return m}function u(){return A}function l(){return y}function c(){return E}function f(){return _}function d(){return v}function h(){return T}var g;e=e||{};var p=e.abrController,m=e.switchHistory,y=e.droppedFramesHistory,E=e.currentRequest,_=e.useBufferOccupancyABR,v=e.useL2AABR,T=e.useLoLPABR,S=e.streamProcessor?e.streamProcessor.getScheduleController():null,b=e.streamProcessor?e.streamProcessor.getRepresentationInfo():null,A=e.videoModel?e.videoModel:null;return g={getMediaType:t,getMediaInfo:r,getDroppedFramesHistory:l,getCurrentRequest:c,getSwitchHistory:s,getStreamInfo:n,getScheduleController:i,getAbrController:o,getRepresentationInfo:a,useBufferOccupancyABR:f,useL2AABR:d,useLoLPABR:h,getVideoModel:u},g}n.r(t);var a=n("./src/core/FactoryMaker.js");r.__dashjs_factory_name="RulesContext",t.default=a.default.getClassFactory(r)},"./src/streaming/rules/SwitchRequest.js":function(e,t,n){function r(e,t,n){function r(e){var t=o.DEFAULT;return e!==o.DEFAULT&&e!==o.STRONG&&e!==o.WEAK||(t=e),t}var a,s,u,l;return s=void 0===e?i:e,u=r(n),l=void 0===t?null:t,a={quality:s,reason:l,priority:u},a}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=-1,o={DEFAULT:.5,STRONG:1,WEAK:0};r.__dashjs_factory_name="SwitchRequest";var s=a.default.getClassFactory(r);s.NO_CHANGE=i,s.PRIORITY=o,a.default.updateClassFactory(r.__dashjs_factory_name,s),t.default=s},"./src/streaming/rules/SwitchRequestHistory.js":function(e,t,n){function r(){function e(e){e.newValue===i.default.NO_CHANGE&&(e.newValue=e.oldValue),r[e.oldValue]||(r[e.oldValue]={noDrops:0,drops:0,dropSize:0});var t=e.newValue-e.oldValue,n=t<0?1:0,s=n?-t:0,u=n?0:1;if(r[e.oldValue].drops+=n,r[e.oldValue].dropSize+=s,r[e.oldValue].noDrops+=u,a.push({idx:e.oldValue,noDrop:u,drop:n,dropSize:s}),a.length>o){var l=a.shift();r[l.idx].drops-=l.drop,r[l.idx].dropSize-=l.dropSize,r[l.idx].noDrops-=l.noDrop}}function t(){return r}function n(){r=[],a=[]}var r=[],a=[];return{push:e,getSwitchRequests:t,reset:n}}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/rules/SwitchRequest.js"),o=8;r.__dashjs_factory_name="SwitchRequestHistory";var s=a.default.getClassFactory(r);t.default=s},"./src/streaming/rules/ThroughputHistory.js":function(e,t,n){function r(e){function t(){v={throughputHalfLife:{fast:N,slow:C},latencyHalfLife:{fast:w,slow:D}},p()}function n(e,t,n){return e===a.default.VIDEO?n<O.get().streaming.cacheLoadThresholds[a.default.VIDEO]:e===a.default.AUDIO?n<O.get().streaming.cacheLoadThresholds[a.default.AUDIO]:void 0}function r(e,t,r){if(t.trace&&t.trace.length){var o=t.tresponse.getTime()-t.trequest.getTime()||1,s=t._tfinish.getTime()-t.tresponse.getTime()||1,u=t.trace.reduce(function(e,t){return e+t.b[0]},0),l=0,c=0;if(O.get().streaming.lowLatencyEnabled){var f=O.get().streaming.abr.fetchThroughputCalculationMode;if(f===a.default.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING){var d=t.trace.reduce(function(e,t){return e+t.t},0);c=Math.round(d/t.trace.length)}0===c&&(l=t.trace.reduce(function(e,t){return e+t.d},0))}else l=r?s:o+s;if(0!==l&&(c=Math.round(8*u/l)),h(e),n(e,o,s)){if(m[e].length>0&&!m[e].hasCachedEntries)return;m[e].hasCachedEntries=!0}else m[e]&&m[e].hasCachedEntries&&g(e);m[e].push(c),m[e].length>T&&m[e].shift(),y[e].push(o),y[e].length>T&&y[e].shift(),i(E[e],c,.001*s,v.throughputHalfLife),i(_[e],o,1,v.latencyHalfLife)}}function i(e,t,n,r){var a=Math.pow(.5,n/r.fast);e.fastEstimate=(1-a)*t+a*e.fastEstimate;var i=Math.pow(.5,n/r.slow);e.slowEstimate=(1-i)*t+i*e.slowEstimate,e.totalWeight+=n}function o(e,t,n){var r,a;if(e?(r=m[t],a=n?S:b):(r=y[t],a=A),r){if(a>=r.length)a=r.length;else if(e)for(var i=1;i<a;++i){var o=r[r.length-i]/r[r.length-i-1];if((o>=I||o<=1/R)&&(a+=1,a===r.length))break}}else a=0;return a}function s(e,t,n){return O.get().streaming.abr.movingAverageMethod!==a.default.MOVING_AVERAGE_SLIDING_WINDOW?l(e,t):u(e,t,n)}function u(e,t,n){var r=o(e,t,n),a=e?m:y,i=a[t];return 0!==r&&i&&0!==i.length?(i=i.slice(-r),i.reduce(function(e,t){return e+t})/i.length):NaN}function l(e,t){var n=e?v.throughputHalfLife:v.latencyHalfLife,r=e?E[t]:_[t];if(!r||r.totalWeight<=0)return NaN;var a=r.fastEstimate/(1-Math.pow(.5,r.totalWeight/n.fast)),i=r.slowEstimate/(1-Math.pow(.5,r.totalWeight/n.slow));return e?Math.min(a,i):Math.max(a,i)}function c(e,t){return s(!0,e,t)}function f(e,t){var n=c(e,t);return isNaN(n)||(n*=O.get().streaming.abr.bandwidthSafetyFactor),n}function d(e){return s(!1,e)}function h(e){m[e]=m[e]||[],y[e]=y[e]||[],E[e]=E[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0},_[e]=_[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0}}function g(e){delete m[e],delete y[e],delete E[e],delete _[e],h(e)}function p(){m={},y={},E={},_={}}e=e||{};var m,y,E,_,v,T=20,S=3,b=4,A=4,R=1.3,I=1.3,C=8,N=3,D=2,w=1,O=e.settings,M={push:r,getAverageThroughput:c,getSafeAverageThroughput:f,getAverageLatency:d,reset:p};return t(),M}n.r(t);var a=n("./src/streaming/constants/Constants.js"),i=n("./src/core/FactoryMaker.js");r.__dashjs_factory_name="ThroughputHistory",t.default=i.default.getClassFactory(r)},"./src/streaming/rules/abr/ABRRulesCollection.js":function(e,t,n){function r(e){function t(){T=[],S=[],I.get().streaming.abr.useDefaultABRRules&&(I.get().streaming.abr.ABRStrategy===g.default.ABR_STRATEGY_L2A?T.push(Object(c.default)(b).create({dashMetrics:R,mediaPlayerModel:A,settings:I})):I.get().streaming.abr.ABRStrategy===g.default.ABR_STRATEGY_LoLP?T.push(Object(f.default)(b).create({dashMetrics:R})):(T.push(Object(l.default)(b).create({dashMetrics:R,mediaPlayerModel:A,settings:I})),T.push(Object(a.default)(b).create({dashMetrics:R})),I.get().streaming.abr.additionalAbrRules.insufficientBufferRule&&T.push(Object(i.default)(b).create({dashMetrics:R,settings:I})),I.get().streaming.abr.additionalAbrRules.switchHistoryRule&&T.push(Object(u.default)(b).create()),I.get().streaming.abr.additionalAbrRules.droppedFramesRule&&T.push(Object(s.default)(b).create()),I.get().streaming.abr.additionalAbrRules.abandonRequestsRule&&S.push(Object(o.default)(b).create({dashMetrics:R,mediaPlayerModel:A,settings:I}))));var e=A.getABRCustomRules();e.forEach(function(e){e.type===p&&T.push(e.rule(b).create()),e.type===m&&S.push(e.rule(b).create())})}function n(e){return e.filter(function(e){return e.quality>h.default.NO_CHANGE})}function r(e){var t,n,r,a,i,o={},s=null;if(0!==e.length){for(o[h.default.PRIORITY.STRONG]={quality:h.default.NO_CHANGE,reason:null},o[h.default.PRIORITY.WEAK]={quality:h.default.NO_CHANGE,reason:null},o[h.default.PRIORITY.DEFAULT]={quality:h.default.NO_CHANGE,reason:null},t=0,n=e.length;t<n;t+=1)r=e[t],r.quality!==h.default.NO_CHANGE&&(o[r.priority].quality===h.default.NO_CHANGE||o[r.priority].quality>r.quality)&&(o[r.priority].quality=r.quality,o[r.priority].reason=r.reason||null);return o[h.default.PRIORITY.WEAK].quality!==h.default.NO_CHANGE&&(s=o[h.default.PRIORITY.WEAK]),o[h.default.PRIORITY.DEFAULT].quality!==h.default.NO_CHANGE&&(s=o[h.default.PRIORITY.DEFAULT]),o[h.default.PRIORITY.STRONG].quality!==h.default.NO_CHANGE&&(s=o[h.default.PRIORITY.STRONG]),s&&(a=s.quality,i=s.reason),Object(h.default)(b).create(a,i)}}function d(e){var t=T.map(function(t){return t.getMaxIndex(e)}),a=n(t),i=r(a);return i||Object(h.default)(b).create()}function y(e,t){var a=S.map(function(n){return n.shouldAbandon(e,t)}),i=n(a),o=r(i);return o||Object(h.default)(b).create()}function E(){[T,S].forEach(function(e){e&&e.length&&e.forEach(function(e){return e.reset&&e.reset()})}),T=[],S=[]}function _(){return T}e=e||{};var v,T,S,b=this.context,A=e.mediaPlayerModel,R=e.dashMetrics,I=e.settings;return v={initialize:t,reset:E,getMaxQuality:d,getMinSwitchRequest:r,shouldAbandonFragment:y,getQualitySwitchRules:_},v}n.r(t)
;var a=n("./src/streaming/rules/abr/ThroughputRule.js"),i=n("./src/streaming/rules/abr/InsufficientBufferRule.js"),o=n("./src/streaming/rules/abr/AbandonRequestsRule.js"),s=n("./src/streaming/rules/abr/DroppedFramesRule.js"),u=n("./src/streaming/rules/abr/SwitchHistoryRule.js"),l=n("./src/streaming/rules/abr/BolaRule.js"),c=n("./src/streaming/rules/abr/L2ARule.js"),f=n("./src/streaming/rules/abr/lolp/LoLpRule.js"),d=n("./src/core/FactoryMaker.js"),h=n("./src/streaming/rules/SwitchRequest.js"),g=n("./src/streaming/constants/Constants.js"),p="qualitySwitchRules",m="abandonFragmentRules";r.__dashjs_factory_name="ABRRulesCollection";var y=d.default.getClassFactory(r);y.QUALITY_SWITCH_RULES=p,y.ABANDON_FRAGMENT_RULES=m,d.default.updateSingletonFactory(r.__dashjs_factory_name,y),t.default=y},"./src/streaming/rules/abr/AbandonRequestsRule.js":function(e,t,n){function r(e){function t(){c=Object(o.default)(y).getInstance().getLogger(l),u()}function n(e,t){f[e]=f[e]||{},f[e][t]=f[e][t]||{}}function i(e,t){h[e]=h[e]||[],h[e].push(t)}function s(e){var t=Object(a.default)(y).create(a.default.NO_CHANGE,{name:r.__dashjs_factory_name});if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getCurrentRequest")&&e.hasOwnProperty("getRepresentationInfo")&&e.hasOwnProperty("getAbrController")))return t;var o=e.getMediaInfo(),s=e.getMediaType(),u=e.getStreamInfo(),l=u?u.id:null,T=e.getCurrentRequest();if(!isNaN(T.index)){n(s,T.index);var S=E.getStableBufferTime(),b=_.getCurrentBufferLevel(s);if(b>S)return t;var A=f[s][T.index];if(null===A||null===T.firstByteDate||d.hasOwnProperty(A.id))return t;if(void 0===A.firstByteTime&&(h[s]=[],A.firstByteTime=T.firstByteDate.getTime(),A.segmentDuration=T.duration,A.bytesTotal=T.bytesTotal,A.id=T.index),A.bytesLoaded=T.bytesLoaded,A.elapsedTime=(new Date).getTime()-A.firstByteTime,A.bytesLoaded>0&&A.elapsedTime>0&&i(s,Math.round(8*A.bytesLoaded/A.elapsedTime)),h[s].length>=m&&A.elapsedTime>p&&A.bytesLoaded<A.bytesTotal){var R=h[s].reduce(function(e,t){return e+t},0);if(A.measuredBandwidthInKbps=Math.round(R/h[s].length),A.estimatedTimeOfDownload=+(8*A.bytesTotal/A.measuredBandwidthInKbps/1e3).toFixed(2),A.estimatedTimeOfDownload<A.segmentDuration*g||0===e.getRepresentationInfo().quality)return t;if(!d.hasOwnProperty(A.id)){var I=e.getAbrController(),C=A.bytesTotal-A.bytesLoaded,N=I.getBitrateList(o),D=I.getQualityForBitrate(o,A.measuredBandwidthInKbps*v.get().streaming.abr.bandwidthSafetyFactor,l),w=I.getMinAllowedIndexFor(s,l),O=void 0!==w?Math.max(w,D):D,M=A.bytesTotal*N[O].bitrate/N[I.getQualityFor(s,l)].bitrate;C>M&&(t.quality=O,t.reason.throughput=A.measuredBandwidthInKbps,t.reason.fragmentID=A.id,d[A.id]=A,c.debug("["+s+"] frag id",A.id," is asking to abandon and switch to quality to ",O," measured bandwidth was",A.measuredBandwidthInKbps),delete f[s][A.id])}}else A.bytesLoaded===A.bytesTotal&&delete f[s][A.id]}return t}function u(){f={},d={},h=[]}e=e||{};var l,c,f,d,h,g=1.8,p=500,m=5,y=this.context,E=e.mediaPlayerModel,_=e.dashMetrics,v=e.settings;return l={shouldAbandon:s,reset:u},t(),l}n.r(t);var a=n("./src/streaming/rules/SwitchRequest.js"),i=n("./src/core/FactoryMaker.js"),o=n("./src/core/Debug.js");r.__dashjs_factory_name="AbandonRequestsRule",t.default=i.default.getClassFactory(r)},"./src/streaming/rules/abr/BolaRule.js":function(e,t,n){function r(e){function t(){j=Object(c.default)(k).getInstance().getLogger(F),P(),G.on(f.default.BUFFER_EMPTY,R,F),G.on(f.default.PLAYBACK_SEEKING,I,F),G.on(f.default.METRIC_ADDED,N,F),G.on(f.default.QUALITY_CHANGE_REQUESTED,w,F),G.on(f.default.FRAGMENT_LOADING_ABANDONED,O,F),G.on(l.default.MEDIA_FRAGMENT_LOADED,C,F)}function n(e){return e.map(function(e){return Math.log(e)})}function r(e,t,n){var r=n.reduce(function(e,t,r){return t>n[e]?r:e},0);if(0===r)return null;var a=Math.max(e,p+m*t.length),i=(n[r]-1)/(a/p-1),o=p/i;return{gp:i,Vp:o}}function o(e){var t={},a=e.getMediaInfo(),i=a.bitrateList.map(function(e){return e.bandwidth}),o=n(i);o=o.map(function(e){return e-o[0]+1});var s=U.getStableBufferTime(),u=r(s,i,o);return u?(t.state=h,t.bitrates=i,t.utilities=o,t.stableBufferTime=s,t.Vp=u.Vp,t.gp=u.gp,t.lastQuality=0,E(t)):t.state=d,t}function E(e){e.placeholderBuffer=0,e.mostAdvancedSegmentStart=NaN,e.lastSegmentWasReplacement=!1,e.lastSegmentStart=NaN,e.lastSegmentDurationS=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN}function _(e,t){var n=U.getStableBufferTime();if(e.stableBufferTime!==n){var a=r(n,e.bitrates,e.utilities);if(a.Vp!==e.Vp||a.gp!==e.gp){var i=B.getCurrentBufferLevel(t),o=i+e.placeholderBuffer;o-=p,o*=a.Vp/e.Vp,o+=p,e.stableBufferTime=n,e.Vp=a.Vp,e.gp=a.gp,e.placeholderBuffer=Math.max(0,o-i)}}}function v(e){var t=e.getMediaType(),n=x[t];return n?n.state!==d&&_(n,t):(n=o(e),x[t]=n),n}function T(e,t){for(var n=e.bitrates.length,r=NaN,a=NaN,i=0;i<n;++i){var o=(e.Vp*(e.utilities[i]+e.gp)-t)/e.bitrates[i];(isNaN(a)||o>=a)&&(a=o,r=i)}return r}function S(e,t){return e.Vp*(e.utilities[t]+e.gp)}function b(e,t){for(var n=e.bitrates[t],r=e.utilities[t],a=0,i=t-1;i>=0;--i)if(e.utilities[i]<e.utilities[t]){var o=e.bitrates[i],s=e.utilities[i],u=e.Vp*(e.gp+(n*s-o*r)/(n-o));a=Math.max(a,u)}return a}function A(e,t){var n=Date.now();if(isNaN(e.lastSegmentFinishTimeMs)){if(!isNaN(e.lastCallTimeMs)){var r=.001*(n-e.lastCallTimeMs);e.placeholderBuffer+=Math.max(0,r)}}else{var a=.001*(n-e.lastSegmentFinishTimeMs);e.placeholderBuffer+=Math.max(0,a)}e.lastCallTimeMs=n,e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN,_(e,t)}function R(){for(var e in x)x.hasOwnProperty(e)&&x[e].state===g&&(x[e].placeholderBuffer=0)}function I(){for(var e in x)if(x.hasOwnProperty(e)){var t=x[e];t.state!==d&&(t.state=h,E(t))}}function C(e){if(e&&e.chunk&&e.chunk.mediaInfo){var t=x[e.chunk.mediaInfo.type];if(t&&t.state!==d){var n=e.chunk.start;isNaN(t.mostAdvancedSegmentStart)||n>t.mostAdvancedSegmentStart?(t.mostAdvancedSegmentStart=n,t.lastSegmentWasReplacement=!1):t.lastSegmentWasReplacement=!0,t.lastSegmentStart=n,t.lastSegmentDurationS=e.chunk.duration,t.lastQuality=e.chunk.quality,D(t,e.chunk.mediaInfo.type)}}}function N(e){if(e&&e.metric===a.default.HTTP_REQUEST&&e.value&&e.value.type===s.HTTPRequest.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){var t=x[e.mediaType];t&&t.state!==d&&(t.lastSegmentRequestTimeMs=e.value.trequest.getTime(),t.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),D(t,e.mediaType))}}function D(e,t){if(!isNaN(e.lastSegmentStart)&&!isNaN(e.lastSegmentRequestTimeMs)&&!isNaN(e.placeholderBuffer)){if(e.placeholderBuffer*=y,!isNaN(e.lastSegmentFinishTimeMs)){var n=B.getCurrentBufferLevel(t),r=n+.001*(e.lastSegmentFinishTimeMs-e.lastSegmentRequestTimeMs),a=S(e,e.lastQuality),i=Math.max(0,a-r);e.placeholderBuffer=Math.min(i,e.placeholderBuffer)}e.lastSegmentWasReplacement&&!isNaN(e.lastSegmentDurationS)&&(e.placeholderBuffer+=e.lastSegmentDurationS),e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN}}function w(e){if(e){var t=x[e.mediaType];t&&t.state!==d&&(t.abrQuality=e.newQuality)}}function O(e){if(e){var t=x[e.mediaType];if(t&&t.state!==d){var n,r=B.getCurrentBufferLevel(e.mediaType);n=t.abrQuality>0?b(t,t.abrQuality):p;var a=Math.max(0,n-r);t.placeholderBuffer=Math.min(t.placeholderBuffer,a)}}}function M(e){var t=Object(i.default)(k).create();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getScheduleController")&&e.hasOwnProperty("getStreamInfo")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("useBufferOccupancyABR")))return t;var n=e.getMediaInfo(),r=e.getMediaType(),a=e.getScheduleController(),o=e.getStreamInfo(),s=e.getAbrController(),u=s.getThroughputHistory(),l=o?o.id:null,c=o&&o.manifestInfo&&o.manifestInfo.isDynamic,f=e.useBufferOccupancyABR();if(t.reason=t.reason||{},!f)return t;a.setTimeToLoadDelay(0);var p=v(e);if(p.state===d)return t;var m,y=B.getCurrentBufferLevel(r),_=u.getAverageThroughput(r,c),R=u.getSafeAverageThroughput(r,c),I=u.getAverageLatency(r);if(t.reason.state=p.state,t.reason.throughput=_,t.reason.latency=I,isNaN(_))return t;switch(p.state){case h:m=s.getQualityForBitrate(n,R,l,I),t.quality=m,t.reason.throughput=R,p.placeholderBuffer=Math.max(0,b(p,m)-y),p.lastQuality=m,!isNaN(p.lastSegmentDurationS)&&y>=p.lastSegmentDurationS&&(p.state=g);break;case g:A(p,r),m=T(p,y+p.placeholderBuffer);var C=s.getQualityForBitrate(n,R,l,I);m>p.lastQuality&&m>C&&(m=Math.max(C,p.lastQuality));var N=Math.max(0,y+p.placeholderBuffer-S(p,m));N<=p.placeholderBuffer?(p.placeholderBuffer-=N,N=0):(N-=p.placeholderBuffer,p.placeholderBuffer=0,m<s.getMaxAllowedIndexFor(r,l)?a.setTimeToLoadDelay(1e3*N):N=0),t.quality=m,t.reason.throughput=_,t.reason.latency=I,t.reason.bufferLevel=y,t.reason.placeholderBuffer=p.placeholderBuffer,t.reason.delay=N,p.lastQuality=m;break;default:j.debug("BOLA ABR rule invoked in bad state."),t.quality=s.getQualityForBitrate(n,R,l,I),t.reason.state=p.state,t.reason.throughput=R,t.reason.latency=I,p.state=h,E(p)}return t}function P(){x={}}function L(){P(),G.off(f.default.BUFFER_EMPTY,R,F),G.off(f.default.PLAYBACK_SEEKING,I,F),G.off(f.default.METRIC_ADDED,N,F),G.off(f.default.QUALITY_CHANGE_REQUESTED,w,F),G.off(f.default.FRAGMENT_LOADING_ABANDONED,O,F),G.off(l.default.MEDIA_FRAGMENT_LOADED,C,F)}e=e||{};var F,j,x,k=this.context,B=e.dashMetrics,U=e.mediaPlayerModel,G=Object(u.default)(k).getInstance();return F={getMaxIndex:M,reset:L},t(),F}n.r(t);var a=n("./src/streaming/constants/MetricsConstants.js"),i=n("./src/streaming/rules/SwitchRequest.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/streaming/vo/metrics/HTTPRequest.js"),u=n("./src/core/EventBus.js"),l=n("./src/core/events/Events.js"),c=n("./src/core/Debug.js"),f=n("./src/streaming/MediaPlayerEvents.js"),d=0,h=1,g=2,p=10,m=2,y=.99;r.__dashjs_factory_name="BolaRule",t.default=o.default.getClassFactory(r)},"./src/streaming/rules/abr/DroppedFramesRule.js":function(e,t,n){function r(){function e(){r=Object(o.default)(a).getInstance().getLogger(n)}function t(e){var t=Object(i.default)(a).create();if(!e||!e.hasOwnProperty("getDroppedFramesHistory"))return t;var n=e.getDroppedFramesHistory(),o=e.getStreamInfo().id;if(n){var l=n.getFrameHistory(o);if(!l||0===l.length)return t;for(var c=0,f=0,d=i.default.NO_CHANGE,h=1;h<l.length;h++)if(l[h]&&(c=l[h].droppedVideoFrames,f=l[h].totalVideoFrames,f>u&&c/f>s)){d=h-1,r.debug("index: "+d+" Dropped Frames: "+c+" Total Frames: "+f);break}return Object(i.default)(a).create(d,{droppedFrames:c})}return t}var n,r,a=this.context,s=.15,u=375;return n={getMaxIndex:t},e(),n}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/rules/SwitchRequest.js"),o=n("./src/core/Debug.js");r.__dashjs_factory_name="DroppedFramesRule",t.default=a.default.getClassFactory(r)},"./src/streaming/rules/abr/InsufficientBufferRule.js":function(e,t,n){function r(e){function t(){y=Object(s.default)(T).getInstance().getLogger(m),d(),S.on(f.default.PLAYBACK_SEEKING,h,m),S.on(i.default.BYTES_APPENDED_END_FRAGMENT,g,m)}function n(){if(!b||!b.hasOwnProperty("getCurrentBufferLevel")||!b.hasOwnProperty("getCurrentBufferState"))throw new Error(l.default.MISSING_CONFIG_ERROR)}function r(e){var t=Object(u.default)(T).create();if(!e||!e.hasOwnProperty("getMediaType"))return t;n();var r=e.getMediaType(),a=b.getCurrentBufferState(r),i=e.getRepresentationInfo(),s=i.fragmentDuration,l=e.getStreamInfo(),f=l?l.id:null,d=l&&l.manifestInfo&&l.manifestInfo.isDynamic;if(o(r)||!s)return t;if(a&&a.state===c.default.BUFFER_EMPTY)y.debug("["+r+"] Switch to index 0; buffer is empty."),t.quality=0,t.reason="InsufficientBufferRule: Buffer is empty";else{var h=e.getMediaInfo(),g=e.getAbrController(),p=g.getThroughputHistory(),m=b.getCurrentBufferLevel(r),E=p.getAverageThroughput(r,d),v=p.getAverageLatency(r),S=E*(m/s)*_;t.quality=g.getQualityForBitrate(h,S,f,v),t.reason="InsufficientBufferRule: being conservative to avoid immediate rebuffering"}return t}function o(e){return!A.get().streaming.lowLatencyEnabled&&E[e].ignoreCount>0}function d(){E={},E[l.default.VIDEO]={ignoreCount:v},E[l.default.AUDIO]={ignoreCount:v}}function h(){d()}function g(e){isNaN(e.startTime)||e.mediaType!==l.default.AUDIO&&e.mediaType!==l.default.VIDEO||E[e.mediaType].ignoreCount>0&&E[e.mediaType].ignoreCount--}function p(){d(),S.off(f.default.PLAYBACK_SEEKING,h,m),S.off(i.default.BYTES_APPENDED_END_FRAGMENT,g,m)}e=e||{};var m,y,E,_=.5,v=2,T=this.context,S=Object(a.default)(T).getInstance(),b=e.dashMetrics,A=e.settings;return m={getMaxIndex:r,reset:p},t(),m}n.r(t);var a=n("./src/core/EventBus.js"),i=n("./src/core/events/Events.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/core/Debug.js"),u=n("./src/streaming/rules/SwitchRequest.js"),l=n("./src/streaming/constants/Constants.js"),c=n("./src/streaming/constants/MetricsConstants.js"),f=n("./src/streaming/MediaPlayerEvents.js");r.__dashjs_factory_name="InsufficientBufferRule",t.default=o.default.getClassFactory(r)},"./src/streaming/rules/abr/L2ARule.js":function(e,t,n){function r(e){function t(){D=Object(c.default)(w).getInstance().getLogger(I),A(),M.on(l.default.PLAYBACK_SEEKING,m,I),M.on(l.default.MEDIA_FRAGMENT_LOADED,y,I),M.on(l.default.METRIC_ADDED,E,I),M.on(l.default.QUALITY_CHANGE_REQUESTED,v,I)}function n(e){var t={},n=e.getMediaInfo(),a=n.bitrateList.map(function(e){return e.bandwidth/1e3});return t.state=h,t.bitrates=a,t.lastQuality=0,r(n),o(t),t}function r(e){e&&e.type&&(N[e.type]={},N[e.type].w=[],N[e.type].prev_w=[],N[e.type].Q=0,N[e.type].segment_request_start_s=0,N[e.type].segment_download_finish_s=0,N[e.type].B_target=1.5)}function o(e){e.placeholderBuffer=0,e.mostAdvancedSegmentStart=NaN,e.lastSegmentWasReplacement=!1,e.lastSegmentStart=NaN,e.lastSegmentDurationS=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN}function p(e){var t=e.getMediaType(),r=C[t];return r||(r=n(e),C[t]=r),r}function m(){for(var e in C)if(C.hasOwnProperty(e)){var t=C[e];t.state!==d&&(t.state=h,o(t))}}function y(e){if(e&&e.chunk&&e.chunk.mediaInfo){var t=C[e.chunk.mediaInfo.type],n=N[e.chunk.mediaInfo.type];if(t&&t.state!==d){var r=e.chunk.start;isNaN(t.mostAdvancedSegmentStart)||r>t.mostAdvancedSegmentStart?(t.mostAdvancedSegmentStart=r,t.lastSegmentWasReplacement=!1):t.lastSegmentWasReplacement=!0,t.lastSegmentStart=r,t.lastSegmentDurationS=e.chunk.duration,t.lastQuality=e.chunk.quality,_(t,n)}}}function E(e){if(e&&e.metric===a.default.HTTP_REQUEST&&e.value&&e.value.type===s.HTTPRequest.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){var t=C[e.mediaType],n=N[e.mediaType];t&&t.state!==d&&(t.lastSegmentRequestTimeMs=e.value.trequest.getTime(),t.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),_(t,n))}}function _(e,t){isNaN(e.lastSegmentStart)||isNaN(e.lastSegmentRequestTimeMs)||(t.segment_request_start_s=.001*e.lastSegmentRequestTimeMs,t.segment_download_finish_s=.001*e.lastSegmentFinishTimeMs,e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN)}function v(e){if(e&&e.mediaType){var t=C[e.mediaType];t&&t.state!==d&&(t.abrQuality=e.newQuality)}}function T(e,t){if(e.length!==t.length)return-1;for(var n=0,r=0;r<e.length;r++)n+=e[r]*t[r];return n}function S(e){for(var t=e.length,n=!1,r=[],a=0;a<t;++a)r[a]=e[a];for(var i=e.sort(function(e,t){return t-e}),o=0,s=0,u=[],l=0;l<t-1;++l)if(o+=i[l],s=(o-1)/(l+1),s>=i[l+1]){n=!0;break}n||(s=(o+i[t-1]-1)/t);for(var c=0;c<t;++c)u[c]=Math.max(r[c]-s,0);return u}function b(e){var t,n=Object(i.default)(w).create(),r=4,a=Math.pow(r,.99),s=Math.max(Math.pow(r,1),a*Math.sqrt(r)),u=e.getMediaInfo(),l=e.getMediaType(),c=u.bitrateList.map(function(e){return e.bandwidth}),m=c.length,y=e.getScheduleController(),E=e.getStreamInfo(),_=e.getAbrController(),v=_.getThroughputHistory(),b=E&&E.manifestInfo&&E.manifestInfo.isDynamic,A=e.useL2AABR(),R=O.getCurrentBufferLevel(l,!0),I=v.getSafeAverageThroughput(l,b),C=v.getAverageThroughput(l,b),M=2,P=v.getAverageLatency(l),L=e.getVideoModel(),F=L.getPlaybackRate();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getScheduleController")&&e.hasOwnProperty("getStreamInfo")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("useL2AABR")))return n;if(n.reason=n.reason||{},!A||l===f.default.AUDIO)return n;y.setTimeToLoadDelay(0);var j=p(e);if(j.state===d)return n;var x=N[l];if(!x)return n;if(n.reason.state=j.state,n.reason.throughput=C,n.reason.latency=P,isNaN(C))return n;switch(j.state){case h:if(t=_.getQualityForBitrate(u,I,E.id,P),n.quality=t,n.reason.throughput=I,j.lastQuality=t,!isNaN(j.lastSegmentDurationS)&&R>=x.B_target){j.state=g,x.Q=a;for(var k=0;k<m;++k)k===j.lastQuality?x.prev_w[k]=1:x.prev_w[k]=0}break;case g:var B=[],U=O.getCurrentHttpRequest(l).trace.reduce(function(e,t){return e+t.d},0),G=O.getCurrentHttpRequest(l).trace.reduce(function(e,t){return e+t.b[0]},0),H=Math.round(8*G/U);H<1&&(H=1);for(var q=j.lastSegmentDurationS,Y=1,K=0;K<m;++K)c[K]=c[K]/1e3,F*c[K]>H&&(Y=-1),x.w[K]=x.prev_w[K]+Y*(q/(2*s))*((x.Q+a)*(F*c[K]/H));x.w=S(x.w);for(var V=0;V<m;++V)B[V]=x.w[V]-x.prev_w[V],x.prev_w[V]=x.w[V];x.Q=Math.max(0,x.Q-q+q*F*((T(c,x.prev_w)+T(c,B))/H));for(var W=[],z=0;z<m;++z)W[z]=Math.abs(c[z]-T(x.w,c));t=W.indexOf(Math.min.apply(Math,W)),t>j.lastQuality&&c[j.lastQuality+1]<=H&&(t=j.lastQuality+1),c[t]>=H&&(x.Q=M*Math.max(a,x.Q)),n.quality=t,n.reason.throughput=C,n.reason.latency=P,n.reason.bufferLevel=R,j.lastQuality=n.quality;break;default:D.debug("L2A ABR rule invoked in bad state."),n.quality=_.getQualityForBitrate(u,I,E.id,P),n.reason.state=j.state,n.reason.throughput=I,n.reason.latency=P,j.state=h,o(j)}return n}function A(){C={},N={}}function R(){A(),M.off(l.default.PLAYBACK_SEEKING,m,I),M.off(l.default.MEDIA_FRAGMENT_LOADED,y,I),M.off(l.default.METRIC_ADDED,E,I),M.off(l.default.QUALITY_CHANGE_REQUESTED,v,I)}e=e||{};var I,C,N,D,w=this.context,O=e.dashMetrics,M=Object(u.default)(w).getInstance();return I={getMaxIndex:b,reset:R},t(),I}n.r(t);var a=n("./src/streaming/constants/MetricsConstants.js"),i=n("./src/streaming/rules/SwitchRequest.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/streaming/vo/metrics/HTTPRequest.js"),u=n("./src/core/EventBus.js"),l=n("./src/core/events/Events.js"),c=n("./src/core/Debug.js"),f=n("./src/streaming/constants/Constants.js"),d=0,h=1,g=2;r.__dashjs_factory_name="L2ARule",t.default=o.default.getClassFactory(r)},"./src/streaming/rules/abr/SwitchHistoryRule.js":function(e,t,n){function r(){function e(){r=Object(i.default)(a).getInstance().getLogger(n)}function t(e){for(var t=e?e.getSwitchHistory():null,n=t?t.getSwitchRequests():[],i=0,l=0,c=0,f=Object(o.default)(a).create(),d=0;d<n.length;d++)if(void 0!==n[d]&&(i+=n[d].drops,l+=n[d].noDrops,c+=n[d].dropSize,i+l>=u&&i/l>s)){f.quality=d>0&&n[d].drops>0?d-1:d,f.reason={index:f.quality,drops:i,noDrops:l,dropSize:c},r.debug("Switch history rule index: "+f.quality+" samples: "+(i+l)+" drops: "+i);break}return f}var n,r,a=this.context,s=.075,u=6;return n={getMaxIndex:t},e(),n}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js"),o=n("./src/streaming/rules/SwitchRequest.js");r.__dashjs_factory_name="SwitchHistoryRule",t.default=a.default.getClassFactory(r)},"./src/streaming/rules/abr/ThroughputRule.js":function(e,t,n){function r(e){function t(){if(!l||!l.hasOwnProperty("getCurrentBufferState"))throw new Error(o.default.MISSING_CONFIG_ERROR)}function n(e){var n=Object(i.default)(u).create();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("useBufferOccupancyABR")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("getScheduleController")))return n;t();var r=e.getMediaInfo(),a=e.getMediaType(),o=l.getCurrentBufferState(a),c=e.getScheduleController(),f=e.getAbrController(),d=e.getStreamInfo(),h=d?d.id:null,g=d&&d.manifestInfo?d.manifestInfo.isDynamic:null,p=f.getThroughputHistory(),m=p.getSafeAverageThroughput(a,g),y=p.getAverageLatency(a),E=e.useBufferOccupancyABR();return isNaN(m)||!o||E?n:(f.getAbandonmentStateFor(h,a)!==s.default.ABANDON_LOAD&&(o.state===s.default.BUFFER_LOADED||g)&&(n.quality=f.getQualityForBitrate(r,m,h,y),c.setTimeToLoadDelay(0),n.reason={throughput:m,latency:y}),n)}function r(){}e=e||{};var a,u=this.context,l=e.dashMetrics;return a={getMaxIndex:n,reset:r},a}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/rules/SwitchRequest.js"),o=n("./src/streaming/constants/Constants.js"),s=n("./src/streaming/constants/MetricsConstants.js");r.__dashjs_factory_name="ThroughputRule",t.default=a.default.getClassFactory(r)},"./src/streaming/rules/abr/lolp/LearningAbrController.js":function(e,t,n){function r(){function e(){T=Object(i.default)(D).getInstance().getLogger(v),n()}function t(){n()}function n(){S=null,b=1,A=100,R=0,I=null,C=null,N=o.DYNAMIC}function r(){var e=0;if(S)for(var t=0;t<S.length;t++){var n=S[t];n.state.throughput>e&&(e=n.state.throughput)}return e}function a(e){var t=e.map(function(e){return Math.pow(e,2)}).reduce(function(e,t){return e+t});return Math.sqrt(t)}function s(e,t,n){var r=e.map(function(e,r){return n[r]*Math.pow(e-t[r],2)}).reduce(function(e,t){return e+t}),a=r<0?-1:1;return a*Math.sqrt(Math.abs(r))}function u(e,t){var n=[e.state.throughput,e.state.latency,e.state.rebuffer,e.state.switch],r=[t.state.throughput,t.state.latency,t.state.rebuffer,t.state.switch];return s(n,r,[1,1,1,1])}function l(e,t,n){for(var r=0;r<t.length;r++){var a=t[r],i=.1,o=u(a,e),s=Math.exp(-1*Math.pow(o,2)/(2*Math.pow(i,2)));c(a,n,s)}}function c(e,t,n){var r=e.state,a=[.01,.01,.01,.01];r.throughput=r.throughput+(t[0]-r.throughput)*a[0]*n,r.latency=r.latency+(t[1]-r.latency)*a[1]*n,r.rebuffer=r.rebuffer+(t[2]-r.rebuffer)*a[2]*n,r.switch=r.switch+(t[3]-r.switch)*a[3]*n}function f(e,t){var n=0,r=e;if(S)for(var a=0;a<S.length;a++){var i=S[a];i.bitrate<e.bitrate&&i.bitrate>n&&t>i.bitrate&&(n=i.bitrate,r=i)}return r}function d(e,t,n,a,i,u,c){var d=n,m=a,E=t,_=y(e),v=t/b;v>1&&(v=r()),n/=A;var S=0,C=0,D=0,w=1e4;T.debug("getNextQuality called throughput:".concat(v," latency:").concat(n," bufferSize:").concat(a," currentQualityIndex:").concat(u," playbackRate:").concat(i));var O=_[u],M=O.bitrate*c.getSegmentDuration()/E,P=Math.max(0,M-m);if(m-M<c.getMinBuffer())return T.debug("Buffer is low for bitrate= ".concat(O.bitrate," downloadTime=").concat(M," currentBuffer=").concat(m," rebuffer=").concat(P)),f(O,E).qualityIndex;switch(N){case o.MANUAL:h();break;case o.RANDOM:g(_);break;case o.DYNAMIC:p(c,_,d,m,P,E,i);break;default:p(c,_,d,m,P,E,i)}for(var L=null,F=null,j=null,x=0;x<_.length;x++){var k=_[x],B=k.state,U=[B.throughput,B.latency,B.rebuffer,B.switch],G=I.slice(),H=c.getNextBufferWithBitrate(k.bitrate,m,E),q=H<c.getMinBuffer();q&&T.debug("Buffer is low for bitrate=".concat(k.bitrate," downloadTime=").concat(M," currentBuffer=").concat(m," nextBuffer=").concat(H)),(k.bitrate>t-w||q)&&k.bitrate!==R&&(G[0]=100);var Y=s(U,[v,S,C,D],G);(null===L||Y<L)&&(L=Y,F=k.qualityIndex,j=k)}var K=Math.abs(O.bitrate-j.bitrate)/b;return l(O,_,[v,n,P,K]),l(j,_,[v,S,C,K]),F}function h(){var e=.4,t=.4,n=.4,r=.4;I=[e,t,n,r]}function g(e){I=m(e.length,4)}function p(e,t,n,r,a,i,o){I||(I=C[C.length-1]);var s=e.findWeightVector(t,n,r,a,i,o);null!==s&&-1!==s&&(I=s)}function m(e,t){for(var n=[],r=Math.sqrt(2/e),a=0;a<t;a++)n.push(Math.random()*r);return I=n,I}function y(e){if(!S){S=[];var t=e.bitrateList,n=[];R=t[0].bandwidth,t.forEach(function(e){n.push(e.bandwidth),e.bandwidth<R&&(R=e.bandwidth)}),b=a(n);for(var r=0;r<t.length;r++){var i={qualityIndex:r,bitrate:t[r].bandwidth,state:{throughput:t[r].bandwidth/b,latency:0,rebuffer:0,switch:0}};S.push(i)}C=_(S)}return S}function E(e){for(var t=[],n=0;n<e;n++){var a=[Math.random()*r(),Math.random(),Math.random(),Math.random()];t.push(a)}return t}function _(e){var t=[],n=E(Math.pow(e.length,2));t.push(n[0]);for(var r=[1,1,1,1],a=1;a<e.length;a++){for(var i=null,o=null,u=0;u<n.length;u++){for(var l=n[u],c=null,f=0;f<t.length;f++){var d=s(l,t[f],r);(null===c||d<c)&&(c=d)}(null===o||c>o)&&(i=l,o=c)}t.push(i)}for(var h=null,g=null,p=0;p<t.length;p++){for(var m=0,y=0;y<t.length;y++)p!==y&&(m+=s(t[p],t[y],r));(null===h||m>h)&&(h=m,g=p)}var _=[];for(_.push(t[g]),t.splice(g,1);t.length>0;){for(var v=null,T=null,S=0;S<t.length;S++){var b=s(_[0],t[S],r);(null===v||b<v)&&(v=b,T=S)}_.push(t[T]),t.splice(T,1)}return _}var v,T,S,b,A,R,I,C,N,D=this.context;return v={getNextQuality:d,reset:t},e(),v}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js"),o={MANUAL:"manual_weight_selection",RANDOM:"random_weight_selection",DYNAMIC:"dynamic_weight_selection"};r.__dashjs_factory_name="LearningAbrController",t.default=a.default.getClassFactory(r)},"./src/streaming/rules/abr/lolp/LoLpQoEEvaluator.js":function(e,t,n){function r(){function e(){t()}function t(){f=null,d=null,h=null,g=null}function n(e,t,n){f=r("segment",e,t,n),d=e,h=t,g=n}function r(e,t,n,r){var a=new i.default;return a.type=e,a.weights.bitrateReward=t||1,a.weights.bitrateSwitchPenalty=1,a.weights.rebufferPenalty=n||1e3,a.weights.latencyPenalty=[],a.weights.latencyPenalty.push({threshold:1.1,penalty:.05*r}),a.weights.latencyPenalty.push({threshold:1e8,penalty:.1*n}),a.weights.playbackSpeedPenalty=r||200,a}function a(e,t,n,r){f&&o(e,t,n,r,f)}function o(e,t,n,r,a){a.bitrateWSum+=a.weights.bitrateReward*e,a.lastBitrate&&(a.bitrateSwitchWSum+=a.weights.bitrateSwitchPenalty*Math.abs(e-a.lastBitrate)),a.lastBitrate=e,a.rebufferWSum+=a.weights.rebufferPenalty*t;for(var i=0;i<a.weights.latencyPenalty.length;i++){var o=a.weights.latencyPenalty[i];if(n<=o.threshold){a.latencyWSum+=o.penalty*n;break}}a.playbackSpeedWSum+=a.weights.playbackSpeedPenalty*Math.abs(1-r),a.totalQoe=a.bitrateWSum-a.bitrateSwitchWSum-a.rebufferWSum-a.latencyWSum-a.playbackSpeedWSum}function s(){return f}function u(e,t,n,a){var i=null;return d&&h&&g&&(i=r("segment",d,h,g)),i?(o(e,t,n,a,i),i.totalQoe):0}function l(){t()}var c,f,d,h,g;return c={setupPerSegmentQoe:n,logSegmentMetrics:a,getPerSegmentQoe:s,calculateSingleUseQoe:u,reset:l},e(),c}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/rules/abr/lolp/QoeInfo.js");r.__dashjs_factory_name="LoLpQoeEvaluator",t.default=a.default.getClassFactory(r)},"./src/streaming/rules/abr/lolp/LoLpRule.js":function(e,t,n){function r(e){function t(){g=Object(a.default)(_).getInstance().getLogger(p),m=Object(o.default)(_).create(),y=Object(s.default)(_).create()}function n(e){try{var t=Object(u.default)(_).create(),n=e.getMediaInfo().type,r=e.getAbrController(),a=e.getStreamInfo(),i=r.getQualityFor(n,a.id),o=e.getMediaInfo(),s=E.getCurrentBufferState(n),p=e.getScheduleController(),v=E.getCurrentBufferLevel(n,!0),T=a&&a.manifestInfo?a.manifestInfo.isDynamic:null,S=p.getPlaybackController(),b=S.getCurrentLiveLatency();if(!e.useLoLPABR()||n===f.default.AUDIO)return t;b||(b=0);var A=S.getPlaybackRate(),R=r.getThroughputHistory(),I=R.getSafeAverageThroughput(n,T);if(g.debug("Throughput ".concat(Math.round(I)," kbps")),isNaN(I)||!s)return t;if(r.getAbandonmentStateFor(a.id,n)===l.default.ABANDON_LOAD)return t;for(var C=o.bitrateList,N=e.getRepresentationInfo().fragmentDuration,D=C[0].bandwidth/1e3,w=C[C.length-1].bandwidth/1e3,O=0;O<C.length;O++){var M=C[O].bandwidth/1e3;M>w?w=M:M<D&&(D=M)}var P=C[i].bandwidth,L=P/1e3,F=E.getCurrentHttpRequest(n,!0),j=(F.tresponse.getTime()-F.trequest.getTime())/1e3,x=j>N?j-N:0;y.setupPerSegmentQoe(N,w,D),y.logSegmentMetrics(L,x,b,A);var k=Object(c.default)(_).create({targetLatency:d,bufferMin:h,segmentDuration:N,qoeEvaluator:y});return t.quality=m.getNextQuality(o,1e3*I,b,v,A,i,k),t.reason={throughput:I,latency:b},t.priority=u.default.PRIORITY.STRONG,p.setTimeToLoadDelay(0),t.quality!==i&&console.log("[TgcLearningRule]["+n+"] requesting switch to index: ",t.quality,"Average throughput",Math.round(I),"kbps"),t}catch(e){throw e}}function r(){m.reset(),y.reset()}function i(){r()}e=e||{};var g,p,m,y,E=e.dashMetrics,_=this.context;return p={getMaxIndex:n,reset:i},t(),p}n.r(t);var a=n("./src/core/Debug.js"),i=n("./src/core/FactoryMaker.js"),o=n("./src/streaming/rules/abr/lolp/LearningAbrController.js"),s=n("./src/streaming/rules/abr/lolp/LoLpQoEEvaluator.js"),u=n("./src/streaming/rules/SwitchRequest.js"),l=n("./src/streaming/constants/MetricsConstants.js"),c=n("./src/streaming/rules/abr/lolp/LoLpWeightSelector.js"),f=n("./src/streaming/constants/Constants.js"),d=1.5,h=.3;r.__dashjs_factory_name="LoLPRule",t.default=i.default.getClassFactory(r)},"./src/streaming/rules/abr/lolp/LoLpWeightSelector.js":function(e,t,n){function r(e){function t(){n()}function n(){f=[.2,.4,.6,.8,1],d=4,h=i(f,d),g=0}function r(e,t,n,r,i,o){var s=null,u=null,c=null,f=Math.abs(t-g);return e.forEach(function(e){h.forEach(function(r){var d,h={throughput:r[0],latency:r[1],buffer:r[2],switch:r[3]},g=e.bitrate*y/i,p=l(n,g),m=Math.max(1e-5,g-p);d=0===h.buffer?10:1/h.buffer;var _=d*m;d=0===h.latency?10:1/h.latency;var v=d*e.state.latency,T=E.calculateSingleUseQoe(e.bitrate,_,v,o);(null===s||T>s)&&a(t,p,f)&&(s=T,u=r,c=e.bitrate)})}),null===u&&null===c&&(u=-1),g=t,u}function a(e,t,n){return!(e>p+n)&&t>=m}function i(e,t){var n=e.map(function(e){return[e]}),r=function t(n,r,a){if(a===r)return n;for(var i=n.length,o=0;o<i;o++)for(var s=n.shift(),u=0;u<e.length;u++)n.push(s.concat(e[u]));return t(n,r,a+1)};return r(n,t,1)}function o(){return m}function s(){return y}function u(e,t,n){var r=e*y/n;return l(t,r)}function l(e,t){var n,r=s();return n=t>r?e-r:e+r-t,n}var c,f,d,h,g,p=e.targetLatency,m=e.bufferMin,y=e.segmentDuration,E=e.qoeEvaluator;return c={getMinBuffer:o,getSegmentDuration:s,getNextBufferWithBitrate:u,getNextBuffer:l,findWeightVector:r},t(),c}n.r(t);var a=n("./src/core/FactoryMaker.js");r.__dashjs_factory_name="LoLpWeightSelector",t.default=a.default.getClassFactory(r)},"./src/streaming/rules/abr/lolp/QoeInfo.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.type=null,this.lastBitrate=null,this.weights={},this.weights.bitrateReward=null,this.weights.bitrateSwitchPenalty=null,this.weights.rebufferPenalty=null,this.weights.latencyPenalty=null,this.weights.playbackSpeedPenalty=null,this.bitrateWSum=0,this.bitrateSwitchWSum=0,this.rebufferWSum=0,this.latencyWSum=0,this.playbackSpeedWSum=0,this.totalQoe=0};t.default=a},"./src/streaming/text/EmbeddedTextHtmlRender.js":function(e,t,n){function r(){function e(e){for(var t="",n=0;n<e.length;++n){var r=e[n];t+=r.uchar}var a=t.length,i=t.replace(/^\s+/,"").length;return a-i}function t(e){return"left: "+3.125*e.x+"%; top: "+6.66*e.y1+"%; width: "+(100-3.125*e.x)+"%; height: "+6.66*Math.max(e.y2-1-e.y1,1)+"%; align-items: flex-start; overflow: visible; -webkit-writing-mode: horizontal-tb;"}function n(e){return"red"===e?"rgb(255, 0, 0)":"green"===e?"rgb(0, 255, 0)":"blue"===e?"rgb(0, 0, 255)":"cyan"===e?"rgb(0, 255, 255)":"magenta"===e?"rgb(255, 0, 255)":"yellow"===e?"rgb(255, 255, 0)":"white"===e?"rgb(255, 255, 255)":"black"===e?"rgb(0, 0, 0)":e}function r(e,t){var r=e.videoHeight/15;return t?"font-size: "+r+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; color: "+(t.foreground?n(t.foreground):"rgb(255, 255, 255)")+"; font-style: "+(t.italics?"italic":"normal")+"; text-decoration: "+(t.underline?"underline":"none")+"; white-space: pre; background-color: "+(t.background?n(t.background):"transparent")+";":"font-size: "+r+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; justify-content: flex-start; text-align: left; color: rgb(255, 255, 255); font-style: normal; white-space: pre; line-height: normal; font-weight: normal; text-decoration: none; width: 100%; display: flex;"}function a(e){return e.replace(/^\s+/g,"")}function i(e){return e.replace(/\s+$/g,"")}function o(n,o,s,l){var c,f,d=null,h=null,g=!1,p=-1,m={start:o,end:s,spans:[]},y="style_cea608_white_black",E={},_={},v=[];for(c=0;c<15;++c){var T=l.rows[c],S="",b=null;if(!1===T.isEmpty()){var A=e(T.chars);null===d&&(d={x:A,y1:c,y2:c+1,p:[]}),A!==p&&g&&(d.p.push(m),m={start:o,
end:s,spans:[]},d.y2=c,d.name="region_"+d.x+"_"+d.y1+"_"+d.y2,!1===E.hasOwnProperty(d.name)?(v.push(d),E[d.name]=d):(h=E[d.name],h.p.contat(d.p)),d={x:A,y1:c,y2:c+1,p:[]});for(var R=0;R<T.chars.length;++R){var I=T.chars[R],C=I.penState;if(null===b||!C.equals(b)){S.trim().length>0&&(m.spans.push({name:y,line:S,row:c}),S="");var N="style_cea608_"+C.foreground+"_"+C.background;C.underline&&(N+="_underline"),C.italics&&(N+="_italics"),_.hasOwnProperty(N)||(_[N]=JSON.parse(JSON.stringify(C))),b=C,y=N}S+=I.uchar}S.trim().length>0&&m.spans.push({name:y,line:S,row:c}),g=!0,p=A}else g=!1,p=-1,d&&(d.p.push(m),m={start:o,end:s,spans:[]},d.y2=c,d.name="region_"+d.x+"_"+d.y1+"_"+d.y2,!1===E.hasOwnProperty(d.name)?(v.push(d),E[d.name]=d):(h=E[d.name],h.p.contat(d.p)),d=null)}d&&(d.p.push(m),d.y2=c+1,d.name="region_"+d.x+"_"+d.y1+"_"+d.y2,!1===E.hasOwnProperty(d.name)?(v.push(d),E[d.name]=d):(h=E[d.name],h.p.contat(d.p)),d=null);var D=[];for(c=0;c<v.length;++c){var w=v[c],O="sub_cea608_"+u++,M=document.createElement("div");M.id=O;var P=t(w);M.style.cssText="position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;"+P;var L=document.createElement("div");L.className="paragraph bodyStyle",L.style.cssText=r(n);var F=document.createElement("div");F.className="cueUniWrapper",F.style.cssText="unicode-bidi: normal; direction: ltr;";for(var j=0;j<w.p.length;++j){var x=w.p[j],k=0;for(f=0;f<x.spans.length;++f){var B=x.spans[f];if(B.line.length>0){if(0!==f&&k!=B.row){var U=document.createElement("br");U.className="lineBreak",F.appendChild(U)}var G=!1;k===B.row&&(G=!0),k=B.row;var H=_[B.name],q=document.createElement("span");q.className="spanPadding "+B.name+" customSpanColor",q.style.cssText=r(n,H),0!==f&&G?f===x.spans.length-1?q.textContent=i(B.line):q.textContent=B.line:x.spans.length>1&&f<x.spans.length-1&&B.row===x.spans[f+1].row?q.textContent=a(B.line):q.textContent=B.line.trim(),F.appendChild(q)}}}L.appendChild(F),M.appendChild(L);var Y={bodyStyle:["%",90]};for(var K in _)_.hasOwnProperty(K)&&(Y[K]=["%",90]);D.push({type:"html",start:o,end:s,cueHTMLElement:M,cueID:O,cellResolution:[32,15],isFromCEA608:!0,fontSize:Y,lineHeight:{},linePadding:{}})}return D}var s,u=0;return s={createHTMLCaptionsFromScreen:o},s}n.r(t);var a=n("./src/core/FactoryMaker.js");r.__dashjs_factory_name="EmbeddedTextHtmlRender",t.default=a.default.getSingletonFactory(r)},"./src/streaming/text/NotFragmentedTextBufferController.js":function(e,t,n){function r(e){function t(){k=!1,B=null,x=!1,G=Object(s.default)(H).getInstance(),q.on(i.default.INIT_FRAGMENT_LOADED,b,j)}function n(){return f}function r(e){p(e)}function o(e){return new Promise(function(t,n){try{U=Object(u.default)(H).create({mediaSource:B,textController:Y,eventBus:q}),U.initializeForFirstUse(V,e),k||(U.getBuffer()&&"function"==typeof U.getBuffer().initialize&&U.getBuffer().initialize(),k=!0),t(U)}catch(e){K.error(new l.default(c.default.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,c.default.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+W)),n(e)}})}function d(){return V.id}function h(){return W}function g(){return U}function p(e){B=e}function m(){return B}function y(){return!1}function E(){return 0}function _(){return x}function v(e){x!==e&&(x=e,x&&F(i.default.BUFFERING_COMPLETED))}function T(e){q.off(i.default.INIT_FRAGMENT_LOADED,b,j),!e&&U&&(U.abort(),U.reset(),U=null)}function S(e){return null!==G.extract(V.id,e)}function b(e){e.chunk.bytes&&!x&&(G.save(e.chunk),U.append(e.chunk),v(!0))}function A(){return null}function R(){return[]}function I(){return Number.POSITIVE_INFINITY}function C(){return Promise.resolve()}function N(){return Promise.resolve()}function D(){return Promise.resolve()}function w(){return x=!1,Promise.resolve()}function O(){return Promise.resolve()}function M(){}function P(){}function L(){return Promise.resolve()}function F(e,t){var n=t||{};q.trigger(e,n,{streamId:V.id,mediaType:W})}e=e||{};var j,x,k,B,U,G,H=this.context,q=Object(a.default)(H).getInstance(),Y=e.textController,K=e.errHandler,V=e.streamInfo,W=e.type;return j={initialize:r,getStreamId:d,getType:h,getBufferControllerType:n,createBufferSink:o,getBuffer:g,getBufferLevel:E,getRangeAt:A,getAllRangesWithSafetyFactor:R,getContinuousBufferTimeForTargetTime:I,setMediaSource:p,getMediaSource:m,appendInitSegmentFromCache:S,getIsBufferingCompleted:_,setIsBufferingCompleted:v,getIsPruningInProgress:y,reset:T,clearBuffers:C,prepareForPlaybackSeek:D,prepareForReplacementTrackSwitch:w,setSeekTarget:M,updateAppendWindow:O,pruneAllSafely:L,updateBufferTimestampOffset:N,segmentRequestingCompleted:P},t(),j}n.r(t);var a=n("./src/core/EventBus.js"),i=n("./src/core/events/Events.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/streaming/utils/InitCache.js"),u=n("./src/streaming/SourceBufferSink.js"),l=n("./src/streaming/vo/DashJSError.js"),c=n("./src/core/errors/Errors.js"),f="NotFragmentedTextBufferController";r.__dashjs_factory_name=f,t.default=o.default.getClassFactory(r)},"./src/streaming/text/TextController.js":function(e,t,n){function r(e){function t(){k=null,G=!1,H=!1,B=!1,q=!1,F=Object(u.default)(Y).getInstance(),j=Object(l.default)(Y).getInstance(),x=Object(c.default)(Y).getInstance(),D()}function n(){x.on(f.default.CURRENT_TRACK_CHANGED,v,O),x.on(f.default.TEXT_TRACKS_QUEUE_INITIALIZED,_,O)}function r(e){var t=e.id,n=Object(s.default)(Y).create({videoModel:X,streamInfo:e});n.initialize(),L[t]=n;var r=Object(o.default)(Y).create({errHandler:V,adapter:K,manifestModel:W,mediaController:z,videoModel:X,textTracks:n,vttParser:F,ttmlParser:j,streamInfo:e});r.initialize(),P[t]=r,M[t]={},M[t].lastEnabledIndex=-1}function i(e){var t=e.id;L[t]&&L[t].createTracks()}function g(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=e.id;P[a]&&P[a].addMediaInfos(t,n,r)}function p(e){var t=e.id;if(P&&P[t])return P[t]}function m(){return U}function y(e,t){var n=e.id;P[n]&&P[n].addEmbeddedTrack(t)}function E(e){k=e,B=!0}function _(e){var t=e.tracks,n=e.index,r=e.streamId,a=Q.get().streaming.text.defaultEnabled;!1===a&&!S()||q?A(r,-1):(k&&t.some(function(e,t){if(z.matchSettings(k,e))return A(r,t),n=t,!0}),U=!1),M[r].lastEnabledIndex=n,x.trigger(d.default.TEXT_TRACKS_ADDED,{enabled:S(),index:n,tracks:t,streamId:r}),H=!0}function v(e){if(!B&&e&&e.newMediaInfo){var t=e.newMediaInfo;t.type===a.default.TEXT&&(k={lang:t.lang,role:t.roles[0],index:t.index,codec:t.codec,accessibility:t.accessibility[0]})}}function T(e,t){Object(h.checkParameterType)(t,"boolean"),S()!==t&&(t&&A(e,M[e].lastEnabledIndex),t||(M[e].lastEnabledIndex=C(e),H?A(e,-1):q=!0))}function S(){var e=!0;return U&&!G&&(e=!1),e}function b(e){Object(h.checkParameterType)(e,"boolean"),G=e}function A(e,t){U=-1===t,U&&z&&z.saveTextSettingsDisabled();var n=C(e);if(n!==t&&L[e]){L[e].setModeForTrackIdx(n,a.default.TEXT_HIDDEN),L[e].setCurrentTrackIdx(t),L[e].setModeForTrackIdx(t,a.default.TEXT_SHOWING);var r=L[e].getCurrentTrackInfo();r&&r.isFragmented&&!r.isEmbedded?R(e,r,n):r&&!r.isFragmented&&I(e,r),z.setTrack(r)}}function R(e,t,n){if(P[e])for(var r=P[e].getConfig(),i=r.fragmentedTracks,o=0;o<i.length;o++){var s=i[o];if(t.lang===s.lang&&(s.id?t.id===s.id:t.index===s.index)){var u=z.getCurrentTrackFor(a.default.TEXT,e);(s.id?u.id!==s.id:u.index!==s.index)?(L[e].deleteCuesFromTrackIdx(n),P[e].setCurrentFragmentedTrackIdx(o)):-1===n&&x.trigger(f.default.SET_FRAGMENTED_TEXT_AFTER_DISABLED,{},{streamId:e,mediaType:a.default.TEXT})}}}function I(e,t){x.trigger(f.default.SET_NON_FRAGMENTED_TEXT,{currentTrackInfo:t},{streamId:e,mediaType:a.default.TEXT})}function C(e){return L[e].getCurrentTrackIdx()}function N(e){if(e){var t=e.id;P[t]&&P[t].resetMediaInfos(),L[t]&&L[t].deleteAllTextTracks()}}function D(){P={},L={},M={},U=!0,H=!1,q=!1}function w(){D(),x.off(f.default.CURRENT_TRACK_CHANGED,v,O),x.off(f.default.TEXT_TRACKS_QUEUE_INITIALIZED,_,O),Object.keys(P).forEach(function(e){P[e].resetEmbedded(),P[e].reset()})}var O,M,P,L,F,j,x,k,B,U,G,H,q,Y=this.context,K=e.adapter,V=e.errHandler,W=e.manifestModel,z=e.mediaController,X=e.videoModel,Q=e.settings;return O={deactivateStream:N,initialize:n,initializeForStream:r,createTracks:i,getTextSourceBuffer:p,getAllTracksAreDisabled:m,addEmbeddedTrack:y,setInitialSettings:E,enableText:T,isTextEnabled:S,setTextTrack:A,getCurrentTrackIdx:C,enableForcedTextStreaming:b,addMediaInfosToBuffer:g,reset:w},t(),O}n.r(t);var a=n("./src/streaming/constants/Constants.js"),i=n("./src/core/FactoryMaker.js"),o=n("./src/streaming/text/TextSourceBuffer.js"),s=n("./src/streaming/text/TextTracks.js"),u=n("./src/streaming/utils/VTTParser.js"),l=n("./src/streaming/utils/TTMLParser.js"),c=n("./src/core/EventBus.js"),f=n("./src/core/events/Events.js"),d=n("./src/streaming/MediaPlayerEvents.js"),h=n("./src/streaming/utils/SupervisorTools.js");r.__dashjs_factory_name="TextController",t.default=i.default.getClassFactory(r)},"./src/streaming/text/TextSourceBuffer.js":function(e,t,n){function r(e){function t(){W=Object(c.default)(me).getInstance().getLogger(V),z=Object(s.default)(me).getInstance(),l()}function n(){return pe.id}function r(){J=null,Z=NaN,ee=[],te=null,$=!1}function l(){r(),Q=[],X=null}function d(){Ee||A()}function g(e,t,n){if(Q=Q.concat(t),e===a.default.TEXT&&t[0].isFragmented&&!t[0].isEmbedded){J=n,V.buffered=Object(u.default)(me).create(),ee=ce.getTracksFor(a.default.TEXT,pe.id).filter(function(e){return e.isFragmented});for(var r=ce.getCurrentTrackFor(a.default.TEXT,pe.id),i=0;i<ee.length;i++)if(ee[i]===r){N(i);break}}for(var o=0;o<t.length;o++)v(t[o])}function v(e){var t=new o.default,n={subtitle:"subtitles",caption:"captions"};for(var r in e)t[r]=e[r];t.labels=e.labels,t.defaultTrack=G(e),t.isFragmented=e.isFragmented,t.isEmbedded=!!e.isEmbedded,t.isTTML=D(e),t.kind=w(e,n),de.addTextTrack(t)}function T(){}function S(){l(),Q=[],z=null}function b(e){var t=e.chunk,n=e.timeOffset;t.mediaInfo.embeddedCaptions&&O(t.bytes,t,n)}function A(){re=[],ne=null,ae=0,oe=[],ie=null,Ee=!0,se=Object(f.default)(me).getInstance(),ye.on(y.default.VIDEO_CHUNK_RECEIVED,b,V),ye.on(y.default.BUFFER_CLEARED,Y,V)}function R(){ye.off(y.default.VIDEO_CHUNK_RECEIVED,b,V),ye.off(y.default.BUFFER_CLEARED,Y,V),de&&de.deleteAllTextTracks(),Ee=!1,re=[],oe=[null,null],ie=null}function I(e){if(Ee&&e)if(e.id===a.default.CC1||e.id===a.default.CC3){for(var t=0;t<re.length;t++)if(re[t].id===e.id)return;re.push(e)}else W.warn("Embedded track "+e.id+" not supported!")}function C(){var e={fragmentModel:J,fragmentedTracks:ee,videoModel:fe};return e}function N(e){ne=e}function D(e){return e.codec&&e.codec.search(a.default.STPP)>=0||e.mimeType&&e.mimeType.search(a.default.TTML)>=0}function w(e,t){var n=e.roles&&e.roles.length>0?t[e.roles[0]]:t.caption;return n=n===t.caption||n===t.subtitle?n:t.caption,n}function O(e,t,n){var r=t.mediaInfo,i=r.type,o=r.mimeType,s=r.codec||o;s?-1!==r.codec.indexOf("application/mp4")?M(e,t,s):i===a.default.VIDEO?j(e,t,n):F(e,t,s):W.error("No text type defined")}function M(e,t,n){var r,i;if("InitializationSegment"===t.segmentType)$=!0,Z=z.getMediaTimescaleFromMoov(e);else{if(!$)return;i=z.getSamplesInfo(e),r=i.sampleList,r.length>0&&(te=r[0].cts-t.start*Z),n.search(a.default.STPP)>=0?P(e,r,n):L(e,r)}}function P(e,t,n){var r,i;for(X=null!==X?X:H(n),r=0;r<t.length;r++){var o=t[r],s=o.cts,u=U(),l=u+s/Z,c=l+o.duration/Z;V.buffered.add(l,c);var f=new DataView(e,o.offset,o.subSizes[0]),d=h.a.Utils.dataViewToString(f,a.default.UTF8),g=[],p=o.offset+o.subSizes[0];for(i=1;i<o.subSizes.length;i++){var m=new Uint8Array(e,p,o.subSizes[i]),y=String.fromCharCode.apply(null,m);g.push(y),p+=o.subSizes[i]}try{var E=le.getValue(),_=E.ttmlTimeIsRelative?s/Z:0,v=X.parse(d,_,s/Z,(s+o.duration)/Z,g);de.addCaptions(ne,u,v)}catch(e){J.removeExecutedRequestsBeforeTime(),this.remove(),W.error("TTML parser error: "+e.message)}}}function L(e,t){var n,r,a,i=[];for(n=0;n<t.length;n++){var o=t[n];o.cts-=te;var s=U(),u=s+o.cts/Z,l=u+o.duration/Z;V.buffered.add(u,l);var c=e.slice(o.offset,o.offset+o.size),f=h.a.parseBuffer(c);for(r=0;r<f.boxes.length;r++){var d=f.boxes[r];if(W.debug("VTT box1: "+d.type),"vtte"!==d.type&&"vttc"===d.type)for(W.debug("VTT vttc boxes.length = "+d.boxes.length),a=0;a<d.boxes.length;a++){var g=d.boxes[a];if(W.debug("VTT box2: "+g.type),"payl"===g.type){var p=g.cue_text;W.debug("VTT cue_text = "+p);var m=o.cts/Z,y=(o.cts+o.duration)/Z;i.push({start:m,end:y,data:p,styles:{}}),W.debug("VTT "+m+"-"+y+" : "+p)}}}}i.length>0&&de.addCaptions(ne,0,i)}function F(e,t,n){var r,i,o=new DataView(e,0,e.byteLength);i=h.a.Utils.dataViewToString(o,a.default.UTF8);try{r=H(n).parse(i,0),de.addCaptions(de.getCurrentTrackIdx(),0,r),V.buffered&&V.buffered.add(t.start,t.end)}catch(e){ue.error(new E.default(_.default.TIMED_TEXT_ERROR_ID_PARSE_CODE,_.default.TIMED_TEXT_ERROR_MESSAGE_PARSE+e.message,i))}}function j(e,t,n){var r,a;if(t.segmentType===i.HTTPRequest.INIT_SEGMENT_TYPE)0===ae&&(ae=z.getMediaTimescaleFromMoov(e));else if(t.segmentType===i.HTTPRequest.MEDIA_SEGMENT_TYPE){if(0===ae)return void W.warn("CEA-608: No timescale for embeddedTextTrack yet");a=z.getSamplesInfo(e);var o=a.lastSequenceNumber;if(oe[0]||oe[1]||x(),ae){if(false)for(r=0;r<oe.length;r++)oe[r]&&oe[r].reset();for(var s=B(e,a.sampleList),u=0;u<oe.length;u++){var l=s.fields[u],c=oe[u];if(c)for(r=0;r<l.length;r++)c.addData(l[r][0]/ae-n,l[r][1])}ie=o}}}function x(){for(var e,t=0;t<re.length;t++){if(e=de.getTrackIdxForId(re[t].id),-1===e)return void W.warn("CEA-608: data before track is ready.");var n=k(e);oe[t]=new p.a.Cea608Parser(t+1,{newCue:n},null)}}function k(e){function t(t,n,r){var a;if(fe.getTTMLRenderingDiv())a=se.createHTMLCaptionsFromScreen(fe.getElement(),t,n,r);else{var i=r.getDisplayText();a=[{start:t,end:n,data:i,styles:{}}]}a&&de.addCaptions(e,0,a)}return t}function B(e,t){if(0===t.length)return null;for(var n={splits:[],fields:[[],[]]},r=new DataView(e),a=0;a<t.length;a++)for(var i=t[a],o=p.a.findCea608Nalus(r,i.offset,i.size),s=null,u=0,l=0;l<o.length;l++)for(var c=p.a.extractCea608DataFromRange(r,o[l]),f=0;f<2;f++)if(c[f].length>0){i.cts!==s?u=0:u+=1;var d=U();n.fields[f].push([i.cts+d*ae,c[f],u]),s=i.cts}return n.fields.forEach(function(e){e.sort(function(e,t){return e[0]===t[0]?e[2]-t[2]:e[0]-t[0]})}),n}function U(){return isNaN(V.timestampOffset)?0:V.timestampOffset}function G(e){var t=!1;return re.length>1&&e.isEmbedded?t=e.id&&e.id===a.default.CC1:1===re.length?e.id&&"string"==typeof e.id&&"CC"===e.id.substring(0,2)&&(t=!0):0===re.length&&(t=e.index===Q[0].index),t}function H(e){var t;return e.search(a.default.VTT)>=0?t=he:(e.search(a.default.TTML)>=0||e.search(a.default.STPP)>=0)&&(t=ge),t}function q(e,t){void 0===e&&e===t&&(e=V.buffered.start(0),t=V.buffered.end(V.buffered.length-1)),V.buffered.remove(e,t),de.deleteCuesFromTrackIdx(ne,e,t)}function Y(e){re.forEach(function(t){var n=de.getTrackIdxForId(t.id);n>=0&&de.deleteCuesFromTrackIdx(n,e.from,e.to)})}function K(){Q=[]}var V,W,z,X,Q,J,$,Z,ee,te,ne,re,ae,ie,oe,se,ue=e.errHandler,le=e.manifestModel,ce=e.mediaController,fe=e.videoModel,de=e.textTracks,he=e.vttParser,ge=e.ttmlParser,pe=e.streamInfo,me=this.context,ye=Object(m.default)(me).getInstance(),Ee=!1;return V={initialize:d,addMediaInfos:g,resetMediaInfos:K,getStreamId:n,append:O,abort:T,addEmbeddedTrack:I,resetEmbedded:R,getConfig:C,setCurrentFragmentedTrackIdx:N,remove:q,reset:S},t(),V}n.r(t);var a=n("./src/streaming/constants/Constants.js"),i=n("./src/streaming/vo/metrics/HTTPRequest.js"),o=n("./src/streaming/vo/TextTrackInfo.js"),s=n("./src/streaming/utils/BoxParser.js"),u=n("./src/streaming/utils/CustomTimeRanges.js"),l=n("./src/core/FactoryMaker.js"),c=n("./src/core/Debug.js"),f=n("./src/streaming/text/EmbeddedTextHtmlRender.js"),d=n("./node_modules/codem-isoboxer/dist/iso_boxer.js"),h=n.n(d),g=n("./externals/cea608-parser.js"),p=n.n(g),m=n("./src/core/EventBus.js"),y=n("./src/core/events/Events.js"),E=n("./src/streaming/vo/DashJSError.js"),_=n("./src/core/errors/Errors.js");r.__dashjs_factory_name="TextSourceBuffer",t.default=l.default.getClassFactory(r)},"./src/streaming/text/TextTracks.js":function(e,t,n){function r(e){function t(){F=Object(l.default)(J).getInstance().getLogger(L)}function n(){"undefined"!=typeof window&&"undefined"!=typeof navigator&&(j=window.VTTCue||window.TextTrackCue,x=[],k=[],B=-1,U=0,G=0,H=0,q=0,Y=null,K=null,W=!1,X=2147483647,z=null,void 0!==document.fullscreenElement?V="fullscreenElement":void 0!==document.webkitIsFullScreen?V="webkitIsFullScreen":document.msFullscreenElement?V="msFullscreenElement":document.mozFullScreen&&(V="mozFullScreen"))}function r(){return ee.id}function u(e){var t=e.kind,n=void 0!==e.id?e.id:e.lang,r=e.lang,a=e.isTTML,i=e.isEmbedded,o=Z.addTextTrack(t,n,r,a,i);return o}function f(e){x.push(e)}function d(){x.sort(function(e,t){return e.index-t.index}),Y=Z.getTTMLRenderingDiv();for(var e=-1,t=0;t<x.length;t++){var n=u(x[t]);k.push(n),x[t].defaultTrack&&(n.default=!0,e=t);var r=E(t);r&&(r.mode=a.default.TEXT_SHOWING,Y&&(x[t].isTTML||x[t].isEmbedded)?r.renderingType="html":r.renderingType="default"),y(t,0,x[t].captionData),$.trigger(s.default.TEXT_TRACK_ADDED)}if(T.call(this,e),e>=0){var i=function t(){var n=E(e);n&&"html"===n.renderingType&&g.call(this,n,!0),$.off(s.default.PLAYBACK_METADATA_LOADED,t,this)};$.on(s.default.PLAYBACK_METADATA_LOADED,i,this);for(var l=0;l<x.length;l++){var c=E(l);c&&(c.mode=l===e?a.default.TEXT_SHOWING:a.default.TEXT_HIDDEN)}}$.trigger(o.default.TEXT_TRACKS_QUEUE_INITIALIZED,{index:B,tracks:x,streamId:ee.id})}function h(e,t,n,r,a,i){var o=e/t,s=n/r,u=0,l=0;o>s?(l=t,u=l/r*n):(u=e,l=u/n*r);var c=0,f=0,d=0,h=0,g=u/l;return g>a?(h=l,d=l*a):(d=u,h=u/a),c=(e-d)/2,f=(t-h)/2,i?{x:c+.1*d,y:f+.1*h,w:.8*d,h:.8*h}:{x:c,y:f,w:d,h:h}}function g(e,t){var n=Z.getClientWidth(),r=Z.getClientHeight(),a=Z.getVideoWidth(),i=Z.getVideoHeight(),o=Z.getVideoRelativeOffsetTop(),u=Z.getVideoRelativeOffsetLeft();if(0!==a&&0!==i){var l=a/i,c=!1;e.isFromCEA608&&(l=3.5/3,c=!0);var f=h.call(this,n,r,a,i,l,c),d=f.w,g=f.h,p=f.x,m=f.y;if(d!=H||g!=q||p!=U||m!=G||t){if(U=p+u,G=m+o,H=d,q=g,Y){var y=Y.style;y&&(y.left=U+"px",y.top=G+"px",y.width=H+"px",y.height=q+"px",y.zIndex=V&&document[V]||W?X:null,$.trigger(s.default.CAPTION_CONTAINER_RESIZE))}var E=e.activeCues;if(E)for(var _=E.length,v=0;v<_;++v){var T=E[v];T.scaleCue(T)}}}}function p(e){var t,n,r,a,i,o=H,s=q;if(e.cellResolution){var u=[o/e.cellResolution[0],s/e.cellResolution[1]];if(e.linePadding)for(t in e.linePadding)if(e.linePadding.hasOwnProperty(t)){var l=e.linePadding[t];n=(l*u[0]).toString();for(var c=document.getElementsByClassName("spanPadding"),f=0;f<c.length;f++)c[f].style.cssText=c[f].style.cssText.replace(/(padding-left\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+n),c[f].style.cssText=c[f].style.cssText.replace(/(padding-right\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+n)}if(e.fontSize){for(t in e.fontSize)if(e.fontSize.hasOwnProperty(t)){"%"===e.fontSize[t][0]?r=e.fontSize[t][1]/100:"c"===e.fontSize[t][0]&&(r=e.fontSize[t][1]),n=(r*u[1]).toString(),i="defaultFontSize"!==t?document.getElementsByClassName(t):document.getElementsByClassName("paragraph");for(var d=0;d<i.length;d++)i[d].style.cssText=i[d].style.cssText.replace(/(font-size\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+n)}if(e.lineHeight)for(t in e.lineHeight)if(e.lineHeight.hasOwnProperty(t)){"%"===e.lineHeight[t][0]?a=e.lineHeight[t][1]/100:"c"===e.fontSize[t][0]&&(a=e.lineHeight[t][1]),n=(a*u[1]).toString(),i=document.getElementsByClassName(t);for(var h=0;h<i.length;h++)i[h].style.cssText=i[h].style.cssText.replace(/(line-height\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+n)}}}if(e.isd){var g=document.getElementById(e.cueID);g&&Y.removeChild(g),m(e)}}function m(e){if(Y){var t=document.createElement("div");Y.appendChild(t),z=Object(c.renderHTML)(e.isd,t,function(t){var n=/^(urn:)(mpeg:[a-z0-9][a-z0-9-]{0,31}:)(subs:)([0-9]+)$/,r=/^#(.*)$/;if(n.test(t)){var a=n.exec(t),i=parseInt(a[4],10)-1,o=btoa(e.images[i]),s="data:image/png;base64,"+o;return s}if(r.test(t)){var u=r.exec(t),l=u[1],c="data:image/png;base64,"+e.embeddedImages[l];return c}return null},Y.clientHeight,Y.clientWidth,!1,function(e){F.info("renderCaption :",e)},z,!0),t.id=e.cueID,$.trigger(s.default.CAPTION_RENDERED,{captionDiv:t,currentTrackIdx:B})}}function y(e,t,n){var r=E(e),i=this;if(r&&Array.isArray(n)&&0!==n.length)for(var o=0;o<n.length;o++){var u=void 0,l=n[o];r.cellResolution=l.cellResolution,r.isFromCEA608=l.isFromCEA608,"html"!==l.type||!Y||isNaN(l.start)||isNaN(l.end)?!l.data||isNaN(l.start)||isNaN(l.end)||(u=new j(l.start-t,l.end-t,l.data),l.styles&&(void 0!==l.styles.align&&"align"in u&&(u.align=l.styles.align),void 0!==l.styles.line&&"line"in u&&(u.line=l.styles.line),void 0!==l.styles.position&&"position"in u&&(u.position=l.styles.position),void 0!==l.styles.size&&"size"in u&&(u.size=l.styles.size)),u.onenter=function(){r.mode===a.default.TEXT_SHOWING&&$.trigger(s.default.CAPTION_RENDERED,{currentTrackIdx:B})}):(u=new j(l.start+t,l.end+t,""),u.cueHTMLElement=l.cueHTMLElement,u.isd=l.isd,u.images=l.images,u.embeddedImages=l.embeddedImages,u.cueID=l.cueID,u.scaleCue=p.bind(i),u.cellResolution=l.cellResolution,u.lineHeight=l.lineHeight,u.linePadding=l.linePadding,u.fontSize=l.fontSize,Y.style.left=U+"px",Y.style.top=G+"px",Y.style.width=H+"px",Y.style.height=q+"px",u.onenter=function(){r.mode===a.default.TEXT_SHOWING&&(this.isd?(m(this),F.debug("Cue enter id:"+this.cueID)):(Y.appendChild(this.cueHTMLElement),p.call(i,this),$.trigger(s.default.CAPTION_RENDERED,{captionDiv:this.cueHTMLElement,currentTrackIdx:B})))},u.onexit=function(){if(Y)for(var e=Y.childNodes,t=0;t<e.length;++t)e[t].id===this.cueID&&(F.debug("Cue exit id:"+e[t].id),Y.removeChild(e[t]),--t)});try{u?b(r,u)||r.addCue(u):F.error("impossible to display subtitles.")}catch(e){throw R(r),r.addCue(u),e}}}function E(e){return e>=0&&x[e]?Z.getTextTrack(x[e].kind,x[e].id,x[e].lang,x[e].isTTML,x[e].isEmbedded):null}function _(){return B}function v(e){for(var t=-1,n=0;n<x.length;n++)if(x[n].id===e){t=n;break}return t}function T(e){var t=this;if(e!==B){B=e;var n=E(B);S.call(this,n),K&&(clearInterval(K),K=null),n&&"html"===n.renderingType&&(g.call(this,n,!0),window.ResizeObserver?(Q=new window.ResizeObserver(function(){g.call(t,n,!0)}),Q.observe(Z.getElement())):K=setInterval(g.bind(this,n),500))}}function S(e){O.call(this),e&&"html"===e.renderingType?D.call(this):w.call(this)}function b(e,t){if(!e.cues)return!1;for(var n=0;n<e.cues.length;n++)if(e.cues[n].startTime===t.startTime&&e.cues[n].endTime===t.endTime)return!0;return!1}function A(e,t,n){return(isNaN(t)||e.startTime>=t)&&(isNaN(n)||e.endTime<=n)}function R(e,t,n){if(e.cues)for(var r=e.cues,a=r.length-1,i=a;i>=0;i--)A(r[i],t,n)&&(r[i].onexit&&r[i].onexit(),e.removeCue(r[i]))}function I(e,t,n){var r=E(e);r&&R(r,t,n)}function C(){for(var e=k?k.length:0,t=0;t<e;t++){var n=E(t);n&&R.call(this,n,ee.start,ee.start+ee.duration)}k=[],x=[],K&&(clearInterval(K),K=null),Q&&Z&&(Q.unobserve(Z.getElement()),Q=null),B=-1,O.call(this)}function N(e){Z.removeChild(k[e]),k.splice(e,1)}function D(){var e=document.getElementById("native-cue-style");if(!e){e=document.createElement("style"),e.id="native-cue-style",document.head.appendChild(e);var t=e.sheet,n=Z.getElement();try{n&&(n.id?t.insertRule("#"+n.id+"::cue {background: transparent}",0):0!==n.classList.length?t.insertRule("."+n.className+"::cue {background: transparent}",0):t.insertRule("video::cue {background: transparent}",0))}catch(e){F.info(""+e.message)}}}function w(){var e=document.getElementById("native-cue-style");e&&document.head.removeChild(e)}function O(){if(Y)for(;Y.firstChild;)Y.removeChild(Y.firstChild)}function M(e,t){var n=E(e);n&&n.mode!==t&&(n.mode=t)}function P(){return x[B]}var L,F,j,x,k,B,U,G,H,q,Y,K,V,W,z,X,Q,J=this.context,$=Object(i.default)(J).getInstance(),Z=e.videoModel,ee=e.streamInfo;return L={initialize:n,getStreamId:r,addTextTrack:f,addCaptions:y,createTracks:d,getCurrentTrackIdx:_,setCurrentTrackIdx:T,getTrackIdxForId:v,getCurrentTrackInfo:P,setModeForTrackIdx:M,deleteCuesFromTrackIdx:I,deleteAllTextTracks:C,deleteTextTrack:N},t(),L}n.r(t);var a=n("./src/streaming/constants/Constants.js"),i=n("./src/core/EventBus.js"),o=n("./src/core/events/Events.js"),s=n("./src/streaming/MediaPlayerEvents.js"),u=n("./src/core/FactoryMaker.js"),l=n("./src/core/Debug.js"),c=n("./node_modules/imsc/src/main/js/main.js");r.__dashjs_factory_name="TextTracks",t.default=u.default.getClassFactory(r)},"./src/streaming/thumbnail/ThumbnailController.js":function(e,t,n){function r(e){function t(){g(),m=Object(s.default)(y).create({streamInfo:E,adapter:e.adapter,baseURLController:e.baseURLController,timelineConverter:e.timelineConverter,debug:e.debug,eventBus:e.eventBus,events:e.events,dashConstants:e.dashConstants,dashMetrics:e.dashMetrics,segmentBaseController:e.segmentBaseController})}function n(){m.addTracks();var e=m.getTracks();e&&e.length>0&&f(0)}function r(){return E.id}function a(e,t){if("function"==typeof t){var n,r,a=m.getCurrentTrack();if(!a||a.segmentDuration<=0||null==e)t(null);else{r=m.getThumbnailRequestForTime(e),r&&(a.segmentDuration=r.duration),n=e%a.segmentDuration;var i=Math.floor(n*a.tilesHor*a.tilesVert/a.segmentDuration),s=new o.default;if(s.width=Math.floor(a.widthPerTile),s.height=Math.floor(a.heightPerTile),s.x=Math.floor(i%a.tilesHor)*a.widthPerTile,s.y=Math.floor(i/a.tilesHor)*a.heightPerTile,"readThumbnail"in a)return a.readThumbnail(e,function(e){s.url=e,t(s)});if(r)s.url=r.url,a.segmentDuration=NaN;else{var u=Math.floor(e/a.segmentDuration);s.url=c(a,u)}t(s)}}}function c(e,t){var n=t+e.startNumber,r=Object(l.replaceTokenForTemplate)(e.templateUrl,"Number",n);return r=Object(l.replaceTokenForTemplate)(r,"Time",(n-1)*e.segmentDuration*e.timescale),r=Object(l.replaceTokenForTemplate)(r,"Bandwidth",e.bandwidth),Object(l.unescapeDollarsInTemplate)(r)}function f(e){m.setTrackByIndex(e)}function d(){return m.getCurrentTrackIndex()}function h(){var e=m.getTracks(),t=0;return e.map(function(e){var n=new u.default;return n.mediaType=i.default.IMAGE,n.qualityIndex=t++,n.bitrate=e.bitrate,n.width=e.width,n.height=e.height,n})}function g(){m&&m.reset()}var p,m,y=this.context,E=e.streamInfo;return p={getStreamId:r,initialize:n,provide:a,setTrackByIndex:f,getCurrentTrackIndex:d,getBitrateList:h,reset:g},t(),p}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/constants/Constants.js"),o=n("./src/streaming/vo/Thumbnail.js"),s=n("./src/streaming/thumbnail/ThumbnailTracks.js"),u=n("./src/streaming/vo/BitrateInfo.js"),l=n("./src/dash/utils/SegmentsUtils.js");r.__dashjs_factory_name="ThumbnailController",t.default=a.default.getClassFactory(r)},"./src/streaming/thumbnail/ThumbnailTracks.js":function(e,t,n){function r(e){function t(){S(),D=Object(f.default)(O).create({}),w=Object(c.default)(O).getInstance(),N=Object(h.default)(O).create({events:k,eventBus:x,streamInfo:L,timelineConverter:F,dashConstants:B,dashMetrics:e.dashMetrics,segmentBaseController:e.segmentBaseController,type:a.default.IMAGE}),R=Object(d.default)(O).create({streamInfo:L,type:a.default.IMAGE,timelineConverter:F,segmentsController:N,baseURLController:P,debug:j,eventBus:x,events:k,dashConstants:B,urlUtils:U}),R.initialize(!!M&&M.getIsDynamic())}function n(){if(L&&M&&(C=M.getMediaInfoForType(L,a.default.IMAGE),C)){var e=M.getVoRepresentations(C);e&&e.length>0&&e.forEach(function(e){(e.segmentInfoType===i.default.SEGMENT_TEMPLATE&&e.segmentDuration>0&&e.media||e.segmentInfoType===i.default.SEGMENT_TIMELINE)&&r(e),e.segmentInfoType===i.default.SEGMENT_BASE&&r(e,!0)}),A.length>0&&A.sort(function(e,t){return e.bitrate-t.bitrate})}}function r(e,t){var n=new s.default;n.id=e.id,n.bitrate=e.bandwidth,n.width=e.width,n.height=e.height,n.tilesHor=1,n.tilesVert=1,e.essentialProperties&&e.essentialProperties.forEach(function(e){if(g.indexOf(e.schemeIdUri)>=0&&e.value){var t=e.value.split("x");2!==t.length||isNaN(t[0])||isNaN(t[1])||(n.tilesHor=parseInt(t[0],10),n.tilesVert=parseInt(t[1],10))}}),t?N.updateSegmentData(e).then(function(t){o(n,e,t)}):(n.startNumber=e.startNumber,n.segmentDuration=e.segmentDuration,n.timescale=e.timescale,n.templateUrl=m(e)),n.tilesHor>0&&n.tilesVert>0&&(n.widthPerTile=n.width/n.tilesHor,n.heightPerTile=n.height/n.tilesVert,A.push(n))}function o(e,t,n){var r=[],a=p(n,t);t.segments=a,e.segmentDuration=t.segments[0].duration,e.readThumbnail=function(e,n){var a=null;r.some(function(t){if(t.start<=e&&t.end>e)return a=t.url,!0}),a?n(a):t.segments.some(function(a){if(a.mediaStartTime<=e&&a.mediaStartTime+a.duration>e){var i=P.resolve(t.path);return D.load({method:"get",url:i.url,request:{range:a.mediaRange,responseType:"arraybuffer"},onload:function(e){var t=w.getSamplesInfo(e.target.response),i=new Blob([e.target.response.slice(t.sampleList[0].offset,t.sampleList[0].offset+t.sampleList[0].size)],{type:"image/jpeg"}),o=window.URL.createObjectURL(i);r.push({start:a.mediaStartTime,end:a.mediaStartTime+a.duration,url:o}),n&&n(o)}}),!0}})}}function p(e,t){var n,r,a,i,o=[],s=0;for(n=0,r=e.segments.length;n<r;n++)a=e.segments[n],i=Object(l.getTimeBasedSegment)(F,M.getIsDynamic(),t,a.startTime,a.duration,a.timescale,a.media,a.mediaRange,s),i&&(o.push(i),i=null,s++);return o}function m(e){var t=U.isRelative(e.media)?U.resolve(e.media,P.resolve(e.path).url):e.media;return t?Object(l.replaceIDForTemplate)(t,e.id):""}function y(){return A}function E(){return I}function _(){return I<0?null:A[I]}function v(e){A&&0!==A.length&&(e>=A.length&&(e=A.length-1),I=e)}function T(e){for(var t,n=M.getVoRepresentations(C),r=0;r<n.length;r++)if(A[I].id===n[r].id){t=n[r];break}return R.getSegmentRequestForTime(C,t,e)}function S(){A=[],I=-1,C=null}var b,A,R,I,C,N,D,w,O=this.context,M=e.adapter,P=e.baseURLController,L=e.streamInfo,F=e.timelineConverter,j=e.debug,x=e.eventBus,k=e.events,B=e.dashConstants,U=Object(u.default)(O).getInstance();return b={getTracks:y,addTracks:n,reset:S,setTrackByIndex:v,getCurrentTrack:_,getCurrentTrackIndex:E,getThumbnailRequestForTime:T},t(),b}n.r(t),n.d(t,"THUMBNAILS_SCHEME_ID_URIS",function(){return g});var a=n("./src/streaming/constants/Constants.js"),i=n("./src/dash/constants/DashConstants.js"),o=n("./src/core/FactoryMaker.js"),s=n("./src/streaming/vo/ThumbnailTrackInfo.js"),u=n("./src/streaming/utils/URLUtils.js"),l=n("./src/dash/utils/SegmentsUtils.js"),c=n("./src/streaming/utils/BoxParser.js"),f=n("./src/streaming/net/XHRLoader.js"),d=n("./src/dash/DashHandler.js"),h=n("./src/dash/controllers/SegmentsController.js"),g=["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"];r.__dashjs_factory_name="ThumbnailTracks",t.default=o.default.getClassFactory(r)},"./src/streaming/utils/BaseURLSelector.js":function(e,t,n){function r(){function e(){g=Object(s.default)(E).create({updateEventName:o.default.SERVICE_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:o.default.SERVICE_LOCATION_BLACKLIST_ADD}),p=Object(l.default)(E).create({blacklistController:g}),m=Object(u.default)(E).create({blacklistController:g}),y=p}function t(e){e.selector&&(y=e.selector)}function n(e){Object(d.checkParameterType)(e,"boolean"),y=e?m:p}function r(e){if(e){var t=e.baseUrls,n=e.selectedIdx;if(!isNaN(n))return t[n];var r=y.select(t);return r?(e.selectedIdx=t.indexOf(r),r):(_.trigger(o.default.URL_RESOLUTION_FAILED,{error:new f.default(a.default.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE,a.default.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE)}),void(y===p&&c()))}}function c(){g.reset()}var h,g,p,m,y,E=this.context,_=Object(i.default)(E).getInstance();return h={chooseSelector:n,select:r,reset:c,setConfig:t},e(),h}n.r(t);var a=n("./src/core/errors/Errors.js"),i=n("./src/core/EventBus.js"),o=n("./src/core/events/Events.js"),s=n("./src/streaming/controllers/BlacklistController.js"),u=n("./src/streaming/utils/baseUrlResolution/DVBSelector.js"),l=n("./src/streaming/utils/baseUrlResolution/BasicSelector.js"),c=n("./src/core/FactoryMaker.js"),f=n("./src/streaming/vo/DashJSError.js"),d=n("./src/streaming/utils/SupervisorTools.js");r.__dashjs_factory_name="BaseURLSelector",
t.default=c.default.getClassFactory(r)},"./src/streaming/utils/BoxParser.js":function(e,t,n){function r(){function e(){h=Object(a.default)(p).getInstance().getLogger(g)}function t(e){if(!e)return null;void 0===e.fileStart&&(e.fileStart=0);var t=u.a.parseBuffer(e),n=Object(i.default)(p).create();return n.setData(t),n}function n(e,t,n){if(void 0===n&&(n=0),!t||n+8>=t.byteLength)return new l.default(0,!1);for(var r,a=t instanceof ArrayBuffer?new Uint8Array(t):t,i=0;n<a.byteLength;){var o=s(a,n),u=c(a,n+4);if(0===o)break;n+o<=a.byteLength&&(e.indexOf(u)>=0?r=new l.default(n,!0,o):i=n+o),n+=o}return r||new l.default(i,!1)}function r(e){if(!e||0===e.byteLength)return{sampleList:[],lastSequenceNumber:NaN,totalDuration:NaN,numSequences:NaN};var n,r,a,i,o,s,u,l,c,f,d,h,g,p,m,y,E,_=t(e),v=_.getBoxes("moof"),T=_.getBoxes("mfhd");y=_.getBoxes("moof").length,m=T[T.length-1].sequence_number,a=0,s=[];var S=-1,b=-1;for(d=0;d<v.length;d++){var A=v[d],R=A.getChildBoxes("traf");for(c=0;c<R.length;c++){var I=R[c],C=I.getChildBox("tfhd"),N=I.getChildBox("tfdt");o=N.baseMediaDecodeTime;var D=I.getChildBoxes("trun"),w=I.getChildBoxes("subs");for(f=0;f<D.length;f++){var O=D[f];for(a=O.sample_count,p=(C.base_data_offset||0)+(O.data_offset||0),l=0;l<a;l++){u=O.samples[l],n=void 0!==u.sample_duration?u.sample_duration:C.default_sample_duration,i=void 0!==u.sample_size?u.sample_size:C.default_sample_size,r=void 0!==u.sample_composition_time_offset?u.sample_composition_time_offset:0;var M={dts:o,cts:o+r,duration:n,offset:A.offset+p,size:i,subSizes:[i]};if(w)for(h=0;h<w.length;h++){var P=w[h];if(S<P.entry_count-1&&l>b&&(S++,b+=P.entries[S].sample_delta),l==b){M.subSizes=[];var L=P.entries[S];for(g=0;g<L.subsample_count;g++)M.subSizes.push(L.subsamples[g].subsample_size)}}s.push(M),p+=i,o+=n}}E=o-N.baseMediaDecodeTime}}return{sampleList:s,lastSequenceNumber:m,totalDuration:E,numSequences:y}}function o(e){var n=t(e),r=n?n.getBox("mdhd"):void 0;return r?r.timescale:NaN}function s(e,t){return e[t+3]>>>0|e[t+2]<<8>>>0|e[t+1]<<16>>>0|e[t]<<24>>>0}function c(e,t){return String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t])}function f(e){var n,r,a=null,i=t(e);if(!i)return a;var o=i.getBox("ftyp"),s=i.getBox("moov");return h.debug("Searching for initialization."),s&&s.isComplete&&(n=o?o.offset:s.offset,r=s.offset+s.size-1,a=n+"-"+r,h.debug("Found the initialization.  Range: "+a)),a}function d(e,t,n){if(void 0===n&&(n=0),!t||n+8>=t.byteLength)return new l.default(0,!1);for(var r,a=t instanceof ArrayBuffer?new Uint8Array(t):t,i=0;n<a.byteLength;){var o=s(a,n),u=c(a,n+4);if(0===o)break;n+o<=a.byteLength&&(e.indexOf(u)>=0?r=new l.default(n,!0,o,u):i=n+o),n+=o}return r||new l.default(i,!1)}var h,g,p=this.context;return g={parse:t,findLastTopIsoBoxCompleted:n,getMediaTimescaleFromMoov:o,getSamplesInfo:r,findInitRange:f,parsePayload:d},e(),g}n.r(t);var a=n("./src/core/Debug.js"),i=n("./src/streaming/utils/IsoFile.js"),o=n("./src/core/FactoryMaker.js"),s=n("./node_modules/codem-isoboxer/dist/iso_boxer.js"),u=n.n(s),l=n("./src/streaming/vo/IsoBoxSearchInfo.js");r.__dashjs_factory_name="BoxParser",t.default=o.default.getSingletonFactory(r)},"./src/streaming/utils/Capabilities.js":function(e,t,n){function r(){var e="WebKitMediaSource"in window,t="MediaSource"in window;return e||t}function a(){function e(){m=!1}function t(e){e&&e.settings&&(p=e.settings)}function n(){return m}function a(e){m=e}function i(e,t){return t!==s.default.AUDIO&&t!==s.default.VIDEO?Promise.resolve(!0):l(e,t)?f(e,t):c(e)}function l(e,t){return p.get().streaming.capabilities.useMediaCapabilitiesApi&&navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo&&(e.codec&&t===s.default.AUDIO||t===s.default.VIDEO&&e.codec&&e.width&&e.height&&e.bitrate&&e.framerate)}function c(e){return new Promise(function(t){if(e&&e.codec){var n=e.codec;e.width&&e.height&&(n+=';width="'+e.width+'";height="'+e.height+'"'),"MediaSource"in window&&MediaSource.isTypeSupported(n)?t(!0):"WebKitMediaSource"in window&&WebKitMediaSource.isTypeSupported(n)?t(!0):t(!1)}else t(!1)})}function f(e,t){return new Promise(function(n){if(e&&e.codec){var r={type:"media-source"};r[t]={},r[t].contentType=e.codec,r[t].width=e.width,r[t].height=e.height,r[t].bitrate=parseInt(e.bitrate),r[t].framerate=parseFloat(e.framerate),navigator.mediaCapabilities.decodingInfo(r).then(function(e){n(e.supported)}).catch(function(){n(!1)})}else n(!1)})}function d(e){try{return-1!==o.THUMBNAILS_SCHEME_ID_URIS.indexOf(e.schemeIdUri)}catch(e){return!0}}function h(e,t){for(var n,r=e.split(".")[0],a=0===t.indexOf(r),i=0;i<u.length;i++)if(u[i].codec===r){n=u[i];break}return n?a||n.compatibleCodecs.some(function(e){return 0===t.indexOf(e)}):a}var g,p,m;return g={setConfig:t,supportsMediaSource:r,supportsEncryptedMedia:n,supportsCodec:i,setEncryptedMediaSupported:a,supportsEssentialProperty:d,codecRootCompatibleWithCodec:h},e(),g}n.r(t),n.d(t,"supportsMediaSource",function(){return r});var i=n("./src/core/FactoryMaker.js"),o=n("./src/streaming/thumbnail/ThumbnailTracks.js"),s=n("./src/streaming/constants/Constants.js"),u=[{codec:"avc1",compatibleCodecs:["avc3"]},{codec:"avc3",compatibleCodecs:["avc1"]}];a.__dashjs_factory_name="Capabilities",t.default=i.default.getSingletonFactory(a)},"./src/streaming/utils/CapabilitiesFilter.js":function(e,t,n){function r(){function e(){E=Object(i.default)(v).getInstance().getLogger(g)}function t(e){e&&(e.adapter&&(p=e.adapter),e.capabilities&&(m=e.capabilities),e.settings&&(y=e.settings))}function n(e){return new Promise(function(t){var n=[];n.push(r(o.default.VIDEO,e)),n.push(r(o.default.AUDIO,e)),Promise.all(n).then(function(){y.get().streaming.capabilities.filterUnsupportedEssentialProperties&&f(e),d(e),t()}).catch(function(){t()})})}function r(e,t){if(!t||!t.Period_asArray||0===t.Period_asArray.length)return Promise.resolve();var n=[];return t.Period_asArray.forEach(function(t){n.push(a(t,e))}),Promise.all(n)}function a(e,t){return new Promise(function(n){if(e&&e.AdaptationSet_asArray&&0!==e.AdaptationSet_asArray.length){var r=[];e.AdaptationSet_asArray.forEach(function(e){p.getIsTypeOf(e,t)&&r.push(s(e,t))}),Promise.all(r).then(function(){e.AdaptationSet_asArray=e.AdaptationSet_asArray.filter(function(e){var t=e.Representation_asArray&&e.Representation_asArray.length>0;return t||E.warn("AdaptationSet has been removed because of no supported Representation"),t}),n()}).catch(function(){n()})}else n()})}function s(e,t){return new Promise(function(n){if(e.Representation_asArray&&0!==e.Representation_asArray.length){var r=[],a=[];e.Representation_asArray.forEach(function(n,i){var o=p.getCodec(e,i,!1),s=u(t,n,o);a.push(s),r.push(m.supportsCodec(s,t))}),Promise.all(r).then(function(t){e.Representation_asArray=e.Representation_asArray.filter(function(e,n){return t[n]||E.debug("[Stream] Codec ".concat(a[n].codec," not supported ")),t[n]}),n()}).catch(function(){n()})}else n()})}function u(e,t,n){switch(e){case o.default.VIDEO:return l(t,n);case o.default.AUDIO:return c(t,n);default:return null}}function l(e,t){var n=e.width||null,r=e.height||null,a=e.frameRate||null,i=e.bandwidth||null;return{codec:t,width:n,height:r,framerate:a,bitrate:i}}function c(e,t){var n=e.audioSamplingRate||null,r=e.bandwidth||null;return{codec:t,bitrate:r,samplerate:n}}function f(e){e&&e.Period_asArray&&0!==e.Period_asArray.length&&e.Period_asArray.forEach(function(e){e.AdaptationSet_asArray=e.AdaptationSet_asArray.filter(function(e){return!e.Representation_asArray||0===e.Representation_asArray.length||(e.Representation_asArray=e.Representation_asArray.filter(function(e){var t=p.getEssentialPropertiesForRepresentation(e);if(t&&t.length>0)for(var n=0;n<t.length;){if(!m.supportsEssentialProperty(t[n]))return E.debug("[Stream] EssentialProperty not supported: "+t[n].schemeIdUri),!1;n+=1}return!0}),e.Representation_asArray&&e.Representation_asArray.length>0)})})}function d(e){_&&0!==_.length&&e&&e.Period_asArray&&0!==e.Period_asArray.length&&e.Period_asArray.forEach(function(e){e.AdaptationSet_asArray=e.AdaptationSet_asArray.filter(function(e){return!e.Representation_asArray||0===e.Representation_asArray.length||(e.Representation_asArray=e.Representation_asArray.filter(function(e){return!_.some(function(t){return!t(e)})}),e.Representation_asArray&&e.Representation_asArray.length>0)})})}function h(e){_=e}var g,p,m,y,E,_,v=this.context;return g={setConfig:t,filterUnsupportedFeatures:n,setCustomCapabilitiesFilters:h},e(),g}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js"),o=n("./src/streaming/constants/Constants.js");r.__dashjs_factory_name="CapabilitiesFilter",t.default=a.default.getSingletonFactory(r)},"./src/streaming/utils/CustomTimeRanges.js":function(e,t,n){function r(){function e(e,t){var n=0;for(n=0;n<this.customTimeRangeArray.length&&e>this.customTimeRangeArray[n].start;n++);for(this.customTimeRangeArray.splice(n,0,{start:e,end:t}),n=0;n<this.customTimeRangeArray.length-1;n++)this.mergeRanges(n,n+1)&&n--;this.length=this.customTimeRangeArray.length}function t(){this.customTimeRangeArray=[],this.length=0}function n(e,t){for(var n=0;n<this.customTimeRangeArray.length;n++)if(e<=this.customTimeRangeArray[n].start&&t>=this.customTimeRangeArray[n].end)this.customTimeRangeArray.splice(n,1),n--;else{if(e>this.customTimeRangeArray[n].start&&t<this.customTimeRangeArray[n].end){this.customTimeRangeArray.splice(n+1,0,{start:t,end:this.customTimeRangeArray[n].end}),this.customTimeRangeArray[n].end=e;break}e>this.customTimeRangeArray[n].start&&e<this.customTimeRangeArray[n].end?this.customTimeRangeArray[n].end=e:t>this.customTimeRangeArray[n].start&&t<this.customTimeRangeArray[n].end&&(this.customTimeRangeArray[n].start=t)}this.length=this.customTimeRangeArray.length}function r(e,t){var n=this.customTimeRangeArray[e],r=this.customTimeRangeArray[t];return n.start<=r.start&&r.start<=n.end&&n.end<=r.end?(n.end=r.end,this.customTimeRangeArray.splice(t,1),!0):r.start<=n.start&&n.start<=r.end&&r.end<=n.end?(n.start=r.start,this.customTimeRangeArray.splice(t,1),!0):r.start<=n.start&&n.start<=r.end&&n.end<=r.end?(this.customTimeRangeArray.splice(e,1),!0):n.start<=r.start&&r.start<=n.end&&r.end<=n.end&&(this.customTimeRangeArray.splice(t,1),!0)}function a(e){return Object(i.checkInteger)(e),e>=this.customTimeRangeArray.length||e<0?NaN:this.customTimeRangeArray[e].start}function o(e){return Object(i.checkInteger)(e),e>=this.customTimeRangeArray.length||e<0?NaN:this.customTimeRangeArray[e].end}var s=[],u=0;return{customTimeRangeArray:s,length:u,add:e,clear:t,remove:n,mergeRanges:r,start:a,end:o}}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/utils/SupervisorTools.js");r.__dashjs_factory_name="CustomTimeRanges",t.default=a.default.getClassFactory(r)},"./src/streaming/utils/DOMStorage.js":function(e,t,n){function r(e){function t(){T=Object(i.default)(b).getInstance().getLogger(v),r()}function n(e){if(void 0!==S)return S;S=!1;var t,n="1",r="1";try{"undefined"!=typeof window&&(t=window[e])}catch(e){return T.warn("DOMStorage access denied: "+e.message),S}if(!t||e!==c&&e!==f)return S;try{t.setItem(n,r),t.removeItem(n),S=!0}catch(e){T.warn("DOMStorage is supported, but cannot be used: "+e.message)}return S}function r(){n(c)&&s.forEach(function(e){var t=localStorage.getItem(e.oldKey);if(t){localStorage.removeItem(e.oldKey);try{localStorage.setItem(e.newKey,t)}catch(e){T.error(e.message)}}})}function a(){var e=6e5;return Math.round((new Date).getTime()/e)*e}function g(e,t){return n(e)&&A.get().streaming[t+"CachingInfo"].enabled}function p(){if(!A)throw new Error(o.default.MISSING_CONFIG_ERROR)}function m(e){var t=null;if(p(),g(c,h)){var n=l.replace(/\?/,e);try{var r=JSON.parse(localStorage.getItem(n))||{},a=(new Date).getTime()-parseInt(r.timestamp,10)>=A.get().streaming.lastMediaSettingsCachingInfo.ttl||!1;t=r.settings,a&&(localStorage.removeItem(n),t=null)}catch(e){return null}}return t}function y(e){var t=NaN;if(p(),g(c,d)){var n=u.replace(/\?/,e);try{var r=JSON.parse(localStorage.getItem(n))||{},a=(new Date).getTime()-parseInt(r.timestamp,10)>=A.get().streaming.lastBitrateCachingInfo.ttl||!1,i=parseFloat(r.bitrate);isNaN(i)||a?a&&localStorage.removeItem(n):(t=i,T.debug("Last saved bitrate for "+e+" was "+i))}catch(e){return null}}return t}function E(e,t){if(g(c,h)){var n=l.replace(/\?/,e);try{localStorage.setItem(n,JSON.stringify({settings:t,timestamp:a()}))}catch(e){T.error(e.message)}}}function _(e,t){if(g(c,d)&&t){var n=u.replace(/\?/,e);try{localStorage.setItem(n,JSON.stringify({bitrate:t.toFixed(3),timestamp:a()}))}catch(e){T.error(e.message)}}}e=e||{};var v,T,S,b=this.context,A=e.settings;return v={getSavedBitrateSettings:y,setSavedBitrateSettings:_,getSavedMediaSettings:m,setSavedMediaSettings:E},t(),v}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js"),o=n("./src/streaming/constants/Constants.js"),s=[{oldKey:"dashjs_vbitrate",newKey:"dashjs_video_bitrate"},{oldKey:"dashjs_abitrate",newKey:"dashjs_audio_bitrate"},{oldKey:"dashjs_vsettings",newKey:"dashjs_video_settings"},{oldKey:"dashjs_asettings",newKey:"dashjs_audio_settings"}],u="dashjs_?_bitrate",l="dashjs_?_settings",c="localStorage",f="sessionStorage",d="lastBitrate",h="lastMediaSettings";r.__dashjs_factory_name="DOMStorage";var g=a.default.getSingletonFactory(r);t.default=g},"./src/streaming/utils/DefaultURLUtils.js":function(e,t,n){function r(){function e(){try{new window.URL("x","http://y");f=m}catch(e){}finally{f=f||y}}function t(e){var t=e.indexOf("/"),n=e.lastIndexOf("/");return-1!==t?n===t+1?e:(-1!==e.indexOf("?")&&(e=e.substring(0,e.indexOf("?"))),e.substring(0,n+1)):""}function n(e){var t=e.match(p);return t?t[1]:""}function r(e){var t=/^(?:\w+\:\/\/)?([^\/]+)(.*)$/.exec(e);return t[2].substring(1)}function a(e){var t=e.match(d);return t?t[0]:""}function i(e){return!d.test(e)}function o(e){return i(e)&&"/"===e.charAt(0)}function s(e){return 0===e.indexOf("//")}function u(e){return h.test(e)}function l(e){return g.test(e)}function c(e,t){return f(e,t)}var f,d=/^[a-z][a-z0-9+\-_.]*:/i,h=/^https?:\/\//i,g=/^https:\/\//i,p=/^([a-z][a-z0-9+\-_.]*:\/\/[^\/]+)\/?/i,m=function(e,t){try{return new window.URL(e,t).toString()}catch(t){return e}},y=function(e,r){var u=t;if(!r)return e;if(!i(e))return e;o(e)&&(u=n),s(e)&&(u=a);var l=u(r),c="/"!==l.charAt(l.length-1)&&"/"!==e.charAt(0)?"/":"";return[l,e].join(c)};e();var E={parseBaseUrl:t,parseOrigin:n,parseScheme:a,isRelative:i,isPathAbsolute:o,isSchemeRelative:s,isHTTPURL:u,isHTTPS:l,removeHostname:r,resolve:c};return E}n.r(t);var a=n("./src/core/FactoryMaker.js");r.__dashjs_factory_name="DefaultURLUtils",t.default=a.default.getSingletonFactory(r)},"./src/streaming/utils/EBMLParser.js":function(e,t,n){function r(e){function t(){return h}function n(e){h=e}function r(e,t){var n,r,a=!0,i=0;if(void 0===t&&(t=!1),e.tag>16777215?(d.getUint32(h)!==e.tag&&(a=!1),i=4):e.tag>65535?(n=d.getUint16(h),r=d.getUint8(h+2),256*n+r!==e.tag&&(a=!1),i=3):e.tag>255?(d.getUint16(h)!==e.tag&&(a=!1),i=2):(d.getUint8(h)!==e.tag&&(a=!1),i=1),!a&&e.required&&!t)throw new Error("required tag not found");return a&&(h+=i),a}function a(e,t){var n=r(e,t);return n&&s(),n}function i(e){var t;return r(e),t=s(),f[e.parse](t)}function o(e,t){var n,a=r(e,t);return a&&(n=s(),h+=n),a}function s(e){var t=1,n=128,r=8,a=-1,i=0,o=d.getUint8(h),s=0;for(s=0;s<r;s+=1){if((o&n)===n){i=void 0===e?o&~n:o,a=s;break}n>>=1}for(s=0;s<a;s+=1,t+=1)i=i<<8|255&d.getUint8(h+t);return h+=t,i}function u(e){var t;switch(e){case 4:t=d.getFloat32(h),h+=4;break;case 8:t=d.getFloat64(h),h+=8}return t}function l(e){for(var t=0,n=0;n<e;n+=1)t<<=8,t|=255&d.getUint8(h+n);return h+=e,t}function c(){return h<d.byteLength}var f;e=e||{};var d=new DataView(e.data),h=0;return f={getPos:t,setPos:n,consumeTag:r,consumeTagAndSize:a,parseTag:i,skipOverElement:o,getMatroskaCodedNum:s,getMatroskaFloat:u,getMatroskaUint:l,moreData:c},f}n.r(t);var a=n("./src/core/FactoryMaker.js");r.__dashjs_factory_name="EBMLParser",t.default=a.default.getClassFactory(r)},"./src/streaming/utils/ErrorHandler.js":function(e,t,n){function r(){function e(e){r.trigger(i.default.ERROR,{error:e})}var t,n=this.context,r=Object(a.default)(n).getInstance();return t={error:e},t}n.r(t);var a=n("./src/core/EventBus.js"),i=n("./src/core/events/Events.js"),o=n("./src/core/FactoryMaker.js");r.__dashjs_factory_name="ErrorHandler",t.default=o.default.getSingletonFactory(r)},"./src/streaming/utils/InitCache.js":function(e,t,n){function r(){function e(e){var t=e.streamId,n=e.representationId;r[t]=r[t]||{},r[t][n]=e}function t(e,t){return r&&r[e]&&r[e][t]?r[e][t]:null}function n(){r={}}var r={},a={save:e,extract:t,reset:n};return a}n.r(t);var a=n("./src/core/FactoryMaker.js");r.__dashjs_factory_name="InitCache",t.default=a.default.getSingletonFactory(r)},"./src/streaming/utils/IsoFile.js":function(e,t,n){function r(){function e(e){return e&&s&&s.boxes&&0!==s.boxes.length&&"function"==typeof s.fetch?i(s.fetch(e)):null}function t(e){var t=[];if(!e||!s||"function"!=typeof s.fetchAll)return t;for(var n,r=s.fetchAll(e),a=0,o=r.length;a<o;a++)n=i(r[a]),n&&t.push(n);return t}function n(e){s=e}function r(){if(!s||!s.boxes||!s.boxes.length)return null;var e=s.boxes[s.boxes.length-1].type,n=t(e);return n.length>0?n[n.length-1]:null}function i(e){if(!e)return null;var t=new a.default(e);return e.hasOwnProperty("_incomplete")&&(t.isComplete=!e._incomplete),t}var o,s;return o={getBox:e,getBoxes:t,setData:n,getLastBox:r},o}n.r(t);var a=n("./src/streaming/vo/IsoBox.js"),i=n("./src/core/FactoryMaker.js");r.__dashjs_factory_name="IsoFile",t.default=i.default.getClassFactory(r)},"./src/streaming/utils/ObjectUtils.js":function(e,t,n){function r(){function e(e,t){return o()(e,t)}var t;return t={areEqual:e},t}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./node_modules/fast-deep-equal/index.js"),o=n.n(i);r.__dashjs_factory_name="ObjectUtils",t.default=a.default.getSingletonFactory(r)},"./src/streaming/utils/RequestModifier.js":function(e,t,n){function r(){function e(e){return e}function t(e){return e}var n;return n={modifyRequestURL:e,modifyRequestHeader:t},n}n.r(t);var a=n("./src/core/FactoryMaker.js");r.__dashjs_factory_name="RequestModifier",t.default=a.default.getSingletonFactory(r)},"./src/streaming/utils/SupervisorTools.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(r(e)!==t)throw u.default.BAD_ARGUMENT_ERROR}function i(e){var t=null!==e&&!isNaN(e)&&e%1==0;if(!t)throw u.default.BAD_ARGUMENT_ERROR+" : argument is not an integer"}function o(e,t,n){if(e<t||e>n)throw u.default.BAD_ARGUMENT_ERROR+" : argument out of range"}function s(e){if("string"!=typeof e||e!==u.default.AUDIO&&e!==u.default.VIDEO)throw u.default.BAD_ARGUMENT_ERROR}n.r(t),n.d(t,"checkParameterType",function(){return a}),n.d(t,"checkInteger",function(){return i}),n.d(t,"checkRange",function(){return o}),n.d(t,"checkIsVideoOrAudioType",function(){return s});var u=n("./src/streaming/constants/Constants.js")},"./src/streaming/utils/TTMLParser.js":function(e,t,n){function r(){function e(){a=Object(i.default)(f).getInstance().getLogger(r)}function t(){var e="cue_TTML_"+h;return h++,e}function n(e,n,r,i,o){var f,h,g,p="",m=[],y={},E={},_="",v="",T={onOpenTag:function(e,t,n){if(n[" imagetype"]&&!n[" imageType"]&&(d.trigger(l.default.CONFORMANCE_VIOLATION,{level:c.default.LEVELS.ERROR,event:c.default.EVENTS.NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE}),n[" imageType"]=n[" imagetype"]),"image"===t&&("http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt"===e||"http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt"===e)){if(!n[" imageType"]||"PNG"!==n[" imageType"].value)return void a.warn("smpte-tt imageType != PNG. Discarded");_=n["http://www.w3.org/XML/1998/namespace id"].value}},onCloseTag:function(){_&&(E[_]=v.trim()),v="",_=""},onText:function(e){_&&(v+=e)}};if(!e)throw p="no ttml data to parse",new Error(p);y.data=e,d.trigger(s.default.TTML_TO_PARSE,y);var S=Object(u.fromXML)(y.data,function(e){p=e},T);d.trigger(s.default.TTML_PARSED,{ttmlString:y.data,ttmlDoc:S});var b=S.getMediaTimeEvents();for(g=0;g<b.length;g++){var A=Object(u.generateISD)(S,b[g],function(e){p=e});A.contents.some(function(e){return e.contents.length})&&(f=b[g]+n<r?r:b[g]+n,h=b[g+1]+n>i?i:b[g+1]+n,f<h&&m.push({start:f,end:h,type:"html",cueID:t(),isd:A,images:o,embeddedImages:E}))}if(""!==p)throw a.error(p),new Error(p);return m}var r,a,f=this.context,d=Object(o.default)(f).getInstance(),h=0;return r={parse:n},e(),r}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js"),o=n("./src/core/EventBus.js"),s=n("./src/core/events/Events.js"),u=n("./node_modules/imsc/src/main/js/main.js"),l=n("./src/streaming/MediaPlayerEvents.js"),c=n("./src/streaming/constants/ConformanceViolationConstants.js");r.__dashjs_factory_name="TTMLParser",t.default=a.default.getSingletonFactory(r)},"./src/streaming/utils/URLUtils.js":function(e,t,n){function r(){function e(e){var t;for(t=0;t<y.length;t++){var n=y[t].regex;if(n.test(e))return y[t].utils}return m}function t(){m=Object(i.default)(E).getInstance()}function n(e,t){y.push({regex:e,utils:t})}function r(t,n,r){var a=e(r||n);return a&&"function"==typeof a[t]?a[t](n,r):m[t](n,r)}function a(e){return r("parseBaseUrl",e)}function o(e){return r("parseOrigin",e)}function s(e){return r("removeHostname",e)}function u(e){return r("parseScheme",e)}function l(e){return r("isRelative",e)}function c(e){return r("isPathAbsolute",e)}function f(e){return r("isSchemeRelative",e)}function d(e){return r("isHTTPURL",e)}function h(e){return r("isHTTPS",e)}function g(e,t){return r("resolve",e,t)}var p,m,y=[],E=this.context;return t(),p={registerUrlRegex:n,parseBaseUrl:a,parseOrigin:o,parseScheme:u,isRelative:l,isPathAbsolute:c,isSchemeRelative:f,isHTTPURL:d,isHTTPS:h,removeHostname:s,resolve:g},p}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/streaming/utils/DefaultURLUtils.js");r.__dashjs_factory_name="URLUtils";var o=a.default.getSingletonFactory(r);t.default=o},"./src/streaming/utils/VTTParser.js":function(e,t,n){function r(){function e(){l=Object(i.default)(g).getInstance().getLogger(u),c=/(?:\r\n|\r|\n)/gm,f=/-->/,d=/(^[\s]+|[\s]+$)/g,h=/\s\b/g}function t(e){var t,a,i=[];if(!e)return i;e=e.split(c),t=e.length,a=-1;for(var u=0;u<t;u++){var h=e[u];if(h.length>0&&h!==o&&h.match(f)){var g=r(h),p=g.cuePoints,m=g.styles,y=s(e,u+1),E=n(p[0].replace(d,"")),_=n(p[1].replace(d,""));!isNaN(E)&&!isNaN(_)&&E>=a&&_>E?""!==y?(a=E,i.push({start:E,end:_,data:y,styles:m})):l.error("Skipping cue due to empty/malformed cue text"):l.error("Skipping cue due to incorrect cue timing")}}return i}function n(e){var t=e.split(":"),n=t.length-1;return e=60*parseInt(t[n-1],10)+parseFloat(t[n]),2===n&&(e+=3600*parseInt(t[0],10)),e}function r(e){var t=e.split(f),n=t[1].split(h);return n.shift(),t[1]=n[0],n.shift(),{cuePoints:t,styles:a(n)}}function a(e){var t={};return e.forEach(function(e){if(e.split(/:/).length>1){var n=e.split(/:/)[1];n&&-1!=n.search(/%/)&&(n=parseInt(n.replace(/%/,""),10)),(e.match(/align/)||e.match(/A/))&&(t.align=n),(e.match(/line/)||e.match(/L/))&&(t.line=n),(e.match(/position/)||e.match(/P/))&&(t.position=n),(e.match(/size/)||e.match(/S/))&&(t.size=n)}}),t}function s(e,t){for(var n,r=t,a="",i="";""!==e[r]&&r<e.length;)r++;if(n=r-t,n>1)for(var o=0;o<n;o++){if(i=e[t+o],i.match(f)){a="";break}a+=i,o!==n-1&&(a+="\n")}else i=e[t],i.match(f)||(a=i);return a}var u,l,c,f,d,h,g=this.context;return u={parse:t},e(),u}n.r(t);var a=n("./src/core/FactoryMaker.js"),i=n("./src/core/Debug.js"),o="WEBVTT";r.__dashjs_factory_name="VTTParser",t.default=a.default.getSingletonFactory(r)},"./src/streaming/utils/baseUrlResolution/BasicSelector.js":function(e,t,n){function r(e){function t(e){var t,n=0;return e&&e.some(function(e,t){return n=t,!r.contains(e.serviceLocation)})&&(t=e[n]),t}var n;e=e||{};var r=e.blacklistController;return n={select:t},n}n.r(t);var a=n("./src/core/FactoryMaker.js");r.__dashjs_factory_name="BasicSelector",t.default=a.default.getClassFactory(r)},"./src/streaming/utils/baseUrlResolution/DVBSelector.js":function(e,t,n){function r(e){function t(e){var t=[],n=function(e){return!t.length||!e.dvb_priority||-1===t.indexOf(e.dvb_priority)},r=function(e){return!i.contains(e.serviceLocation)||(e.dvb_priority&&t.push(e.dvb_priority),!1)};return e.filter(r).filter(n)}function n(e){var t,n,r=function(e,t){var n=e.dvb_priority-t.dvb_priority;return isNaN(n)?0:n},a=function(e,t,n){return!t||n[0].dvb_priority&&e.dvb_priority&&n[0].dvb_priority===e.dvb_priority},i=0,o=[],s=0;if(n=e.sort(r).filter(a),n.length)return n.length>1&&(n.forEach(function(e){i+=e.dvb_weight,o.push(i)}),t=Math.floor(Math.random()*(i-1)),o.every(function(e,n){return s=n,!(t<e)})),n[s]}function r(e){return e&&n(t(e))}var a;e=e||{};var i=e.blacklistController;return a={select:r},a}n.r(t);var a=n("./src/core/FactoryMaker.js");r.__dashjs_factory_name="DVBSelector",t.default=a.default.getClassFactory(r)},"./src/streaming/vo/BitrateInfo.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.mediaType=null,this.bitrate=null,this.width=null,this.height=null,this.scanType=null,this.qualityIndex=NaN};t.default=a},"./src/streaming/vo/DashJSError.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(t,n,a){r(this,e),this.code=t||null,this.message=n||null,this.data=a||null};t.default=a},"./src/streaming/vo/DataChunk.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.streamId=null,this.mediaInfo=null,this.segmentType=null,this.quality=NaN,this.index=NaN,this.bytes=null,this.start=NaN,this.end=NaN,this.duration=NaN,this.representationId=null,this.endFragment=null};t.default=a},"./src/streaming/vo/FragmentRequest.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}n.r(t);var o=n("./src/streaming/vo/metrics/HTTPRequest.js"),s=function(){function e(t){r(this,e),this.action=e.ACTION_DOWNLOAD,this.startTime=NaN,this.mediaStartTime=NaN,this.mediaType=null,this.mediaInfo=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=t||null,this.serviceLocation=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null,this.bytesLoaded=NaN,this.bytesTotal=NaN,this.delayLoadingTime=NaN,this.responseType="arraybuffer",this.representationId=null}return i(e,[{key:"isInitializationRequest",value:function(){return this.type&&this.type===o.HTTPRequest.INIT_SEGMENT_TYPE}},{key:"setInfo",value:function(e){this.type=e&&e.init?o.HTTPRequest.INIT_SEGMENT_TYPE:o.HTTPRequest.MEDIA_SEGMENT_TYPE,this.url=e&&e.url?e.url:null,this.range=e&&e.range?e.range.start+"-"+e.range.end:null,this.mediaType=e&&e.mediaType?e.mediaType:null}}]),e}();s.ACTION_DOWNLOAD="download",s.ACTION_COMPLETE="complete",t.default=s},"./src/streaming/vo/HeadRequest.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function s(e){var t=c();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}n.r(t);var d=n("./src/streaming/vo/FragmentRequest.js"),h=function(e){function t(e){var r;return a(this,t),r=n.call(this,e),r.checkForExistenceOnly=!0,r}i(t,e);var n=s(t);return t}(d.default);t.default=h},"./src/streaming/vo/IsoBox.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}n.r(t);var o=function(){function e(t){if(r(this,e),this.offset=t._offset,this.type=t.type,this.size=t.size,this.boxes=[],t.boxes)for(var n=0;n<t.boxes.length;n++)this.boxes.push(new e(t.boxes[n]));switch(this.isComplete=!0,t.type){case"sidx":if(this.timescale=t.timescale,this.earliest_presentation_time=t.earliest_presentation_time,this.first_offset=t.first_offset,this.references=t.references,t.references){this.references=[];for(var a=0;a<t.references.length;a++){var i={reference_type:t.references[a].reference_type,referenced_size:t.references[a].referenced_size,subsegment_duration:t.references[a].subsegment_duration};this.references.push(i)}}break;case"emsg":this.id=t.id,this.version=1===t.version?1:0,this.value=t.value,this.timescale=t.timescale,this.scheme_id_uri=t.scheme_id_uri,this.presentation_time_delta=1===t.version?t.presentation_time:t.presentation_time_delta,this.event_duration=t.event_duration,this.message_data=t.message_data;break;case"mdhd":this.timescale=t.timescale;break;case"mfhd":this.sequence_number=t.sequence_number;break;case"subs":this.entry_count=t.entry_count,this.entries=t.entries;break;case"tfhd":this.base_data_offset=t.base_data_offset,this.sample_description_index=t.sample_description_index,this.default_sample_duration=t.default_sample_duration,this.default_sample_size=t.default_sample_size,this.default_sample_flags=t.default_sample_flags,this.flags=t.flags;break;case"tfdt":this.version=t.version,this.baseMediaDecodeTime=t.baseMediaDecodeTime,this.flags=t.flags;break;case"trun":if(this.sample_count=t.sample_count,this.first_sample_flags=t.first_sample_flags,this.data_offset=t.data_offset,this.flags=t.flags,this.samples=t.samples,t.samples){this.samples=[];for(var o=0,s=t.samples.length;o<s;o++){var u={sample_size:t.samples[o].sample_size,sample_duration:t.samples[o].sample_duration,sample_composition_time_offset:t.samples[o].sample_composition_time_offset};this.samples.push(u)}}}}return i(e,[{key:"getChildBox",value:function(e){for(var t=0;t<this.boxes.length;t++)if(this.boxes[t].type===e)return this.boxes[t]}},{key:"getChildBoxes",value:function(e){for(var t=[],n=0;n<this.boxes.length;n++)this.boxes[n].type===e&&t.push(this.boxes[n]);return t}}]),e}();t.default=o},"./src/streaming/vo/IsoBoxSearchInfo.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t)
;var a=function e(t,n,a){r(this,e),this.lastCompletedOffset=t,this.found=n,this.size=a};t.default=a},"./src/streaming/vo/MetricsList.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.TcpList=[],this.HttpList=[],this.RepSwitchList=[],this.BufferLevel=[],this.BufferState=[],this.PlayList=[],this.DroppedFrames=[],this.SchedulingInfo=[],this.DVRInfo=[],this.ManifestUpdate=[],this.RequestsQueue=null,this.DVBErrors=[]};t.default=a},"./src/streaming/vo/TextRequest.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function s(e){var t=c();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}n.r(t);var d=n("./src/streaming/constants/Constants.js"),h=n("./src/streaming/vo/FragmentRequest.js"),g=function(e){function t(e,r){var i;return a(this,t),i=n.call(this),i.url=e||null,i.type=r||null,i.mediaType=d.default.STREAM,i.responseType="",i}i(t,e);var n=s(t);return t}(h.default);t.default=g},"./src/streaming/vo/TextTrackInfo.js":function(e,t,n){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function s(e){var t=c();return function(){var n,r=f(e);if(t){var a=f(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return u(this,n)}}function u(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}n.r(t);var d=n("./src/dash/vo/MediaInfo.js"),h=function(e){function t(){var e;return a(this,t),e=n.call(this),e.captionData=null,e.label=null,e.defaultTrack=!1,e.kind=null,e.isFragmented=!1,e.isEmbedded=!1,e.isTTML=null,e}i(t,e);var n=s(t);return t}(d.default);t.default=h},"./src/streaming/vo/Thumbnail.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.url=null,this.width=null,this.height=null,this.x=null,this.y=null};t.default=a},"./src/streaming/vo/ThumbnailTrackInfo.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.bitrate=0,this.width=0,this.height=0,this.tilesHor=0,this.tilesVert=0,this.widthPerTile=0,this.heightPerTile=0,this.startNumber=0,this.segmentDuration=0,this.timescale=0,this.templateUrl="",this.id=""};t.default=a},"./src/streaming/vo/URIFragmentData.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null,this.r=null};t.default=a},"./src/streaming/vo/metrics/BufferLevel.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.t=null,this.level=null};t.default=a},"./src/streaming/vo/metrics/BufferState.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=n("./src/streaming/constants/MetricsConstants.js"),i=function e(){r(this,e),this.target=null,this.state=a.default.BUFFER_EMPTY};t.default=i},"./src/streaming/vo/metrics/DVRInfo.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.time=null,this.range=null,this.manifestInfo=null};t.default=a},"./src/streaming/vo/metrics/DroppedFrames.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.time=null,this.droppedFrames=null};t.default=a},"./src/streaming/vo/metrics/HTTPRequest.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t),n.d(t,"HTTPRequest",function(){return a}),n.d(t,"HTTPRequestTrace",function(){return i});var a=function e(){r(this,e),this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.responsecode=null,this.interval=null,this.trace=[],this._stream=null,this._tfinish=null,this._mediaduration=null,this._quality=null,this._responseHeaders=null,this._serviceLocation=null},i=function e(){r(this,e),this.s=null,this.d=null,this.b=[],this.t=null};a.GET="GET",a.HEAD="HEAD",a.MPD_TYPE="MPD",a.XLINK_EXPANSION_TYPE="XLinkExpansion",a.INIT_SEGMENT_TYPE="InitializationSegment",a.INDEX_SEGMENT_TYPE="IndexSegment",a.MEDIA_SEGMENT_TYPE="MediaSegment",a.BITSTREAM_SWITCHING_SEGMENT_TYPE="BitstreamSwitchingSegment",a.MSS_FRAGMENT_INFO_SEGMENT_TYPE="FragmentInfoSegment",a.LICENSE="license",a.OTHER_TYPE="other"},"./src/streaming/vo/metrics/ManifestUpdate.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t),n.d(t,"ManifestUpdate",function(){return a}),n.d(t,"ManifestUpdateStreamInfo",function(){return i}),n.d(t,"ManifestUpdateRepresentationInfo",function(){return o});var a=function e(){r(this,e),this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.representationInfo=[]},i=function e(){r(this,e),this.id=null,this.index=null,this.start=null,this.duration=null},o=function e(){r(this,e),this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null}},"./src/streaming/vo/metrics/PlayList.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t),n.d(t,"PlayList",function(){return a}),n.d(t,"PlayListTrace",function(){return i});var a=function e(){r(this,e),this.start=null,this.mstart=null,this.starttype=null,this.trace=[]};a.INITIAL_PLAYOUT_START_REASON="initial_playout",a.SEEK_START_REASON="seek",a.RESUME_FROM_PAUSE_START_REASON="resume",a.METRICS_COLLECTION_START_REASON="metrics_collection_start";var i=function e(){r(this,e),this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null};i.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",i.REBUFFERING_REASON="rebuffering",i.USER_REQUEST_STOP_REASON="user_request",i.END_OF_PERIOD_STOP_REASON="end_of_period",i.END_OF_CONTENT_STOP_REASON="end_of_content",i.METRICS_COLLECTION_STOP_REASON="metrics_collection_end",i.FAILURE_STOP_REASON="failure"},"./src/streaming/vo/metrics/RepresentationSwitch.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.t=null,this.mt=null,this.to=null,this.lto=null};t.default=a},"./src/streaming/vo/metrics/RequestsQueue.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.loadingRequests=[],this.executedRequests=[]};t.default=a},"./src/streaming/vo/metrics/SchedulingInfo.js":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(t);var a=function e(){r(this,e),this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null};t.default=a},0:function(e,t){},1:function(e,t){}}).default},e.exports=n()}),_=r(E),v=e.getComponent("Component"),T="#222",S="#ccc",b={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'},A=function(n){function r(t,r,a){var i;i=n.call(this,t,e.mergeOptions(r,{playerOptions:{}}),a)||this;for(var o=t.getChild("TextTrackSettings").$$("select"),s=0;s<o.length;s++)i.on(o[s],"change",i.updateStyle.bind(g(i)));return t.dash.mediaPlayer.on(_.MediaPlayer.events.CAPTION_RENDERED,i.updateStyle.bind(g(i))),i}d(r,n);var a=r.prototype;return a.createEl=function(){var e=n.prototype.createEl.call(this,"div",{className:"vjs-text-track-display-ttml"},{"aria-live":"off","aria-atomic":"true"});return e.style.position="absolute",e.style.left="0",e.style.right="0",e.style.top="0",e.style.bottom="0",e.style.margin="1.5%",e},a.updateStyle=function(e){var n=e.captionDiv;if(this.player_.textTrackSettings){var r=this.player_.textTrackSettings.getValues();if(n=n||this.player_.getChild("TTMLTextTrackDisplay").el().firstChild,n){m(n);for(var a=n.getElementsByTagName("span"),i=0;i<a.length;i++){var o=a[i];if(o.parentNode.style.textAlign="center",r.color&&(o.style.color=r.color),r.textOpacity&&p(o,"color",y(r.color||"#fff",r.textOpacity)),r.backgroundColor&&(o.style.backgroundColor=r.backgroundColor),r.backgroundOpacity&&p(o,"backgroundColor",y(r.backgroundColor||"#000",r.backgroundOpacity)),r.windowColor&&(r.windowOpacity?p(o.parentNode,"backgroundColor",y(r.windowColor,r.windowOpacity)):o.parent.style.backgroundColor=r.windowColor),r.edgeStyle&&("dropshadow"===r.edgeStyle?o.style.textShadow="2px 2px 3px "+T+", 2px 2px 4px "+T+", 2px 2px 5px "+T:"raised"===r.edgeStyle?o.style.textShadow="1px 1px "+T+", 2px 2px "+T+", 3px 3px "+T:"depressed"===r.edgeStyle?o.style.textShadow="1px 1px "+S+", 0 1px "+S+", -1px -1px "+T+", 0 -1px "+T:"uniform"===r.edgeStyle&&(o.style.textShadow="0 0 4px "+T+", 0 0 4px "+T+", 0 0 4px "+T+", 0 0 4px "+T)),r.fontPercent&&1!==r.fontPercent){var s=t.parseFloat(o.style.fontSize);o.style.fontSize=s*r.fontPercent+"px",o.style.height="auto",o.style.top="auto",o.style.bottom="2px"}r.fontFamily&&"default"!==r.fontFamily&&("small-caps"===r.fontFamily?o.style.fontVariant="small-caps":o.style.fontFamily=b[r.fontFamily])}}}},r}(v);e.registerComponent("TTMLTextTrackDisplay",A);var R=function(){function t(n,r,a){var i=this;if(a=a||r.options_,this.player=e(a.playerId),this.player.dash=this.player.dash||{},this.tech_=r,this.el_=r.el(),this.elParent_=this.el_.parentNode,this.hasFiniteDuration_=!1,n.src){r.isReady_=!1,t.updateSourceData&&(e.log.warn('updateSourceData has been deprecated. Please switch to using hook("updatesource", callback).'),n=t.updateSourceData(n)),t.hooks("updatesource").forEach(function(e){n=e(n)});var o=n.src;this.keySystemOptions_=t.buildDashJSProtData(n.keySystemOptions),this.player.dash.mediaPlayer=_.MediaPlayer().create(),this.mediaPlayer_=this.player.dash.mediaPlayer,t.useVideoJSDebug&&(e.log.warn('useVideoJSDebug has been deprecated. Please switch to using hook("beforeinitialize", callback).'),t.useVideoJSDebug(this.mediaPlayer_)),t.beforeInitialize&&(e.log.warn('beforeInitialize has been deprecated. Please switch to using hook("beforeinitialize", callback).'),t.beforeInitialize(this.player,this.mediaPlayer_)),t.hooks("beforeinitialize").forEach(function(e){e(i.player,i.mediaPlayer_)}),this.mediaPlayer_.initialize(),this.retriggerError_=function(e){if("capability"===e.error&&"mediasource"===e.event)i.player.error({code:4,message:"The media cannot be played because it requires a feature that your browser does not support."});else if("manifestError"!==e.error||"createParser"!==e.event.id&&"codec"!==e.event.id&&"nostreams"!==e.event.id&&"nostreamscomposed"!==e.event.id&&"parse"!==e.event.id&&"multiplexedrep"!==e.event.id)if("mediasource"===e.error)e.event.match("MEDIA_ERR_ABORTED")?i.player.error({code:1,message:e.event}):e.event.match("MEDIA_ERR_NETWORK")?i.player.error({code:2,message:e.event}):e.event.match("MEDIA_ERR_DECODE")?i.player.error({code:3,message:e.event}):e.event.match("MEDIA_ERR_SRC_NOT_SUPPORTED")?i.player.error({code:4,message:e.event}):e.event.match("MEDIA_ERR_ENCRYPTED")?i.player.error({code:5,message:e.event}):(e.event.match("UNKNOWN"),i.player.error({code:4,message:e.event}));else if("capability"===e.error&&"encryptedmedia"===e.event)i.player.error({code:5,message:"The media cannot be played because it requires encryption features that your browser does not support."});else if("key_session"===e.error)i.player.error({code:5,message:e.event});else if("download"===e.error)i.player.error({code:2,message:"The media playback was aborted because too many consecutive download errors occurred."});else{if("mssError"!==e.error)return;i.player.error({code:3,message:e.event})}else i.player.error({code:4,message:e.event.message});setTimeout(function(){i.mediaPlayer_.reset()},10)},this.mediaPlayer_.on(_.MediaPlayer.events.ERROR,this.retriggerError_),this.getDuration_=function(e){var t=e.data.Period_asArray,n=i.hasFiniteDuration_;e.data.mediaPresentationDuration||t[t.length-1].duration?i.hasFiniteDuration_=!0:i.hasFiniteDuration_=!1,i.hasFiniteDuration_!==n&&i.player.trigger("durationchange")},this.mediaPlayer_.on(_.MediaPlayer.events.MANIFEST_LOADED,this.getDuration_),a.dash&&Object.keys(a.dash).forEach(function(t){var n;if("useTTML"!==t){var r="set"+t.charAt(0).toUpperCase()+t.slice(1),o=a.dash[t];i.mediaPlayer_.hasOwnProperty(r)&&(e.log.warn("Using dash options in videojs-contrib-dash without the set prefix has been deprecated. Change '"+t+"' to '"+r+"'"),t=r),i.mediaPlayer_.hasOwnProperty(t)?(Array.isArray(o)||(o=[o]),(n=i.mediaPlayer_)[t].apply(n,o)):e.log.warn("Warning: dash configuration option unrecognized: "+t)}}),this.mediaPlayer_.attachView(this.el_),a.dash&&a.dash.useTTML&&(this.ttmlContainer_=this.player.addChild("TTMLTextTrackDisplay"),this.mediaPlayer_.attachTTMLRenderingDiv(this.ttmlContainer_.el())),this.mediaPlayer_.setAutoPlay(!1),u.call(null,this.player,r),f.call(null,this.player,r,a),this.mediaPlayer_.setProtectionData(this.keySystemOptions_),this.mediaPlayer_.attachSource(o),this.tech_.triggerReady()}}t.buildDashJSProtData=function(t){var n={};if(!t||!Array.isArray(t))return null;for(var r=0;r<t.length;r++){var a=t[r],i=e.mergeOptions({},a.options);i.licenseUrl&&(i.serverURL=i.licenseUrl,delete i.licenseUrl),n[a.name]=i}return n};var n=t.prototype;return n.dispose=function(){this.mediaPlayer_&&(this.mediaPlayer_.off(_.MediaPlayer.events.ERROR,this.retriggerError_),this.mediaPlayer_.off(_.MediaPlayer.events.MANIFEST_LOADED,this.getDuration_),this.mediaPlayer_.reset()),this.player.dash&&delete this.player.dash,this.ttmlContainer_&&(this.ttmlContainer_.dispose(),this.player.removeChild("TTMLTextTrackDisplay"))},n.duration=function(){return this.mediaPlayer_.isDynamic()&&!this.hasFiniteDuration_?1/0:this.mediaPlayer_.duration()},t.hooks=function(e,n){return t.hooks_[e]=t.hooks_[e]||[],n&&(t.hooks_[e]=t.hooks_[e].concat(n)),t.hooks_[e]},t.hook=function(e,n){t.hooks(e,n)},t.removeHook=function(e,n){var r=t.hooks(e).indexOf(n);return-1!==r&&(t.hooks_[e]=t.hooks_[e].slice(),t.hooks_[e].splice(r,1),!0)},t}();R.hooks_={};var I=function(r){r=JSON.parse(JSON.stringify(r)),R.updateSourceData&&(e.log.warn('updateSourceData has been deprecated. Please switch to using hook("updatesource", callback).'),r=R.updateSourceData(r)),R.hooks("updatesource").forEach(function(e){r=e(r)});var a=n.createElement("video");return!(r.keySystemOptions&&!t.navigator.requestMediaKeySystemAccess&&!a.msSetMediaKeys)};return e.DashSourceHandler=function(){return{canHandleSource:function(t){var n=/\.mpd/i;return I(t)?e.DashSourceHandler.canPlayType(t.type)?"probably":n.test(t.src)?"maybe":"":""},handleSource:function(e,t,n){return new R(e,t,n)},canPlayType:function(t){return e.DashSourceHandler.canPlayType(t)}}},e.DashSourceHandler.canPlayType=function(e){var t=/^application\/dash\+xml/i;return t.test(e)?"probably":""},t.MediaSource&&e.getTech("Html5").registerSourceHandler(e.DashSourceHandler(),0),e.Html5DashJS=R,R});
