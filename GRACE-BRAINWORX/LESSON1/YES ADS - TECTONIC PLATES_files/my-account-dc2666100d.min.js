function initMyAccount(){if($("#edit-details").length&&displayOtherCareerInput(),$("#change-password").length&&$(".show-hide-password").on("click",function(e){e.preventDefault();var o=document.getElementById("old_password");"password"===o.type?(o.type="text",$(this).addClass("opacity-05")):(o.type="password",$(this).removeClass("opacity-05"))}),$("#my-downloads").length&&($("#my-downloads").on("change","#my-downloads-filter",function(){window.location=$(this).find("option:selected").data("url")}),$("#my-downloads").on("click","#clearSearch",function(e){e.preventDefault(),setTimeout(function(){location.reload()},2e3)})),$(".my-resource-alerts").length&&($("#overlay").hide(),$(".my-resource-alerts").on("click",".remove-alert-modal",function(e){e.preventDefault();var o=$(this).data("resource-id"),r=$(".resource-alerts").find("div[data-resource-id='"+o+"']"),a=r.find(".resource-title").html(),t=r.find(".resource-image").attr("src"),s=$("#remove-resource-alert-modal");s.find(".modal-resource-title").html(a),s.find(".modal-resource-image").prop("alt",a),s.find(".modal-resource-image").prop("src",t),s.find(".remove-alert").attr("data-resource-id",o),s.show(),s.center(),$("#overlay").show()}),$("#remove-resource-alert-modal").on("click",".close-option",function(e){e.preventDefault();var o=$("#remove-resource-alert-modal");o.hide(),$("#overlay").hide()}),$("#remove-resource-alert-modal").on("click",".remove-alert",function(){var e={},o=$(this).data("resource-id");e[o]=0,$("#remove-resource-alert-modal").find(".close-option").trigger("click");var r=$('<div title="Removing alert">Please wait...</div>');r.dialog({draggable:!1,modal:!0,resizable:!1,dialogClass:"no-close loadingDialog"}),$.post("/php/ajax/setMailingPref.php",{action:"updateResourceAlerts",lists:e},function(e){return r.dialog("close"),"success"!==e.message?void showDropDownMessage(e.message,!0):(showDropDownMessage("Your changes have been saved."),void setTimeout(function(){location.reload()},2e3))},"json")}),$(".my-resource-alerts").on("click",".pager_bar a",function(e){e.preventDefault(),getPaginationResults($(this))})),$("#recently-viewed-page").length){var e=getViewedFromLocalStorage();$.ajax({type:"POST",url:window.location.href,data:{action:"sendViewed",resources:e},success:function(e){var o=$("#resources-list");o.html(e)}}),$("#recently-viewed-page").on("click",".pager_bar a",function(e){e.preventDefault();var o=getViewedFromLocalStorage();getPaginationResults($(this),o)})}$("#saved-resources-page").length&&($("#overlay").hide(),setUpDraggableBookmarks(),setUpDroppableFolders(),setFoldersListAsSticky(),"undefined"!=typeof mCustomScrollbar&&$(".folder-menu").mCustomScrollbar({theme:"dark",scrollButtons:{enable:!0}}),$("#resource-select-all").change(function(){$("input[name='resource-select']").prop("checked",this.checked),toggleCheckboxSelection(this)}),$(".resources-area").on("click","input[name='resource-select']",function(){$(this).prop("checked",this.checked),toggleCheckboxSelection(this)}),$(".new-folder").on("click",function(e){e.preventDefault(),showModal($("#create-folder-modal"))}),$("#create-folder-modal").on("click",".confirm-edit-folder",function(e){e.preventDefault();var o=$("#create-folder-modal").find("#modal-folder-title").val();$.post(window.location.href,{action:"createFolder",folderName:o},function(e){return"success"!==e.message?void showDropDownMessage(e.message,!0):(showDropDownMessage("Your changes have been saved."),void setTimeout(function(){location.reload()},2e3))},"json")}),$("#create-folder-modal").on("click",".close-option",function(e){e.preventDefault(),closeModal($("#create-folder-modal"))}),$(".rename-folder").on("click",function(e){e.preventDefault();var o=$(this).data("folder-id"),r=$(this).data("folder-title"),a=$("#edit-folder-modal");a.find("#modal-folder-title").val(r),a.find(".confirm-edit-folder").attr("data-folder-id",o),showModal(a)}),$("#edit-folder-modal").on("click",".confirm-edit-folder",function(e){e.preventDefault();var o=$(this).data("folder-id"),r=$("#edit-folder-modal").find("#modal-folder-title").val();$.post(window.location.href,{action:"editFolder",folder:o,folderName:r},function(e){return"success"!==e.message?void showDropDownMessage(e.message,!0):(showDropDownMessage("Your changes have been saved."),void setTimeout(function(){location.reload()},2e3))},"json")}),$("#edit-folder-modal").on("click",".close-option",function(e){e.preventDefault(),closeModal($("#edit-folder-modal"))}),$(".folder-reminder").on("click",function(e){e.preventDefault(),$("#folder-reminder-modal").find("button.confirm").attr("data-folder-id",$(this).data("folder-id"));var o=$(this).data("folder-reminder"),r=$("#folder-reminder-modal").find(".existingReminder");r.hide(),o&&(r.find(".date").text($(this).data("folder-reminder")),r.show(),$("#folder-reminder-modal").find(".folderReminderDate").hide()),showModal($("#folder-reminder-modal"))}),$("#folder-reminder-modal").on("click",".close-option",function(e){e.preventDefault(),$("#folder-reminder-modal").find(".folderReminderDate").show(),closeModal($("#folder-reminder-modal"))}),$(".editBookmarkFolder.setReminder").submit(function(e){e.preventDefault();var o=$(this),r=o.find(".confirm"),a=$("#folderReminderDate_day").val();if(!a)return void apprise("Please choose a day!");var t=$("#folderReminderDate_month").val();if(!t)return void apprise("Please choose a month!");var s=$("#folderReminderDate_year").val();if(!s)return void apprise("Please choose a year!");var i,n=a+"/"+t+"/"+s;try{i=$.datepicker.parseDate("dd/mm/yy",n)}catch(e){return void apprise(n+" is not a valid date.")}var d=new Date;d.setFullYear(s,t-1,a);var c=new Date;if(d<=c)return void apprise("You must choose a date that is in the future.");var l=r.data("folder-id");$.post(window.location.href,{action:"setReminder",folder:l,day:a,month:t,year:s},function(e){return"success"!==e.message?void showDropDownMessage(e.message,!0):(showDropDownMessage("Your changes have been saved."),void setTimeout(function(){location.reload()},2e3))},"json")}),$(".delete-folder").on("click",function(e){e.preventDefault();var o=$(this).data("folder-id"),r=$(this).data("confirm-message");confirm(r)&&$.post(window.location.href,{action:"deleteFolder",folder:o},function(e){return"success"!==e.message?void showDropDownMessage(e.message,!0):(showDropDownMessage("Your changes have been saved."),void setTimeout(function(){var e=window.location.pathname.split("/");parseInt(e[e.length-1])===o?window.location="/my-saved-resources":location.reload()},2e3))},"json")}),$("#saved-resources-page").on("click",".pager_bar a",function(e){e.preventDefault();var o=$("#search-saved-resources").find('input[name="searchTerm"]').val();getPaginationResults($(this),"","saved",o)}),$("#search-saved-resources").on("submit",function(e){e.preventDefault();var o=1,r=$("#search-saved-resources"),a=r.find('input[name="searchTerm"]').val();searchSavedResources(a,o)}),$(".search-resources-icon").on("click",function(e){e.preventDefault(),$("#search-saved-resources").trigger("submit")}),$(".resources-area").on("click",'.move-resource[data-move-type="individual"]',function(e){e.preventDefault();var o=$("#view-folders-modal"),r=$(this).parent().parent();o.find(".resource-title").html(r.find(".resourceTitle").html()),o.find(".confirm-folders").attr("data-resource-id",r.data("resource-id")),o.find(".confirm-folders").attr("data-type-id",r.data("type-id")),showModal(o)}),$("#search-folders").on("submit",function(e){e.preventDefault();var o=$("#search-folders"),r=o.find('input[name="searchTerm"]').val();$.ajax({type:"POST",url:window.location,data:{action:"search-folders",searchTerm:r},success:function(e){$("#search-folders").find('input[name="searchTerm"]').val(r),$(".user-folders").html(e)}})}),$(".search-folders-icon").on("click",function(e){e.preventDefault(),$("#search-folders").trigger("submit")}),$("#view-folders-modal").on("click",".folder",function(e){e.preventDefault();var o=imageAssetBase+"/images/twinkl-icons/cross-circle-icon-grey.svg",r=imageAssetBase+"/images/twinkl-icons/check-circle-icon-green.svg",a=$(this);a.hasClass("selected")?(a.removeClass("selected"),a.find(".status-icon img").attr("src",o)):(a.addClass("selected"),a.find(".status-icon img").attr("src",r))}),$("#view-folders-modal").on("click",".confirm-folders",function(e){e.preventDefault();var o=[];$(".folder.selected").each(function(){var e={};e.itemId=$(".confirm-folders").attr("data-resource-id"),e.typeId=$(".confirm-folders").attr("data-type-id"),e.folderId=$(this).data("folder-id"),o.push(e)}),addSavedResourceToFolder(o,"individual")}),$("#view-folders-modal").on("click",".close-option",function(e){e.preventDefault(),removeSelectedFolders(),closeModal($("#view-folders-modal"))}),$(".resources-area").on("click",'.move-resource[data-move-type="bulk"]',function(e){e.preventDefault();var o=$(this).data("move-type"),r=$("#resources-choose-location").find(":selected").val();if(!r){var a=$("#resources-choose-location").data("missing-message");return void showDropDownMessage(a,!0)}var t=[];$("input[name='resource-select']").each(function(e,o){if($(o).is(":checked")){var a={};a.itemId=$(this).parent().parent().data("resource-id"),a.typeId=$(this).parent().parent().data("type-id"),a.folderId=r,t.push(a)}});var s=$(this).data("confirm-message");confirm(s)&&addSavedResourceToFolder(t,o)}),$(".resources-area").on("click",".delete-resource",function(e){e.preventDefault();var o=$(this).data("delete-type");if("bulk"===o&&0===$("input[name='resource-select']:checked").length){var r=$(this).data("missing-message");return void showDropDownMessage(r,!0)}var a=[];if("individual"===o){var t=$(this).parent().parent(),s=t.data("resource-id"),i=t.data("type-id"),n=t.data("folder-id");n||(n=0);var d={};d.itemId=s,d.typeId=i,d.folderId=n,a.push(d)}else $("input[name='resource-select']").each(function(e,o){if($(o).is(":checked")){var r={};r.itemId=$(this).parent().parent().data("resource-id"),r.typeId=$(this).parent().parent().data("type-id"),r.folderId=$(this).parent().parent().data("folder-id"),r.folderId||(r.folderId=0),a.push(r)}});var c=$(this).data("confirm-message");confirm(c)&&$.post(window.location.href,{action:"removeBookmark",data:a},function(e){return"success"!==e.message?void showDropDownMessage(e.message,!0):(showDropDownMessage("Your changes have been saved."),void setTimeout(function(){location.reload()},2e3))},"json")}),$("#saved-resources-page").on("click",".animate-menu",function(){var e=$("#main-page-content"),o=$(".sidebar-col");o.is(":visible")?(o.animate({width:"hide"}),e.removeClass(),e.addClass("col-12"),$(this).css("right",0),$(this).find(".showMenu").removeClass("hidden"),$(this).find(".hideMenu").addClass("hidden")):(o.animate({width:"show"}),e.removeClass(),e.addClass("col-12 col-lg-8 col-xl-9"),$(this).css("right",""),$(this).find(".hideMenu").removeClass("hidden"),$(this).find(".showMenu").addClass("hidden"))}))}function displayOtherCareerInput(){if($("#career").length){var e=$("#career"),o=e.attr("data-user-id"),r=$("#otherIdArray").val(),a=r.split(",");a.indexOf(e.val())>-1&&o?$("#career_other_field").slideDown("fast"):($("#career_other").val(""),$("#career_other_field").slideUp("fast"))}}function getViewedFromLocalStorage(){var e=localStorage.rh||"[]";e=JSON.parse(e).reverse();var o=[];return e.forEach(function(e){e.image&&e.title&&e.url&&o.push(e)}),o}function getPaginationResults(e,o,r,a){var t=e.attr("href"),s=t.match(/\d+$/);s&&(page=s[0]);var i={action:"paging",page:page};o&&(i.resources=o),a&&(i.searchTerm=a),$.ajax({type:"POST",url:window.location.href,data:i,success:function(e){if("saved"===r)$(".saved-resources-inner").html(e),$("html, body").animate({scrollTop:$(".resource-toolbar-options").offset().top},1e3);else{var o=$("#resources-list");o.html(e)}}})}function showModal(e){e.show(),e.center(),$("#overlay").show()}function closeModal(e){e.hide(),$("#overlay").hide()}function searchSavedResources(e,o){$.ajax({type:"POST",url:window.location,data:{action:"search",searchTerm:e,page:o},success:function(o){$("#search-saved-resources").find('input[name="searchTerm"]').val(e),$(".saved-resources-inner").html(o)}})}function toggleCheckboxSelection(e){e.checked===!0?$("#resources-choose-location").removeAttr("disabled"):0===$("input[name='resource-select']:checked").length&&$("#resources-choose-location").attr("disabled","disabled")}function setFoldersListAsSticky(){if(!$("body").hasClass("is-mobile-device")&&!$("body").hasClass("is-tablet-device")&&$(".folder-menu").length){var e=$(".folder-menu").offset().top;$(document).scroll(function(){var o="29";$(".sidebar-col").is(":visible")&&(o="22"),$(document).scrollTop()>e?$(".folder-menu").css({position:"fixed",top:"80px",width:o+"%"}):$(".folder-menu").css({position:"static",top:e+"px",width:"auto"})})}}function removeSelectedFolders(){var e=imageAssetBase+"/images/twinkl-icons/cross-circle-icon-grey.svg";$(".folder.selected").each(function(){$(this).removeClass("selected"),$(this).find(".status-icon img").attr("src",e)})}function addSavedResourceToFolder(e,o){$.post(window.location.href,{action:"addBookmarkToFolder",data:e},function(e){return"success"!==e.message?void showDropDownMessage(e.message,!0):(showDropDownMessage("Your changes have been saved."),void("individual"===o?(removeSelectedFolders(),closeModal($("#view-folders-modal"))):($("input[name='resource-select']:checked").trigger("click"),$("#resources-choose-location").prop("selectedIndex",0),$("#resources-choose-location").prop("disabled","disabled"))))},"json")}function setUpDraggableBookmarks(){var e=$("#saved-resources-page").find("#bookmarkList li");e&&e.draggable({cursorAt:{left:50,top:25},opacity:.5,refreshPositions:!0,zIndex:10009,appendTo:".cd-panel__content",helper:function(){return $('<img class="bookmark-drag-helper" src="'+$(this).find("a.resource-content").find("img").attr("src")+'" />')},drag:function(e,o){$(".bookmark-drag-clone").css({left:e.pageX,top:e.pageY})},start:function(e,o){$(".bookmark-drag-helper").clone().attr("class","bookmark-drag-clone").appendTo("body"),$(".bookmark-drag-helper").hide(),$(this).css("cursor","no-drop"),$(".folder-menu").find(".user-folder").find(".folder").addClass("highlight"),$("#bookmarkList").hasClass("resources")&&$(".folder-menu").hasClass("selected")},stop:function(e,o){$(this).css("cursor","initial"),$(".folder-menu").find(".user-folder").find(".folder").removeClass("highlight"),$(".bookmark-drag-clone").remove()}})}function setUpDroppableFolders(){var e=$("#saved-resources-page").find(".folder-menu").find(".user-folder").find(".folder");e.droppable({tolerance:"pointer",hoverClass:"hoverDrop",activeClass:"highlight",over:function(){$(".bookmark-drag-clone").css("cursor","copy")},out:function(){$(".bookmark-drag-clone").css("cursor","no-drop")},drop:function(e,o){var r=o.draggable.find("span.resourceTitle").text(),a=$(this).find(".folder-content a").text(),t=[],s={};s.itemId=o.draggable.attr("data-resource-id"),s.typeId=o.draggable.attr("data-type-id"),s.folderId=$(this).parent().attr("data-folder-id"),t.push(s),$.post(document.URL,{action:"addBookmarkToFolder",data:t},function(e){"success"!==e.message?showDropDownMessage(e.message,!0):showDropDownMessage("'"+r+"' has been added to '"+a+"'")},"json")}})}function initOneClickSwitchPopup(){$(".clickSwitchToAnnualOneClick").on("click",function(e){var o=$(this).data("modal");$("#overlay").show(),$(o).show()}),$("#switchToAnnualOneClick .dismiss-popup").on("click",function(e){$("#overlay").hide(),$("#switchToAnnualOneClick").hide()})}initOneClickSwitchPopup(),document.fn.events.on("last",function(){initMyAccount()});